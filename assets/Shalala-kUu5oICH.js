import{q as kn,m as H,u as Be,t as z,d as Cn,a as R,o as ae,p as Pn,w as pe,i as N,c as C,S as Ie,g as Sn,M as Ae,F as De,h as Mn,j as $n,f as se}from"./index-Bgo53qU8.js";import{I as _e,c as xn,C as Ee,p as Oe,d as qn,m as An,e as Dn,g as En}from"./chess_pgn_logic-C2oalU4H.js";const On=["white","black"],J=["a","b","c","d","e","f","g","h"],ee=["1","2","3","4","5","6","7","8"],Tn=[...ee].reverse(),ye=Array.prototype.concat(...J.map(e=>ee.map(n=>e+n))),P=e=>ye[8*e[0]+e[1]],m=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Fe=ye.map(m);function Nn(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const Kn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},ke=e=>e==="white"?"black":"white",U=(e,n)=>{const o=e[0]-n[0],t=e[1]-n[1];return o*o+t*t},ge=(e,n)=>e.role===n.role&&e.color===n.color,Y=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],D=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},Ve=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},Ce=(e,n)=>{e.style.visibility=n?"visible":"hidden"},B=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ze=e=>e.button===2,O=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Ge(e,n,o){const t=m(e);return n||(t[0]=7-t[0],t[1]=7-t[1]),[o.left+o.width*t[0]/8+o.width/16,o.top+o.height*(7-t[1])/8+o.height/16]}const j=(e,n)=>Math.abs(e-n),Wn=e=>(n,o,t,r)=>j(n,t)<2&&(e==="white"?r===o+1||o<=1&&r===o+2&&n===t:r===o-1||o>=6&&r===o-2&&n===t),Ue=(e,n,o,t)=>{const r=j(e,o),i=j(n,t);return r===1&&i===2||r===2&&i===1},Ye=(e,n,o,t)=>j(e,o)===j(n,t),Xe=(e,n,o,t)=>e===o||n===t,Qe=(e,n,o,t)=>Ye(e,n,o,t)||Xe(e,n,o,t),Ln=(e,n,o)=>(t,r,i,c)=>j(t,i)<2&&j(r,c)<2||o&&r===c&&r===(e==="white"?0:7)&&(t===4&&(i===2&&n.includes(0)||i===6&&n.includes(7))||n.includes(i));function Rn(e,n){const o=n==="white"?"1":"8",t=[];for(const[r,i]of e)r[1]===o&&i.color===n&&i.role==="rook"&&t.push(m(r)[0]);return t}function Je(e,n,o){const t=e.get(n);if(!t)return[];const r=m(n),i=t.role,c=i==="pawn"?Wn(t.color):i==="knight"?Ue:i==="bishop"?Ye:i==="rook"?Xe:i==="queen"?Qe:Ln(t.color,Rn(e,t.color),o);return Fe.filter(a=>(r[0]!==a[0]||r[1]!==a[1])&&c(r[0],r[1],a[0],a[1])).map(P)}function _(e,...n){e&&setTimeout(()=>e(...n),1)}function Hn(e){e.orientation=ke(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function jn(e,n){for(const[o,t]of n)t?e.pieces.set(o,t):e.pieces.delete(o)}function zn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,t]of e.pieces)t.role==="king"&&t.color===n&&(e.check=o)}function Bn(e,n,o,t){W(e),e.premovable.current=[n,o],_(e.premovable.events.set,n,o,t)}function K(e){e.premovable.current&&(e.premovable.current=void 0,_(e.premovable.events.unset))}function In(e,n,o){K(e),e.predroppable.current={role:n,key:o},_(e.predroppable.events.set,n,o)}function W(e){const n=e.predroppable;n.current&&(n.current=void 0,_(n.events.unset))}function Fn(e,n,o){if(!e.autoCastle)return!1;const t=e.pieces.get(n);if(!t||t.role!=="king")return!1;const r=m(n),i=m(o);if(r[1]!==0&&r[1]!==7||r[1]!==i[1])return!1;r[0]===4&&!e.pieces.has(o)&&(i[0]===6?o=P([7,i[1]]):i[0]===2&&(o=P([0,i[1]])));const c=e.pieces.get(o);return!c||c.color!==t.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),r[0]<i[0]?(e.pieces.set(P([6,i[1]]),t),e.pieces.set(P([5,i[1]]),c)):(e.pieces.set(P([2,i[1]]),t),e.pieces.set(P([3,i[1]]),c)),!0)}function en(e,n,o){const t=e.pieces.get(n),r=e.pieces.get(o);if(n===o||!t)return!1;const i=r&&r.color!==t.color?r:void 0;return o===e.selected&&S(e),_(e.events.move,n,o,i),Fn(e,n,o)||(e.pieces.set(o,t),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,_(e.events.change),i||!0}function Pe(e,n,o,t){if(e.pieces.has(o))if(t)e.pieces.delete(o);else return!1;return _(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,_(e.events.change),e.movable.dests=void 0,e.turnColor=ke(e.turnColor),!0}function nn(e,n,o){const t=en(e,n,o);return t&&(e.movable.dests=void 0,e.turnColor=ke(e.turnColor),e.animation.current=void 0),t}function on(e,n,o){if(Se(e,n,o)){const t=nn(e,n,o);if(t){const r=e.hold.stop();S(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return t!==!0&&(i.captured=t),_(e.movable.events.after,n,o,i),!0}}else if(Zn(e,n,o))return Bn(e,n,o,{ctrlKey:e.stats.ctrlKey}),S(e),!0;return S(e),!1}function tn(e,n,o,t){const r=e.pieces.get(n);r&&(Vn(e,n,o)||t)?(e.pieces.delete(n),Pe(e,r,o,t),_(e.movable.events.afterNewPiece,r.role,o,{premove:!1,predrop:!1})):r&&Gn(e,n,o)?In(e,r.role,o):(K(e),W(e)),e.pieces.delete(n),S(e)}function me(e,n,o){if(_(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){S(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&on(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(ln(e,n)||Me(e,n))&&(rn(e,n),e.hold.start())}function rn(e,n){e.selected=n,Me(e,n)?e.premovable.customDests||(e.premovable.dests=Je(e.pieces,n,e.premovable.castle)):e.premovable.dests=void 0}function S(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ln(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const Se=(e,n,o)=>{var t,r;return n!==o&&ln(e,n)&&(e.movable.free||!!(!((r=(t=e.movable.dests)===null||t===void 0?void 0:t.get(n))===null||r===void 0)&&r.includes(o)))};function Vn(e,n,o){const t=e.pieces.get(n);return!!t&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function Me(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function Zn(e,n,o){var t,r;const i=(r=(t=e.premovable.customDests)===null||t===void 0?void 0:t.get(n))!==null&&r!==void 0?r:Je(e.pieces,n,e.premovable.castle);return n!==o&&Me(e,n)&&i.includes(o)}function Gn(e,n,o){const t=e.pieces.get(n),r=e.pieces.get(o);return!!t&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function Un(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function Yn(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],t=n[1];let r=!1;if(Se(e,o,t)){const i=nn(e,o,t);if(i){const c={premove:!0};i!==!0&&(c.captured=i),_(e.movable.events.after,o,t,c),r=!0}}return K(e),r}function Xn(e,n){const o=e.predroppable.current;let t=!1;if(!o)return!1;if(n(o)){const r={role:o.role,color:e.movable.color};Pe(e,r,o.key)&&(_(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),t=!0)}return W(e),t}function $e(e){K(e),W(e),S(e)}function Te(e){e.movable.color=e.movable.dests=e.animation.current=void 0,$e(e)}function I(e,n,o){let t=Math.floor(8*(e[0]-o.left)/o.width);n||(t=7-t);let r=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(r=7-r),t>=0&&t<8&&r>=0&&r<8?P([t,r]):void 0}function Qn(e,n,o,t){const r=m(e),i=Fe.filter(l=>Qe(r[0],r[1],l[0],l[1])||Ue(r[0],r[1],l[0],l[1])),a=i.map(l=>Ge(P(l),o,t)).map(l=>U(n,l)),[,u]=a.reduce((l,d,s)=>l[0]<d?l:[d,s],[a[0],0]);return P(i[u])}const y=e=>e.orientation==="white",cn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Jn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},eo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function an(e){e==="start"&&(e=cn);const n=new Map;let o=7,t=0;for(const r of e)switch(r){case" ":case"[":return n;case"/":if(--o,o<0)return n;t=0;break;case"~":{const i=n.get(P([t-1,o]));i&&(i.promoted=!0);break}default:{const i=r.charCodeAt(0);if(i<57)t+=i-48;else{const c=r.toLowerCase();n.set(P([t,o]),{role:Jn[c],color:r===c?"black":"white"}),++t}}}return n}function no(e){return Tn.map(n=>J.map(o=>{const t=e.get(o+n);if(t){let r=eo[t.role];return t.color==="white"&&(r=r.toUpperCase()),t.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function sn(e,n){n.animation&&(xe(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function dn(e,n){var o,t,r;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((t=n.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),xe(e,n),n.fen&&(e.pieces=an(n.fen),e.drawable.shapes=((r=n.drawable)===null||r===void 0?void 0:r.shapes)||[]),"check"in n&&zn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&rn(e,e.selected),sn(e,n),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",c="e"+i,a=e.movable.dests.get(c),u=e.pieces.get(c);if(!a||!u||u.role!=="king")return;e.movable.dests.set(c,a.filter(l=>!(l==="a"+i&&a.includes("c"+i))&&!(l==="h"+i&&a.includes("g"+i))))}}function xe(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Ne(e[o])&&Ne(n[o])?xe(e[o],n[o]):e[o]=n[o])}function Ne(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const L=(e,n)=>n.animation.enabled?ro(e,n):T(e,n);function T(e,n){const o=e(n);return n.dom.redraw(),o}const de=(e,n)=>({key:e,pos:m(e),piece:n}),oo=(e,n)=>n.sort((o,t)=>U(e.pos,o.pos)-U(e.pos,t.pos))[0];function to(e,n){const o=new Map,t=[],r=new Map,i=[],c=[],a=new Map;let u,l,d;for(const[s,p]of e)a.set(s,de(s,p));for(const s of ye)u=n.pieces.get(s),l=a.get(s),u?l?ge(u,l.piece)||(i.push(l),c.push(de(s,u))):c.push(de(s,u)):l&&i.push(l);for(const s of c)l=oo(s,i.filter(p=>ge(s.piece,p.piece))),l&&(d=[l.pos[0]-s.pos[0],l.pos[1]-s.pos[1]],o.set(s.key,d.concat(d)),t.push(l.key));for(const s of i)t.includes(s.key)||r.set(s.key,s.piece);return{anims:o,fadings:r}}function un(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(n-o.start)*o.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const r=io(t);for(const i of o.plan.anims.values())i[2]=i[0]*r,i[3]=i[1]*r;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>un(e,i))}}function ro(e,n){const o=new Map(n.pieces),t=e(n),r=to(o,n);if(r.anims.size||r.fadings.size){const i=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:r},i||un(n,performance.now())}else n.dom.redraw();return t}const io=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,lo=["green","red","blue","yellow"];function co(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?S(e):$e(e);const o=B(n),t=I(o,y(e),e.dom.bounds());t&&(e.drawable.current={orig:t,pos:o,brush:fo(n),snapToValidMove:e.drawable.defaultSnapToValidMove},fn(e))}function fn(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=I(n.pos,y(e),e.dom.bounds());o||(n.snapToValidMove=!1);const t=n.snapToValidMove?Qn(n.orig,n.pos,y(e),e.dom.bounds()):o;t!==n.mouseSq&&(n.mouseSq=t,n.dest=t!==n.orig?t:void 0,e.dom.redrawNow()),fn(e)}})}function ao(e,n){e.drawable.current&&(e.drawable.current.pos=B(n))}function so(e){const n=e.drawable.current;n&&(n.mouseSq&&ho(e.drawable,n),hn(e))}function hn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function uo(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),pn(e.drawable))}function fo(e){var n;const o=(e.shiftKey||e.ctrlKey)&&Ze(e),t=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return lo[(o?1:0)+(t?2:0)]}function ho(e,n){const o=r=>r.orig===n.orig&&r.dest===n.dest,t=e.shapes.find(o);t&&(e.shapes=e.shapes.filter(r=>!o(r))),(!t||t.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),pn(e)}function pn(e){e.onChange&&e.onChange(e.shapes)}function po(e,n){if(!(e.trustAllEvents||n.isTrusted)||n.buttons!==void 0&&n.buttons>1||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),t=B(n),r=I(t,y(e),o);if(!r)return;const i=e.pieces.get(r),c=e.selected;if(!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!i||i.color!==e.turnColor)&&uo(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||i||c||go(e,t)))n.preventDefault();else if(n.touches)return;const a=!!e.premovable.current,u=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&Se(e,e.selected,r)?L(s=>me(s,r),e):me(e,r);const l=e.selected===r,d=mn(e,r);if(i&&d&&l&&Un(e,r)){e.draggable.current={orig:r,piece:i,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:d,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},d.cgDragging=!0,d.classList.add("dragging");const s=e.dom.elements.ghost;s&&(s.className=`ghost ${i.color} ${i.role}`,D(s,Y(o)(m(r),y(e))),Ce(s,!0)),qe(e)}else a&&K(e),u&&W(e);e.dom.redraw()}function go(e,n){const o=y(e),t=e.dom.bounds(),r=Math.pow(t.width/8,2);for(const i of e.pieces.keys()){const c=Ge(i,o,t);if(U(c,n)<=r)return!0}return!1}function mo(e,n,o,t){const r="a0";e.pieces.set(r,n),e.dom.redraw();const i=B(o);e.draggable.current={orig:r,piece:n,origPos:i,pos:i,started:!0,element:()=>mn(e,r),originTarget:o.target,newPiece:!0,force:!!t,keyHasChanged:!1},qe(e)}function qe(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const t=e.pieces.get(o.orig);if(!t||!ge(t,o.piece))ne(e);else if(!o.started&&U(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const i=o.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),o.element=i}const r=e.dom.bounds();D(o.element,[o.pos[0]-r.left-r.width/16,o.pos[1]-r.top-r.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==I(o.pos,y(e),r))}qe(e)})}function vo(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=B(n))}function bo(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}K(e),W(e);const t=B(n)||o.pos,r=I(t,y(e),e.dom.bounds());r&&o.started&&o.orig!==r?o.newPiece?tn(e,o.orig,r,o.force):(e.stats.ctrlKey=n.ctrlKey,on(e,o.orig,r)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(o.orig),_(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===r||!r)?S(e):e.selectable.enabled||S(e),gn(e),e.draggable.current=void 0,e.dom.redraw()}function ne(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,S(e),gn(e),e.dom.redraw())}function gn(e){const n=e.dom.elements;n.ghost&&Ce(n.ghost,!1)}function mn(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function wo(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{Ke(e,2),setTimeout(()=>Ke(e,void 0),120)},120)}function Ke(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function _o(e,n){function o(){Hn(e),n()}return{set(t){t.orientation&&t.orientation!==e.orientation&&o(),sn(e,t),(t.fen?L:T)(r=>dn(r,t),e)},state:e,getFen:()=>no(e.pieces),toggleOrientation:o,setPieces(t){L(r=>jn(r,t),e)},selectSquare(t,r){t?L(i=>me(i,t,r),e):e.selected&&(S(e),e.dom.redraw())},move(t,r){L(i=>en(i,t,r),e)},newPiece(t,r){L(i=>Pe(i,t,r),e)},playPremove(){if(e.premovable.current){if(L(Yn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const r=Xn(e,t);return e.dom.redraw(),r}return!1},cancelPremove(){T(K,e)},cancelPredrop(){T(W,e)},cancelMove(){T(t=>{$e(t),ne(t)},e)},stop(){T(t=>{Te(t),ne(t)},e)},explode(t){wo(e,t)},setAutoShapes(t){T(r=>r.drawable.autoShapes=t,e)},setShapes(t){T(r=>r.drawable.shapes=t,e)},getKeyAtDomPos(t){return I(t,y(e),e.dom.bounds())},redrawAll:n,dragNewPiece(t,r,i){mo(e,t,r,i)},destroy(){Te(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function yo(){return{pieces:an(cn),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:Kn()}}const We={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function ko(){const e=b("defs"),n=w(b("filter"),{id:"cg-filter-blur"});return n.appendChild(w(b("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(n),e}function Co(e,n,o){var t;const r=e.drawable,i=r.current,c=i&&i.mouseSq?i:void 0,a=new Map,u=e.dom.bounds(),l=r.autoShapes.filter(h=>!h.piece);for(const h of r.shapes.concat(l).concat(c?[c]:[])){if(!h.dest)continue;const g=(t=a.get(h.dest))!==null&&t!==void 0?t:new Set,f=re(te(m(h.orig),e.orientation),u),$=re(te(m(h.dest),e.orientation),u);g.add(be(f,$)),a.set(h.dest,g)}const d=r.shapes.concat(l).map(h=>({shape:h,current:!1,hash:Le(h,ve(h.dest,a),!1,u)}));c&&d.push({shape:c,current:!0,hash:Le(c,ve(c.dest,a),!0,u)});const s=d.map(h=>h.hash).join(";");if(s===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=s;const p=n.querySelector("defs");Po(r,d,p),So(d,n.querySelector("g"),o.querySelector("g"),h=>xo(e,h,r.brushes,a,u))}function Po(e,n,o){var t;const r=new Map;let i;for(const u of n.filter(l=>l.shape.dest&&l.shape.brush))i=vn(e.brushes[u.shape.brush],u.shape.modifiers),!((t=u.shape.modifiers)===null||t===void 0)&&t.hilite&&r.set(oe(i).key,oe(i)),r.set(i.key,i);const c=new Set;let a=o.firstElementChild;for(;a;)c.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[u,l]of r.entries())c.has(u)||o.appendChild(Do(l))}function So(e,n,o,t){const r=new Map;for(const i of e)r.set(i.hash,!1);for(const i of[n,o]){const c=[];let a=i.firstElementChild,u;for(;a;)u=a.getAttribute("cgHash"),r.has(u)?r.set(u,!0):c.push(a),a=a.nextElementSibling;for(const l of c)i.removeChild(l)}for(const i of e.filter(c=>!r.get(c.hash)))for(const c of t(i))c.isCustom?o.appendChild(c.el):n.appendChild(c.el)}function Le({orig:e,dest:n,brush:o,piece:t,modifiers:r,customSvg:i,label:c},a,u,l){var d,s;return[l.width,l.height,u,e,n,o,a&&"-",t&&Mo(t),r&&$o(r),i&&`custom-${Re(i.html)},${(s=(d=i.center)===null||d===void 0?void 0:d[0])!==null&&s!==void 0?s:"o"}`,c&&`label-${Re(c.text)}`].filter(p=>p).join(",")}function Mo(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function $o(e){return[e.lineWidth,e.hilite&&"*"].filter(n=>n).join(",")}function Re(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return n.toString()}function xo(e,{shape:n,current:o,hash:t},r,i,c){var a,u;const l=re(te(m(n.orig),e.orientation),c),d=n.dest?re(te(m(n.dest),e.orientation),c):l,s=n.brush&&vn(r[n.brush],n.modifiers),p=i.get(n.dest),h=[];if(s){const g=w(b("g"),{cgHash:t});h.push({el:g}),l[0]!==d[0]||l[1]!==d[1]?g.appendChild(Ao(n,s,l,d,o,ve(n.dest,i))):g.appendChild(qo(r[n.brush],l,o,c))}if(n.label){const g=n.label;(a=g.fill)!==null&&a!==void 0||(g.fill=n.brush&&r[n.brush].color);const f=n.brush?void 0:"tr";h.push({el:Eo(g,t,l,d,p,f),isCustom:!0})}if(n.customSvg){const g=(u=n.customSvg.center)!==null&&u!==void 0?u:"orig",[f,$]=g==="label"?wn(l,d,p).map(k=>k-.5):g==="dest"?d:l,M=w(b("g"),{transform:`translate(${f},${$})`,cgHash:t});M.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${n.customSvg.html}</svg>`,h.push({el:M,isCustom:!0})}return h}function qo(e,n,o,t){const r=Oo(),i=(t.width+t.height)/(4*Math.max(t.width,t.height));return w(b("circle"),{stroke:e.color,"stroke-width":r[o?0:1],fill:"none",opacity:bn(e,o),cx:n[0],cy:n[1],r:i-r[1]/2})}function oe(e){return["#ffffff","#fff","white"].includes(e.color)?We.hilitePrimary:We.hiliteWhite}function Ao(e,n,o,t,r,i){var c;function a(d){var s;const p=No(i&&!r),h=t[0]-o[0],g=t[1]-o[1],f=Math.atan2(g,h),$=Math.cos(f)*p,M=Math.sin(f)*p;return w(b("line"),{stroke:d?oe(n).color:n.color,"stroke-width":To(n,r)+(d?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${d?oe(n).key:n.key})`,opacity:!((s=e.modifiers)===null||s===void 0)&&s.hilite?1:bn(n,r),x1:o[0],y1:o[1],x2:t[0]-$,y2:t[1]-M})}if(!(!((c=e.modifiers)===null||c===void 0)&&c.hilite))return a(!1);const u=b("g"),l=w(b("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(Ko(o,t)),l.appendChild(a(!0)),u.appendChild(l),u.appendChild(a(!1)),u}function Do(e){const n=w(b("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return n.appendChild(w(b("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function Eo(e,n,o,t,r,i){var c;const u=.4*.75**e.text.length,l=wn(o,t,r),d=i==="tr"?.4:0,s=w(b("g"),{transform:`translate(${l[0]+d},${l[1]-d})`,cgHash:n});s.appendChild(w(b("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:(c=e.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const p=w(b("text"),{"font-size":u,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return p.innerHTML=e.text,s.appendChild(p),s}function te(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function ve(e,n){return(e&&n.has(e)&&n.get(e).size>1)===!0}function b(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function w(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function vn(e,n){return n?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}:e}function Oo(){return[3/64,4/64]}function To(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function bn(e,n){return(e.opacity||1)*(n?.9:1)}function No(e){return(e?20:10)/64}function re(e,n){const o=Math.min(1,n.width/n.height),t=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*t]}function Ko(e,n){const o={from:[Math.floor(Math.min(e[0],n[0])),Math.floor(Math.min(e[1],n[1]))],to:[Math.ceil(Math.max(e[0],n[0])),Math.ceil(Math.max(e[1],n[1]))]};return w(b("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function be(e,n,o=!0){const t=Math.atan2(n[1]-e[1],n[0]-e[0])+Math.PI;return o?(Math.round(t*8/Math.PI)+16)%16:t}function Wo(e,n){return Math.sqrt([e[0]-n[0],e[1]-n[1]].reduce((o,t)=>o+t*t,0))}function wn(e,n,o){let t=Wo(e,n);const r=be(e,n,!1);if(o&&(t-=33/64,o.size>1)){t-=10/64;const i=be(e,n);(o.has((i+1)%16)||o.has((i+15)%16))&&i&1&&(t-=.4)}return[e[0]-Math.cos(r)*t,e[1]-Math.sin(r)*t].map(i=>i+.5)}function Lo(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const u of On)e.classList.toggle("orientation-"+u,n.orientation===u);e.classList.toggle("manipulable",!n.viewOnly);const o=O("cg-container");e.appendChild(o);const t=O("cg-board");o.appendChild(t);let r,i,c;if(n.drawable.visible&&(r=w(b("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(ko()),r.appendChild(b("g")),i=w(b("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(b("g")),c=O("cg-auto-pieces"),o.appendChild(r),o.appendChild(i),o.appendChild(c)),n.coordinates){const u=n.orientation==="black"?" black":"",l=n.ranksPosition==="left"?" left":"";if(n.coordinatesOnSquares){const d=n.orientation==="white"?s=>s+1:s=>8-s;J.forEach((s,p)=>o.appendChild(ue(ee.map(h=>s+h),"squares rank"+d(p)+u+l)))}else o.appendChild(ue(ee,"ranks"+u+l)),o.appendChild(ue(J,"files"+u))}let a;return n.draggable.enabled&&n.draggable.showGhost&&(a=O("piece","ghost"),Ce(a,!1),o.appendChild(a)),{board:t,container:o,wrap:e,ghost:a,svg:r,customSvg:i,autoPieces:c}}function ue(e,n){const o=O("coords",n);let t;for(const r of e)t=O("coord"),t.textContent=r,o.appendChild(t);return o}function Ro(e,n){if(!e.dropmode.active)return;K(e),W(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const t=B(n),r=t&&I(t,y(e),e.dom.bounds());r&&tn(e,"a0",r)}e.dom.redraw()}function Ho(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",r=>r.preventDefault()),e.viewOnly)return;const t=zo(e);o.addEventListener("touchstart",t,{passive:!1}),o.addEventListener("mousedown",t,{passive:!1})}function jo(e,n){const o=[];if("ResizeObserver"in window||o.push(Z(document.body,"chessground.resize",n)),!e.viewOnly){const t=He(e,vo,ao),r=He(e,bo,so);for(const c of["touchmove","mousemove"])o.push(Z(document,c,t));for(const c of["touchend","mouseup"])o.push(Z(document,c,r));const i=()=>e.dom.bounds.clear();o.push(Z(document,"scroll",i,{capture:!0,passive:!0})),o.push(Z(window,"resize",i,{passive:!0}))}return()=>o.forEach(t=>t())}function Z(e,n,o,t){return e.addEventListener(n,o,t),()=>e.removeEventListener(n,o,t)}const zo=e=>n=>{e.draggable.current?ne(e):e.drawable.current?hn(e):n.shiftKey||Ze(n)?e.drawable.enabled&&co(e,n):e.viewOnly||(e.dropmode.active?Ro(e,n):po(e,n))},He=(e,n,o)=>t=>{e.drawable.current?e.drawable.enabled&&o(e,t):e.viewOnly||n(e,t)};function Bo(e){const n=y(e),o=Y(e.dom.bounds()),t=e.dom.elements.board,r=e.pieces,i=e.animation.current,c=i?i.plan.anims:new Map,a=i?i.plan.fadings:new Map,u=e.draggable.current,l=Fo(e),d=new Set,s=new Set,p=new Map,h=new Map;let g,f,$,M,k,F,le,x,ce,X;for(f=t.firstChild;f;){if(g=f.cgKey,_n(f))if($=r.get(g),k=c.get(g),F=a.get(g),M=f.cgPiece,f.cgDragging&&(!u||u.orig!==g)&&(f.classList.remove("dragging"),D(f,o(m(g),n)),f.cgDragging=!1),!F&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),$){if(k&&f.cgAnimating&&M===G($)){const v=m(g);v[0]+=k[2],v[1]+=k[3],f.classList.add("anim"),D(f,o(v,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),D(f,o(m(g),n)),e.addPieceZIndex&&(f.style.zIndex=fe(m(g),n)));M===G($)&&(!F||!f.cgFading)?d.add(g):F&&M===G(F)?(f.classList.add("fading"),f.cgFading=!0):he(p,M,f)}else he(p,M,f);else if(yn(f)){const v=f.className;l.get(g)===v?s.add(g):he(h,v,f)}f=f.nextSibling}for(const[v,V]of l)if(!s.has(v)){ce=h.get(V),X=ce&&ce.pop();const q=o(m(v),n);if(X)X.cgKey=v,D(X,q);else{const A=O("square",V);A.cgKey=v,D(A,q),t.insertBefore(A,t.firstChild)}}for(const[v,V]of r)if(k=c.get(v),!d.has(v))if(le=p.get(G(V)),x=le&&le.pop(),x){x.cgKey=v,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const q=m(v);e.addPieceZIndex&&(x.style.zIndex=fe(q,n)),k&&(x.cgAnimating=!0,x.classList.add("anim"),q[0]+=k[2],q[1]+=k[3]),D(x,o(q,n))}else{const q=G(V),A=O("piece",q),Q=m(v);A.cgPiece=q,A.cgKey=v,k&&(A.cgAnimating=!0,Q[0]+=k[2],Q[1]+=k[3]),D(A,o(Q,n)),e.addPieceZIndex&&(A.style.zIndex=fe(Q,n)),t.appendChild(A)}for(const v of p.values())ze(e,v);for(const v of h.values())ze(e,v)}function Io(e){const n=y(e),o=Y(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(_n(t)&&!t.cgAnimating||yn(t))&&D(t,o(m(t.cgKey),n)),t=t.nextSibling}function je(e){var n,o;const t=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,i=t.height/t.width,c=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=c*i;r.style.width=c+"px",r.style.height=a+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-width",c+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("---cg-height",a+"px")}const _n=e=>e.tagName==="PIECE",yn=e=>e.tagName==="SQUARE";function ze(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function fe(e,n){const t=e[1];return`${n?10-t:3+t}`}const G=e=>`${e.color} ${e.role}`;function Fo(e){var n,o,t;const r=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)E(r,a,"last-move");if(e.check&&e.highlight.check&&E(r,e.check,"check"),e.selected&&(E(r,e.selected,"selected"),e.movable.showDests)){const a=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(a)for(const l of a)E(r,l,"move-dest"+(e.pieces.has(l)?" oc":""));const u=(t=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(e.selected))!==null&&t!==void 0?t:e.premovable.dests;if(u)for(const l of u)E(r,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const i=e.premovable.current;if(i)for(const a of i)E(r,a,"current-premove");else e.predroppable.current&&E(r,e.predroppable.current.key,"current-premove");const c=e.exploding;if(c)for(const a of c.keys)E(r,a,"exploding"+c.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,u)=>{E(r,u,a)}),r}function E(e,n,o){const t=e.get(n);t?e.set(n,`${t} ${o}`):e.set(n,o)}function he(e,n,o){const t=e.get(n);t?t.push(o):e.set(n,[o])}function Vo(e,n,o){const t=new Map,r=[];for(const a of e)t.set(a.hash,!1);let i=n.firstElementChild,c;for(;i;)c=i.getAttribute("cgHash"),t.has(c)?t.set(c,!0):r.push(i),i=i.nextElementSibling;for(const a of r)n.removeChild(a);for(const a of e)t.get(a.hash)||n.appendChild(o(a))}function Zo(e,n){const t=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:Yo(r),current:!1}));Vo(t,n,r=>Uo(e,r,e.dom.bounds()))}function Go(e){var n;const o=y(e),t=Y(e.dom.bounds());let r=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;r;)Ve(r,t(m(r.cgKey),o),r.cgScale),r=r.nextSibling}function Uo(e,{shape:n,hash:o},t){var r,i,c;const a=n.orig,u=(r=n.piece)===null||r===void 0?void 0:r.role,l=(i=n.piece)===null||i===void 0?void 0:i.color,d=(c=n.piece)===null||c===void 0?void 0:c.scale,s=O("piece",`${u} ${l}`);return s.setAttribute("cgHash",o),s.cgKey=a,s.cgScale=d,Ve(s,Y(t)(m(a),y(e)),d),s}const Yo=e=>{var n,o,t;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")};function Xo(e,n){const o=yo();dn(o,n||{});function t(){const r="dom"in o?o.dom.unbind:void 0,i=Lo(e,o),c=Nn(()=>i.board.getBoundingClientRect()),a=d=>{Bo(l),i.autoPieces&&Zo(l,i.autoPieces),!d&&i.svg&&Co(l,i.svg,i.customSvg)},u=()=>{je(l),Io(l),i.autoPieces&&Go(l)},l=o;return l.dom={elements:i,bounds:c,redraw:Qo(a),redrawNow:a,unbind:r},l.drawable.prevSvgHash="",je(l),a(!1),Ho(l,u),r||(l.dom.unbind=jo(l,u)),l.events.insert&&l.events.insert(i),l}return _o(t(),t)}function Qo(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}var Jo=z('<div class="is2d chessboard">');const et=e=>{let n,o;return kn(()=>{let t=e.color,r=e.dests,i={premovable:{enabled:!1},movable:{color:t,free:!1,dests:r,events:{after:e.onMoveAfter}}};o=Xo(n,i)}),H(()=>{let t,r;e.fen_uci?[t,r]=e.fen_uci:t=_e;let i=[];r&&(i.push(r.slice(0,2)),i.push(r.slice(2,4)));let c=e.movable?e.color:void 0;o.set({fen:t,lastMove:i,turnColor:e.color,movable:{color:c,dests:e.dests}})}),H(()=>{let t=e.orientation??"white";o.set({orientation:t})}),H(()=>{let t=e.doPromotion;if(t){let r=o.state.pieces.get(t);o.setPieces(new Map([[t,{color:r.color,role:"queen",promoted:!0}]]))}}),(()=>{var t=Jo();return Be(r=>n=r,t),t})()};var nt=z("<div class=chesstree>"),ot=z("<div class=lines>"),tt=z("<div class=line>"),rt=z("<span class=index>"),it=z("<div>");const lt=e=>{let n=e.before_fen??_e,[o,t]=R([],{equals:!1}),[r,i]=R(void 0,{equals:!1});H(()=>{let l=e.pgn;l&&(i(l),a([]))});const c=()=>r()?.root,a=l=>{let d=ae(()=>r());if(d){let s=d.get_at(l);if(s){let p=s.after_fen,h=s.uci;e.on_set_fen_uci(p,h),t(s.path)}}};H(Pn(()=>e.on_wheel,l=>{if(l){let d=o();if(l<0)d.length>1&&a(d.slice(0,-1));else{let s=r();if(s){let h=s._traverse_path(d)?.children[0]?.data.path;h&&a(h)}}}})),H(()=>{let l=e.add_uci;if(!l)return;let d=ae(()=>r()),s=ae(()=>o());d?d.append_uci(l,s):d=xn.make(n,[l]),s=[...s,l],pe(()=>{i(d),t(s)})});let u;return H(()=>{let l=o(),d=u.parentElement;if(!d)return;const s=u.querySelector(".on_path_end");if(!s){d.scrollTop=l.length>0?99999:0;return}let p=s.offsetTop-d.offsetHeight/2+s.offsetHeight;d.scrollTo({behavior:"smooth",top:p})}),(()=>{var l=nt();return Be(d=>u=d,l),N(l,C(Ie,{get when(){return c()},get fallback(){return[]},children:d=>C(we,{on_set_path:a,get cursor_path(){return o()},get lines(){return[d()]}})})),l})()},we=e=>C(De,{get each(){return e.lines},children:n=>[C(ct,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},get data(){return n.data},get show_index(){return e.show_index}}),C(Sn,{get children(){return[C(Ae,{get when(){return n.children.length===1},get children(){return C(we,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},get lines(){return n.children}})}}),C(Ae,{get when(){return n.children.length>1},get children(){var o=ot();return N(o,C(De,{get each(){return n.children},children:t=>(()=>{var r=tt();return N(r,C(we,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},lines:[t],show_index:!0})),r})()})),o}})]}})]}),ct=e=>{let n=`${Math.ceil(e.data.ply/2)}.`;e.data.ply%2===0&&(n+="..");let o=()=>e.cursor_path.join("").startsWith(e.data.path.join("")),t=()=>e.cursor_path.join("")===e.data.path.join(""),r=()=>["move",t()?"on_path_end":o()?"on_path":""].join(" ");return(()=>{var i=it();return i.$$click=()=>e.on_set_path(e.data.path),N(i,C(Ie,{get when(){return e.show_index||e.data.ply&1},get children(){var c=rt();return N(c,n),c}}),null),N(i,()=>e.data.san,null),Mn(()=>$n(i,r())),i})()};Cn(["click"]);var at=z("<div class=shalala><div class=chessboard-wrap></div><div class=chesstree-wrap><div class=chesstree-v>");class ie{static init=()=>new ie;get position(){return this._position[0]()}set position(n){this._position[1](n)}get turnColor(){return this.m_color()}get promotion(){return this._promotion[0]()}set promotion(n){this._promotion[1](n)}get add_uci(){return this._add_uci[0]()}set add_uci(n){this._add_uci[1](n)}get last_move(){return this._last_move[0]()}set last_move(n){this._last_move[1](n)}_add_uci;_promotion;_position;m_fen;m_dests;m_color;_last_move;constructor(){this._on_wheel=R(void 0,{equals:!1}),this._last_move=R(void 0,{equals:!1}),this._add_uci=R(void 0,{equals:!1}),this._promotion=R(void 0,{equals:!1}),this._position=R(Ee.fromSetup(Oe(_e).unwrap()).unwrap(),{equals:!1}),this.m_dests=se(()=>qn(this.position)),this.m_fen=se(()=>An(this.position.toSetup())),this.m_color=se(()=>this.position.turn)}_on_wheel;set_on_wheel=n=>{this._on_wheel[1](n)};get on_wheel(){return this._on_wheel[0]()}on_set_fen_uci=(n,o)=>{pe(()=>{this.add_uci=void 0,this.last_move=o,this.position=Ee.fromSetup(Oe(n).unwrap()).unwrap()})};reset_move_after=()=>{this.position=this.position};on_move_after=(n,o)=>{let t=this.position.board.get(Dn(n)),r=n+o;t.role==="pawn"&&(o[1]==="8"&&this.turnColor==="white"||o[1]==="1"&&this.turnColor==="black")&&(r+="q"),this.position.play(En(r)),pe(()=>{this.last_move=r,this.position=this.position,r.length===5&&(this.promotion=o),this.add_uci=r})};get fen_uci(){let n=this.fen,o=this.last_move;return[n,o]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}}const st=()=>{let e=ie.init();const n=o=>{const t=o.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(o.preventDefault(),e.set_on_wheel(Math.sign(o.deltaY)))};return(()=>{var o=at(),t=o.firstChild,r=t.nextSibling,i=r.firstChild;return o.addEventListener("wheel",n),N(t,C(et,{movable:!0,get doPromotion(){return e.promotion},get onMoveAfter(){return e.on_move_after},get fen_uci(){return e.fen_uci},get color(){return e.turnColor},get dests(){return e.dests}})),N(i,C(lt,{get on_wheel(){return e.on_wheel},get add_uci(){return e.add_uci},get on_set_fen_uci(){return e.on_set_fen_uci}})),o})()},ft=Object.freeze(Object.defineProperty({__proto__:null,Shala:ie,default:st},Symbol.toStringTag,{value:"Module"}));export{et as C,ie as S,ft as a,ke as o};
