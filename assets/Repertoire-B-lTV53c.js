var je=Object.defineProperty;var Le=(m,r,a)=>r in m?je(m,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[r]=a;var T=(m,r,a)=>(Le(m,typeof r!="symbol"?r+"":r,a),a);import{h as Ie,j as Oe,i as h,c as d,S,k as Ye,l as C,b as p,m as $,n as b,o as y,p as pe,q as ve,r as Ae,f as N,g as R,F as V,s as F,M as L,e as Ne,v as Fe,d as Ge,t as l,w as k}from"./index-BTaSn_6n.js";/* empty css                   */import{S as We}from"./studyrepo-D-IyOdvq.js";import{S as Be,C as He}from"./Shalala-CqbIXUv1.js";import{T as Ke,a as X,C as Ue}from"./Chesstree2-jRXpwtnQ.js";import{M as Je,I as Ve}from"./chess_pgn_logic-C_jzwARE.js";import{S as Xe,O as ge}from"./SessionStore-D7Yec2K5.js";import{s as Ze}from"./scroll-DnAhRpRC.js";var et=l("<div class=progress><div class=bar></div><h3>"),tt=l("<div class=repertoire-wrap>"),fe=l("<small> Click on variations to expand. "),rt=l("<small> Your goal is to guess every move correctly to pass the quiz. "),st=l("<h2>Select a Quiz Option"),at=l("<button><span> Take Quiz "),lt=l("<button><span> Play Deathmatch "),it=l("<h2>Deathmatch Mode"),$e=l("<span class=passed>passed"),_t=l("<small> Deathmatch "),nt=l("<small> Your score: "),ze=l("<small> Progress +<!>% "),ot=l("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),ct=l("<h2>Quiz Mode"),ht=l("<small> Quiz "),ut=l("<small> Your score: <!> out of 15 correct"),dt=l("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),mt=l("<small> Your goal is to guess every move correctly to fill up the progress bar. "),pt=l("<h2>Select a Practice Option"),vt=l("<button><span> Play all Moves "),gt=l("<button><span> Play as Match "),ft=l("<h2>Play as Match"),qe=l("<small> End of practice. "),be=l("<small> Congratulations. "),$t=l("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),zt=l("<h2>Play all moves"),qt=l("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),bt=l("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),wt=l("<li><div><h3></h3> "),kt=l('<div class=line><span class="fill white"></span><span class="fill black">'),yt=l("<span class=index>"),St=l("<div class=fbt>"),Ct=l("<small>You will play the moves from the opening."),xt=l("<small>If you go out of book, game ends."),Mt=l("<div class=in_mode><button class=end2><span> End Deathmatch "),we=l("<span class=failed>failed"),Pt=l("<small>You are given 15 random positions from the opening."),Et=l("<small>Guess the correct move."),Tt=l("<h2> of 15"),Rt=l("<div class=in_mode><button class=end2><span> End Quiz "),Dt=l("<small> Try to guess the moves for <!>."),Qt=l("<small> AI will play the next move, picking a random variation. "),jt=l("<small> Moves will be hidden once the game is started. "),Lt=l("<small>Try to guess the moves for both sides."),It=l("<small>Moves will be hidden once you start.");const Ot=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Yt=m=>Ot[Math.floor((1-m/10)*6)],At=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Nt{constructor(){T(this,"_mode");T(this,"_match_color");T(this,"_practice_end_result");T(this,"_quiz_quiz_ls");T(this,"_quiz_deathmatch_fail");T(this,"_quiz_deathmatch_result_path");this._mode=C(void 0,{equals:!1}),this._match_color=C("white"),this._quiz_quiz_ls=C([],{equals:!1}),this._quiz_deathmatch_fail=C(0),this._quiz_deathmatch_result_path=C([]),this._practice_end_result=C(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){k(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){k(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){k(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){k(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){k(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){k(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){k(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const ke=m=>(()=>{var r=et(),a=r.firstChild,u=a.nextSibling;return h(u,()=>`%${m.width}`),N(c=>F(a,`width: ${m.width}%`,c)),r})();class Ft{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(a=>Math.round(a.progress/r)).reduce((a,u)=>a+u)}}class D{constructor(r,a,u,c){this.study_id=r,this.i_chapter=a,this.score_tree=u,this.solved_paths=c}static load_from_store(r,a){let u=new ge(r.id,a);return D.make(r.id,a,r.chapters[a].pgn.tree,X.set_for_saving(u.solved_paths))}static save_paths_to_store(r){let a=new ge(r.study_id,r.i_chapter);a.solved_paths=r.solved_paths.get_for_saving(),a.practice_progress=r.progress}static make(r,a,u,c=new X){return new D(r,a,Je.make(u),c)}get clone(){return new D(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>b(()=>{var a;return(a=this.score_tree.get_at(r))==null?void 0:a.score})??0).reduce((r,a)=>r+a,0)*100)}get progress_map(){let r=b(()=>this.score_tree.progress_paths);const a=b(()=>r.map(u=>[u.filter(c=>c.length%2===1).map(c=>this.score_tree.get_at(c).score).reduce((c,t)=>c+t,0),u.filter(c=>c.length%2===0).map(c=>this.score_tree.get_at(c).score).reduce((c,t)=>c+t,0)]));return r.map((u,c)=>{let t=u[0],f=u[u.length-1],x=a[c][0],G=a[c][1],I=p(()=>this.solved_paths.paths),Q=p(()=>I().filter(v=>u.some(q=>q.join("")===v.join("")))),O=p(()=>Q().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,q)=>v+q,0)),_=p(()=>Q().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,q)=>v+q,0));return{color:Yt(t.length/20+f.length/10),total:x*2,black:p(()=>_()/G),white:p(()=>O()/x),path:f}}).reverse()}clone_merge_stats(r){let a=b(()=>this.clone);return a.solved_paths.merge_dup(r.solved_paths),a}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){D.save_paths_to_store(this)}}const er=()=>{const m=Ie(),[r]=Oe(m.id,We.read_study);return(()=>{var a=tt();return h(a,d(S,{get when(){return!r.loading},fallback:"Loading...",get children(){return d(Gt,{get study(){return r()}})}})),a})()},Gt=m=>{const r=Ye(),a=()=>m.study;let[u,c]=C(!1),t=new Nt,f=new Be;const[x,G]=C(Xe.i_chapter??0);let I=p(()=>{const s=a();return new Ft(s.chapters.map((o,z)=>D.load_from_store(s,z)))}),Q=p(()=>I().chapters[x()]);const O=p(()=>a().chapters[x()]),_=p(()=>{t.mode;let s=O();return Ke.make(s.pgn.tree.clone)}),v=p(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===15});$(()=>{t.mode==="quiz-quiz"&&(t.i_quiz_quiz===15||b(()=>{_().set_random_cursor_hide_rest(),t.match_color=_().cursor_after_color}))}),$(()=>{let{mode:s,match_color:o}=t;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{b(()=>{_().reveal_one_random()})},400)}),$(()=>{_().solved_paths.replace_all(Q().solved_paths)});const q=p(()=>{let s=_().tree;return b(()=>D.make(a().name,x(),s,new X))});$(()=>{b(()=>q()).solved_paths.replace_all(_().solved_paths)});let Z=p(()=>{let s=Q(),o=q(),z=b(()=>s.progress);return s.clone_merge_stats(o).progress-z});$(y(()=>[Q(),q()],(s,o)=>{if(o){let[z,M]=o;z.merge_and_save_stats(M)}})),$(y(()=>f.add_uci,s=>{if(u()||!s)return;_().try_next_uci_fail(s)?(ee(),t.mode==="quiz-quiz"&&t.quiz_pass_one()):((t.mode==="match"||t.mode==="moves")&&(c(!0),setTimeout(()=>{_().on_wheel(-1),c(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=_().cursor_path.slice(0,-1)))})),$(y(()=>t.quiz_deathmatch_fail_result,s=>{(s>0||s<0)&&r.play("victory")})),$(y(()=>t.practice_end_result,s=>{s&&r.play("victory")})),$(()=>{let{mode:s,match_color:o}=t;s==="match"&&o==="black"&&b(()=>{ee()})}),$(y(()=>_().fen_last_move,s=>{if(s){let[o,z]=s;f.on_set_fen_uci(o,z)}else f.on_set_fen_uci(Ve)}));const ee=()=>{let s=()=>_().is_cursor_path_at_a_leaf;s()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=_().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(c(!0),setTimeout(()=>{_().reveal_one_random(),s()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=_().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),c(!1)},400))};$(y(()=>f.on_wheel,s=>{s&&_().on_wheel(s)}));const te=s=>{s.key==="f"&&t.flip_match_color()};$(y(()=>{var s;return(s=_().tree)==null?void 0:s.get_at(_().cursor_path)},s=>{s&&r.move(s)})),pe(()=>{document.addEventListener("keypress",te)}),ve(()=>{document.removeEventListener("keypress",te)});const re=Ze(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),f.set_on_wheel(Math.sign(s.deltaY)))});$(()=>{t.match_color=a().orientation??"white"});const ye=p(()=>q().progress_map);let W;pe(()=>{W.addEventListener("wheel",re,{passive:!1})}),ve(()=>{W.removeEventListener("wheel",re)});const se=s=>{let o=t.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},Se=p(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),Ce=p(y(()=>t.quiz_deathmatch_result_path,s=>{var M,j;let o=s.length,z=(j=(M=_().tree)==null?void 0:M.all_leaves.map(P=>P.path).filter(P=>!_().failed_paths.find(B=>B.join("")===P.join(""))).filter(P=>P.join("").startsWith(s.join("")))[0])==null?void 0:j.length;return`${o} out of ${z}`})),xe=p(()=>{var s;return(s=_().tree)==null?void 0:s.collect_branch_sums(_().cursor_path)});return(()=>{var s=bt(),o=s.firstChild,z=o.firstChild,M=z.nextSibling,j=M.firstChild,P=j.firstChild,B=j.nextSibling,ae=o.nextSibling,le=ae.nextSibling,Me=le.nextSibling,ie=Me.firstChild,_e=ie.firstChild,ne=_e.firstChild,Pe=ne.nextSibling,Ee=_e.nextSibling,Te=Ee.firstChild,Re=ie.nextSibling,oe=Re.firstChild,ce=oe.nextSibling,he=ce.nextSibling,H=he.firstChild,K=H.nextSibling,U=K.nextSibling,ue=U.nextSibling,De=he.nextSibling,de=De.firstChild,J=de.firstChild,me=J.nextSibling,Qe=de.nextSibling;return Ae(e=>W=e,s),h(P,()=>a().name),h(j,d(ke,{get width(){return I().progress}}),null),h(B,d(V,{get each(){return a().chapters},children:(e,i)=>(()=>{var n=wt(),w=n.firstChild,g=w.firstChild;return g.nextSibling,n.$$click=()=>G(i()),h(g,()=>e.name),h(w,d(ke,{get width(){var E;return((E=I())==null?void 0:E.chapters[i()].progress)??0}}),null),N(()=>R(n,i()===x()?"active":"")),n})()})),h(ae,d(He,{get orientation(){return t.match_color},get movable(){return Se()},get doPromotion(){return f.promotion},get onMoveAfter(){return f.on_move_after},get fen_uci(){return f.fen_uci},get color(){return f.turnColor},get dests(){return f.dests}})),h(le,d(V,{get each(){return ye()},children:e=>(()=>{var i=kt(),n=i.firstChild,w=n.nextSibling;return i.$$click=g=>_().try_set_cursor_path(e.path),N(g=>{var E=`background: ${e.color}; height: ${Math.round(e.total*100)}%`,Y=`height: ${Math.round(e.white()*100)}%`,A=`height: ${Math.round(e.black()*100)}%`;return g.e=F(i,E,g.e),g.t=F(n,Y,g.t),g.a=F(w,A,g.a),g},{e:void 0,t:void 0,a:void 0}),i})()})),h(ne,()=>a().name),h(Pe,()=>O().name),h(oe,d(Ue,{get lala(){return _()}})),h(ce,d(V,{get each(){return xe()},children:e=>(()=>{var i=St();return i.$$click=()=>_().try_set_cursor_path(e.path),h(i,d(S,{get when(){return e.ply&1},get children(){var n=yt();return h(n,()=>At(e.ply)),n}}),null),h(i,()=>e.san,null),i})()})),H.$$click=()=>_().navigate_first(),K.$$click=()=>_().navigate_prev(),U.$$click=()=>_().navigate_next(),ue.$$click=()=>_().navigate_last(),J.$$click=()=>t.end_match_or_moves(),me.$$click=()=>t.mode="quiz",h(Qe,d(Ne,{get children(){return[d(L,{get when(){return t.mode==="quiz"},get children(){return[fe(),rt(),st(),(()=>{var e=at();return e.$$click=()=>t.mode="quiz-quiz",e})(),(()=>{var e=lt();return e.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(L,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[it(),d(S,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Ct(),xt(),(()=>{var e=Mt(),i=e.firstChild;return i.$$click=()=>t.end_deathmatch(),e})()]},get children(){return[(()=>{var e=_t();return e.firstChild,h(e,d(S,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return we()},get children(){return[" ",$e()]}}),null),e})(),(()=>{var e=nt();return e.firstChild,h(e,Ce,null),e})(),(()=>{var e=ze(),i=e.firstChild,n=i.nextSibling;return n.nextSibling,h(e,Z,n),e})(),(()=>{var e=ot(),i=e.firstChild,n=i.nextSibling;return i.$$click=()=>t.restart_deathmatch(),n.$$click=()=>t.end_deathmatch(),e})()]}})]}}),d(L,{get when(){return t.mode==="quiz-quiz"},get children(){return[ct(),d(S,{get when(){return v()},get fallback(){return[Pt(),Et(),(()=>{var e=Tt(),i=e.firstChild;return h(e,()=>t.i_quiz_quiz,i),e})(),(()=>{var e=Rt(),i=e.firstChild;return i.$$click=()=>t.end_quiz(),e})()]},get children(){return[(()=>{var e=ht();return e.firstChild,h(e,d(S,{get when(){return t.quiz_pass>10},get fallback(){return we()},get children(){return[" ",$e()]}}),null),e})(),(()=>{var e=ut(),i=e.firstChild,n=i.nextSibling;return n.nextSibling,h(e,()=>t.quiz_pass,n),e})(),(()=>{var e=ze(),i=e.firstChild,n=i.nextSibling;return n.nextSibling,h(e,Z,n),e})(),(()=>{var e=dt(),i=e.firstChild,n=i.nextSibling;return i.$$click=()=>t.restart_quiz(),n.$$click=()=>t.end_quiz(),e})()]}})]}}),d(L,{get when(){return t.mode===void 0},get children(){return[fe(),mt(),pt(),(()=>{var e=vt();return e.$$click=()=>t.mode="moves",e})(),(()=>{var e=gt();return e.$$click=()=>t.mode="match",e})()]}}),d(L,{get when(){return t.mode==="match"},get children(){return[ft(),d(S,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Dt(),i=e.firstChild,n=i.nextSibling;return n.nextSibling,h(e,()=>t.match_color,n),e})(),Qt(),jt()]},get children(){return[qe(),be()]}}),(()=>{var e=$t(),i=e.firstChild,n=i.nextSibling;return i.$$click=()=>t.restart_match(),n.$$click=()=>{let w=_().cursor_path;t.end_match_or_moves(),_().cursor_path=w},e})()]}}),d(L,{get when(){return t.mode==="moves"},get children(){return[zt(),d(S,{get when(){return t.practice_end_result},get fallback(){return[Lt(),It()]},get children(){return[qe(),be()]}}),(()=>{var e=qt(),i=e.firstChild,n=i.nextSibling;return i.$$click=()=>{t.restart_moves()},n.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),N(e=>{var i=O().site,n="fbt first"+(!u()&&_().can_navigate_prev?"":" disabled"),w="fbt prev"+(!u()&&_().can_navigate_prev?"":" disabled"),g="fbt next"+(!u()&&_().can_navigate_next?"":" disabled"),E="fbt last"+(!u()&&_().can_navigate_next?"":" disabled"),Y="tab"+se("practice"),A="tab"+se("quiz");return i!==e.e&&Fe(Te,"href",e.e=i),n!==e.t&&R(H,e.t=n),w!==e.a&&R(K,e.a=w),g!==e.o&&R(U,e.o=g),E!==e.i&&R(ue,e.i=E),Y!==e.n&&R(J,e.n=Y),A!==e.s&&R(me,e.s=A),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),s})()};Ge(["click"]);export{er as default};
