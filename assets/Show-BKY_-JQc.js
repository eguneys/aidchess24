import{O as F,_ as ke,$ as Se,t as i,i as c,c as r,ap as Ce,h as xe,g as Me,a8 as Te,a4 as Ae,a5 as A,b as o,aa as Pe,J as Fe,l as E,W as Le,k as b,ab as Re,A as Ie,F as Y,af as Ne,U as Be,ag as Ee,ah as qe,ai as De,ao as Ge,Y as j,e as Ue,f as We,s as He,aq as Je,ar as Oe,d as Ye}from"./index-DVEm8iN8.js";import{createRepeatProps as je}from"./List-BFHAyvRJ.js";import{b as ze,a as P,P as Ke,n as Qe}from"./random-CWS6XyIQ.js";var Ve=i("<span class=time-ago>");function Xe(_){const[k,d]=F(""),p=()=>{const h=new Date().getTime(),s=Math.round((h-_.timestamp)/1e3);if(s<60)d(`${s} seconds ago`);else if(s<3600){const n=Math.round(s/60);d(`${n} minutes ago`)}else if(s<86400){const n=Math.round(s/3600);d(`${n} hours ago`)}else if(s<604800){const n=Math.round(s/86400);d(`${n} days ago`)}else if(s<2592e3){const n=Math.round(s/604800);d(`${n} weeks ago`)}else if(s<31536e3){const n=Math.round(s/2592e3);d(`${n} months ago`)}else{const n=Math.round(s/31536e3);d(`${n} years ago`)}};return ke(()=>{p();const h=setInterval(p,6e4);Se(()=>clearInterval(h))}),(()=>{var h=Ve();return c(h,k),h})()}var Ze=i("<span class=value>"),et=i("<div class=header><div class=title></div><div class=filter><span class=label>Filter:</span><span class=value></span> moves</div><div class=due-moves><span class=label>Due:</span>"),tt=i("<div class=board-wrap>"),st=i("<button>Hint: Show Previous Moves"),at=i("<button>Goto Next Due Move"),nt=i("<div class=controls>"),rt=i("<div class=replay-wrap>"),lt=i("<div class=underboard><div class=move-history><h4>Latest Attempts for this Move</h4><div class=attempts></div></div><div class=session-history><h4>Latest Attempts for Today </h4><div class=attempts>"),ot=i("<main class=repeat-show>"),it=i('<div class="Loading ...">'),_t=i("<div class=no-dues><span>Great; No due moves at this time."),ct=i("<span class=idle>..."),ut=i("<button>Show Answer"),dt=i("<span class=ply>"),pt=i("<div><i>");const $t=()=>r(mt,{}),ht=Je(new Oe({}));function mt(){let _=Ce(ht),[k]=xe(),d=k.filter??"white";const p=()=>{switch(d){case"first-ten":return"First Ten";case"ten-twenty":return"First Ten to Twenty";case"twenty-plus":return"Twenty Plus";case"white":return"White";case"black":return"Black"}};let[h,{goto_path:s,goto_path_if_can:n,set_failed_path:S,set_success_path:T,set_hide_after_path:f,add_child_san_to_current_path:K,save_due_move_if_not:Q,add_attempt_with_spaced_repetition:V,load_study:X,load_chapters_for_sections:Z,load_due_moves:ee,load_replay_tree_by_due_move:te}]=Me(),C=Te(h);const se=()=>h.replay_tree,q=()=>C.fen,ae=()=>C.last_move;let u=je();const ne=()=>{Z(u.selected_section_ids)},re=()=>{let e=u.selected_study_id,t=u.selected_section_ids;e&&t.length>0&&ee(e,t)};let le=Ae();A(()=>X(le.id)),A(ne),A(re);const D=o(()=>{switch(d){case"first-ten":return u.due_first_ten;case"ten-twenty":return u.due_ten_twenty;case"twenty-plus":return u.due_twenty_plus;case"white":return u.due_white;case"black":return u.due_black}}),G=o(()=>{switch(d){case"first-ten":return u.all_first_ten;case"ten-twenty":return u.all_ten_twenty;case"twenty-plus":return u.all_twenty_plus;case"white":return u.all_white;case"black":return u.all_black}}),[L,R]=F(),oe=o(e=>{let t=D();if(L()!==void 0)return e;if(t.length>0)return ze(t)}),[U,W]=F(),m=o(()=>U()??oe());A(()=>{let e=m();e&&te(e)});const ie=o(()=>m()===void 0),I=o(()=>L()!==void 0),_e=o(()=>m()?.tree_step_node.step.uci),H=o(()=>Pe(m()?.tree_step_node.step.before_fen??Fe)),ce=o(()=>!I()),[N,ue]=F(),B=e=>{if(e){let t=m();f(Ge(t.tree_step_node.step.path))}else f("");ue(e)},de=e=>{n(e)};async function w(e){R(e),f(void 0);let t=m();await V(_,t,e),await Q(t),e.includes("solved")&&await new Promise(a=>{setTimeout(()=>{J(),a(void 0)},800)})}const J=()=>{j(()=>{R(void 0),B(!1),W(void 0)})},pe=e=>{let t=G()?.find(a=>a.id===e.repeat_due_move_id);t&&j(()=>{R(void 0),B(!1),W(t)})},he=async(e,t)=>{let l=Ne(q()),$=l.turn,x=l.board.get(Be(e)),v=e+t;x.role==="pawn"&&(t[1]==="8"&&$==="white"||t[1]==="1"&&$==="black")&&(v+="q");let y=Ee(v),g=qe(l,y),M=await K(g);f(void 0),s(M.step.path);const be=U()!==void 0;v===_e()?(N()?w("solved-with-hint"):w(be?"solved-with-hint":"solved"),T(M.step.path)):(N()?w("failed-with-hint"):w("failed"),S(M.step.path))},me=()=>{w("failed-with-skip");let e=m().tree_step_node.step.path;S(e),s(e)},O=o(()=>m()?.attempts),ve=o(()=>{let e=G()?.map(t=>t.attempts[0]).filter(Boolean)??[];return e.sort((t,a)=>t.created_at-a.created_at),e}),fe=o(()=>{let e=O();if(e)return e[0]}),ge=e=>{pe(e)},we=e=>{e>0?n(C.get_next_path):n(C.get_prev_path)};let $e=o(()=>{let e=C.step_at_cursor_path;if(!e)return[];let t=L();if(!t)return[];if(h.replay_tree.failed_path===e.step.path)return P(e.step.uci,e.step.san,"✗");if(h.replay_tree.success_path===e.step.path)return t.includes("hint")?P(e.step.uci,e.step.san,"✓"):P(e.step.uci,e.step.san,"!");let a=e.nags?.[0];return a?P(e.step.uci,e.step.san,De(a)):[]});const ye=o(()=>!0);return(()=>{var e=ot();return c(e,r(E,{get fallback(){return it()},get children(){return[(()=>{var t=et(),a=t.firstChild,l=a.nextSibling,$=l.firstChild,x=$.nextSibling,v=l.nextSibling;return v.firstChild,c(a,()=>u.study?.name),c(x,p),c(v,r(E,{get children(){return[(()=>{var y=Ze();return c(y,()=>D().length),y})()," moves left"]}}),null),t})(),(()=>{var t=tt();return Le(t,"wheel",Qe(we)),c(t,r(Ke,{get shapes(){return $e()},get orientation(){return H()},get color(){return H()},get movable(){return ce()},get fen(){return q()},get last_move(){return ae()},play_orig_key:he})),t})(),(()=>{var t=rt();return c(t,r(E,{get children(){return r(b,{get when(){return!ie()},get fallback(){return(()=>{var a=_t();return a.firstChild,c(a,r(Ie,{href:"/repetition",children:"Go Back to Repetitions"}),null),a})()},get children(){return[r(Re,{handle_goto_path:de,get replay_tree(){return se()},lose_focus:!1}),(()=>{var a=nt();return c(a,r(b,{get when(){return ye()},get fallback(){return ct()},get children(){return[r(b,{get when(){return o(()=>!I())()&&!N()},get children(){var l=st();return l.$$click=()=>B(!0),l}}),r(b,{get when(){return I()},get fallback(){return(()=>{var l=ut();return l.$$click=me,l})()},get children(){var l=at();return l.$$click=J,l}})]}})),a})()]}})}})),t})(),(()=>{var t=lt(),a=t.firstChild,l=a.firstChild,$=l.nextSibling,x=a.nextSibling,v=x.firstChild,y=v.nextSibling;return c($,r(Y,{get each(){return O()},children:(g,M)=>r(z,{get latest(){return M()===0},attempt:g,time:!0})})),c(y,r(Y,{get each(){return ve()},children:g=>r(z,{get latest(){return g===fe()},attempt:g,time:!1,on_click:()=>ge(g)})})),t})()]}})),e})()}function z(_){const k=o(()=>" "+_.attempt.attempt_result),d=()=>_.attempt.attempt_result.includes("skip")?"":_.attempt.attempt_result.includes("solved")?_.attempt.attempt_result.includes("hint")?"":"":"";return(()=>{var p=pt(),h=p.firstChild;return p.$$click=()=>_.on_click?.(),c(p,r(b,{get when(){return _.ply},get children(){var s=dt();return c(s,()=>_.ply),s}}),null),c(p,r(b,{get when(){return _.time},get children(){return r(Xe,{get timestamp(){return _.attempt.created_at}})}}),null),Ue(s=>{var n="attempt"+k(),S=!!_.latest,T=!_.time,f=d();return n!==s.e&&We(p,s.e=n),S!==s.t&&p.classList.toggle("latest",s.t=S),T!==s.a&&p.classList.toggle("selectable",s.a=T),f!==s.o&&He(h,"data-icon",s.o=f),s},{e:void 0,t:void 0,a:void 0,o:void 0}),p})()}Ye(["click"]);export{$t as default};
