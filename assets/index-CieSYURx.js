import{$ as P,k as _,x as z,m as N}from"./index-B6YmRJks.js";const x=Symbol("store-raw"),E=Symbol("store-node"),p=Symbol("store-has"),R=Symbol("store-self");function S(e){let n;return e!=null&&typeof e=="object"&&(e[P]||!(n=Object.getPrototypeOf(e))||n===Object.prototype||Array.isArray(e))}function m(e,n=new Set){let i,l,t,o;if(i=e!=null&&e[x])return i;if(!S(e)||n.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):n.add(e);for(let f=0,c=e.length;f<c;f++)t=e[f],(l=m(t,n))!==t&&(e[f]=l)}else{Object.isFrozen(e)?e=Object.assign({},e):n.add(e);const f=Object.keys(e),c=Object.getOwnPropertyDescriptors(e);for(let d=0,s=f.length;d<s;d++)o=f[d],!c[o].get&&(t=e[o],(l=m(t,n))!==t&&(e[o]=l))}return e}function D(e,n){let i=e[n];return i||Object.defineProperty(e,n,{value:i=Object.create(null)}),i}function I(e,n,i){if(e[n])return e[n];const[l,t]=_(i,{equals:!1,internal:!0});return l.$=t,e[n]=l}function w(e,n,i,l=!1){if(!l&&e[n]===i)return;const t=e[n],o=e.length;i===void 0?(delete e[n],e[p]&&e[p][n]&&t!==void 0&&e[p][n].$()):(e[n]=i,e[p]&&e[p][n]&&t===void 0&&e[p][n].$());let f=D(e,E),c;if((c=I(f,n,t))&&c.$(()=>i),Array.isArray(e)&&e.length!==o){for(let d=e.length;d<o;d++)(c=f[d])&&c.$();(c=I(f,"length",o))&&c.$(e.length)}(c=f[R])&&c.$()}const q=Symbol("store-root");function b(e,n,i,l,t){const o=n[i];if(e===o)return;const f=Array.isArray(e);if(i!==q&&(!S(e)||!S(o)||f!==Array.isArray(o)||t&&e[t]!==o[t])){w(n,i,e);return}if(f){if(e.length&&o.length&&(!l||t&&e[0]&&e[0][t]!=null)){let s,r,u,h,a,O,A,$;for(u=0,h=Math.min(o.length,e.length);u<h&&(o[u]===e[u]||t&&o[u]&&e[u]&&o[u][t]===e[u][t]);u++)b(e[u],o,u,l,t);const g=new Array(e.length),v=new Map;for(h=o.length-1,a=e.length-1;h>=u&&a>=u&&(o[h]===e[a]||t&&o[u]&&e[u]&&o[h][t]===e[a][t]);h--,a--)g[a]=o[h];if(u>a||u>h){for(r=u;r<=a;r++)w(o,r,e[r]);for(;r<e.length;r++)w(o,r,g[r]),b(e[r],o,r,l,t);o.length>e.length&&w(o,"length",e.length);return}for(A=new Array(a+1),r=a;r>=u;r--)O=e[r],$=t&&O?O[t]:O,s=v.get($),A[r]=s===void 0?-1:s,v.set($,r);for(s=u;s<=h;s++)O=o[s],$=t&&O?O[t]:O,r=v.get($),r!==void 0&&r!==-1&&(g[r]=o[s],r=A[r],v.set($,r));for(r=u;r<e.length;r++)r in g?(w(o,r,g[r]),b(e[r],o,r,l,t)):w(o,r,e[r])}else for(let s=0,r=e.length;s<r;s++)b(e[s],o,s,l,t);o.length>e.length&&w(o,"length",e.length);return}const c=Object.keys(e);for(let s=0,r=c.length;s<r;s++)b(e[c[s]],o,c[s],l,t);const d=Object.keys(o);for(let s=0,r=d.length;s<r;s++)e[d[s]]===void 0&&w(o,d[s],void 0)}function C(e,n={}){const{merge:i,key:l="id"}=n,t=m(e);return o=>{if(!S(o)||!S(t))return t;const f=b(t,{[q]:o},q,i,l);return f===void 0?o:f}}var J=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(n,i)=>(typeof require<"u"?require:n)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),L=e=>(typeof e.clear=="function"||(e.clear=()=>{let n;for(;n=e.key(0);)e.removeItem(n)}),e),T=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function V(e){if(!e)return"";let n="";for(const i in e){if(!T.includes(i))continue;const l=e[i];n+=l instanceof Date?`; ${i}=${l.toUTCString()}`:typeof l=="boolean"?`; ${i}`:`; ${i}=${l}`}return n}function F(e,n){var i;return((i=e.match(`(^|;)\\s*${n}\\s*=\\s*([^;]+)`))==null?void 0:i.pop())??null}var j;try{j=J("solid-start/server").useRequest}catch{j=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var y=L({_read:()=>document.cookie,_write:(e,n,i)=>{document.cookie=`${e}=${n}${V(i)}`},getItem:(e,n)=>F(y._read(n),e),setItem:(e,n,i)=>{y._write(e,n,i);{const t=Object.assign(new Event("storage"),{key:e,oldValue:null,newValue:n,url:globalThis.document.URL,storageArea:y});window.dispatchEvent(t)}},removeItem:(e,n)=>{y._write(e,"deleted",{...n,expires:new Date(0)})},key:(e,n)=>{let i=null,l=0;return y._read(n).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(t,o)=>(!i&&o&&l++===e&&(i=o),"")),i},getLength:e=>{let n=0;return y._read(e).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,i=>(n+=i?1:0,"")),n},get length(){return this.getLength()}});function M(e,n={}){const i=n.storage||globalThis.localStorage;if(!i)return e;const l=n.storageOptions,t=n.name||`storage-${z()}`,o=n.serialize||JSON.stringify.bind(JSON),f=n.deserialize||JSON.parse.bind(JSON),c=i.getItem(t,l),d=typeof e[0]=="function"?r=>e[1](()=>f(r)):r=>e[1](C(f(r)));let s=!0;return c instanceof Promise?c.then(r=>s&&r&&d(r)):c&&d(c),[e[0],typeof e[0]=="function"?r=>{const u=e[1](r);return r?i.setItem(t,o(u),l):i.removeItem(t,l),s=!1,u}:(...r)=>{e[1](...r);const u=o(N(()=>e[0]));i.setItem(t,u,l),s=!1}]}export{M as m};
