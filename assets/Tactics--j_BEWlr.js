var I=Object.defineProperty;var Q=(i,s,r)=>s in i?I(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r;var m=(i,s,r)=>(Q(i,typeof s!="symbol"?s+"":s,r),r);import{h as U,j as V,b as z,o as v,l as w,i as a,c as u,S,f as F,s as W,d as Y,t as c,k as N,p as J}from"./index-DigfKJAO.js";/* empty css                   */import{S as K}from"./studyrepo-D9Gz3VcT.js";import{S as P,C as X}from"./Shalala-B52gRouf.js";import{a as Z,T as ee}from"./Chesstree2-DxHWZB2U.js";import"./chess_pgn_logic-AUo9Luh0.js";var te=c("<div class=progress><div class=bar></div><h3>"),re=c("<div class=list-wrap><h1 class=header>Tactics</h1><div class=list><div><h3 class=title></h3><span>Total Runs</span><p>Highscore: <!> </p></div><div><p>Current Run</p><p>Score: "),se=c("<div class=repertoire>"),le=c("<div class=board-wrap>"),ne=c("<h3>Puzzle solved. <span> Score +"),ae=c("<h3> Current Run Finished "),ie=c("<button>New Run"),ce=c("<div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>"),_e=c("<h3>Find the best line!"),he=c("<button>View Solution"),oe=c("<button>Next Puzzle");const C=class C{constructor(s){m(this,"_scores");m(this,"_current_run");this.id=s,this._scores=N([],{equals:!1}),this._current_run=[N(0),N(0)]}get current_score(){return this._current_run[0][0]()??0}get i_selected_chapter(){return this._current_run[1][0]()??0}set current_score(s){this._current_run[0][1](s)}set i_selected_chapter(s){this._current_run[1][1](s)}get scores(){return this._scores[0]()}new_current_run(){this.current_score=0,this.i_selected_chapter=0}add_current_run(){let s=this._scores[0]();s.push(this.current_score),s=s.slice(-10),this._scores[1](s)}get highscore(){return Math.max(0,...this._scores[0]())}};m(C,"make",s=>new C(s));let A=C;const x=class x{constructor(s,r){m(this,"attempt");this.puzzle=s,this.solution=r,this.attempt=ee.make(r)}};m(x,"make",(s,r)=>new x(s,r));let T=x;const D=i=>(()=>{var s=te(),r=s.firstChild,_=r.nextSibling;return a(_,()=>`${i.width}/${i.nb}`),F(k=>J(r,`width: ${i.width/i.nb*100}%`,k)),s})(),ve=()=>{let s=U().id,r=A.make(s);const[_]=V(s,K.read_study),k=z(()=>{var e;return(e=_())==null?void 0:e.chapters[r.i_selected_chapter]});let h=new P,o=z(v(k,e=>{if(e){let t=T.make(e.pgn.puzzle,e.pgn.tree);return t.attempt.cursor_path=t.attempt.tree.root.data.path,t.attempt.hidden_paths=t.attempt.tree.root.children.map(n=>n.data.path),t}}));w(v(()=>h.add_uci,e=>{var t;e&&((t=o())==null||t.attempt.try_next_uci_fail(e))})),w(v(()=>{var e;return(e=o())==null?void 0:e.attempt.fen_last_move},e=>{if(e){let[t,n]=e;h.on_set_fen_uci(t,n)}})),w(v(()=>h.on_wheel,e=>{var t;e&&((t=o())==null||t.attempt.on_wheel(e))}));const L=()=>{let e=_();return e?`${r.i_selected_chapter+1} / ${e.chapters.length}  Score: ${r.current_score}`:"--"},y=()=>{var n,d;let e=((n=o())==null?void 0:n.attempt.solved_paths.length)??0,t=((d=o())==null?void 0:d.attempt.failed_paths.length)??0;return e%2===1?e=e+1+(e-1)/2:e=e+e/2,t%2===1?t=t+1+(t-1)/2:t=t+e/2,e-t},j=()=>{r.new_current_run()},q=()=>{r.current_score=Math.max(0,r.current_score+y()),r.i_selected_chapter=r.i_selected_chapter+1};w(v(()=>{var e;return(e=o())==null?void 0:e.attempt.is_revealed},(e,t)=>{e&&!t&&r.i_selected_chapter===_().chapters.length-1&&(r.current_score=Math.max(0,r.current_score+y()),r.add_current_run())}));const B=()=>{var e;(e=o())==null||e.attempt.reveal_hidden_paths()},G=e=>{const t=e.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(e.preventDefault(),h.set_on_wheel(Math.sign(e.deltaY)))};return(()=>{var e=se();return e.addEventListener("wheel",G),a(e,u(S,{get when(){return!_.loading},fallback:"Loading...",get children(){var t=re(),n=t.firstChild,d=n.nextSibling,p=d.firstChild,g=p.firstChild,R=g.nextSibling,$=R.nextSibling,E=$.firstChild,b=E.nextSibling;b.nextSibling;var f=p.nextSibling,M=f.firstChild,l=M.nextSibling;return l.firstChild,a(g,()=>_().name),a(p,u(D,{get width(){return r.scores.length},nb:10}),$),a($,()=>r.highscore,b),a(f,u(D,{get width(){return r.i_selected_chapter+1},get nb(){return _().chapters.length}}),l),a(l,()=>r.current_score,null),t}}),null),a(e,u(S,{get when(){return o()},children:t=>[(()=>{var n=le();return a(n,u(X,{get movable(){return!t().attempt.is_revealed},get doPromotion(){return h.promotion},get onMoveAfter(){return h.on_move_after},get fen_uci(){return h.fen_uci},get color(){return h.turnColor},get dests(){return h.dests}})),n})(),(()=>{var n=ce(),d=n.firstChild,p=d.firstChild,g=p.firstChild,R=g.nextSibling,$=p.nextSibling,E=$.firstChild,b=d.nextSibling,f=b.firstChild,M=f.nextSibling;return a(g,()=>_().name),a(R,L),a(f,u(Z,{get lala(){return t().attempt}})),a(M,u(S,{get when(){return t().attempt.is_revealed},get fallback(){return[_e(),(()=>{var l=he();return l.$$click=B,l})()]},get children(){return[(()=>{var l=ne(),H=l.firstChild,O=H.nextSibling;return O.firstChild,a(O,y,null),l})(),u(S,{get when(){return r.i_selected_chapter===_().chapters.length-1},get fallback(){return(()=>{var l=oe();return l.$$click=q,l})()},get children(){return[ae(),(()=>{var l=ie();return l.$$click=j,l})()]}})]}})),F(()=>W(E,"href",`https://lichess.org/training/${t().puzzle}`)),n})()]}),null),e})()};Y(["click"]);export{ve as default};
