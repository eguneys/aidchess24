var De=Object.defineProperty;var Qe=(m,r,a)=>r in m?De(m,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[r]=a;var E=(m,r,a)=>(Qe(m,typeof r!="symbol"?r+"":r,a),a);import{h as je,j as Le,i as u,c as d,S as R,k as Ie,l as S,b as v,m as $,n as b,o as y,p as de,q as me,r as Oe,f as N,g as T,F as pe,s as F,M as L,e as Ye,v as Ae,d as Ne,t as i,w as k}from"./index-Bw4R4Cw6.js";/* empty css                   */import{S as Fe}from"./studyrepo-Bdl2-VKo.js";import{S as Ge,C as We}from"./Shalala-B46uKQy2.js";import{T as Be,a as V,C as He}from"./Chesstree2-DAMEi7Pw.js";import{M as Ke,I as Ue}from"./chess_pgn_logic-2v1UisCC.js";import{S as Je,O as ve}from"./SessionStore-B3BP9rR1.js";import{s as Ve}from"./scroll-DnAhRpRC.js";var Xe=i("<div class=progress><div class=bar></div><h3>"),Ze=i("<div class=repertoire-wrap>"),ge=i("<small> Click on variations to expand. "),et=i("<small> Your goal is to guess every move correctly to pass the quiz. "),tt=i("<h2>Select a Quiz Option"),rt=i("<button><span> Take Quiz "),st=i("<button><span> Play Deathmatch "),at=i("<h2>Deathmatch Mode"),fe=i("<span class=passed>passed"),it=i("<small> Deathmatch "),lt=i("<small> Your score: "),$e=i("<small> Progress +<!>% "),_t=i("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),nt=i("<h2>Quiz Mode"),ot=i("<small> Quiz "),ct=i("<small> Your score: <!> out of 15 correct"),ht=i("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),ut=i("<small> Your goal is to guess every move correctly to fill up the progress bar. "),dt=i("<h2>Select a Practice Option"),mt=i("<button><span> Play all Moves "),pt=i("<button><span> Play as Match "),vt=i("<h2>Play as Match"),ze=i("<small> End of practice. "),qe=i("<small> Congratulations. "),gt=i("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),ft=i("<h2>Play all moves"),$t=i("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),zt=i("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),qt=i("<li><div><h3></h3> "),bt=i('<div class=line><span class="fill white"></span><span class="fill black">'),wt=i("<small>You will play the moves from the opening."),kt=i("<small>If you go out of book, game ends."),yt=i("<div class=in_mode><button class=end2><span> End Deathmatch "),be=i("<span class=failed>failed"),St=i("<small>You are given 15 random positions from the opening."),Ct=i("<small>Guess the correct move."),xt=i("<h2> of 15"),Mt=i("<div class=in_mode><button class=end2><span> End Quiz "),Pt=i("<small> Try to guess the moves for <!>."),Et=i("<small> AI will play the next move, picking a random variation. "),Tt=i("<small> Moves will be hidden once the game is started. "),Rt=i("<small>Try to guess the moves for both sides."),Dt=i("<small>Moves will be hidden once you start.");const Qt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],jt=m=>Qt[Math.floor((1-m/10)*6)];class Lt{constructor(){E(this,"_mode");E(this,"_match_color");E(this,"_practice_end_result");E(this,"_quiz_quiz_ls");E(this,"_quiz_deathmatch_fail");E(this,"_quiz_deathmatch_result_path");this._mode=S(void 0,{equals:!1}),this._match_color=S("white"),this._quiz_quiz_ls=S([],{equals:!1}),this._quiz_deathmatch_fail=S(0),this._quiz_deathmatch_result_path=S([]),this._practice_end_result=S(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){k(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){k(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){k(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){k(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){k(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){k(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){k(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const we=m=>(()=>{var r=Xe(),a=r.firstChild,h=a.nextSibling;return u(h,()=>`%${m.width}`),N(c=>F(a,`width: ${m.width}%`,c)),r})();class It{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(a=>Math.round(a.progress/r)).reduce((a,h)=>a+h)}}class D{constructor(r,a,h,c){this.study_id=r,this.i_chapter=a,this.score_tree=h,this.solved_paths=c}static load_from_store(r,a){let h=new ve(r.id,a);return D.make(r.id,a,r.chapters[a].pgn.tree,V.set_for_saving(h.solved_paths))}static save_paths_to_store(r){let a=new ve(r.study_id,r.i_chapter);a.solved_paths=r.solved_paths.get_for_saving(),a.practice_progress=r.progress}static make(r,a,h,c=new V){return new D(r,a,Ke.make(h),c)}get clone(){return new D(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>b(()=>{var a;return(a=this.score_tree.get_at(r))==null?void 0:a.score})??0).reduce((r,a)=>r+a,0)*100)}get progress_map(){let r=b(()=>this.score_tree.progress_paths);const a=b(()=>r.map(h=>[h.filter(c=>c.length%2===1).map(c=>this.score_tree.get_at(c).score).reduce((c,t)=>c+t,0),h.filter(c=>c.length%2===0).map(c=>this.score_tree.get_at(c).score).reduce((c,t)=>c+t,0)]));return r.map((h,c)=>{let t=h[0],f=h[h.length-1],C=a[c][0],G=a[c][1],I=v(()=>this.solved_paths.paths),Q=v(()=>I().filter(p=>h.some(q=>q.join("")===p.join("")))),O=v(()=>Q().filter(p=>p.length%2===1).map(p=>this.score_tree.get_at(p).score).reduce((p,q)=>p+q,0)),_=v(()=>Q().filter(p=>p.length%2===0).map(p=>this.score_tree.get_at(p).score).reduce((p,q)=>p+q,0));return{color:jt(t.length/20+f.length/10),total:C*2,black:v(()=>_()/G),white:v(()=>O()/C),path:f}}).reverse()}clone_merge_stats(r){let a=b(()=>this.clone);return a.solved_paths.merge_dup(r.solved_paths),a}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){D.save_paths_to_store(this)}}const Ut=()=>{const m=je(),[r]=Le(m.id,Fe.read_study);return(()=>{var a=Ze();return u(a,d(R,{get when(){return!r.loading},fallback:"Loading...",get children(){return d(Ot,{get study(){return r()}})}})),a})()},Ot=m=>{const r=Ie(),a=()=>m.study;let[h,c]=S(!1),t=new Lt,f=new Ge;const[C,G]=S(Je.i_chapter??0);let I=v(()=>{const s=a();return new It(s.chapters.map((o,z)=>D.load_from_store(s,z)))}),Q=v(()=>I().chapters[C()]);const O=v(()=>a().chapters[C()]),_=v(()=>{t.mode;let s=O();return Be.make(s.pgn.tree.clone)}),p=v(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===15});$(()=>{t.mode==="quiz-quiz"&&(t.i_quiz_quiz===15||b(()=>{_().set_random_cursor_hide_rest(),t.match_color=_().cursor_after_color}))}),$(()=>{let{mode:s,match_color:o}=t;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{b(()=>{_().reveal_one_random()})},400)}),$(()=>{_().solved_paths.replace_all(Q().solved_paths)});const q=v(()=>{let s=_().tree;return b(()=>D.make(a().name,C(),s,new V))});$(()=>{b(()=>q()).solved_paths.replace_all(_().solved_paths)});let X=v(()=>{let s=Q(),o=q(),z=b(()=>s.progress);return s.clone_merge_stats(o).progress-z});$(y(()=>[Q(),q()],(s,o)=>{if(o){let[z,x]=o;z.merge_and_save_stats(x)}})),$(y(()=>f.add_uci,s=>{if(h()||!s)return;_().try_next_uci_fail(s)?(Z(),t.mode==="quiz-quiz"&&t.quiz_pass_one()):((t.mode==="match"||t.mode==="moves")&&(c(!0),setTimeout(()=>{_().on_wheel(-1),c(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=_().cursor_path.slice(0,-1)))})),$(y(()=>t.quiz_deathmatch_fail_result,s=>{(s>0||s<0)&&r.play("victory")})),$(y(()=>t.practice_end_result,s=>{s&&r.play("victory")})),$(()=>{let{mode:s,match_color:o}=t;s==="match"&&o==="black"&&b(()=>{Z()})}),$(y(()=>_().fen_last_move,s=>{if(s){let[o,z]=s;f.on_set_fen_uci(o,z)}else f.on_set_fen_uci(Ue)}));const Z=()=>{let s=()=>_().is_cursor_path_at_a_leaf;s()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=_().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(c(!0),setTimeout(()=>{_().reveal_one_random(),s()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=_().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),c(!1)},400))};$(y(()=>f.on_wheel,s=>{s&&_().on_wheel(s)}));const ee=s=>{s.key==="f"&&t.flip_match_color()};$(y(()=>{var s;return(s=_().tree)==null?void 0:s.get_at(_().cursor_path)},s=>{s&&r.move(s)})),de(()=>{document.addEventListener("keypress",ee)}),me(()=>{document.removeEventListener("keypress",ee)});const te=Ve(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),f.set_on_wheel(Math.sign(s.deltaY)))});$(()=>{t.match_color=a().orientation??"white"});const ke=v(()=>q().progress_map);let W;de(()=>{W.addEventListener("wheel",te,{passive:!1})}),me(()=>{W.removeEventListener("wheel",te)});const re=s=>{let o=t.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},ye=v(()=>t.mode!==void 0&&!p()&&!t.practice_end_result),Se=v(y(()=>t.quiz_deathmatch_result_path,s=>{var x,j;let o=s.length,z=(j=(x=_().tree)==null?void 0:x.all_leaves.map(M=>M.path).filter(M=>!_().failed_paths.find(B=>B.join("")===M.join(""))).filter(M=>M.join("").startsWith(s.join("")))[0])==null?void 0:j.length;return`${o} out of ${z}`}));return(()=>{var s=zt(),o=s.firstChild,z=o.firstChild,x=z.nextSibling,j=x.firstChild,M=j.firstChild,B=j.nextSibling,se=o.nextSibling,ae=se.nextSibling,Ce=ae.nextSibling,ie=Ce.firstChild,le=ie.firstChild,_e=le.firstChild,xe=_e.nextSibling,Me=le.nextSibling,Pe=Me.firstChild,Ee=ie.nextSibling,ne=Ee.firstChild,oe=ne.nextSibling,H=oe.firstChild,K=H.nextSibling,U=K.nextSibling,ce=U.nextSibling,Te=oe.nextSibling,he=Te.firstChild,J=he.firstChild,ue=J.nextSibling,Re=he.nextSibling;return Oe(e=>W=e,s),u(M,()=>a().name),u(j,d(we,{get width(){return I().progress}}),null),u(B,d(pe,{get each(){return a().chapters},children:(e,l)=>(()=>{var n=qt(),w=n.firstChild,g=w.firstChild;return g.nextSibling,n.$$click=()=>G(l()),u(g,()=>e.name),u(w,d(we,{get width(){var P;return((P=I())==null?void 0:P.chapters[l()].progress)??0}}),null),N(()=>T(n,l()===C()?"active":"")),n})()})),u(se,d(We,{get orientation(){return t.match_color},get movable(){return ye()},get doPromotion(){return f.promotion},get onMoveAfter(){return f.on_move_after},get fen_uci(){return f.fen_uci},get color(){return f.turnColor},get dests(){return f.dests}})),u(ae,d(pe,{get each(){return ke()},children:e=>(()=>{var l=bt(),n=l.firstChild,w=n.nextSibling;return l.$$click=g=>_().try_set_cursor_path(e.path),N(g=>{var P=`background: ${e.color}; height: ${Math.round(e.total*100)}%`,Y=`height: ${Math.round(e.white()*100)}%`,A=`height: ${Math.round(e.black()*100)}%`;return g.e=F(l,P,g.e),g.t=F(n,Y,g.t),g.a=F(w,A,g.a),g},{e:void 0,t:void 0,a:void 0}),l})()})),u(_e,()=>a().name),u(xe,()=>O().name),u(ne,d(He,{get lala(){return _()}})),H.$$click=()=>_().navigate_first(),K.$$click=()=>_().navigate_prev(),U.$$click=()=>_().navigate_next(),ce.$$click=()=>_().navigate_last(),J.$$click=()=>t.end_match_or_moves(),ue.$$click=()=>t.mode="quiz",u(Re,d(Ye,{get children(){return[d(L,{get when(){return t.mode==="quiz"},get children(){return[ge(),et(),tt(),(()=>{var e=rt();return e.$$click=()=>t.mode="quiz-quiz",e})(),(()=>{var e=st();return e.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(L,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[at(),d(R,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[wt(),kt(),(()=>{var e=yt(),l=e.firstChild;return l.$$click=()=>t.end_deathmatch(),e})()]},get children(){return[(()=>{var e=it();return e.firstChild,u(e,d(R,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return be()},get children(){return[" ",fe()]}}),null),e})(),(()=>{var e=lt();return e.firstChild,u(e,Se,null),e})(),(()=>{var e=$e(),l=e.firstChild,n=l.nextSibling;return n.nextSibling,u(e,X,n),e})(),(()=>{var e=_t(),l=e.firstChild,n=l.nextSibling;return l.$$click=()=>t.restart_deathmatch(),n.$$click=()=>t.end_deathmatch(),e})()]}})]}}),d(L,{get when(){return t.mode==="quiz-quiz"},get children(){return[nt(),d(R,{get when(){return p()},get fallback(){return[St(),Ct(),(()=>{var e=xt(),l=e.firstChild;return u(e,()=>t.i_quiz_quiz,l),e})(),(()=>{var e=Mt(),l=e.firstChild;return l.$$click=()=>t.end_quiz(),e})()]},get children(){return[(()=>{var e=ot();return e.firstChild,u(e,d(R,{get when(){return t.quiz_pass>10},get fallback(){return be()},get children(){return[" ",fe()]}}),null),e})(),(()=>{var e=ct(),l=e.firstChild,n=l.nextSibling;return n.nextSibling,u(e,()=>t.quiz_pass,n),e})(),(()=>{var e=$e(),l=e.firstChild,n=l.nextSibling;return n.nextSibling,u(e,X,n),e})(),(()=>{var e=ht(),l=e.firstChild,n=l.nextSibling;return l.$$click=()=>t.restart_quiz(),n.$$click=()=>t.end_quiz(),e})()]}})]}}),d(L,{get when(){return t.mode===void 0},get children(){return[ge(),ut(),dt(),(()=>{var e=mt();return e.$$click=()=>t.mode="moves",e})(),(()=>{var e=pt();return e.$$click=()=>t.mode="match",e})()]}}),d(L,{get when(){return t.mode==="match"},get children(){return[vt(),d(R,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Pt(),l=e.firstChild,n=l.nextSibling;return n.nextSibling,u(e,()=>t.match_color,n),e})(),Et(),Tt()]},get children(){return[ze(),qe()]}}),(()=>{var e=gt(),l=e.firstChild,n=l.nextSibling;return l.$$click=()=>t.restart_match(),n.$$click=()=>{let w=_().cursor_path;t.end_match_or_moves(),_().cursor_path=w},e})()]}}),d(L,{get when(){return t.mode==="moves"},get children(){return[ft(),d(R,{get when(){return t.practice_end_result},get fallback(){return[Rt(),Dt()]},get children(){return[ze(),qe()]}}),(()=>{var e=$t(),l=e.firstChild,n=l.nextSibling;return l.$$click=()=>{t.restart_moves()},n.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),N(e=>{var l=O().site,n="fbt first"+(!h()&&_().can_navigate_prev?"":" disabled"),w="fbt prev"+(!h()&&_().can_navigate_prev?"":" disabled"),g="fbt next"+(!h()&&_().can_navigate_next?"":" disabled"),P="fbt last"+(!h()&&_().can_navigate_next?"":" disabled"),Y="tab"+re("practice"),A="tab"+re("quiz");return l!==e.e&&Ae(Pe,"href",e.e=l),n!==e.t&&T(H,e.t=n),w!==e.a&&T(K,e.a=w),g!==e.o&&T(U,e.o=g),P!==e.i&&T(ce,e.i=P),Y!==e.n&&T(J,e.n=Y),A!==e.s&&T(ue,e.s=A),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),s})()};Ne(["click"]);export{Ut as default};
