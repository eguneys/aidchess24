import{B as p,P as g}from"./index-TJK2L0qU.js";const y=(r,t,e,s)=>{let i=g.make_many(r).map(n=>{let a=n.site?.includes("http")?n.site:`https://lichess.org/study/${t}`,o=n.event,l;if(o?.includes(": "))[e,l]=o.split(": ");else if(n.white!=="?"){let c=n.white,d=n.black;l=`${c} vs ${d} at ${o}`}else l=o;return{name:l,site:a,pgn:n}});return{id:t,name:e,orientation:s,chapters:i}},u=(r,t,e,s,i)=>{let n=[];return g.make_many(r).map(a=>{let o,l;a.section?(o=a.section,l=a.chapter):[e,o,l]=a.event.split(":");let c=n.find(d=>d.name===o);c||n.push(c={name:o,chapters:[]}),c?.chapters.push({name:l,pgn:a})}),{id:t,name:e,orientation:s,import_lichess_link:i,sections:n}},f=(r,t,e)=>fetch(`pgns/${r}.pgn`).then(s=>s.text()).then(s=>y(s,r,t,e)),w=(r,t,e)=>fetch(`pgns/${r}.section.pgn`).then(s=>s.text()).then(s=>u(s,r,t,e)),b=(r,t,e)=>{let[s]=p("","pgn.imported."+r);return u(s(),r,t,"white",e)};class h{static init=()=>new h;async read_section_study(t){let{study_name:e,orientation:s,import_lichess_link:i}=m.study_by_id(t)||m.imported_by_id(t);return i?b(t,e,i):w(t,e,s)}read_study(t){let{study_name:e,orientation:s}=m.study_by_id(t);return f(t,e,s)}}const P=h.init(),S={Openings:[["Berlin Defence","berlin","white"],["Slav Defense","slav","black"],["London System","london-system","black"],["Caro-Kann Defense","caro-kann","white"],["Petroff Defense","petroff","white"],["Philidor Defence","philidor","white"],["Accelerated Dragon","accelerated-dragon","white"],["Caro Kann","","white"],["Four-Knights","","white"],["Sicilian Defense","","white"],["French Defense","","black"]],Masters:[["Bobby Fischer 60 Memorable Games","",60],["Magnus Carlsen 2023",""],["Tata Steel 2023",""]],Tactics:[["50 Puzzles 1600","",50],["50 Puzzles 2000","",50],["50 Puzzles 2200","",50]],Endgames:[["100 Endgames You Must Know",""],["King and Pawn Endgames",""]]};class _{static init=()=>{function t(s){return S[s].map(i=>({category:s,study_name:i[0],study_id:i[1],orientation:i[3]}))}let e=new _;return e.openings=t("Openings"),e.masters=t("Masters"),e.tactics=t("Tactics"),e.endgames=t("Endgames"),e.all=[...e.openings,...e.masters,...e.tactics,...e.endgames],e.recent=[],e.completed=[],e.imported=p([],"fixture.imported"),e};clear_progress(t){Object.entries(localStorage).map(e=>e[0]).filter(e=>e.includes(`.openings.id.${t}`)).map(e=>localStorage.removeItem(e))}async update_imported_study(t){let e=`https://lichess.org/study/${t}`,s=await fetch(`https://lichess.org/api/study/${t}.pgn`).then(i=>i.text());m.save_import_pgn(t,s,e)}delete_imported_study(t){let e=this.imported[0]();e=e.filter(n=>n.study_id!==t),this.imported[1](e);let[s,i]=p("","pgn.imported."+t);i(""),Object.entries(localStorage).map(n=>n[0]).filter(n=>n.includes(`.openings.id.${t}`)).map(n=>localStorage.removeItem(n))}save_import_pgn(t,e,s){this.delete_imported_study(t);let i="";i=u(e,t,i,"white",s).name;let a=this.imported[0]();a.push({category:"openings",study_name:i,study_id:t,import_lichess_link:s,import_pgn:!s}),this.imported[1](a);let[o,l]=p("","pgn.imported."+t);l(e)}all;openings;masters;tactics;endgames;recent;completed;imported;imported_by_id(t){return this.imported[0]().find(s=>s.study_id===t)}study_by_id(t){return this.all.find(s=>s.study_id===t)}}const m=_.init();export{m as R,P as S};
