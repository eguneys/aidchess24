import{g as $,a7 as Z,a8 as A,a9 as ee,n as te,q as R,aa as se,v as ie,u as y,B as O,i as l,c as f,A as ne,j,k as q,F as B,S as E,t as b,D as P,e as le,d as re,R as w}from"./index-BZK0BI4d.js";function be(s){const i=$(()=>Z(A(s)));return()=>i()()}function C(s){const[i,a]=ee([]);return te(R(s,()=>{ae(A(s),i,a)})),i}function ae(s,i,a,e={key:"id"}){const t=s.subscribe(c=>a(se(c,e)));return ie(()=>"unsubscribe"in t?t.unsubscribe():t()),i}var ce=b("<div class=repeat-show><div class=studies><h3>Repertoires</h3><div class=list-wrap><div class=list>"),F=b("<div>"),de=b("<p>Selected <!> sections"),oe=b("<div class=buttons><button>First 10 moves <span></span></button><div class=small><button>10-20 moves <span></span></button><button>20+ moves <span></span></button></div><div class=small><button>White moves <span></span></button><button>Black moves <span>"),ue=b("<div class=study-side><div class=sections><h3>Sections</h3><div class=list-wrap><div class=list></div></div></div><div class=dues>"),_e=b("<p> Please Select Some Sections ");const he=()=>{const s=y(w),i=C(()=>s.studies.toArray()),[a,e]=O(0,"dues.show"),t=$(()=>i[a()]);return(()=>{var c=ce(),h=c.firstChild,m=h.firstChild,d=m.nextSibling,p=d.firstChild;return l(p,f(B,{each:i,get fallback(){return f(ne,{href:"/repertoires",children:"Import some studies first"})},children:(_,n)=>(()=>{var r=F();return r.$$click=()=>e(n()),l(r,()=>_.name),j(()=>q(r,"study"+(a()===n()?" active":""))),r})()})),l(c,f(E,{get when(){return t()},children:_=>f($e,{get study(){return _()}})}),null),c})()},N=s=>{const i=y(w);let a=C(async()=>{let e=await i.due_cards.where("section_id").anyOf(s).toArray();return await Promise.all(e.map(async t=>{let c=await i.moves.where("id").anyOf(t.move_ids).toArray(),h=await i.sections.where("id").equals(t.section_id).first(),m=await Promise.all(c.map(async d=>({data:d.data,chapter:await i.chapters.where("id").equals(d.chapter_id).first()})));return{id:t.id,before_fen:t.before_fen,due:t.card.due.getTime(),section:h,moves:m}}))});return{get due(){return a.filter(e=>e.due<=new Date().getTime())},get due_white(){return this.due.filter(e=>P(e.before_fen)==="white")},get due_black(){return this.due.filter(e=>P(e.before_fen)==="black")},get due_10(){return this.due.filter(e=>e.moves[0]?.data.path.length<=20)},get due_10_20(){return this.due.filter(e=>e.moves[0]?.data.path.length>=20&&e.moves[0].data.path.length<=40)},get due_20plus(){return this.due.filter(e=>e.moves[0]?.data.path.length>=40)}}},Q=s=>O([],"repeat.selected_sections."+s),$e=s=>{const i=y(w),a=C(()=>i.sections.where("study_id").equals(s.study.id).toArray()),e=$(()=>Q(s.study.id)),t=$(()=>e()[0]()),c=n=>e()[1](n),h=$(()=>t().length),m=n=>{t().includes(n)?c(t().filter(r=>r!==n)):c([...t(),n])};let d=$(R(t,n=>N(n)));const p=le(),_=n=>{let r=s.study.id;p("/repeat/"+r+(n?`?filter=${n}`:""))};return(()=>{var n=ue(),r=n.firstChild,T=r.firstChild,M=T.nextSibling,z=M.firstChild,I=r.nextSibling;return l(z,f(B,{each:a,children:o=>(()=>{var u=F();return u.$$click=()=>m(o.id),l(u,()=>o.name),j(()=>q(u,"section"+(t().includes(o.id)?" selected":""))),u})()})),l(I,f(E,{get when(){return h()>0},get fallback(){return _e()},get children(){return[(()=>{var o=de(),u=o.firstChild,g=u.nextSibling;return g.nextSibling,l(o,h,g),o})(),(()=>{var o=oe(),u=o.firstChild,g=u.firstChild,V=g.nextSibling,x=u.nextSibling,v=x.firstChild,W=v.firstChild,G=W.nextSibling,k=v.nextSibling,H=k.firstChild,J=H.nextSibling,K=x.nextSibling,S=K.firstChild,L=S.firstChild,U=L.nextSibling,D=S.nextSibling,X=D.firstChild,Y=X.nextSibling;return u.$$click=()=>_("first-ten"),l(V,()=>d().due_10.length),v.$$click=()=>_("ten-twenty"),l(G,()=>d().due_10_20.length),k.$$click=()=>_("twenty-plus"),l(J,()=>d().due_20plus.length),S.$$click=()=>_("white"),l(U,()=>d().due_white.length),D.$$click=()=>_("black"),l(Y,()=>d().due_black.length),o})()]}})),n})()};re(["click"]);const me=Object.freeze(Object.defineProperty({__proto__:null,Due_Component:N,PersistedSelectionComponent:Q,default:he},Symbol.toStringTag,{value:"Module"}));export{N as D,Q as P,me as S,be as c};
