var ke=Object.defineProperty;var Ce=(u,r,e)=>r in u?ke(u,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[r]=e;var k=(u,r,e)=>(Ce(u,typeof r!="symbol"?r+"":r,e),e);import{h as Se,j as ye,i as d,c as h,S as C,k as S,b as p,l as f,m as y,o as Y,n as te,p as re,q as xe,f as O,g as W,F as ae,s as A,M as P,e as Me,r as Ee,d as Pe,t as a,v as $}from"./index-d0EvX5jC.js";/* empty css                   */import{S as Te}from"./studyrepo-B2LCCshh.js";import{S as Re,C as De}from"./Shalala-DeWI7E8n.js";import{T as Qe,a as B,C as Le}from"./Chesstree2-Dv5pdjWQ.js";import{I as Ye,M as je}from"./chess_pgn_logic-BE3PMxqv.js";import{S as Ie,O as se}from"./SessionStore-BwDqybXh.js";import"./index-p05AIKDF.js";function Oe(u){let r=0;return e=>{r+=e.deltaY*(e.deltaMode?40:1),Math.abs(r)>=4?(u(e,!0),r=0):u(e,!1)}}var Ae=a("<div class=progress><div class=bar></div><h3>"),Ne=a("<div class=repertoire-wrap>"),le=a("<small> Click on variations to expand. "),Fe=a("<small> Your goal is to guess every move correctly to pass the quiz. "),Ge=a("<h2>Select a Quiz Option"),We=a("<button><span> Take Quiz "),Be=a("<button><span> Play Deathmatch "),He=a("<h2>Deathmatch Mode"),ie=a("<span class=passed>passed"),Ke=a("<small> Deathmatch "),Ue=a("<small> Your score: "),Je=a("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),Ve=a("<h2>Quiz Mode"),Xe=a("<small> Quiz "),Ze=a("<small> Your score: <!> out of 15 correct"),et=a("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),tt=a("<small> Your goal is to guess every move correctly to fill up the progress bar. "),rt=a("<h2>Select a Practice Option"),at=a("<button><span> Play all Moves "),st=a("<button><span> Play as Match "),lt=a("<h2>Play as Match"),_e=a("<small> End of practice. "),oe=a("<small> Congratulations. "),it=a("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),_t=a("<h2>Play all moves"),ot=a("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),nt=a("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),ct=a("<li><div><h3></h3> "),ht=a('<div class=line><span class="fill white"></span><span class="fill black">'),ut=a("<small>You will play the moves from the opening."),dt=a("<small>If you go out of book, game ends."),mt=a("<div class=in_mode><button class=end2><span> End Deathmatch "),ne=a("<span class=failed>failed"),pt=a("<small>You are given 15 random positions from the opening."),vt=a("<small>Guess the correct move."),ft=a("<h2> of 15"),gt=a("<div class=in_mode><button class=end2><span> End Quiz "),$t=a("<small> Try to guess the moves for <!>."),zt=a("<small> AI will play the next move, picking a random variation. "),qt=a("<small> Moves will be hidden once the game is started. "),bt=a("<small>Try to guess the moves for both sides."),wt=a("<small>Moves will be hidden once you start.");const kt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Ct=u=>kt[Math.floor((1-u/10)*6)];class St{constructor(){k(this,"_mode");k(this,"_match_color");k(this,"_practice_end_result");k(this,"_quiz_quiz_ls");k(this,"_quiz_deathmatch_fail");k(this,"_quiz_deathmatch_result_path");this._mode=S(void 0,{equals:!1}),this._match_color=S("white"),this._quiz_quiz_ls=S([],{equals:!1}),this._quiz_deathmatch_fail=S(0),this._quiz_deathmatch_result_path=S([]),this._practice_end_result=S(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){$(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){$(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){$(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){$(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){$(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){$(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){$(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){$(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){$(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const ce=u=>(()=>{var r=Ae(),e=r.firstChild,i=e.nextSibling;return d(i,()=>`%${u.width}`),O(o=>A(e,`width: ${u.width}%`,o)),r})();class yt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(e=>Math.round(e.progress/r)).reduce((e,i)=>e+i)}}class T{constructor(r,e,i,o){this.study_id=r,this.i_chapter=e,this.score_tree=i,this.solved_paths=o}static load_from_store(r,e){let i=new se(r.id,e);return T.make(r.id,e,r.chapters[e].pgn.tree,B.set_for_saving(i.solved_paths))}static save_paths_to_store(r){let e=new se(r.study_id,r.i_chapter);e.solved_paths=r.solved_paths.get_for_saving(),e.practice_progress=r.progress}static make(r,e,i,o=new B){return new T(r,e,je.make(i),o)}get progress(){return Math.floor(this.solved_paths.expand_paths.map(r=>{var e;return((e=this.score_tree.get_at(r))==null?void 0:e.score)??0}).reduce((r,e)=>r+e,0)*100)}get progress_map(){let r=y(()=>this.score_tree.progress_paths);const e=y(()=>r.map(i=>[i.filter(o=>o.length%2===1).map(o=>this.score_tree.get_at(o).score).reduce((o,q)=>o+q,0),i.filter(o=>o.length%2===0).map(o=>this.score_tree.get_at(o).score).reduce((o,q)=>o+q,0)]));return r.map((i,o)=>{let q=i[0],x=i[i.length-1],R=e[o][0],D=e[o][1],c=p(()=>this.solved_paths.expand_paths),Q=p(()=>c().filter(m=>i.some(z=>z.join("")===m.join("")))),L=p(()=>Q().filter(m=>m.length%2===1).map(m=>this.score_tree.get_at(m).score).reduce((m,z)=>m+z,0)),j=p(()=>Q().filter(m=>m.length%2===0).map(m=>this.score_tree.get_at(m).score).reduce((m,z)=>m+z,0));return{color:Ct(q.length/20+x.length/10),total:R*2,black:p(()=>j()/D),white:p(()=>L()/R),path:x}}).reverse()}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),T.save_paths_to_store(this)}}const jt=()=>{const u=Se(),[r]=ye(u.id,Te.read_study);return(()=>{var e=Ne();return d(e,h(C,{get when(){return!r.loading},fallback:"Loading...",get children(){return h(xt,{get study(){return r()}})}})),e})()},xt=u=>{const r=()=>u.study;let e=new St,i=new Re;const[o,q]=S(Ie.i_chapter??0);let x=p(()=>{const s=r();return new yt(s.chapters.map((_,g)=>T.load_from_store(s,g)))}),R=p(()=>x().chapters[o()]);const D=p(()=>r().chapters[o()]),c=p(()=>{e.mode;let s=D();return Qe.make(s.pgn.tree.clone)}),Q=p(()=>{if(e.mode==="quiz-quiz")return e.i_quiz_quiz===15});f(()=>{e.mode==="quiz-quiz"&&(e.i_quiz_quiz===15||y(()=>{c().set_random_cursor_hide_rest(),e.match_color=c().cursor_after_color}))}),f(()=>{let{mode:s,match_color:_}=e;s==="quiz-deathmatch"&&_==="black"&&setTimeout(()=>{y(()=>{c().reveal_one_random()})},400)}),f(()=>{c().solved_paths.replace_all(R().solved_paths)});const L=p(()=>{let s=c().tree;return y(()=>T.make(r().name,o(),s,new B))});f(()=>{if(e.mode!=="match"&&e.mode!=="moves")return;y(()=>L()).solved_paths.replace_all(c().solved_paths)}),f(Y(()=>[L(),R()],(s,_)=>{if(_){let[g,M]=_;M.merge_and_save_stats(g)}})),f(Y(()=>i.add_uci,s=>{if(!s)return;c().try_next_uci_fail(s)?(j(),e.mode==="quiz-quiz"&&e.quiz_pass_one()):((e.mode==="match"||e.mode==="moves")&&setTimeout(()=>{c().on_wheel(-1)},100),e.mode==="quiz-quiz"&&e.quiz_fail_one(),e.mode==="quiz-deathmatch"&&(e.quiz_deathmatch_fail_result=-1,e.quiz_deathmatch_result_path=c().cursor_path.slice(0,-1)))})),f(()=>{let{mode:s,match_color:_}=e;s==="match"&&_==="black"&&y(()=>{j()})}),f(Y(()=>c().fen_last_move,s=>{if(s){let[_,g]=s;i.on_set_fen_uci(_,g)}else i.on_set_fen_uci(Ye)}));const j=()=>{let s=()=>c().is_cursor_path_at_a_leaf;s()?e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=c().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0):(e.mode==="match"||e.mode==="quiz-deathmatch")&&setTimeout(()=>{c().reveal_one_random(),s()&&(e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=c().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0))},400)};f(Y(()=>i.on_wheel,s=>{s&&c().on_wheel(s)}));const m=s=>{s.key==="f"&&e.flip_match_color()};te(()=>{document.addEventListener("keypress",m)}),re(()=>{document.removeEventListener("keypress",m)});const z=Oe(s=>{const _=s.target;_.tagName!=="PIECE"&&_.tagName!=="SQUARE"&&_.tagName!=="CG-BOARD"||(s.preventDefault(),i.set_on_wheel(Math.sign(s.deltaY)))});f(()=>{e.match_color=r().orientation??"white"});const he=p(()=>L().progress_map);let N;te(()=>{N.addEventListener("wheel",z,{passive:!1})}),re(()=>{N.removeEventListener("wheel",z)});const H=s=>{let _=e.mode;if(s==="practice"){if(_===void 0||_==="match"||_==="moves")return" active"}else if(_==="quiz"||_==="quiz-quiz"||_==="quiz-deathmatch")return" active";return""},ue=p(()=>e.mode!==void 0&&!Q()&&!e.practice_end_result),de=p(Y(()=>e.quiz_deathmatch_result_path,s=>{var M,E;let _=s.length,g=(E=(M=c().tree)==null?void 0:M.all_leaves.map(b=>b.path).filter(b=>!c().failed_paths.find(F=>F.join("")===b.join(""))).filter(b=>b.join("").startsWith(s.join("")))[0])==null?void 0:E.length;return`${_} out of ${g}`}));return(()=>{var s=nt(),_=s.firstChild,g=_.firstChild,M=g.nextSibling,E=M.firstChild,b=E.firstChild,F=E.nextSibling,K=_.nextSibling,U=K.nextSibling,me=U.nextSibling,J=me.firstChild,V=J.firstChild,pe=V.firstChild,ve=pe.nextSibling,fe=V.nextSibling,ge=fe.firstChild,$e=J.nextSibling,X=$e.firstChild,ze=X.nextSibling,Z=ze.firstChild,G=Z.firstChild,ee=G.nextSibling,qe=Z.nextSibling;return xe(t=>N=t,s),d(b,()=>r().name),d(E,h(ce,{get width(){return x().progress}}),null),d(F,h(ae,{get each(){return r().chapters},children:(t,l)=>(()=>{var n=ct(),w=n.firstChild,v=w.firstChild;return v.nextSibling,n.$$click=()=>q(l()),d(v,()=>t.name),d(w,h(ce,{get width(){var I;return((I=x())==null?void 0:I.chapters[l()].progress)??0}}),null),O(()=>W(n,l()===o()?"active":"")),n})()})),d(K,h(De,{get orientation(){return e.match_color},get movable(){return ue()},get doPromotion(){return i.promotion},get onMoveAfter(){return i.on_move_after},get fen_uci(){return i.fen_uci},get color(){return i.turnColor},get dests(){return i.dests}})),d(U,h(ae,{get each(){return he()},children:t=>(()=>{var l=ht(),n=l.firstChild,w=n.nextSibling;return l.$$click=v=>c().try_set_cursor_path(t.path),O(v=>{var I=`background: ${t.color}; height: ${Math.round(t.total*100)}%`,be=`height: ${Math.round(t.white()*100)}%`,we=`height: ${Math.round(t.black()*100)}%`;return v.e=A(l,I,v.e),v.t=A(n,be,v.t),v.a=A(w,we,v.a),v},{e:void 0,t:void 0,a:void 0}),l})()})),d(ve,()=>D().name),d(X,h(Le,{get lala(){return c()}})),G.$$click=()=>e.end_match_or_moves(),ee.$$click=()=>e.mode="quiz",d(qe,h(Me,{get children(){return[h(P,{get when(){return e.mode==="quiz"},get children(){return[le(),Fe(),Ge(),(()=>{var t=We();return t.$$click=()=>e.mode="quiz-quiz",t})(),(()=>{var t=Be();return t.$$click=()=>e.mode="quiz-deathmatch",t})()]}}),h(P,{get when(){return e.mode==="quiz-deathmatch"},get children(){return[He(),h(C,{get when(){return e.quiz_deathmatch_fail_result!==0},get fallback(){return[ut(),dt(),(()=>{var t=mt(),l=t.firstChild;return l.$$click=()=>e.end_deathmatch(),t})()]},get children(){return[(()=>{var t=Ke();return t.firstChild,d(t,h(C,{get when(){return e.quiz_deathmatch_fail_result>0},get fallback(){return ne()},get children(){return[" ",ie()]}}),null),t})(),(()=>{var t=Ue();return t.firstChild,d(t,de,null),t})(),(()=>{var t=Je(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>e.restart_deathmatch(),n.$$click=()=>e.end_deathmatch(),t})()]}})]}}),h(P,{get when(){return e.mode==="quiz-quiz"},get children(){return[Ve(),h(C,{get when(){return Q()},get fallback(){return[pt(),vt(),(()=>{var t=ft(),l=t.firstChild;return d(t,()=>e.i_quiz_quiz,l),t})(),(()=>{var t=gt(),l=t.firstChild;return l.$$click=()=>e.end_quiz(),t})()]},get children(){return[(()=>{var t=Xe();return t.firstChild,d(t,h(C,{get when(){return e.quiz_pass>10},get fallback(){return ne()},get children(){return[" ",ie()]}}),null),t})(),(()=>{var t=Ze(),l=t.firstChild,n=l.nextSibling;return n.nextSibling,d(t,()=>e.quiz_pass,n),t})(),(()=>{var t=et(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>e.restart_quiz(),n.$$click=()=>e.end_quiz(),t})()]}})]}}),h(P,{get when(){return e.mode===void 0},get children(){return[le(),tt(),rt(),(()=>{var t=at();return t.$$click=()=>e.mode="moves",t})(),(()=>{var t=st();return t.$$click=()=>e.mode="match",t})()]}}),h(P,{get when(){return e.mode==="match"},get children(){return[lt(),h(C,{get when(){return e.practice_end_result},get fallback(){return[(()=>{var t=$t(),l=t.firstChild,n=l.nextSibling;return n.nextSibling,d(t,()=>e.match_color,n),t})(),zt(),qt()]},get children(){return[_e(),oe()]}}),(()=>{var t=it(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>e.restart_match(),n.$$click=()=>e.end_match_or_moves(),t})()]}}),h(P,{get when(){return e.mode==="moves"},get children(){return[_t(),h(C,{get when(){return e.practice_end_result},get fallback(){return[bt(),wt()]},get children(){return[_e(),oe()]}}),(()=>{var t=ot(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>{e.restart_moves()},n.$$click=()=>e.end_match_or_moves(),t})()]}})]}})),O(t=>{var l=D().site,n="tab"+H("practice"),w="tab"+H("quiz");return l!==t.e&&Ee(ge,"href",t.e=l),n!==t.t&&W(G,t.t=n),w!==t.a&&W(ee,t.a=w),t},{e:void 0,t:void 0,a:void 0}),s})()};Pe(["click"]);export{jt as default};
