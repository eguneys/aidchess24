var Ue=Object.defineProperty;var Ve=(m,r,i)=>r in m?Ue(m,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[r]=i;var C=(m,r,i)=>(Ve(m,typeof r!="symbol"?r+"":r,i),i);import{h as Je,j as Xe,i as h,c as u,S as M,k as Ze,l as S,m as $,b as v,n as k,o as E,p as Se,q as xe,r as et,f as N,g as w,F as B,s as H,M as Y,v as z,e as tt,w as st,d as rt,t as n}from"./index-RL2AIYcv.js";/* empty css                   */import{S as at}from"./studyrepo-DiWL8oZB.js";import{S as lt,C as it}from"./Shalala-zk4oEHZl.js";import{T as _t,a as le,C as nt}from"./Chesstree2-4T52Obl2.js";import{M as ot,I as ct}from"./chess_pgn_logic-Bo_PnRlm.js";import{O as ht,S as ut,a as Ce}from"./SessionStore-DSIdu9UR.js";import{s as dt}from"./scroll-DnAhRpRC.js";var mt=n("<div class=progress><div class=bar></div><h3>"),pt=n("<div class=repertoire-wrap>"),Ee=n("<small> Click on variations to expand. "),vt=n("<small> Your goal is to guess every move correctly to pass the quiz. "),gt=n("<div class=in_mode><button><span> Take Quiz </span></button><button><span> Play Deathmatch "),ft=n("<h2>Deathmatch Mode"),Me=n("<span class=passed>passed"),$t=n("<small> Deathmatch "),zt=n("<small> Your score: "),Pe=n("<small> Progress +<!>% "),qt=n("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),bt=n("<small> Quiz "),wt=n("<small> Your score: <!> out of 15 correct"),kt=n("<div class=past>"),yt=n("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),St=n("<small> Your goal is to guess every move correctly to fill up the progress bar. "),xt=n("<div class=in_mode><button><span> Play all Moves </span></button><button><span> Play as Match "),Ct=n("<h2>Play as Match"),Te=n("<small> End of practice. "),Re=n("<small> Congratulations. "),Et=n("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Mt=n("<h2>Play all moves"),Pt=n("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Tt=n("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=progress>%</h3><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Rt=n("<li><div><h3></h3> "),Dt=n('<div class=line><span class="fill white"></span><span class="fill black">'),jt=n("<span class=index>"),Lt=n("<div class=fbt>"),Qt=n("<small>You will play the moves from the opening."),It=n("<small>If you go out of book, game ends."),Yt=n("<div class=in_mode><button class=end2><span> End Deathmatch "),De=n("<span class=failed>failed"),At=n("<h3>Quiz Mode"),Nt=n("<small>You are given 15 random positions from the opening."),Ot=n("<small>Guess the correct move."),Ft=n("<h2> of 15"),Gt=n("<div class=in_mode><button class=end2><span> End Quiz "),Wt=n("<span>"),Bt=n("<small> Try to guess the moves for <!>."),Ht=n("<small> AI will play the next move, picking a random variation. "),Kt=n("<small> Moves will be hidden once the game is started. "),Ut=n("<small>Try to guess the moves for both sides."),Vt=n("<small>Moves will be hidden once you start.");const Jt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Xt=m=>Jt[Math.floor((1-m/10)*6)],Zt=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class es{constructor(){C(this,"_mode");C(this,"_match_color");C(this,"_practice_end_result");C(this,"_quiz_quiz_ls_paths",[]);C(this,"_quiz_quiz_ls");C(this,"_quiz_deathmatch_fail");C(this,"_quiz_deathmatch_result_path");this._mode=S(void 0,{equals:!1}),this._match_color=S("white"),this._quiz_quiz_ls=S([],{equals:!1}),this._quiz_deathmatch_fail=S(0),this._quiz_deathmatch_result_path=S([]),this._practice_end_result=S(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){z(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){z(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){z(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){z(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz-quiz"})}end_quiz(){z(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz"})}quiz_pass_one(r){z(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(r)})}quiz_fail_one(r){z(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(r)})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){z(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){z(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const je=m=>(()=>{var r=mt(),i=r.firstChild,d=i.nextSibling;return h(d,()=>`%${m.width}`),N(o=>H(i,`width: ${m.width}%`,o)),r})();class ts{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(i=>Math.round(i.progress/r)).reduce((i,d)=>i+d)}}class D{constructor(r,i,d,o){this.study_id=r,this.i_chapter=i,this.score_tree=d,this.solved_paths=o}static load_from_store(r,i){let d=new Ce(r.id,i);return D.make(r.id,i,r.chapters[i].pgn.tree,le.set_for_saving(d.solved_paths))}static save_paths_to_store(r){let i=new Ce(r.study_id,r.i_chapter);i.solved_paths=r.solved_paths.get_for_saving(),i.practice_progress=r.progress}static make(r,i,d,o=new le){return new D(r,i,ot.make(d),o)}get clone(){return new D(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>k(()=>{var i;return(i=this.score_tree.get_at(r))==null?void 0:i.score})??0).reduce((r,i)=>r+i,0)*100)}get progress_map(){let r=k(()=>this.score_tree.progress_paths);const i=k(()=>r.map(d=>[d.filter(o=>o.length%2===1).map(o=>this.score_tree.get_at(o).score).reduce((o,b)=>o+b,0),d.filter(o=>o.length%2===0).map(o=>this.score_tree.get_at(o).score).reduce((o,b)=>o+b,0)]));return r.map((d,o)=>{let b=d[0],t=d[d.length-1],q=i[o][0],x=i[o][1],K=v(()=>this.solved_paths.paths),j=v(()=>K().filter(s=>d.some(y=>y.join("")===s.join("")))),L=v(()=>j().filter(s=>s.length%2===1).map(s=>this.score_tree.get_at(s).score).reduce((s,y)=>s+y,0)),A=v(()=>j().filter(s=>s.length%2===0).map(s=>this.score_tree.get_at(s).score).reduce((s,y)=>s+y,0));return{color:Xt(b.length/20+t.length/10),total:q+x,black:v(()=>A()/x),white:v(()=>L()/q),path:t}}).reverse()}clone_merge_stats(r){let i=k(()=>this.clone);return i.solved_paths.merge_dup(r.solved_paths),i}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){D.save_paths_to_store(this)}}const us=()=>{const m=Je(),[r]=Xe(m.id,at.read_study);return(()=>{var i=pt();return h(i,u(M,{get when(){return!r.loading},fallback:"Loading...",get children(){return u(ss,{get study(){return r()}})}})),i})()},ss=m=>{const r=Ze(),i=()=>m.study;r.setVolume(.2);let d=new ht(i().id),[o,b]=S(!1),t=new es,q=new lt;const[x,K]=S(ut.i_chapter??d.i_chapter_index);$(()=>{d.i_chapter_index=x()});let j=v(()=>{const a=i();return new ts(a.chapters.map((c,g)=>D.load_from_store(a,g)))}),L=v(()=>j().chapters[x()]);const A=v(()=>i().chapters[x()]),s=v(()=>{t.mode;let a=A();return _t.make(a.pgn.tree.clone)}),y=v(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===16}),[Le,ie]=S(!1);$(()=>{if(t.mode==="quiz-quiz"){let a=y();t.quiz_quiz_ls[t.quiz_quiz_ls.length-1]<0&&(ie(!0),setTimeout(()=>{ie(!1)},500)),a?(r.play("victory"),k(()=>{s().clear_failed_paths(),s()._hidden_paths.clear()})):(b(!0),setTimeout(()=>{z(()=>k(()=>{s().set_random_cursor_hide_rest(),t.match_color=s().cursor_after_color;let g=s().cursor_path;Q(g.slice(0,-1)),setTimeout(()=>{s().cursor_path=g,b(!1)},200)}))},100))}}),$(()=>{let{mode:a,match_color:c}=t;a==="quiz-deathmatch"&&c==="black"&&setTimeout(()=>{k(()=>{s().reveal_one_random()})},400)}),$(()=>{s().solved_paths.replace_all(L().solved_paths)});const O=v(()=>{let a=s().tree;return k(()=>D.make(i().name,x(),a,new le))});$(()=>{k(()=>O()).solved_paths.replace_all(s().solved_paths)});let _e=v(()=>{let a=L(),c=O(),g=k(()=>a.progress);return a.clone_merge_stats(c).progress-g});$(E(()=>[L(),O()],(a,c)=>{if(c){let[g,P]=c;g.merge_and_save_stats(P)}})),$(E(()=>q.add_uci,a=>{if(o()||!a)return;s().try_next_uci_fail(a)?(ne(),t.mode==="quiz-quiz"&&t.quiz_pass_one(s().cursor_path)):((t.mode==="match"||t.mode==="moves")&&(b(!0),setTimeout(()=>{s().on_wheel(-1),b(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(s().cursor_path.slice(0,-1)),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=s().cursor_path.slice(0,-1),s()._hidden_paths.clear()))})),$(E(()=>t.quiz_deathmatch_fail_result,a=>{(a>0||a<0)&&r.play("victory")})),$(E(()=>t.practice_end_result,a=>{a&&r.play("victory")})),$(()=>{let{mode:a,match_color:c}=t;a==="match"&&c==="black"&&k(()=>{ne()})}),$(E(()=>s().fen_last_move,a=>{if(a){let[c,g]=a;q.on_set_fen_uci(c,g)}else q.on_set_fen_uci(ct)}));const ne=()=>{let a=()=>s().is_cursor_path_at_a_leaf;a()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=s().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(b(!0),setTimeout(()=>{s().reveal_one_random(),a()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=s().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),b(!1)},400))};$(E(()=>q.on_wheel,a=>{a&&s().on_wheel(a)}));const oe=a=>{a.key==="f"&&t.flip_match_color()};let U=!1;$(E(()=>{var a;return(a=s().tree)==null?void 0:a.get_at(s().cursor_path)},a=>{if(a){if(U){U=!1;return}r.move(a)}})),Se(()=>{document.addEventListener("keypress",oe)}),xe(()=>{document.removeEventListener("keypress",oe)});const ce=dt(a=>{const c=a.target;c.tagName!=="PIECE"&&c.tagName!=="SQUARE"&&c.tagName!=="CG-BOARD"||(a.preventDefault(),q.set_on_wheel(Math.sign(a.deltaY)))});$(()=>{t.match_color=i().orientation??"white"});const Qe=v(()=>O().progress_map);let V;Se(()=>{V.addEventListener("wheel",ce,{passive:!1})}),xe(()=>{V.removeEventListener("wheel",ce)});const he=a=>{let c=t.mode;if(a==="practice"){if(c===void 0||c==="match"||c==="moves")return" active"}else if(c==="quiz"||c==="quiz-quiz"||c==="quiz-deathmatch")return" active";return""},Ie=v(()=>t.mode!==void 0&&!y()&&!t.practice_end_result&&!t.quiz_deathmatch_fail_result),Ye=v(E(()=>t.quiz_deathmatch_result_path,a=>{var P,I;let c=a.length,g=(I=(P=s().tree)==null?void 0:P.all_leaves.map(T=>T.path).filter(T=>!s().failed_paths.find(J=>J.join("")===T.join(""))).filter(T=>T.join("").startsWith(a.join("")))[0])==null?void 0:I.length;return`${c} out of ${g}`})),Ae=v(()=>s().collect_branch_sums(s().cursor_path)),Q=a=>{U=!0,s().cursor_path=a};return(()=>{var a=Tt(),c=a.firstChild,g=c.firstChild,P=g.nextSibling,I=P.firstChild,T=I.firstChild,J=I.nextSibling,ue=c.nextSibling,de=ue.nextSibling,Ne=de.nextSibling,me=Ne.firstChild,pe=me.firstChild,ve=pe.firstChild,Oe=ve.nextSibling,X=pe.nextSibling,Fe=X.firstChild,Ge=X.nextSibling,We=Ge.firstChild,Be=me.nextSibling,ge=Be.firstChild,Z=ge.nextSibling,F=Z.firstChild,ee=F.nextSibling,fe=Z.nextSibling,te=fe.firstChild,se=te.nextSibling,re=se.nextSibling,$e=re.nextSibling,He=fe.nextSibling,ze=He.firstChild,ae=ze.firstChild,qe=ae.nextSibling,Ke=ze.nextSibling;return et(e=>V=e,a),h(T,()=>i().name),h(I,u(je,{get width(){return j().progress}}),null),h(J,u(B,{get each(){return i().chapters},children:(e,l)=>(()=>{var _=Rt(),p=_.firstChild,f=p.firstChild;return f.nextSibling,_.$$click=()=>K(l()),h(f,()=>e.name),h(p,u(je,{get width(){var R;return((R=j())==null?void 0:R.chapters[l()].progress)??0}}),null),N(()=>w(_,l()===x()?"active":"")),_})()})),h(ue,u(it,{get orientation(){return t.match_color},get movable(){return Ie()},get doPromotion(){return q.promotion},get onMoveAfter(){return q.on_move_after},get fen_uci(){return q.fen_uci},get color(){return q.turnColor},get dests(){return q.dests}})),h(de,u(B,{get each(){return Qe()},children:e=>(()=>{var l=Dt(),_=l.firstChild,p=_.nextSibling;return l.$$click=f=>s().try_set_cursor_path(e.path),N(f=>{var R=`background: ${e.color}; height: ${e.total*100}%`,G=`height: ${e.white()*100}%`,W=`height: ${e.black()*100}%`;return f.e=H(l,R,f.e),f.t=H(_,G,f.t),f.a=H(p,W,f.a),f},{e:void 0,t:void 0,a:void 0}),l})()})),h(ve,()=>i().name),h(Oe,()=>A().name),h(X,()=>L().progress,Fe),h(ge,u(nt,{get lala(){return s()}})),F.$$click=()=>s().navigate_up(),ee.$$click=()=>s().navigate_down(),h(Z,u(B,{get each(){return Ae()},children:e=>(()=>{var l=Lt();return l.$$click=()=>s().try_set_cursor_path(e.path),h(l,u(M,{get when(){return e.ply&1},get children(){var _=jt();return h(_,()=>Zt(e.ply)),_}}),null),h(l,()=>e.san,null),l})()}),null),te.$$click=()=>s().navigate_first(),se.$$click=()=>s().navigate_prev(),re.$$click=()=>s().navigate_next(),$e.$$click=()=>s().navigate_last(),ae.$$click=()=>t.end_match_or_moves(),qe.$$click=()=>t.mode="quiz",h(Ke,u(tt,{get children(){return[u(Y,{get when(){return t.mode==="quiz"},get children(){return[Ee(),vt(),(()=>{var e=gt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="quiz-quiz",_.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),u(Y,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[ft(),u(M,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Qt(),It(),(()=>{var e=Yt(),l=e.firstChild;return l.$$click=()=>{z(()=>{let _=s().cursor_path.slice(0,-1);t.end_deathmatch(),s()._hidden_paths.clear(),Q(_)})},e})()]},get children(){return[(()=>{var e=$t();return e.firstChild,h(e,u(M,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return De()},get children(){return[" ",Me()]}}),null),e})(),(()=>{var e=zt();return e.firstChild,h(e,Ye,null),e})(),(()=>{var e=Pe(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,h(e,_e,_),e})(),(()=>{var e=qt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_deathmatch(),_.$$click=()=>{z(()=>{let p=s().cursor_path.slice(0,-1);t.end_deathmatch(),s()._hidden_paths.clear(),Q(p)})},e})()]}})]}}),u(Y,{get when(){return t.mode==="quiz-quiz"},get children(){return u(M,{get when(){return y()},get fallback(){return[At(),Nt(),Ot(),(()=>{var e=Ft(),l=e.firstChild;return h(e,()=>t.i_quiz_quiz,l),N(()=>w(e,Le()?"error":"")),e})(),(()=>{var e=Gt(),l=e.firstChild;return l.$$click=()=>{z(()=>{let _=s().cursor_path;t.end_quiz(),s()._hidden_paths.clear(),Q(_)})},e})()]},get children(){return[(()=>{var e=bt();return e.firstChild,h(e,u(M,{get when(){return t.quiz_pass>10},get fallback(){return De()},get children(){return[" ",Me()]}}),null),e})(),(()=>{var e=wt(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,h(e,()=>t.quiz_pass,_),e})(),(()=>{var e=Pe(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,h(e,_e,_),e})(),(()=>{var e=kt();return h(e,u(B,{get each(){return t.quiz_quiz_ls},children:(l,_)=>(()=>{var p=Wt();return p.$$click=()=>s().cursor_path=t._quiz_quiz_ls_paths[_()],w(p,"move "+(l>0?"success":"error")),h(p,()=>_()+1),p})()})),e})(),(()=>{var e=yt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_quiz(),_.$$click=()=>{z(()=>{let p=s().cursor_path;t.end_quiz(),s()._hidden_paths.clear(),Q(p)})},e})()]}})}}),u(Y,{get when(){return t.mode===void 0},get children(){return[Ee(),St(),(()=>{var e=xt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="moves",_.$$click=()=>t.mode="match",e})()]}}),u(Y,{get when(){return t.mode==="match"},get children(){return[Ct(),u(M,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Bt(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,h(e,()=>t.match_color,_),e})(),Ht(),Kt()]},get children(){return[Te(),Re()]}}),(()=>{var e=Et(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_match(),_.$$click=()=>{let p=s().cursor_path;t.end_match_or_moves(),s()._hidden_paths.clear(),Q(p)},e})()]}}),u(Y,{get when(){return t.mode==="moves"},get children(){return[Mt(),u(M,{get when(){return t.practice_end_result},get fallback(){return[Ut(),Vt()]},get children(){return[Te(),Re()]}}),(()=>{var e=Pt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>{t.restart_moves()},_.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),N(e=>{var l=A().site,_=o()||!s().can_navigate_up,p="fbt prev"+(!o()&&s().can_navigate_up?"":" disabled"),f=o()||!s().can_navigate_down,R="fbt prev"+(!o()&&s().can_navigate_down?"":" disabled"),G="fbt first"+(!o()&&s().can_navigate_prev?"":" disabled"),W="fbt prev"+(!o()&&s().can_navigate_prev?"":" disabled"),be="fbt next"+(!o()&&s().can_navigate_next?"":" disabled"),we="fbt last"+(!o()&&s().can_navigate_next?"":" disabled"),ke="tab"+he("practice"),ye="tab"+he("quiz");return l!==e.e&&st(We,"href",e.e=l),_!==e.t&&(F.disabled=e.t=_),p!==e.a&&w(F,e.a=p),f!==e.o&&(ee.disabled=e.o=f),R!==e.i&&w(ee,e.i=R),G!==e.n&&w(te,e.n=G),W!==e.s&&w(se,e.s=W),be!==e.h&&w(re,e.h=be),we!==e.r&&w($e,e.r=we),ke!==e.d&&w(ae,e.d=ke),ye!==e.l&&w(qe,e.l=ye),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a})()};rt(["click"]);export{us as default};
