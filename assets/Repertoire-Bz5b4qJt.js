var Ne=Object.defineProperty;var Fe=(m,r,s)=>r in m?Ne(m,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[r]=s;var R=(m,r,s)=>(Fe(m,typeof r!="symbol"?r+"":r,s),s);import{h as Ge,j as We,i as u,c as d,S as C,k as Be,l as x,b as p,m as $,n as w,o as S,p as be,q as qe,r as He,f as F,g as k,F as ee,s as G,M as L,e as Ke,v as Ue,d as Je,t as l,w as y}from"./index-NqVopViM.js";/* empty css                   */import{S as Ve}from"./studyrepo-2V_mIfSy.js";import{S as Xe,C as Ze}from"./Shalala-YAjY4SII.js";import{T as et,a as te,C as tt}from"./Chesstree2-BZyUToPS.js";import{M as rt,I as at}from"./chess_pgn_logic-oqEZb5j_.js";import{S as st,O as we}from"./SessionStore-DoSfT7CH.js";import{s as lt}from"./scroll-DnAhRpRC.js";var it=l("<div class=progress><div class=bar></div><h3>"),_t=l("<div class=repertoire-wrap>"),ke=l("<small> Click on variations to expand. "),nt=l("<small> Your goal is to guess every move correctly to pass the quiz. "),ot=l("<h2>Select a Quiz Option"),ct=l("<button><span> Take Quiz "),ht=l("<button><span> Play Deathmatch "),ut=l("<h2>Deathmatch Mode"),ye=l("<span class=passed>passed"),dt=l("<small> Deathmatch "),mt=l("<small> Your score: "),Se=l("<small> Progress +<!>% "),pt=l("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),vt=l("<h2>Quiz Mode"),gt=l("<small> Quiz "),ft=l("<small> Your score: <!> out of 15 correct"),$t=l("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),zt=l("<small> Your goal is to guess every move correctly to fill up the progress bar. "),bt=l("<h2>Select a Practice Option"),qt=l("<button><span> Play all Moves "),wt=l("<button><span> Play as Match "),kt=l("<h2>Play as Match"),Ce=l("<small> End of practice. "),xe=l("<small> Congratulations. "),yt=l("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),St=l("<h2>Play all moves"),Ct=l("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),xt=l("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Mt=l("<li><div><h3></h3> "),Pt=l('<div class=line><span class="fill white"></span><span class="fill black">'),Et=l("<span class=index>"),Tt=l("<div class=fbt>"),Rt=l("<small>You will play the moves from the opening."),Dt=l("<small>If you go out of book, game ends."),Qt=l("<div class=in_mode><button class=end2><span> End Deathmatch "),Me=l("<span class=failed>failed"),jt=l("<small>You are given 15 random positions from the opening."),Lt=l("<small>Guess the correct move."),It=l("<h2> of 15"),Ot=l("<div class=in_mode><button class=end2><span> End Quiz "),Yt=l("<small> Try to guess the moves for <!>."),At=l("<small> AI will play the next move, picking a random variation. "),Nt=l("<small> Moves will be hidden once the game is started. "),Ft=l("<small>Try to guess the moves for both sides."),Gt=l("<small>Moves will be hidden once you start.");const Wt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Bt=m=>Wt[Math.floor((1-m/10)*6)],Ht=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Kt{constructor(){R(this,"_mode");R(this,"_match_color");R(this,"_practice_end_result");R(this,"_quiz_quiz_ls");R(this,"_quiz_deathmatch_fail");R(this,"_quiz_deathmatch_result_path");this._mode=x(void 0,{equals:!1}),this._match_color=x("white"),this._quiz_quiz_ls=x([],{equals:!1}),this._quiz_deathmatch_fail=x(0),this._quiz_deathmatch_result_path=x([]),this._practice_end_result=x(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){y(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){y(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){y(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){y(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){y(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){y(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){y(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){y(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){y(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const Pe=m=>(()=>{var r=it(),s=r.firstChild,c=s.nextSibling;return u(c,()=>`%${m.width}`),F(h=>G(s,`width: ${m.width}%`,h)),r})();class Ut{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(s=>Math.round(s.progress/r)).reduce((s,c)=>s+c)}}class D{constructor(r,s,c,h){this.study_id=r,this.i_chapter=s,this.score_tree=c,this.solved_paths=h}static load_from_store(r,s){let c=new we(r.id,s);return D.make(r.id,s,r.chapters[s].pgn.tree,te.set_for_saving(c.solved_paths))}static save_paths_to_store(r){let s=new we(r.study_id,r.i_chapter);s.solved_paths=r.solved_paths.get_for_saving(),s.practice_progress=r.progress}static make(r,s,c,h=new te){return new D(r,s,rt.make(c),h)}get clone(){return new D(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>w(()=>{var s;return(s=this.score_tree.get_at(r))==null?void 0:s.score})??0).reduce((r,s)=>r+s,0)*100)}get progress_map(){let r=w(()=>this.score_tree.progress_paths);const s=w(()=>r.map(c=>[c.filter(h=>h.length%2===1).map(h=>this.score_tree.get_at(h).score).reduce((h,t)=>h+t,0),c.filter(h=>h.length%2===0).map(h=>this.score_tree.get_at(h).score).reduce((h,t)=>h+t,0)]));return r.map((c,h)=>{let t=c[0],f=c[c.length-1],M=s[h][0],W=s[h][1],I=p(()=>this.solved_paths.paths),Q=p(()=>I().filter(v=>c.some(q=>q.join("")===v.join("")))),O=p(()=>Q().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,q)=>v+q,0)),i=p(()=>Q().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,q)=>v+q,0));return{color:Bt(t.length/20+f.length/10),total:M*2,black:p(()=>i()/W),white:p(()=>O()/M),path:f}}).reverse()}clone_merge_stats(r){let s=w(()=>this.clone);return s.solved_paths.merge_dup(r.solved_paths),s}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){D.save_paths_to_store(this)}}const ir=()=>{const m=Ge(),[r]=We(m.id,Ve.read_study);return(()=>{var s=_t();return u(s,d(C,{get when(){return!r.loading},fallback:"Loading...",get children(){return d(Jt,{get study(){return r()}})}})),s})()},Jt=m=>{const r=Be(),s=()=>m.study;let[c,h]=x(!1),t=new Kt,f=new Xe;const[M,W]=x(st.i_chapter??0);let I=p(()=>{const a=s();return new Ut(a.chapters.map((o,z)=>D.load_from_store(a,z)))}),Q=p(()=>I().chapters[M()]);const O=p(()=>s().chapters[M()]),i=p(()=>{t.mode;let a=O();return et.make(a.pgn.tree.clone)}),v=p(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===15});$(()=>{t.mode==="quiz-quiz"&&(t.i_quiz_quiz===15||w(()=>{i().set_random_cursor_hide_rest(),t.match_color=i().cursor_after_color}))}),$(()=>{let{mode:a,match_color:o}=t;a==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{w(()=>{i().reveal_one_random()})},400)}),$(()=>{i().solved_paths.replace_all(Q().solved_paths)});const q=p(()=>{let a=i().tree;return w(()=>D.make(s().name,M(),a,new te))});$(()=>{w(()=>q()).solved_paths.replace_all(i().solved_paths)});let re=p(()=>{let a=Q(),o=q(),z=w(()=>a.progress);return a.clone_merge_stats(o).progress-z});$(S(()=>[Q(),q()],(a,o)=>{if(o){let[z,P]=o;z.merge_and_save_stats(P)}})),$(S(()=>f.add_uci,a=>{if(c()||!a)return;i().try_next_uci_fail(a)?(ae(),t.mode==="quiz-quiz"&&t.quiz_pass_one()):((t.mode==="match"||t.mode==="moves")&&(h(!0),setTimeout(()=>{i().on_wheel(-1),h(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=i().cursor_path.slice(0,-1)))})),$(S(()=>t.quiz_deathmatch_fail_result,a=>{(a>0||a<0)&&r.play("victory")})),$(S(()=>t.practice_end_result,a=>{a&&r.play("victory")})),$(()=>{let{mode:a,match_color:o}=t;a==="match"&&o==="black"&&w(()=>{ae()})}),$(S(()=>i().fen_last_move,a=>{if(a){let[o,z]=a;f.on_set_fen_uci(o,z)}else f.on_set_fen_uci(at)}));const ae=()=>{let a=()=>i().is_cursor_path_at_a_leaf;a()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=i().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(h(!0),setTimeout(()=>{i().reveal_one_random(),a()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=i().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),h(!1)},400))};$(S(()=>f.on_wheel,a=>{a&&i().on_wheel(a)}));const se=a=>{a.key==="f"&&t.flip_match_color()};$(S(()=>{var a;return(a=i().tree)==null?void 0:a.get_at(i().cursor_path)},a=>{a&&r.move(a)})),be(()=>{document.addEventListener("keypress",se)}),qe(()=>{document.removeEventListener("keypress",se)});const le=lt(a=>{const o=a.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(a.preventDefault(),f.set_on_wheel(Math.sign(a.deltaY)))});$(()=>{t.match_color=s().orientation??"white"});const Ee=p(()=>q().progress_map);let B;be(()=>{B.addEventListener("wheel",le,{passive:!1})}),qe(()=>{B.removeEventListener("wheel",le)});const ie=a=>{let o=t.mode;if(a==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},Te=p(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),Re=p(S(()=>t.quiz_deathmatch_result_path,a=>{var P,j;let o=a.length,z=(j=(P=i().tree)==null?void 0:P.all_leaves.map(E=>E.path).filter(E=>!i().failed_paths.find(H=>H.join("")===E.join(""))).filter(E=>E.join("").startsWith(a.join("")))[0])==null?void 0:j.length;return`${o} out of ${z}`})),De=p(()=>{var a;return(a=i().tree)==null?void 0:a.collect_branch_sums(i().cursor_path)});return(()=>{var a=xt(),o=a.firstChild,z=o.firstChild,P=z.nextSibling,j=P.firstChild,E=j.firstChild,H=j.nextSibling,_e=o.nextSibling,ne=_e.nextSibling,Qe=ne.nextSibling,oe=Qe.firstChild,ce=oe.firstChild,he=ce.firstChild,je=he.nextSibling,Le=ce.nextSibling,Ie=Le.firstChild,Oe=oe.nextSibling,ue=Oe.firstChild,K=ue.nextSibling,Y=K.firstChild,U=Y.nextSibling,de=K.nextSibling,J=de.firstChild,V=J.nextSibling,X=V.nextSibling,me=X.nextSibling,Ye=de.nextSibling,pe=Ye.firstChild,Z=pe.firstChild,ve=Z.nextSibling,Ae=pe.nextSibling;return He(e=>B=e,a),u(E,()=>s().name),u(j,d(Pe,{get width(){return I().progress}}),null),u(H,d(ee,{get each(){return s().chapters},children:(e,_)=>(()=>{var n=Mt(),b=n.firstChild,g=b.firstChild;return g.nextSibling,n.$$click=()=>W(_()),u(g,()=>e.name),u(b,d(Pe,{get width(){var T;return((T=I())==null?void 0:T.chapters[_()].progress)??0}}),null),F(()=>k(n,_()===M()?"active":"")),n})()})),u(_e,d(Ze,{get orientation(){return t.match_color},get movable(){return Te()},get doPromotion(){return f.promotion},get onMoveAfter(){return f.on_move_after},get fen_uci(){return f.fen_uci},get color(){return f.turnColor},get dests(){return f.dests}})),u(ne,d(ee,{get each(){return Ee()},children:e=>(()=>{var _=Pt(),n=_.firstChild,b=n.nextSibling;return _.$$click=g=>i().try_set_cursor_path(e.path),F(g=>{var T=`background: ${e.color}; height: ${Math.round(e.total*100)}%`,A=`height: ${Math.round(e.white()*100)}%`,N=`height: ${Math.round(e.black()*100)}%`;return g.e=G(_,T,g.e),g.t=G(n,A,g.t),g.a=G(b,N,g.a),g},{e:void 0,t:void 0,a:void 0}),_})()})),u(he,()=>s().name),u(je,()=>O().name),u(ue,d(tt,{get lala(){return i()}})),Y.$$click=()=>i().navigate_up(),U.$$click=()=>i().navigate_down(),u(K,d(ee,{get each(){return De()},children:e=>(()=>{var _=Tt();return _.$$click=()=>i().try_set_cursor_path(e.path),u(_,d(C,{get when(){return e.ply&1},get children(){var n=Et();return u(n,()=>Ht(e.ply)),n}}),null),u(_,()=>e.san,null),_})()}),null),J.$$click=()=>i().navigate_first(),V.$$click=()=>i().navigate_prev(),X.$$click=()=>i().navigate_next(),me.$$click=()=>i().navigate_last(),Z.$$click=()=>t.end_match_or_moves(),ve.$$click=()=>t.mode="quiz",u(Ae,d(Ke,{get children(){return[d(L,{get when(){return t.mode==="quiz"},get children(){return[ke(),nt(),ot(),(()=>{var e=ct();return e.$$click=()=>t.mode="quiz-quiz",e})(),(()=>{var e=ht();return e.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(L,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[ut(),d(C,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Rt(),Dt(),(()=>{var e=Qt(),_=e.firstChild;return _.$$click=()=>t.end_deathmatch(),e})()]},get children(){return[(()=>{var e=dt();return e.firstChild,u(e,d(C,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return Me()},get children(){return[" ",ye()]}}),null),e})(),(()=>{var e=mt();return e.firstChild,u(e,Re,null),e})(),(()=>{var e=Se(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,re,n),e})(),(()=>{var e=pt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_deathmatch(),n.$$click=()=>t.end_deathmatch(),e})()]}})]}}),d(L,{get when(){return t.mode==="quiz-quiz"},get children(){return[vt(),d(C,{get when(){return v()},get fallback(){return[jt(),Lt(),(()=>{var e=It(),_=e.firstChild;return u(e,()=>t.i_quiz_quiz,_),e})(),(()=>{var e=Ot(),_=e.firstChild;return _.$$click=()=>t.end_quiz(),e})()]},get children(){return[(()=>{var e=gt();return e.firstChild,u(e,d(C,{get when(){return t.quiz_pass>10},get fallback(){return Me()},get children(){return[" ",ye()]}}),null),e})(),(()=>{var e=ft(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,()=>t.quiz_pass,n),e})(),(()=>{var e=Se(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,re,n),e})(),(()=>{var e=$t(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_quiz(),n.$$click=()=>{let b=i().cursor_path;t.end_quiz(),i().cursor_path=b},e})()]}})]}}),d(L,{get when(){return t.mode===void 0},get children(){return[ke(),zt(),bt(),(()=>{var e=qt();return e.$$click=()=>t.mode="moves",e})(),(()=>{var e=wt();return e.$$click=()=>t.mode="match",e})()]}}),d(L,{get when(){return t.mode==="match"},get children(){return[kt(),d(C,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Yt(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,()=>t.match_color,n),e})(),At(),Nt()]},get children(){return[Ce(),xe()]}}),(()=>{var e=yt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_match(),n.$$click=()=>{let b=i().cursor_path;t.end_match_or_moves(),i().cursor_path=b},e})()]}}),d(L,{get when(){return t.mode==="moves"},get children(){return[St(),d(C,{get when(){return t.practice_end_result},get fallback(){return[Ft(),Gt()]},get children(){return[Ce(),xe()]}}),(()=>{var e=Ct(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>{t.restart_moves()},n.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),F(e=>{var _=O().site,n=c()||!i().can_navigate_up,b="fbt prev"+(!c()&&i().can_navigate_up?"":" disabled"),g=c()||!i().can_navigate_down,T="fbt prev"+(!c()&&i().can_navigate_down?"":" disabled"),A="fbt first"+(!c()&&i().can_navigate_prev?"":" disabled"),N="fbt prev"+(!c()&&i().can_navigate_prev?"":" disabled"),ge="fbt next"+(!c()&&i().can_navigate_next?"":" disabled"),fe="fbt last"+(!c()&&i().can_navigate_next?"":" disabled"),$e="tab"+ie("practice"),ze="tab"+ie("quiz");return _!==e.e&&Ue(Ie,"href",e.e=_),n!==e.t&&(Y.disabled=e.t=n),b!==e.a&&k(Y,e.a=b),g!==e.o&&(U.disabled=e.o=g),T!==e.i&&k(U,e.i=T),A!==e.n&&k(J,e.n=A),N!==e.s&&k(V,e.s=N),ge!==e.h&&k(X,e.h=ge),fe!==e.r&&k(me,e.r=fe),$e!==e.d&&k(Z,e.d=$e),ze!==e.l&&k(ve,e.l=ze),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a})()};Je(["click"]);export{ir as default};
