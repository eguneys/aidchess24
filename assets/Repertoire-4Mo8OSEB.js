var Ge=Object.defineProperty;var We=(m,r,l)=>r in m?Ge(m,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[r]=l;var D=(m,r,l)=>(We(m,typeof r!="symbol"?r+"":r,l),l);import{h as Be,j as He,i as h,c as d,S as C,k as Ke,l as x,b as p,m as b,n as k,o as S,p as qe,q as we,r as Ue,f as F,g as y,F as te,s as G,M as L,v as z,e as Je,w as Ve,d as Xe,t as i}from"./index-hRg8vhwz.js";/* empty css                   */import{S as Ze}from"./studyrepo-DKXVOn_4.js";import{S as et,C as tt}from"./Shalala-TQl-s5DB.js";import{T as rt,a as re,C as at}from"./Chesstree2-C46Zl0WE.js";import{M as st,I as lt}from"./chess_pgn_logic-Dc05pp9D.js";import{S as it,O as ke}from"./SessionStore-Cg4s5BaG.js";import{s as _t}from"./scroll-DnAhRpRC.js";var nt=i("<div class=progress><div class=bar></div><h3>"),ot=i("<div class=repertoire-wrap>"),ye=i("<small> Click on variations to expand. "),ct=i("<small> Your goal is to guess every move correctly to pass the quiz. "),ht=i("<h2>Select a Quiz Option"),ut=i("<button><span> Take Quiz "),dt=i("<button><span> Play Deathmatch "),mt=i("<h2>Deathmatch Mode"),Se=i("<span class=passed>passed"),pt=i("<small> Deathmatch "),vt=i("<small> Your score: "),Ce=i("<small> Progress +<!>% "),gt=i("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),ft=i("<h2>Quiz Mode"),$t=i("<small> Quiz "),bt=i("<small> Your score: <!> out of 15 correct"),zt=i("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),qt=i("<small> Your goal is to guess every move correctly to fill up the progress bar. "),wt=i("<h2>Select a Practice Option"),kt=i("<button><span> Play all Moves "),yt=i("<button><span> Play as Match "),St=i("<h2>Play as Match"),xe=i("<small> End of practice. "),Me=i("<small> Congratulations. "),Ct=i("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),xt=i("<h2>Play all moves"),Mt=i("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Pt=i("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=progress>%</h3><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Et=i("<li><div><h3></h3> "),Tt=i('<div class=line><span class="fill white"></span><span class="fill black">'),Rt=i("<span class=index>"),Dt=i("<div class=fbt>"),Qt=i("<small>You will play the moves from the opening."),jt=i("<small>If you go out of book, game ends."),Lt=i("<div class=in_mode><button class=end2><span> End Deathmatch "),Pe=i("<span class=failed>failed"),It=i("<small>You are given 15 random positions from the opening."),Ot=i("<small>Guess the correct move."),Yt=i("<h2> of 15"),At=i("<div class=in_mode><button class=end2><span> End Quiz "),Nt=i("<small> Try to guess the moves for <!>."),Ft=i("<small> AI will play the next move, picking a random variation. "),Gt=i("<small> Moves will be hidden once the game is started. "),Wt=i("<small>Try to guess the moves for both sides."),Bt=i("<small>Moves will be hidden once you start.");const Ht=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Kt=m=>Ht[Math.floor((1-m/10)*6)],Ut=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Jt{constructor(){D(this,"_mode");D(this,"_match_color");D(this,"_practice_end_result");D(this,"_quiz_quiz_ls");D(this,"_quiz_deathmatch_fail");D(this,"_quiz_deathmatch_result_path");this._mode=x(void 0,{equals:!1}),this._match_color=x("white"),this._quiz_quiz_ls=x([],{equals:!1}),this._quiz_deathmatch_fail=x(0),this._quiz_deathmatch_result_path=x([]),this._practice_end_result=x(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){z(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){z(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){z(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){z(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){z(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){z(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){z(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const Ee=m=>(()=>{var r=nt(),l=r.firstChild,c=l.nextSibling;return h(c,()=>`%${m.width}`),F(u=>G(l,`width: ${m.width}%`,u)),r})();class Vt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(l=>Math.round(l.progress/r)).reduce((l,c)=>l+c)}}class Q{constructor(r,l,c,u){this.study_id=r,this.i_chapter=l,this.score_tree=c,this.solved_paths=u}static load_from_store(r,l){let c=new ke(r.id,l);return Q.make(r.id,l,r.chapters[l].pgn.tree,re.set_for_saving(c.solved_paths))}static save_paths_to_store(r){let l=new ke(r.study_id,r.i_chapter);l.solved_paths=r.solved_paths.get_for_saving(),l.practice_progress=r.progress}static make(r,l,c,u=new re){return new Q(r,l,st.make(c),u)}get clone(){return new Q(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>k(()=>{var l;return(l=this.score_tree.get_at(r))==null?void 0:l.score})??0).reduce((r,l)=>r+l,0)*100)}get progress_map(){let r=k(()=>this.score_tree.progress_paths);const l=k(()=>r.map(c=>[c.filter(u=>u.length%2===1).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0),c.filter(u=>u.length%2===0).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0)]));return r.map((c,u)=>{let t=c[0],f=c[c.length-1],M=l[u][0],W=l[u][1],I=p(()=>this.solved_paths.paths),P=p(()=>I().filter(v=>c.some(w=>w.join("")===v.join("")))),O=p(()=>P().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,w)=>v+w,0)),s=p(()=>P().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,w)=>v+w,0));return{color:Kt(t.length/20+f.length/10),total:M*2,black:p(()=>s()/W),white:p(()=>O()/M),path:f}}).reverse()}clone_merge_stats(r){let l=k(()=>this.clone);return l.solved_paths.merge_dup(r.solved_paths),l}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){Q.save_paths_to_store(this)}}const nr=()=>{const m=Be(),[r]=He(m.id,Ze.read_study);return(()=>{var l=ot();return h(l,d(C,{get when(){return!r.loading},fallback:"Loading...",get children(){return d(Xt,{get study(){return r()}})}})),l})()},Xt=m=>{const r=Ke(),l=()=>m.study;let[c,u]=x(!1),t=new Jt,f=new et;const[M,W]=x(it.i_chapter??0);let I=p(()=>{const a=l();return new Vt(a.chapters.map((o,q)=>Q.load_from_store(a,q)))}),P=p(()=>I().chapters[M()]);const O=p(()=>l().chapters[M()]),s=p(()=>{t.mode;let a=O();return rt.make(a.pgn.tree.clone)}),v=p(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===15});b(()=>{t.mode==="quiz-quiz"&&(t.i_quiz_quiz===15||k(()=>{s().set_random_cursor_hide_rest(),t.match_color=s().cursor_after_color}))}),b(()=>{let{mode:a,match_color:o}=t;a==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{k(()=>{s().reveal_one_random()})},400)}),b(()=>{s().solved_paths.replace_all(P().solved_paths)});const w=p(()=>{let a=s().tree;return k(()=>Q.make(l().name,M(),a,new re))});b(()=>{k(()=>w()).solved_paths.replace_all(s().solved_paths)});let ae=p(()=>{let a=P(),o=w(),q=k(()=>a.progress);return a.clone_merge_stats(o).progress-q});b(S(()=>[P(),w()],(a,o)=>{if(o){let[q,E]=o;q.merge_and_save_stats(E)}})),b(S(()=>f.add_uci,a=>{if(c()||!a)return;s().try_next_uci_fail(a)?(se(),t.mode==="quiz-quiz"&&t.quiz_pass_one()):((t.mode==="match"||t.mode==="moves")&&(u(!0),setTimeout(()=>{s().on_wheel(-1),u(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=s().cursor_path.slice(0,-1)))})),b(S(()=>t.quiz_deathmatch_fail_result,a=>{(a>0||a<0)&&r.play("victory")})),b(S(()=>t.practice_end_result,a=>{a&&r.play("victory")})),b(()=>{let{mode:a,match_color:o}=t;a==="match"&&o==="black"&&k(()=>{se()})}),b(S(()=>s().fen_last_move,a=>{if(a){let[o,q]=a;f.on_set_fen_uci(o,q)}else f.on_set_fen_uci(lt)}));const se=()=>{let a=()=>s().is_cursor_path_at_a_leaf;a()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=s().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(u(!0),setTimeout(()=>{s().reveal_one_random(),a()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=s().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),u(!1)},400))};b(S(()=>f.on_wheel,a=>{a&&s().on_wheel(a)}));const le=a=>{a.key==="f"&&t.flip_match_color()};b(S(()=>{var a;return(a=s().tree)==null?void 0:a.get_at(s().cursor_path)},a=>{a&&r.move(a)})),qe(()=>{document.addEventListener("keypress",le)}),we(()=>{document.removeEventListener("keypress",le)});const ie=_t(a=>{const o=a.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(a.preventDefault(),f.set_on_wheel(Math.sign(a.deltaY)))});b(()=>{t.match_color=l().orientation??"white"});const Te=p(()=>w().progress_map);let B;qe(()=>{B.addEventListener("wheel",ie,{passive:!1})}),we(()=>{B.removeEventListener("wheel",ie)});const _e=a=>{let o=t.mode;if(a==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},Re=p(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),De=p(S(()=>t.quiz_deathmatch_result_path,a=>{var E,j;let o=a.length,q=(j=(E=s().tree)==null?void 0:E.all_leaves.map(T=>T.path).filter(T=>!s().failed_paths.find(H=>H.join("")===T.join(""))).filter(T=>T.join("").startsWith(a.join("")))[0])==null?void 0:j.length;return`${o} out of ${q}`})),Qe=p(()=>{var a;return(a=s().tree)==null?void 0:a.collect_branch_sums(s().cursor_path)});return(()=>{var a=Pt(),o=a.firstChild,q=o.firstChild,E=q.nextSibling,j=E.firstChild,T=j.firstChild,H=j.nextSibling,ne=o.nextSibling,oe=ne.nextSibling,je=oe.nextSibling,ce=je.firstChild,he=ce.firstChild,ue=he.firstChild,Le=ue.nextSibling,K=he.nextSibling,Ie=K.firstChild,Oe=K.nextSibling,Ye=Oe.firstChild,Ae=ce.nextSibling,de=Ae.firstChild,U=de.nextSibling,Y=U.firstChild,J=Y.nextSibling,me=U.nextSibling,V=me.firstChild,X=V.nextSibling,Z=X.nextSibling,pe=Z.nextSibling,Ne=me.nextSibling,ve=Ne.firstChild,ee=ve.firstChild,ge=ee.nextSibling,Fe=ve.nextSibling;return Ue(e=>B=e,a),h(T,()=>l().name),h(j,d(Ee,{get width(){return I().progress}}),null),h(H,d(te,{get each(){return l().chapters},children:(e,_)=>(()=>{var n=Et(),$=n.firstChild,g=$.firstChild;return g.nextSibling,n.$$click=()=>W(_()),h(g,()=>e.name),h($,d(Ee,{get width(){var R;return((R=I())==null?void 0:R.chapters[_()].progress)??0}}),null),F(()=>y(n,_()===M()?"active":"")),n})()})),h(ne,d(tt,{get orientation(){return t.match_color},get movable(){return Re()},get doPromotion(){return f.promotion},get onMoveAfter(){return f.on_move_after},get fen_uci(){return f.fen_uci},get color(){return f.turnColor},get dests(){return f.dests}})),h(oe,d(te,{get each(){return Te()},children:e=>(()=>{var _=Tt(),n=_.firstChild,$=n.nextSibling;return _.$$click=g=>s().try_set_cursor_path(e.path),F(g=>{var R=`background: ${e.color}; height: ${Math.round(e.total*100)}%`,A=`height: ${Math.round(e.white()*100)}%`,N=`height: ${Math.round(e.black()*100)}%`;return g.e=G(_,R,g.e),g.t=G(n,A,g.t),g.a=G($,N,g.a),g},{e:void 0,t:void 0,a:void 0}),_})()})),h(ue,()=>l().name),h(Le,()=>O().name),h(K,()=>P().progress,Ie),h(de,d(at,{get lala(){return s()}})),Y.$$click=()=>s().navigate_up(),J.$$click=()=>s().navigate_down(),h(U,d(te,{get each(){return Qe()},children:e=>(()=>{var _=Dt();return _.$$click=()=>s().try_set_cursor_path(e.path),h(_,d(C,{get when(){return e.ply&1},get children(){var n=Rt();return h(n,()=>Ut(e.ply)),n}}),null),h(_,()=>e.san,null),_})()}),null),V.$$click=()=>s().navigate_first(),X.$$click=()=>s().navigate_prev(),Z.$$click=()=>s().navigate_next(),pe.$$click=()=>s().navigate_last(),ee.$$click=()=>t.end_match_or_moves(),ge.$$click=()=>t.mode="quiz",h(Fe,d(Je,{get children(){return[d(L,{get when(){return t.mode==="quiz"},get children(){return[ye(),ct(),ht(),(()=>{var e=ut();return e.$$click=()=>t.mode="quiz-quiz",e})(),(()=>{var e=dt();return e.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(L,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[mt(),d(C,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Qt(),jt(),(()=>{var e=Lt(),_=e.firstChild;return _.$$click=()=>{z(()=>{let n=s().cursor_path;t.end_deathmatch(),s().cursor_path=n})},e})()]},get children(){return[(()=>{var e=pt();return e.firstChild,h(e,d(C,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return Pe()},get children(){return[" ",Se()]}}),null),e})(),(()=>{var e=vt();return e.firstChild,h(e,De,null),e})(),(()=>{var e=Ce(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,h(e,ae,n),e})(),(()=>{var e=gt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_deathmatch(),n.$$click=()=>{z(()=>{let $=s().cursor_path;t.end_deathmatch(),s().cursor_path=$})},e})()]}})]}}),d(L,{get when(){return t.mode==="quiz-quiz"},get children(){return[ft(),d(C,{get when(){return v()},get fallback(){return[It(),Ot(),(()=>{var e=Yt(),_=e.firstChild;return h(e,()=>t.i_quiz_quiz,_),e})(),(()=>{var e=At(),_=e.firstChild;return _.$$click=()=>{z(()=>{let n=s().cursor_path;t.end_quiz(),s().cursor_path=n})},e})()]},get children(){return[(()=>{var e=$t();return e.firstChild,h(e,d(C,{get when(){return t.quiz_pass>10},get fallback(){return Pe()},get children(){return[" ",Se()]}}),null),e})(),(()=>{var e=bt(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,h(e,()=>t.quiz_pass,n),e})(),(()=>{var e=Ce(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,h(e,ae,n),e})(),(()=>{var e=zt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_quiz(),n.$$click=()=>{z(()=>{let $=s().cursor_path;t.end_quiz(),s().cursor_path=$})},e})()]}})]}}),d(L,{get when(){return t.mode===void 0},get children(){return[ye(),qt(),wt(),(()=>{var e=kt();return e.$$click=()=>t.mode="moves",e})(),(()=>{var e=yt();return e.$$click=()=>t.mode="match",e})()]}}),d(L,{get when(){return t.mode==="match"},get children(){return[St(),d(C,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Nt(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,h(e,()=>t.match_color,n),e})(),Ft(),Gt()]},get children(){return[xe(),Me()]}}),(()=>{var e=Ct(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_match(),n.$$click=()=>{let $=s().cursor_path;t.end_match_or_moves(),s().cursor_path=$},e})()]}}),d(L,{get when(){return t.mode==="moves"},get children(){return[xt(),d(C,{get when(){return t.practice_end_result},get fallback(){return[Wt(),Bt()]},get children(){return[xe(),Me()]}}),(()=>{var e=Mt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>{t.restart_moves()},n.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),F(e=>{var _=O().site,n=c()||!s().can_navigate_up,$="fbt prev"+(!c()&&s().can_navigate_up?"":" disabled"),g=c()||!s().can_navigate_down,R="fbt prev"+(!c()&&s().can_navigate_down?"":" disabled"),A="fbt first"+(!c()&&s().can_navigate_prev?"":" disabled"),N="fbt prev"+(!c()&&s().can_navigate_prev?"":" disabled"),fe="fbt next"+(!c()&&s().can_navigate_next?"":" disabled"),$e="fbt last"+(!c()&&s().can_navigate_next?"":" disabled"),be="tab"+_e("practice"),ze="tab"+_e("quiz");return _!==e.e&&Ve(Ye,"href",e.e=_),n!==e.t&&(Y.disabled=e.t=n),$!==e.a&&y(Y,e.a=$),g!==e.o&&(J.disabled=e.o=g),R!==e.i&&y(J,e.i=R),A!==e.n&&y(V,e.n=A),N!==e.s&&y(X,e.s=N),fe!==e.h&&y(Z,e.h=fe),$e!==e.r&&y(pe,e.r=$e),be!==e.d&&y(ee,e.d=be),ze!==e.l&&y(ge,e.l=ze),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a})()};Xe(["click"]);export{nr as default};
