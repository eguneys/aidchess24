import{n as cn,C as dn,P as Ce,o as dt,p as V,q as H,I as W,r as b,v as ge,w as un,R as ut,x as Be,y as Le,z as Ye,B as Y,D as _t,E as je,G as _n,H as Ze,t as _,i as u,e as N,f as Z,d as Me,J as P,K as Ge,L as hn,b as x,N as ht,O as gn,Q as et,T as gt,U as Pe,k as tt,c as o,V as ye,F as be,W as wt,X as he,Y as fn,Z as Re,_ as Ie,$ as pn,a0 as vn,a1 as ze,a2 as ft,a3 as mn,l as y,m as He,g as se,a4 as bn,j as We,a5 as fe,a6 as Je,a7 as yt,a8 as Ct,a9 as $n,u as kn,aa as St,ab as xt,ac as wn,ad as yn,ae as Fe,af as Cn,ag as Et,ah as Lt,ai as qt,aj as Ot,ak as Sn,al as nt,am as xn,an as En,s as Ln,ao as qn}from"./index-DmWBKDaJ.js";import{o as pt,d as On,e as vt,C as Pn,a as Pt,P as Tt,b as Nt,n as At}from"./random-Dau6Xz2d.js";const Tn=e=>cn(e);class Nn extends Ce{constructor(){super("crazyhouse")}reset(){super.reset(),this.pockets=dt.empty()}setupUnchecked(t){super.setupUnchecked(t),this.board.promoted=t.board.promoted.intersect(t.board.occupied).diff(t.board.king).diff(t.board.pawn),this.pockets=t.pockets?t.pockets.clone():dt.empty()}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}validate(){return super.validate().chain(t=>{var n,i;return!((n=this.pockets)===null||n===void 0)&&n.count("king")?V.err(new H(W.Kings)):(((i=this.pockets)===null||i===void 0?void 0:i.size())||0)+this.board.occupied.size()>64?V.err(new H(W.Variant)):V.ok(void 0)})}hasInsufficientMaterial(t){return this.pockets?this.board.occupied.size()+this.pockets.size()<=3&&this.board.pawn.isEmpty()&&this.board.promoted.isEmpty()&&this.board.rooksAndQueens().isEmpty()&&this.pockets.count("pawn")<=0&&this.pockets.count("rook")<=0&&this.pockets.count("queen")<=0:super.hasInsufficientMaterial(t)}dropDests(t){var n,i;const s=this.board.occupied.complement().intersect(!((n=this.pockets)===null||n===void 0)&&n[this.turn].hasNonPawns()?b.full():!((i=this.pockets)===null||i===void 0)&&i[this.turn].hasPawns()?b.backranks().complement():b.empty());if(t=t||this.ctx(),ge(t.king)&&t.checkers.nonEmpty()){const a=t.checkers.singleSquare();return ge(a)?s.intersect(un(a,t.king)):b.empty()}else return s}}class An extends Ce{constructor(){super("atomic")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}validate(){if(this.board.occupied.isEmpty())return V.err(new H(W.Empty));if(this.board.king.size()>2)return V.err(new H(W.Kings));const t=this.board.kingOf(Y(this.turn));return ge(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?V.err(new H(W.OppositeCheck)):b.backranks().intersects(this.board.pawn)?V.err(new H(W.PawnsOnBackrank)):V.ok(void 0):V.err(new H(W.Kings))}kingAttackers(t,n,i){const s=this.board.pieces(n,"king");return s.isEmpty()||Ye(t).intersects(s)?b.empty():super.kingAttackers(t,n,i)}playCaptureAt(t,n){super.playCaptureAt(t,n),this.board.take(t);for(const i of Ye(t).intersect(this.board.occupied).diff(this.board.pawn)){const s=this.board.take(i);s?.role==="rook"&&this.castles.discardRook(i),s?.role==="king"&&this.castles.discardColor(s.color)}}hasInsufficientMaterial(t){if(this.board.pieces(Y(t),"king").isEmpty())return!1;if(this.board[t].diff(this.board.king).isEmpty())return!0;if(this.board[Y(t)].diff(this.board.king).nonEmpty()){if(this.board.occupied.equals(this.board.bishop.union(this.board.king))){if(!this.board.bishop.intersect(this.board.white).intersects(b.darkSquares()))return!this.board.bishop.intersect(this.board.black).intersects(b.lightSquares());if(!this.board.bishop.intersect(this.board.white).intersects(b.lightSquares()))return!this.board.bishop.intersect(this.board.black).intersects(b.darkSquares())}return!1}return this.board.queen.nonEmpty()||this.board.pawn.nonEmpty()?!1:this.board.knight.union(this.board.bishop).union(this.board.rook).size()===1?!0:this.board.occupied.equals(this.board.knight.union(this.board.king))?this.board.knight.size()<=2:!1}dests(t,n){n=n||this.ctx();let i=b.empty();for(const s of je(this,t,n)){const a=this.clone();a.play({from:t,to:s});const d=a.board.kingOf(this.turn);ge(d)&&(!ge(a.board.kingOf(a.turn))||a.kingAttackers(d,a.turn,a.board.occupied).isEmpty())&&(i=i.with(s))}return i}isVariantEnd(){return!!this.variantOutcome()}variantOutcome(t){for(const n of Be)if(this.board.pieces(n,"king").isEmpty())return{winner:Y(n)}}}class In extends Ce{constructor(){super("antichess")}reset(){super.reset(),this.castles=Le.empty()}setupUnchecked(t){super.setupUnchecked(t),this.castles=Le.empty()}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}validate(){return this.board.occupied.isEmpty()?V.err(new H(W.Empty)):b.backranks().intersects(this.board.pawn)?V.err(new H(W.PawnsOnBackrank)):V.ok(void 0)}kingAttackers(t,n,i){return b.empty()}ctx(){const t=super.ctx();if(ge(this.epSquare)&&_n(Y(this.turn),this.epSquare).intersects(this.board.pieces(this.turn,"pawn")))return t.mustCapture=!0,t;const n=this.board[Y(this.turn)];for(const i of this.board[this.turn])if(je(this,i,t).intersects(n))return t.mustCapture=!0,t;return t}dests(t,n){n=n||this.ctx();const i=je(this,t,n),s=this.board[Y(this.turn)];return i.intersect(n.mustCapture?ge(this.epSquare)&&this.board.getRole(t)==="pawn"?s.with(this.epSquare):s:b.full())}hasInsufficientMaterial(t){if(this.board[t].isEmpty())return!1;if(this.board[Y(t)].isEmpty())return!0;if(this.board.occupied.equals(this.board.bishop)){const n=this.board[t].intersects(b.lightSquares()),i=this.board[t].intersects(b.darkSquares()),s=this.board[Y(t)].isDisjoint(b.lightSquares()),a=this.board[Y(t)].isDisjoint(b.darkSquares());return n&&s||i&&a}return this.board.occupied.equals(this.board.knight)&&this.board.occupied.size()===2?this.board.white.intersects(b.lightSquares())!==this.board.black.intersects(b.darkSquares())!=(this.turn===t):!1}isVariantEnd(){return this.board[this.turn].isEmpty()}variantOutcome(t){if(t=t||this.ctx(),t.variantEnd||this.isStalemate(t))return{winner:this.turn}}}class Rn extends Ce{constructor(){super("kingofthehill")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}hasInsufficientMaterial(t){return!1}isVariantEnd(){return this.board.king.intersects(b.center())}variantOutcome(t){for(const n of Be)if(this.board.pieces(n,"king").intersects(b.center()))return{winner:n}}}class zn extends Ce{constructor(){super("3check")}reset(){super.reset(),this.remainingChecks=ut.default()}setupUnchecked(t){var n;super.setupUnchecked(t),this.remainingChecks=((n=t.remainingChecks)===null||n===void 0?void 0:n.clone())||ut.default()}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}hasInsufficientMaterial(t){return this.board.pieces(t,"king").equals(this.board[t])}isVariantEnd(){return!!this.remainingChecks&&(this.remainingChecks.white<=0||this.remainingChecks.black<=0)}variantOutcome(t){if(this.remainingChecks){for(const n of Be)if(this.remainingChecks[n]<=0)return{winner:n}}}}const Bn=()=>{const e=Ze.empty();return e.occupied=new b(65535,0),e.promoted=b.empty(),e.white=new b(61680,0),e.black=new b(3855,0),e.pawn=b.empty(),e.knight=new b(6168,0),e.bishop=new b(9252,0),e.rook=new b(16962,0),e.queen=new b(129,0),e.king=new b(33024,0),e};class Mn extends Ce{constructor(){super("racingkings")}reset(){this.board=Bn(),this.pockets=void 0,this.turn="white",this.castles=Le.empty(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){super.setupUnchecked(t),this.castles=Le.empty()}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}validate(){return this.isCheck()||this.board.pawn.nonEmpty()?V.err(new H(W.Variant)):super.validate()}dests(t,n){if(n=n||this.ctx(),t===n.king)return super.dests(t,n);let i=b.empty();for(const s of super.dests(t,n)){const a={from:t,to:s},d=this.clone();d.play(a),d.isCheck()||(i=i.with(s))}return i}hasInsufficientMaterial(t){return!1}isVariantEnd(){const t=b.fromRank(7),n=this.board.king.intersect(t);if(n.isEmpty())return!1;if(this.turn==="white"||n.intersects(this.board.black))return!0;const i=this.board.kingOf("black");if(ge(i)){const s=this.board.occupied.without(i);for(const a of Ye(i).intersect(t).diff(this.board.black))if(this.kingAttackers(a,"white",s).isEmpty())return!1}return!0}variantOutcome(t){if(t?!t.variantEnd:!this.isVariantEnd())return;const n=b.fromRank(7),i=this.board.pieces("black","king").intersects(n),s=this.board.pieces("white","king").intersects(n);return i&&!s?{winner:"black"}:s&&!i?{winner:"white"}:{winner:void 0}}}const Un=()=>{const e=Ze.empty();return e.occupied=new b(4294967295,4294901862),e.promoted=b.empty(),e.white=new b(4294967295,102),e.black=new b(0,4294901760),e.pawn=new b(4294967295,16711782),e.knight=new b(0,1107296256),e.bishop=new b(0,603979776),e.rook=new b(0,2164260864),e.queen=new b(0,134217728),e.king=new b(0,268435456),e};class Kn extends Ce{constructor(){super("horde")}reset(){this.board=Un(),this.pockets=void 0,this.turn="white",this.castles=Le.default(),this.castles.discardColor("white"),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}validate(){if(this.board.occupied.isEmpty())return V.err(new H(W.Empty));if(this.board.king.size()!==1)return V.err(new H(W.Kings));const t=this.board.kingOf(Y(this.turn));if(ge(t)&&this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty())return V.err(new H(W.OppositeCheck));for(const n of Be){const i=this.board.pieces(n,"king").isEmpty()?b.backrank(Y(n)):b.backranks();if(this.board.pieces(n,"pawn").intersects(i))return V.err(new H(W.PawnsOnBackrank))}return V.ok(void 0)}hasInsufficientMaterial(t){if(this.board.pieces(t,"king").nonEmpty())return!1;const n=p=>p==="light"?"dark":"light",i=p=>p==="light"?b.lightSquares():b.darkSquares(),s=p=>{const g=this.board.pieces(p,"bishop");return g.intersects(b.darkSquares())&&g.intersects(b.lightSquares())},a=_t.fromBoard(this.board,t),d=p=>i(p).intersect(this.board.pieces(t,"bishop")).size(),c=d("light")>=1?"light":"dark",l=a.pawn+a.knight+a.rook+a.queen+Math.min(d("dark"),2)+Math.min(d("light"),2),r=_t.fromBoard(this.board,Y(t)),f=p=>i(p).intersect(this.board.pieces(Y(t),"bishop")).size(),m=r.size(),C=p=>m-p;if(l===0)return!0;if(l>=4||(a.pawn>=1||a.queen>=1)&&l>=2||a.rook>=1&&l>=2&&!(l===2&&a.rook===1&&a.bishop===1&&C(f(c))===1))return!1;if(l===1){if(m===1)return!0;if(a.queen===1)return!(r.pawn>=1||r.rook>=1||f("light")>=2||f("dark")>=2);if(a.pawn===1){const p=this.board.pieces(t,"pawn").last(),g=this.clone();g.board.set(p,{color:t,role:"queen"});const $=this.clone();return $.board.set(p,{color:t,role:"knight"}),g.hasInsufficientMaterial(t)&&$.hasInsufficientMaterial(t)}else{if(a.rook===1)return!(r.pawn>=2||r.rook>=1&&r.pawn>=1||r.rook>=1&&r.knight>=1||r.pawn>=1&&r.knight>=1);if(a.bishop===1)return!(f(n(c))>=2||f(n(c))>=1&&r.pawn>=1||r.pawn>=2);if(a.knight===1)return!(m>=4&&(r.knight>=2||r.pawn>=2||r.rook>=1&&r.knight>=1||r.rook>=1&&r.bishop>=1||r.knight>=1&&r.bishop>=1||r.rook>=1&&r.pawn>=1||r.knight>=1&&r.pawn>=1||r.bishop>=1&&r.pawn>=1||s(Y(t))&&r.pawn>=1)&&(f("dark")<2||C(f("dark"))>=3)&&(f("light")<2||C(f("light"))>=3))}}else{if(l===2)return m===1?!0:a.knight===2?r.pawn+r.bishop+r.knight<1:s(t)?!(r.pawn>=1||r.bishop>=1||r.knight>=1&&r.rook+r.queen>=1):a.bishop>=1&&a.knight>=1?!(r.pawn>=1||f(n(c))>=1||C(f(c))>=3):!(r.pawn>=1&&f(n(c))>=1||r.pawn>=1&&r.knight>=1||f(n(c))>=1&&r.knight>=1||f(n(c))>=2||r.knight>=2||r.pawn>=2);if(l===3)return a.knight===2&&a.bishop===1||a.knight===3||s(t)?!1:m===1}return!0}isVariantEnd(){return this.board.white.isEmpty()||this.board.black.isEmpty()}variantOutcome(t){if(this.board.white.isEmpty())return{winner:"black"};if(this.board.black.isEmpty())return{winner:"white"}}}const Dn=(e,t)=>{switch(e){case"chess":return dn.fromSetup(t);case"antichess":return In.fromSetup(t);case"atomic":return An.fromSetup(t);case"horde":return Kn.fromSetup(t);case"racingkings":return Mn.fromSetup(t);case"kingofthehill":return Rn.fromSetup(t);case"3check":return zn.fromSetup(t);case"crazyhouse":return Nn.fromSetup(t)}};var Gn=_("<div class=modal-mask><dialog open><div class=close-button-anchor><button class=close-button data-icon=></button></div><div class=scrollable><div>");function Qe(e){return(()=>{var t=Gn(),n=t.firstChild,i=n.firstChild,s=i.firstChild,a=i.nextSibling,d=a.firstChild;return t.$$click=()=>e.on_close(),n.$$click=c=>{c.stopPropagation()},s.$$click=()=>e.on_close(),u(d,()=>e.children),N(()=>Z(d,"dialog-content "+e.klass)),t})()}Me(["click"]);const Xe="ABCDEFGHIJKLMNOP".split(""),mt=e=>Xe[e];var Fn=_(`<div class="editor is2d"><div class=board-wrap></div><div class=tools-wrap><div class=metadata><div class=color><select><option value=white>White's Turn</option><option value=black>Black's Turn</option></select></div><div class=castling><strong>Castling</strong><div><label><input type=checkbox>White O-O</label><label><input type=checkbox>O-O-O</label></div><div><label><input type=checkbox>Black O-O</label><label><input type=checkbox>O-O-O</label></div></div><div class=enpassant><label for=enpassant-select>En passant</label><select id=enpassant-select><option value selected></option></select></div></div><div class=actions><button>Starting Position</button><button>Clear Board`),Qn=_("<option>"),Vn=_('<div class="is2d chessboard"> '),Yn=_("<div>"),jn=_("<div><div><div>");function Hn(e){const t=f=>[...f].reduce((m,C)=>{const p=parseInt(C);return m+(p>=1?"x".repeat(p):C)},""),n=(f,m,C,p)=>{let g;for(;(g=m.exec(f))!=null;)p.add(g.index+C)},i=new Set,[s,a]=e.split(" "),d=s.split("/"),c=t(d[a==="w"?3:4]);n(c,/pP/g,a==="w"?0:1,i),n(c,/Pp/g,a==="w"?1:0,i);const[l,r]=i.size>=1?[t(d[a==="w"?1:6]),t(d[a==="w"?2:5])]:[null,null];return Array.from(i).filter(f=>l[f]==="x"&&r[f]==="x").map(f=>String.fromCharCode(97+f)+(a==="w"?"6":"3"))}const Wn=e=>{const t=()=>Ge,[n,i]=P(Ge),[s,a]=P("white"),[d,c]=P(),l=["K","Q","k","q"],[r,f]=hn({Q:!1,K:!1,k:!1,q:!1}),m=x(()=>{let w="",S=r;return l.forEach(U=>{S[U]&&(w+=U)}),w}),C=x(()=>{let w=t(),S=n()??w;const U=ht(S).unwrap(F=>F.board,F=>Ze.empty()),ee=s(),D=gn(U,m()).unwrap();let J=d()?et(d()):void 0;return{board:U,turn:ee,castlingRights:D,epSquare:J,pockets:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:0}}),p=x(()=>gt(C())),g=x(()=>Dn("chess",C()).unwrap(w=>gt(w.toSetup()),w=>{})),$=x(()=>Hn(p()));Pe(()=>{e.on_change_fen(g())});const T=w=>{he(()=>{a(w.turn),c(w.epSquare?Tn(w.epSquare):void 0);let S=Le.fromSetup(w);f("Q",S.rook.white.a!==void 0),f("K",S.rook.white.h!==void 0),f("q",S.rook.black.a!==void 0),f("k",S.rook.black.h!==void 0)})},E=w=>{ht(w).unwrap(S=>(he(()=>{i(w),T(S)}),!0),S=>!1)};E(e.initial_fen);const[B,M]=P("pointer"),G=tt(B),[v,k]=P(),O=(w,S)=>{if(M(w),w!=="pointer"){if(w!=="trash"){let[U,ee]=w.split(" ");k([U,ee,S])}}},L=x(()=>{let w,S;switch(B()){case"pointer":S="pointer";break;case"trash":w="/cursors/trash.cur";break;default:w=`/cursors/${B().split(" ").join("-")}.cur`}if(S)return{cursor:S};if(w)return{cursor:`url('${w}'), default`}}),I=()=>{let[w,S]=B().split(" ");M(`${pt(w)} ${S}`)};return(()=>{var w=Fn(),S=w.firstChild,U=S.nextSibling,ee=U.firstChild,D=ee.firstChild,J=D.firstChild,F=J.firstChild,Se=F.nextSibling,pe=D.nextSibling,$e=pe.firstChild,q=$e.nextSibling,R=q.firstChild,ae=R.firstChild,ne=R.nextSibling,oe=ne.firstChild,ke=q.nextSibling,X=ke.firstChild,le=X.firstChild,ve=X.nextSibling,ce=ve.firstChild,de=pe.nextSibling,xe=de.firstChild,me=xe.nextSibling;me.firstChild;var Ue=ee.nextSibling,Te=Ue.firstChild,Ke=Te.nextSibling;return u(w,o(bt,{klass:"spare-top",get color(){return pt(e.orientation)},on_spare:O,is_selected:G}),S),u(S,o(Jn,{on_set_spare:M,on_toggle_spare:I,get spare(){return B()},get orientation(){return e.orientation},on_change_fen:i,get drag_new_piece(){return v()},get fen(){return n()}})),u(w,o(bt,{klass:"spare-bottom",get color(){return e.orientation},on_spare:O,is_selected:G}),U),ye(J,"change",K=>a(K.target.value)),ae.addEventListener("change",K=>f("K",K.target.checked)),oe.addEventListener("change",K=>f("Q",K.target.checked)),le.addEventListener("change",K=>f("k",K.target.checked)),ce.addEventListener("change",K=>f("q",K.target.checked)),me.addEventListener("change",K=>c(K.target.value)),u(me,o(be,{get each(){return $()},children:K=>(()=>{var we=Qn();return we.value=K,u(we,K),we})()}),null),Te.$$click=()=>E(Ge),Ke.$$click=()=>E(vn),N(K=>{var we=L(),Ne=s()==="white",Ae=s()==="black";return K.e=wt(w,we,K.e),Ne!==K.t&&(F.selected=K.t=Ne),Ae!==K.a&&(Se.selected=K.a=Ae),K},{e:void 0,t:void 0,a:void 0}),N(()=>ae.checked=r.K),N(()=>oe.checked=r.Q),N(()=>le.checked=r.k),N(()=>ce.checked=r.q),w})()};function Jn(e){const t=()=>{e.on_change_fen(i.getFen())};let n,i;return Re(()=>{let s={fen:e.fen,orientation:e.orientation,autoCastle:!1,movable:{free:!0,color:"both"},draggable:{showGhost:!0,deleteOnDropOff:!0},premovable:{enabled:!1},selectable:{enabled:!1},highlight:{lastMove:!1},events:{change:t}};i=Pn(n,s);const a=l=>{let r=e.spare;r!=="pointer"&&l.preventDefault();const f=vt(l);if(!f)return;let m=i.getKeyAtDomPos(f);if(m){if(r==="trash")d(m);else if(r!=="pointer"){const C=i.state.pieces.get(m);let[p,g]=r.split(" "),$={color:p,role:g};C&&C.color===$.color&&C.role===$.role?d(m):(i.setPieces(new Map([[m,$]])),t())}}},d=l=>{i.setPieces(new Map([[l,void 0]])),t()},c=l=>{let r=e.spare;r!=="pointer"&&l.preventDefault(),r!=="pointer"&&(i.state.drawable.current=void 0,i.state.drawable.shapes=[],l.type==="contextmenu"&&r!=="trash"&&(i.cancelMove(),e.on_toggle_spare()))};n.addEventListener("mousedown",a),n.addEventListener("contextmenu",c),ze(()=>{n.removeEventListener("mousedown",a),n.removeEventListener("contextmenu",c)})}),Pe(()=>{i.set({fen:e.fen})}),Pe(()=>{i.set({orientation:e.orientation})}),Pe(()=>{let s=e.drag_new_piece;s&&(On(i.state,{color:s[0],role:s[1]},s[2],!0),document.addEventListener("mouseup",a=>{const d=vt(a);d&&i.getKeyAtDomPos(d)&&e.on_set_spare("pointer")},{once:!0}))}),(()=>{var s=Vn();return Ie(a=>n=a,s),s})()}const bt=e=>{const t=e.is_selected;return(()=>{var n=Yn();return u(n,o(Ve,{onClick:i=>e.on_spare("pointer",i),klass:"pointer",spare:"pointer",get selected(){return t("pointer")},get color(){return e.color}}),null),u(n,o(be,{each:fn,children:i=>o(Ve,{onClick:s=>e.on_spare(`${e.color} ${i}`,s),klass:"",get spare(){return`${e.color} ${i}`},get selected(){return t(`${e.color} ${i}`)},get color(){return e.color}})}),null),u(n,o(Ve,{onClick:i=>e.on_spare("trash",i),klass:"trash",spare:"trash",get selected(){return t("trash")},get color(){return e.color}}),null),N(()=>Z(n,"spare "+e.klass+" "+e.color)),n})()},Ve=e=>(()=>{var t=jn(),n=t.firstChild,i=n.firstChild;return ye(t,"mousedown",e.onClick,!0),N(s=>{var a="no-square "+e.klass,d=!!e.selected,c="piece "+e.spare,l={[e.color]:!0};return a!==s.e&&Z(t,s.e=a),d!==s.t&&t.classList.toggle("selected",s.t=d),c!==s.a&&Z(i,s.a=c),s.o=pn(i,l,s.o),s},{e:void 0,t:void 0,a:void 0,o:void 0}),t})();Me(["click","mousedown"]);var Xn=_("<h2>Edit Opening"),Zn=_('<div class=group><label for=name>Name</label><input name=name id=name type=text placeholder="Opening Name"minlength=3>'),ei=_("<div class=section><div class=group><label for=orientation>Set Orientation</label><select name=orientation id=orientation><option value=white>White</option><option value=black>Black"),it=_("<div class=filler>"),It=_('<div class="group buttons"><span class=split></span><button class=delete>Delete <i data-icon=>'),ti=_("<h2>Edit Chapter"),Rt=_('<div class=group><label for=name>Name</label><input name=name id=name type=text placeholder="Section Name"minlength=3>'),ni=_("<div class=group><div class=editor-wrap>"),ii=_("<div class=tabs-wrap><div class=tabs><div class=tab>Empty</div><div class=tab>Editor</div></div><div class=content>"),zt=_("<div class=section><div class=group><label for=order>Set Order</label><select name=order id=order></select></div><div class=group><label for=orientation>Set Orientation</label><select name=orientation id=orientation><option value=white>White</option><option value=black>Black"),ri=_('<div class="group buttons"><button class=delete>Delete <i data-icon=></i></button><span class=split></span><button class=create>Save Changes'),Bt=_("<option>"),si=_("<h2>Edit Section"),ai=_("<div class=tabs><div class=tab>Empty</div><div class=tab>Import Lichess Study</div><div class=tab>Import PGN"),oi=_('<div class=group><label for=name>Import a Study from Lichess</label><input name=name id=name type=text placeholder="Lichess Study URL">'),li=_('<div class=group><label for=name>Import from PGN</label><textarea rows=10 name=name id=name placeholder="Paste PGN here.">'),ci=_("<div class=content>"),$t=_("<button class=import>Import<i data-icon=>"),kt=_("<button class=loading disabled>Loading ...");function di(e){const t=(d,c)=>{d==="Escape"&&(c.value=e.study.name)},n=d=>{let c=d.value;c.length<3&&(c="New Chapter",d.value=c),e.on_update_study({id:e.study.id,name:c})},i=()=>{e.on_delete_study()},s=d=>{e.on_update_study({id:e.study.id,orientation:d})},a=x(()=>e.study.orientation);return[Xn(),(()=>{var d=Zn(),c=d.firstChild,l=c.nextSibling;return l.addEventListener("change",r=>n(r.currentTarget)),l.$$keydown=r=>t(r.key,r.currentTarget),N(()=>l.value=e.study.name),d})(),(()=>{var d=ei(),c=d.firstChild,l=c.firstChild,r=l.nextSibling,f=r.firstChild,m=f.nextSibling;return r.addEventListener("change",C=>s(C.currentTarget.value)),N(C=>{var p=a()==="white",g=a()==="black";return p!==C.e&&(f.selected=C.e=p),g!==C.t&&(m.selected=C.t=g),C},{e:void 0,t:void 0}),d})(),it(),(()=>{var d=It(),c=d.firstChild,l=c.nextSibling;return l.$$click=i,d})()]}function ui(e){const t=(g,$)=>{g==="Escape"&&($.value=e.chapter.name)},n=g=>{let $=g.value;$.length<3&&($="New Chapter",g.value=$),e.on_edit_chapter({id:e.chapter.id,name:$})},i=g=>{let $=parseInt(g);e.on_order_chapter($)},s=()=>{e.on_delete_chapter()},a=()=>{let g=l();g&&e.fen!==g&&e.on_change_root_fen(g)},d=g=>{e.on_edit_chapter({id:e.chapter.id,orientation:g})},c=x(()=>e.chapter.orientation),[l,r]=P(),[f,m]=P("editor"),C=tt(f),p=x(()=>l()??e.fen);return[ti(),(()=>{var g=Rt(),$=g.firstChild,T=$.nextSibling;return T.addEventListener("change",E=>n(E.currentTarget)),T.$$keydown=E=>t(E.key,E.currentTarget),N(()=>T.value=e.chapter.name),g})(),(()=>{var g=ii(),$=g.firstChild,T=$.firstChild,E=T.nextSibling,B=$.nextSibling;return T.$$click=()=>m("empty"),E.$$click=()=>m("editor"),u(B,o(y,{get when(){return f()==="editor"},get children(){var M=ni(),G=M.firstChild;return u(G,o(Wn,{get initial_fen(){return p()},on_change_fen:r,get orientation(){return e.chapter.orientation??"white"}})),M}}),null),u(B,o(y,{get when(){return f()==="empty"},get children(){return[]}}),null),N(M=>{var G=!!C("empty"),v=!!C("editor");return G!==M.e&&T.classList.toggle("active",M.e=G),v!==M.t&&E.classList.toggle("active",M.t=v),M},{e:void 0,t:void 0}),g})(),(()=>{var g=zt(),$=g.firstChild,T=$.firstChild,E=T.nextSibling,B=$.nextSibling,M=B.firstChild,G=M.nextSibling,v=G.firstChild,k=v.nextSibling;return E.addEventListener("change",O=>i(O.currentTarget.value)),u(E,o(be,{get each(){return[...Array(e.nb_chapters).keys()]},children:(O,L)=>(()=>{var I=Bt();return u(I,()=>L()+1),N(()=>I.selected=e.i_chapter===L()),N(()=>I.value=L()),I})()})),G.addEventListener("change",O=>d(O.currentTarget.value)),N(O=>{var L=c()==="white",I=c()==="black";return L!==O.e&&(v.selected=O.e=L),I!==O.t&&(k.selected=O.t=I),O},{e:void 0,t:void 0}),g})(),it(),(()=>{var g=ri(),$=g.firstChild,T=$.nextSibling,E=T.nextSibling;return $.$$click=s,E.$$click=a,N(()=>E.disabled=p()===void 0),g})()]}function _i(e){const t=(v,k)=>{v==="Escape"&&(k.value=e.section.name)},n=v=>{let k=v.value;k.length<3&&(k="New Section",v.value=k),e.on_edit_section({id:e.section.id,name:k})},i=v=>{let k=Xe.indexOf(v);e.on_order_section(k)},s=()=>{e.on_delete_section()},[a,d]=P("lichess"),[c,l]=P(""),r=x(()=>ft(c())),f=async()=>{let v=r();v&&e.on_import_pgns(v,e.section.name)},[m,C]=P(""),p=x(()=>{let v=m().match(/\/study\/([a-zA-Z0-9]{8})\/?$/);return v?`https://lichess.org/api/study/${v[1]}.pgn`:void 0}),g=async v=>await fetch(v).then(k=>k.text()).then(k=>ft(k)),[$]=mn(p,g),T=async()=>{let v=$();v&&e.on_import_pgns(v,e.section.name)},E=x(()=>p()===void 0),B=v=>{e.on_edit_section({id:e.section.id,orientation:v})},M=x(()=>e.section.orientation),G=tt(a);return[si(),(()=>{var v=Rt(),k=v.firstChild,O=k.nextSibling;return O.addEventListener("change",L=>n(L.currentTarget)),O.$$keydown=L=>t(L.key,L.currentTarget),N(()=>O.value=e.section.name),v})(),(()=>{var v=ai(),k=v.firstChild,O=k.nextSibling,L=O.nextSibling;return k.$$click=()=>d("empty"),O.$$click=()=>d("lichess"),L.$$click=()=>d("pgn"),N(I=>{var w=!!G("empty"),S=!!G("lichess"),U=!!G("pgn");return w!==I.e&&k.classList.toggle("active",I.e=w),S!==I.t&&O.classList.toggle("active",I.t=S),U!==I.a&&L.classList.toggle("active",I.a=U),I},{e:void 0,t:void 0,a:void 0}),v})(),(()=>{var v=ci();return u(v,o(y,{get when(){return G("lichess")},get children(){var k=oi(),O=k.firstChild,L=O.nextSibling;return L.addEventListener("change",I=>C(I.target.value)),L.$$keyup=I=>C(I.currentTarget.value),N(()=>Z(L,E()?"error":"success")),k}}),null),u(v,o(y,{get when(){return G("pgn")},get children(){var k=li(),O=k.firstChild,L=O.nextSibling;return L.addEventListener("change",I=>l(I.target.value)),k}}),null),u(v,o(y,{get when(){return G("empty")},get children(){return[]}}),null),v})(),(()=>{var v=zt(),k=v.firstChild,O=k.firstChild,L=O.nextSibling,I=k.nextSibling,w=I.firstChild,S=w.nextSibling,U=S.firstChild,ee=U.nextSibling;return L.addEventListener("change",D=>i(D.currentTarget.value)),u(L,o(be,{get each(){return Xe.slice(0,e.nb_sections)},children:(D,J)=>(()=>{var F=Bt();return F.value=D,u(F,D),N(()=>F.selected=e.i_section===J()),F})()})),S.addEventListener("change",D=>B(D.currentTarget.value)),N(D=>{var J=M()==="white",F=M()==="black";return J!==D.e&&(U.selected=D.e=J),F!==D.t&&(ee.selected=D.t=F),D},{e:void 0,t:void 0}),v})(),it(),(()=>{var v=It(),k=v.firstChild,O=k.nextSibling;return u(v,o(y,{get when(){return a()==="pgn"},get children(){return o(He,{get fallback(){return kt()},get children(){var L=$t();return L.$$click=f,N(()=>L.disabled=r()===void 0),L}})}}),O),u(v,o(y,{get when(){return a()==="lichess"},get children(){return o(He,{get fallback(){return kt()},get children(){var L=$t();return L.$$click=T,N(()=>L.disabled=$()===void 0),L}})}}),O),O.$$click=s,v})()]}Me(["keydown","click","keyup"]);var Mt=_('<main class="openings-show study"><div class=details-wrap></div><div class=board-wrap></div><div class=replay-wrap><div class=header></div></div><div class=sections-wrap></div><div class=tools-wrap>'),Ut=_('<button class="feature practice"><i data-icon=>'),hi=_("<a class=analyze data-icon=>Analyze on lichess"),gi=_("<a class=copy-line data-icon=>Copy variation PGN"),fi=_('<a class="annotate has-sub-menu"data-icon=><i class=glyph-icon></i>Annotate Glyph'),pi=_("<a class=delete data-icon=>Delete after this move"),vi=_("<div class=context-sub-menu>"),mi=_("<a><i>"),bi=_("<h4>Take Quiz"),$i=_("<h4>Play Deathmatch"),ki=_("<h4>Practice with the Computer"),wi=_("<div class=practice-feature><div class=tabs><div>Practice</div></div><div>"),yi=_("<span>End of line."),Ci=_("<div class=info-wrap><div class=status></div><div class=info><p>Computer will follow the lines in the opening.</p><p>Moves will be hidden."),Si=_('<div class="rematch-buttons buttons"><button class=end>End</button><button class=rematch>Rematch</button><button><i>'),xi=_("<span>Your turn."),Ei=_("<span>..."),Kt=_("<span>1 of 15"),Dt=_("<button class=retake>Re-take"),Li=_("<p>You are given 15 random positions from the opening. Play the correct moves."),Gt=_("<div class=info-wrap><div class=status></div><div class=info>"),qi=_("<div class=quiz-history>"),Ft=_("<button class=start>Start"),Qt=_('<div class="quiz-buttons buttons">'),Oi=_("<div class=quiz-item>"),Pi=_("<p>You will play the moves from the opening. If you go out of book, game ends."),Ti=_("<i data-icon=>"),Ni=_("<button class=new><i data-icon=></i><span>New Section"),Ai=_("<div class=sections-list><div class=header><span class=title></span><div class=tools></div></div><div class=list><div class=tools>"),rt=_("<i data-icon=>"),Ii=_("<button class=new><i data-icon=></i><span>New Chapter"),Ri=_('<div class="section active"><div class=header><div class=title><span class=nth></span><span class=fit-ellipsis></span></div></div><div class=chapters-list><div class=list></div><div class=tools>'),zi=_("<div><div class=title><span class=nth>."),Bi=_("<div class=section><div class=header><div class=title><span class=nth></span><span class=fit-ellipsis>"),Mi=_("<div class=no-sections>No Sections yet."),Ui=_("<div class=no-chapters>No Chapters yet."),Ki=_("<div class=loading-chapters>Loading Chapters."),Di=_("<div class=tabs><div><i data-icon=></i></div><div><i data-icon=>"),Gi=_("<div class=settings><div class=group><label for=editable>Disable Edits</label><input id=editable type=checkbox>"),Fi=_("<div class=export><button>Copy PGN</button><button></button><button disabled>Export to Lichess Study"),Qi=_("<div class=fen><h4>FEN"),Vi=_("<div class=content>"),Yi=_("<div class=copy-input-text><input type=text readonly>"),ji=_("<span class=copied><i data-icon=>"),Hi=_("<span><i data-icon=>"),Wi=_("<div class=loading>Loading");const pr=()=>{const[e,{load_study:t}]=se();let n=bn();return We(()=>t(n.id)),o(Xi,fe(()=>Ji(e,n.id)))};function Ji(e,t){let n=x(()=>e.studies[t]),i=x(()=>{let c=n()?.sections;return n()?.section_ids.map(l=>c.find(r=>r.id===l))}),s=x(()=>{let c=n(),l=c?.selected_section_id;if(l)return c?.sections.find(r=>r.id===l)}),a=x(()=>{let c=s();if(c)return c.chapter_ids.map(l=>e.chapters.list.find(r=>r.id===l)).filter(Boolean)}),d=x(()=>{let l=s()?.selected_chapter_id;if(l)return a()?.find(r=>r.id===l)});return{get study(){return n()},get selected_section(){return s()},get selected_chapter(){return d()},get sections(){return i()},get chapters(){return a()}}}function Xi(e){const[,{reset_replay_tree:t,load_replay_tree:n,load_chapter:i,load_chapters:s}]=se(),[a,d]=P("show"),[,c]=nt();We(Je(x(()=>e.selected_section?.id),r=>r&&c(()=>s(r)))),We(Je(x(()=>e.selected_chapter?.id),r=>{c(r?()=>{i(r),n(r)}:()=>{t()})}));const l=r=>({...e,study:r});return o(He,{get fallback(){return o(_r,{})},get children(){return o(y,{get when(){return e.study},children:r=>[o(y,{get when(){return a()==="show"},get children(){return o(Zi,fe(()=>l(r()),{on_feature_practice:()=>d("practice")}))}}),o(y,{get when(){return a()==="practice"},get children(){return o(er,fe(()=>l(r()),{on_feature_practice_off:()=>d("show")}))}})]})}})}function Zi(e){const[t,{goto_path:n,goto_path_if_can:i,delete_at_and_after_path:s,tree_step_node_set_nags:a,add_child_san_to_current_path:d,chapter_as_export_pgn:c,set_write_enabled_replay_tree:l}]=se();l(!e.study.is_edits_disabled);let r=yt(t);Ct(r);let[f,m]=P(),[C,p]=P(!1),[g,$]=P(!1),[T,E]=P(!1),[B,M]=P(!1);const G=x(()=>{let h=f();if(h)return $n(t.replay_tree.steps_tree,h)});Re(()=>{const h=()=>{m(void 0)};document.addEventListener("click",h),ze(()=>{document.removeEventListener("click",h)})});let v,k;const O=(h,A)=>{n(A),m(A);let j=h.clientX,te=h.clientY,ue=k.getBoundingClientRect(),ie=v.getBoundingClientRect();j-=ie.left,te-=ie.top,j=Math.min(j,document.body.clientWidth-ue.width-ie.left-20);let _e=`${te}px`,Ee=`${j}px`;k.style.top=_e,k.style.left=Ee},L=h=>{let A=h.fen;window.open(`https://lichess.org/analysis?fen=${A}`,"_blank"),m(void 0)},[,I]=nt(),w=async h=>{I(()=>{s(h)}),m(void 0)};let S;const U=h=>{clearTimeout(S),S=void 0,h===!1?S=setTimeout(()=>{p(!1)},150):S=setTimeout(()=>{p(!0)},100)},ee=async(h,A)=>{await a(h,[xn(A)]),clearTimeout(S),p(!1)};let D,[J,F]=P(void 0);const Se=x(()=>{let h=J();if(k===void 0||h===void 0)return"";let A=D.getBoundingClientRect(),j=h.getBoundingClientRect(),te=k.getBoundingClientRect(),ue=A.top,ie=te.left-j.width,_e=v.getBoundingClientRect();return ie-=_e.left,ue-=_e.top,`top: ${ue}px; left: ${ie}px;`}),pe=h=>{i(h)};let $e=x(()=>{let h=r.step_at_cursor_path;if(!h)return[];let A=h.nags?.[0];return A?Pt(h.step.uci,h.step.san,Ot(A)):[]});const q=x(()=>e.selected_chapter?.name??"[detached]"),R=x(()=>f()!==void 0||g()||T()!==void 0||B()!==void 0);let[,{import_from_pgn:ae}]=se();const ne=async(h,A)=>{let j=T()?e.selected_section:void 0;E(!1),await ae(e.study,A,h,j)},oe=()=>{},ke=async()=>{let h=await c(e.study.name,e.selected_section.name,e.selected_chapter);navigator.clipboard.writeText(h)},X=h=>{let A=Sn(t.replay_tree.steps_tree,h);navigator.clipboard.writeText(A),m(void 0)},le=h=>{h>0?i(r.get_next_path):i(r.get_prev_path)},ve=x(()=>!e.study.is_edits_disabled),ce=h=>e.sections.indexOf(h),de=h=>e.chapters.indexOf(h),[,{update_section:xe,delete_section:me,update_chapter:Ue,delete_chapter:Te,update_study:Ke,delete_study:K,order_sections:we,order_chapters:Ne,change_root_fen:Ae}]=se(),Ht=xe,Wt=(h,A)=>{me(h,A),E(!1)},Jt=(h,A,j)=>{j.orientation&&st(void 0),Ue(h,A,j)},Xt=h=>{he(()=>{Te(e.study.id,e.selected_section.id,h),M(!1)})},Zt=Ke,en=kn(),tn=async h=>{await K(h),en("/openings")},nn=(h,A)=>{we(h.study_id,h.id,A)},rn=(h,A)=>{Ne(e.study.id,h.section_id,h.id,A)},sn=async h=>{await Ae(e.selected_chapter.id,h),M(!1)},an=async(h,A)=>{let te=Et(r.fen),ue=te.turn,ie=te.board.get(et(h)),_e=h+A;ie.role==="pawn"&&(A[1]==="8"&&ue==="white"||A[1]==="1"&&ue==="black")&&(_e+="q");let Ee=Lt(_e),Q=qt(te,Ee),z=await d(Q);n(z.step.path)},[on,st]=P(),at=x(()=>on()??e.selected_chapter?.orientation??e.selected_section?.orientation??e.study.orientation??"white"),ot=h=>{h.key==="f"&&st(Y(at()))};return Re(()=>{document.addEventListener("keydown",ot),ze(()=>{document.removeEventListener("keydown",ot)})}),(()=>{var h=Mt(),A=h.firstChild,j=A.nextSibling,te=j.nextSibling,ue=te.firstChild,ie=te.nextSibling,_e=ie.nextSibling,Ee=v;return typeof Ee=="function"?Ie(Ee,h):v=h,u(A,o(Yt,fe(e,{get section(){return e.selected_section},get chapter(){return e.selected_chapter}}))),ye(j,"wheel",At(le)),u(j,o(Tt,{get orientation(){return at()},get shapes(){return $e()},get movable(){return ve()},get color(){return St(r.fen)},get fen(){return r.fen},get last_move(){return r.last_move},play_orig_key:an})),u(ue,q),u(te,o(xt,{handle_goto_path:pe,get replay_tree(){return t.replay_tree},get lose_focus(){return R()},on_context_menu:O,get features(){return(()=>{var Q=Ut();return ye(Q,"click",e.on_feature_practice,!0),Q})()}}),null),u(ie,o(Vt,fe(e,{get is_edits_disabled(){return e.study.is_edits_disabled},on_edit_study:()=>$(!0),on_edit_section:()=>E(!0),on_edit_chapter:()=>M(!0)}))),u(_e,o(dr,fe(e,{get fen(){return r.fen},on_export_lichess:oe,on_copy_pgn:ke}))),u(h,o(y,{get when(){return T()},get children(){return o(Qe,{klass:"edit-section",on_close:()=>E(!1),get children(){return o(_i,{get section(){return e.selected_section},get i_section(){return ce(e.selected_section)},get nb_sections(){return e.sections.length},on_delete_section:()=>Wt(e.study.id,e.selected_section.id),on_edit_section:Q=>Ht(e.study.id,Q),on_order_section:Q=>nn(e.selected_section,Q),on_import_pgns:ne})}})}}),null),u(h,o(y,{get when(){return B()},get children(){return o(Qe,{klass:"edit-chapter",on_close:()=>M(!1),get children(){return o(ui,{get fen(){return r.initial_fen},get nb_chapters(){return e.chapters.length},get chapter(){return e.selected_chapter},get i_chapter(){return de(e.selected_chapter)},on_edit_chapter:Q=>Jt(e.study.id,e.selected_chapter.section_id,Q),on_delete_chapter:()=>Xt(e.selected_chapter.id),on_order_chapter:Q=>rn(e.selected_chapter,Q),on_change_root_fen:sn})}})}}),null),u(h,o(y,{get when(){return g()},get children(){return o(Qe,{klass:"edit-study",on_close:()=>$(!1),get children(){return o(di,{get study(){return e.study},on_delete_study:()=>tn(e.study.id),on_update_study:Zt})}})}}),null),u(h,o(y,{get when(){return G()},children:Q=>[o(wn,{get step(){return Q().step},ref(z){var re=k;typeof re=="function"?re(z):k=z},get children(){return[(()=>{var z=hi();return z.$$click=()=>L(Q().step),z})(),(()=>{var z=gi();return z.$$click=()=>X(Q().step.path),z})(),o(y,{get when(){return!e.study.is_edits_disabled},get children(){return[(()=>{var z=fi();z.addEventListener("mouseenter",()=>U(!0)),z.addEventListener("mouseleave",()=>U(!1));var re=D;return typeof re=="function"?Ie(re,z):D=z,z})(),(()=>{var z=pi();return z.$$click=()=>w(Q().step.path),z})()]}})]}}),o(y,{get when(){return C()},get children(){var z=vi();return Ie(re=>setTimeout(()=>F(re)),z),z.addEventListener("mouseenter",()=>U(!0)),z.addEventListener("mouseleave",()=>U(!1)),u(z,o(be,{each:yn,children:(re,De)=>(()=>{var qe=mi(),ln=qe.firstChild;return qe.$$click=()=>ee(Q(),re),u(qe,()=>Fe[De()],null),N(Oe=>{var lt="annotate glyph "+Fe[De()],ct=`glyph-icon ${Fe[De()]}`;return lt!==Oe.e&&Z(qe,Oe.e=lt),ct!==Oe.t&&Z(ln,Oe.t=ct),Oe},{e:void 0,t:void 0}),qe})()})),N(re=>wt(z,Se(),re)),z}})]}),null),h})()}function er(e){const[t,{goto_path:n,goto_path_force:i,goto_path_if_can:s,set_hide_after_path:a,add_child_san_to_success_or_error_path_no_save:d,set_write_enabled_replay_tree:c}]=se();c(!1);let l=yt(t);Ct(l);const[r,f]=P("practice"),m=q=>{q>0?s(l.get_next_path):s(l.get_prev_path)},[C,p]=P(),g=x(()=>C()??e.selected_chapter?.orientation??e.selected_section?.orientation??e.study.orientation??"white"),$=q=>{q.key==="f"&&he(()=>{p(Y(g())),O(void 0),$e()})};Re(()=>{document.addEventListener("keydown",$),ze(()=>{document.removeEventListener("keydown",$)})});let T=x(()=>{let q=l.step_at_cursor_path;if(!q)return[];let R=q.nags?.[0];return R?Pt(q.step.uci,q.step.san,Ot(R)):[]});const E=async(q,R)=>{let ne=Et(l.fen),oe=ne.turn,ke=ne.board.get(et(q)),X=q+R;ke.role==="pawn"&&(R[1]==="8"&&oe==="white"||R[1]==="1"&&oe==="black")&&(X+="q");let le=Lt(X),ve=qt(ne,le);ee(ve)},B=x(()=>e.selected_chapter?.name??"[detached]"),M=q=>{s(q)},[G,v]=P(),[k,O]=P(),[L,I]=P(!1),w=x(()=>G()===void 0&&L()&&!Se()),S=x(()=>k()??g()),U=x(()=>[]),ee=async q=>{r()==="practice"&&D(q)},D=async q=>{let R=await d(q);R&&(R[0]==="error"?(i(R[1].step.path),v(setTimeout(()=>{he(()=>{n(qn(R[1].step.path)),v(void 0)})},600))):(he(()=>{i(R[1].step.path),a(R[1].step.path)}),$e()))},J=q=>{q!==void 0&&he(()=>{pe(!1),O(q),a(void 0),i(""),$e()})},F=x(()=>{let q=Cn(t.replay_tree.steps_tree,t.replay_tree.cursor_path);if(q=q.filter(R=>!t.replay_tree.error_paths.includes(R.step.path)),!(!q||q.length===0))return q}),[Se,pe]=P(!1),$e=()=>{let q=F();if(q===void 0){pe(!0);return}if(S()!==l.turn){let R=Nt(q);v(setTimeout(()=>{he(()=>{i(R.step.path),a(R.step.path),v(void 0),F()===void 0&&pe(!0)})},500))}};return(()=>{var q=Mt(),R=q.firstChild,ae=R.nextSibling,ne=ae.nextSibling,oe=ne.firstChild,ke=ne.nextSibling;return u(R,o(Yt,fe(e,{get section(){return e.selected_section},get chapter(){return e.selected_chapter}}))),ye(ae,"wheel",At(m)),u(ae,o(Tt,{get orientation(){return S()},get shapes(){return T()},get movable(){return w()},get color(){return St(l.fen)},get fen(){return l.fen},get last_move(){return l.last_move},play_orig_key:E})),u(oe,B),u(ne,o(xt,{handle_goto_path:M,get replay_tree(){return t.replay_tree},lose_focus:!1,on_context_menu:()=>{},get features(){return(()=>{var X=Ut();return ye(X,"click",e.on_feature_practice_off,!0),X})()},get feature_content(){return(()=>{var X=wi(),le=X.firstChild,ve=le.firstChild,ce=le.nextSibling;return ve.$$click=()=>f("practice"),u(ce,o(y,{get when(){return r()==="quiz"},get children(){return[bi(),o(ir,{get nodes(){return U()}})]}}),null),u(ce,o(y,{get when(){return r()==="deathmatch"},get children(){return[$i(),o(rr,{})]}}),null),u(ce,o(y,{get when(){return r()==="practice"},get children(){return[ki(),o(tr,{get end_of_practice(){return Se()},get movable(){return w()},on_rematch:J,get color(){return S()},set_movable:I})]}}),null),N(de=>{var xe="feature tab"+(r()==="practice"?" active":""),me="content "+r();return xe!==de.e&&Z(ve,de.e=xe),me!==de.t&&Z(ce,de.t=me),de},{e:void 0,t:void 0}),X})()}}),null),u(ke,o(Vt,fe(e,{is_edits_disabled:!0}))),q})()}function tr(e){const[t,{goto_path:n,reload_replay_tree_with_cursor_path:i}]=se(),[,s]=nt(),a=l=>{if(l===void 0){s(()=>{i(t.replay_tree.cursor_path)});return}he(()=>{s(()=>{i(""),e.on_rematch(l)})})},d=x(()=>e.color),c=x(()=>Y(d()));return e.set_movable(!0),n(""),[(()=>{var l=Ci(),r=l.firstChild;return u(r,o(y,{get when(){return e.end_of_practice},get fallback(){return o(y,{get when(){return e.movable},get fallback(){return Ei()},get children(){return xi()}})},get children(){return yi()}})),l})(),(()=>{var l=Si(),r=l.firstChild,f=r.nextSibling,m=f.nextSibling;return r.$$click=()=>a(),f.$$click=()=>a(d()),m.$$click=()=>a(c()),N(()=>Z(m,`color ${c()}`)),l})()]}function nr(e){let[t,n]=P(void 0);return{step:e,get is_solved(){return t()},set is_solved(i){n(i)}}}function ir(e){let[t,n]=P([...Array(15).keys()]);const[i,s]=P("info");let d=x(En(t,()=>nr(Nt(e.nodes))));return[(()=>{var c=Gt(),l=c.firstChild,r=l.nextSibling;return u(l,o(y,{get when(){return i()==="info"},children:"Press start"}),null),u(l,o(y,{get when(){return i()==="in-progress"},get children(){return Kt()}}),null),u(l,o(y,{get when(){return i()==="end"},get children(){return Dt()}}),null),u(r,o(y,{get when(){return i()==="info"},get children(){return Li()}})),c})(),(()=>{var c=qi();return u(c,o(be,{get each(){return d()},children:(l,r)=>(()=>{var f=Oi();return u(f,()=>r()+1),f})()})),c})(),(()=>{var c=Qt();return u(c,o(y,{get when(){return i()==="info"},get children(){return Ft()}})),c})()]}function rr(){const[e,t]=P("info");return[(()=>{var n=Gt(),i=n.firstChild,s=i.nextSibling;return u(i,o(y,{get when(){return e()==="info"},children:"Press start"}),null),u(i,o(y,{get when(){return e()==="in-progress"},get children(){return Kt()}}),null),u(i,o(y,{get when(){return e()==="end"},get children(){return Dt()}}),null),u(s,o(y,{get when(){return e()==="info"},get children(){return Pi()}})),n})(),(()=>{var n=Qt();return u(n,o(y,{get when(){return e()==="info"},get children(){return Ft()}})),n})()]}function Vt(e){let[,{create_section:t,update_study:n}]=se();const i=async()=>{let a=await t(e.study.id);await s(a.id),e.on_edit_section?.()},s=a=>n({id:e.study.id,selected_section_id:a});return(()=>{var a=Ai(),d=a.firstChild,c=d.firstChild,l=c.nextSibling,r=d.nextSibling,f=r.firstChild;return u(c,()=>e.study.name),u(l,o(y,{get when(){return!e.is_edits_disabled},get children(){var m=Ti();return m.$$click=()=>e.on_edit_study?.(),m}})),u(r,o(be,{get each(){return e.sections},get fallback(){return o(lr,{})},children:(m,C)=>o(y,{get when(){return m===e.selected_section},get fallback(){return o(or,{get is_edits_disabled(){return e.is_edits_disabled},section:m,get nth(){return mt(C())},on_selected:()=>s(m.id),on_edit:()=>e.on_edit_section?.()})},get children(){return o(sr,fe(e,{section:m,get is_edits_disabled(){return e.is_edits_disabled},get nth(){return mt(C())},get on_edit(){return e.on_edit_section},get on_edit_chapter(){return e.on_edit_chapter}}))}})}),f),u(f,o(y,{get when(){return!e.is_edits_disabled},get children(){var m=Ni();return m.$$click=i,m}})),a})()}function sr(e){let[,{create_chapter:t,update_section:n}]=se();const i=async()=>{let a=await t(e.study.id,e.section.id);await s(a.id),e.on_edit_chapter?.()},s=async a=>n(e.study.id,{id:e.section.id,selected_chapter_id:a});return(()=>{var a=Ri(),d=a.firstChild,c=d.firstChild,l=c.firstChild,r=l.nextSibling,f=d.nextSibling,m=f.firstChild,C=m.nextSibling;return u(l,()=>e.nth),u(r,()=>e.section?.name),u(d,o(y,{get when(){return!e.is_edits_disabled},get children(){var p=rt();return p.$$click=()=>e.on_edit?.(),p}}),null),u(m,o(be,{get each(){return e.chapters},get fallback(){return o(cr,{})},children:(p,g)=>o(ar,{get is_edits_disabled(){return e.is_edits_disabled},chapter:p,get nth(){return`${e.nth}${g()+1}`},get selected(){return e.selected_chapter===p},on_selected:()=>s(p.id),on_edit:()=>e.on_edit_chapter?.()})})),u(C,o(y,{get when(){return!e.is_edits_disabled},get children(){var p=Ii();return p.$$click=()=>i(),p}})),N(()=>Ln(r,"title",e.section?.name)),a})()}function ar(e){const t=x(()=>e.selected?" active":"");return(()=>{var n=zi(),i=n.firstChild,s=i.firstChild,a=s.firstChild;return n.$$click=()=>e.on_selected(),u(s,()=>e.nth,a),u(i,()=>e.chapter.name,null),u(n,o(y,{get when(){return!e.is_edits_disabled},get children(){var d=rt();return d.$$click=()=>e.on_edit(),d}}),null),N(()=>Z(n,"chapter"+t())),n})()}function or(e){const t=async()=>{await e.on_selected(),e.on_edit()};return(()=>{var n=Bi(),i=n.firstChild,s=i.firstChild,a=s.firstChild,d=a.nextSibling;return i.$$click=()=>e.on_selected(),u(a,()=>e.nth),u(d,()=>e.section.name),u(i,o(y,{get when(){return!e.is_edits_disabled},get children(){var c=rt();return c.$$click=t,c}}),null),n})()}function lr(){return Mi()}function cr(){return Ui()}function vr(){return Ki()}function Yt(e){return[]}function dr(e){const[,{update_study:t}]=se(),[n,i]=P("share"),[s,a]=P(!0,{equals:!1}),d=()=>{a(!0),e.on_copy_pgn()},c=e.study.is_edits_disabled,l=p=>t({id:e.study.id,is_edits_disabled:p}),[r,f]=P(!1),[,{study_as_export_pgn:m}]=se(),C=async()=>{f(!0);let p=await m(e.study.id);f(!1),hr(p,`${e.study.name}.pgn`)};return[(()=>{var p=Di(),g=p.firstChild,$=g.nextSibling;return g.$$click=()=>i("settings"),$.$$click=()=>i("share"),N(T=>{var E="tab"+(n()==="settings"?" active":""),B="tab"+(n()==="share"?" active":"");return E!==T.e&&Z(g,T.e=E),B!==T.t&&Z($,T.t=B),T},{e:void 0,t:void 0}),p})(),(()=>{var p=Vi();return u(p,o(y,{get when(){return n()==="settings"},get children(){var g=Gi(),$=g.firstChild,T=$.firstChild,E=T.nextSibling;return E.addEventListener("change",B=>l(B.currentTarget.checked)),E.checked=c,g}}),null),u(p,o(y,{get when(){return n()==="share"},get children(){return[(()=>{var g=Fi(),$=g.firstChild,T=$.firstChild,E=$.nextSibling,B=E.nextSibling;return $.$$click=d,u($,o(jt,{get on_copy(){return s()}}),T),E.$$click=C,u(E,o(y,{get when(){return r()},get fallback(){return"Export as PGN"},children:"Loading..."})),ye(B,"click",e.on_export_lichess,!0),N(()=>E.disabled=r()),g})(),(()=>{var g=Qi();return g.firstChild,u(g,o(ur,{get value(){return e.fen}}),null),g})()]}}),null),p})()]}function ur(e){const[t,n]=P(!0,{equals:!1}),i=()=>{navigator.clipboard.writeText(e.value),n(!0)};return(()=>{var s=Yi(),a=s.firstChild;return s.$$click=i,u(s,o(jt,{get on_copy(){return t()}}),null),N(()=>a.value=e.value),s})()}function jt(e){Pe(Je(()=>e.on_copy,()=>{n(!0),setTimeout(()=>n(!1),1e3)},{defer:!0}));const[t,n]=P(!1);return o(y,{get when(){return t()},get fallback(){return Hi()},get children(){return ji()}})}function _r(){return Wi()}function hr(e,t){const n=new Blob([e],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(n),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",t),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}Me(["click"]);export{ar as ChapterComponent,vr as LoadingChapters,cr as NoChapters,lr as NoSections,pr as default};
