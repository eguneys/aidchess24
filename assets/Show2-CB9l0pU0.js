import{g as $,Y as L,Z as A,_ as U,n as X,q as R,$ as ee,v as te,u as y,a as se,i as l,c as f,A as ne,j as O,k as j,F as q,S as B,t as b,D as P,B as ie,e as le,d as re,R as w}from"./index-B_BBSApY.js";function be(n){const i=$(()=>L(A(n)));return()=>i()()}function x(n){const[i,r]=U([]);return X(R(n,()=>{ae(A(n),i,r)})),i}function ae(n,i,r,e={key:"id"}){const t=n.subscribe(a=>r(ee(a,e)));return te(()=>"unsubscribe"in t?t.unsubscribe():t()),i}var ce=b("<div class=repeat-show><div class=studies><h3>Repertoires</h3><div class=list>"),E=b("<div>"),de=b("<p>Selected <!> sections"),oe=b("<div class=buttons><button>First 10 moves <span></span></button><div class=small><button>10-20 moves <span></span></button><button>20+ moves <span></span></button></div><div class=small><button>White moves <span></span></button><button>Black moves <span>"),ue=b("<div class=study-side><div class=sections><h3>Sections</h3><div class=list></div></div><div class=dues>"),_e=b("<p> Please Select Some Sections ");const he=()=>{const n=y(w),i=x(()=>n.studies.toArray()),[r,e]=se(0),t=$(()=>i[r()]);return(()=>{var a=ce(),_=a.firstChild,g=_.firstChild,c=g.nextSibling;return l(c,f(q,{each:i,get fallback(){return f(ne,{href:"/repertoires",children:"Import some studies first"})},children:(m,u)=>(()=>{var s=E();return s.$$click=()=>e(u()),l(s,()=>m.name),O(()=>j(s,"study"+(r()===u()?" active":""))),s})()})),l(a,f(B,{get when(){return t()},children:m=>f($e,{get study(){return m()}})}),null),a})()},F=n=>{const i=y(w);let r=x(async()=>{let e=await i.due_cards.where("section_id").anyOf(n).toArray();return await Promise.all(e.map(async t=>{let a=await i.moves.where("id").anyOf(t.move_ids).toArray(),_=await i.sections.where("id").equals(t.section_id).first(),g=await Promise.all(a.map(async c=>({data:c.data,chapter:await i.chapters.where("id").equals(c.chapter_id).first()})));return{id:t.id,before_fen:t.before_fen,due:t.card.due.getTime(),section:_,moves:g}}))});return{get due(){return r.filter(e=>e.due<=new Date().getTime())},get due_white(){return this.due.filter(e=>P(e.before_fen)==="white")},get due_black(){return this.due.filter(e=>P(e.before_fen)==="black")},get due_10(){return this.due.filter(e=>e.moves[0]?.data.path.length<=20)},get due_10_20(){return this.due.filter(e=>e.moves[0]?.data.path.length>=20&&e.moves[0].data.path.length<=40)},get due_20plus(){return this.due.filter(e=>e.moves[0]?.data.path.length>=40)}}},N=n=>ie([],"repeat.selected_sections."+n),$e=n=>{const i=y(w),r=x(()=>i.sections.where("study_id").equals(n.study.id).toArray()),e=$(()=>N(n.study.id)),t=$(()=>e()[0]()),a=s=>e()[1](s),_=$(()=>t().length),g=s=>{t().includes(s)?a(t().filter(h=>h!==s)):a([...t(),s])};let c=$(R(t,s=>F(s)));const m=le(),u=s=>{let h=n.study.id;m("/repeat/"+h+(s?`?filter=${s}`:""))};return(()=>{var s=ue(),h=s.firstChild,Q=h.firstChild,T=Q.nextSibling,M=h.nextSibling;return l(T,f(q,{each:r,children:d=>(()=>{var o=E();return o.$$click=()=>g(d.id),l(o,()=>d.name),O(()=>j(o,"section"+(t().includes(d.id)?" selected":""))),o})()})),l(M,f(B,{get when(){return _()>0},get fallback(){return _e()},get children(){return[(()=>{var d=de(),o=d.firstChild,p=o.nextSibling;return p.nextSibling,l(d,_,p),d})(),(()=>{var d=oe(),o=d.firstChild,p=o.firstChild,z=p.nextSibling,C=o.nextSibling,v=C.firstChild,I=v.firstChild,V=I.nextSibling,k=v.nextSibling,W=k.firstChild,Y=W.nextSibling,Z=C.nextSibling,S=Z.firstChild,G=S.firstChild,H=G.nextSibling,D=S.nextSibling,J=D.firstChild,K=J.nextSibling;return o.$$click=()=>u("first-ten"),l(z,()=>c().due_10.length),v.$$click=()=>u("ten-twenty"),l(V,()=>c().due_10_20.length),k.$$click=()=>u("twenty-plus"),l(Y,()=>c().due_20plus.length),S.$$click=()=>u("white"),l(H,()=>c().due_white.length),D.$$click=()=>u("black"),l(K,()=>c().due_black.length),d})()]}})),s})()};re(["click"]);const ge=Object.freeze(Object.defineProperty({__proto__:null,Due_Component:F,PersistedSelectionComponent:N,default:he},Symbol.toStringTag,{value:"Module"}));export{F as D,N as P,ge as S,be as c};
