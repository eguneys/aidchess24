var be=Object.defineProperty;var we=(c,r,e)=>r in c?be(c,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[r]=e;var C=(c,r,e)=>(we(c,typeof r!="symbol"?r+"":r,e),e);import{h as ke,j as Se,i as d,c as u,S as Q,k as x,b as p,l as f,m as L,o as D,n as te,p as re,q as Ce,f as I,g as G,F as ae,s as O,M as y,r as W,e as ye,v as xe,d as Me,t as a}from"./index-B6YmRJks.js";/* empty css                   */import{S as Ee}from"./studyrepo-RWTwAmf1.js";import{S as Pe,C as Te}from"./Shalala-B6E8oC_U.js";import{T as Re,a as B,C as De}from"./Chesstree2-BAvs4e_o.js";import{I as Qe,M as Le}from"./chess_pgn_logic-BH3wlgFa.js";import{S as Ye,O as se}from"./SessionStore-Cj-FHMm_.js";import"./index-CieSYURx.js";function je(c){let r=0;return e=>{r+=e.deltaY*(e.deltaMode?40:1),Math.abs(r)>=4?(c(e,!0),r=0):c(e,!1)}}var Ie=a("<div class=progress><div class=bar></div><h3>"),Oe=a("<div class=repertoire-wrap>"),le=a("<small> Click on variations to expand. "),Ae=a("<small> Your goal is to guess every move correctly to pass the quiz. "),Ne=a("<h2>Select a Quiz Option"),Fe=a("<button><span> Take Quiz "),Ge=a("<button><span> Play Deathmatch "),We=a("<h2>Deathmatch Mode"),ie=a("<span class=passed>passed"),Be=a("<small> Deathmatch "),He=a("<small> Your score: "),Ke=a("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),Ue=a("<h2>Quiz Mode"),Je=a("<small> Quiz "),Ve=a("<small> Your score: <!> out of 15 correct"),Xe=a("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),Ze=a("<small> Your goal is to guess every move correctly to fill up the progress bar. "),et=a("<h2>Select a Practice Option"),tt=a("<button><span> Play all Moves "),rt=a("<button><span> Play as Match "),at=a("<h2>Play as Match"),st=a("<small> Try to guess the moves for <!>."),lt=a("<small> AI will play the next move, picking a random variation. "),it=a("<small> Moves will be hidden once the game is started. "),ot=a("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),_t=a("<h2>Play all moves"),nt=a("<small>Try to guess the moves for both sides."),ht=a("<small>Moves will be hidden once you start."),ct=a("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),ut=a("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),dt=a("<li><div><h3></h3> "),mt=a('<div class=line><span class="fill white"></span><span class="fill black">'),pt=a("<small>You will play the moves from the opening."),vt=a("<small>If you go out of book, game ends."),ft=a("<div class=in_mode><button class=end2><span> End Deathmatch "),oe=a("<span class=failed>failed"),gt=a("<small>You are given 15 random positions from the opening."),$t=a("<small>Guess the correct move."),zt=a("<h2> of 15"),qt=a("<div class=in_mode><button class=end2><span> End Quiz ");const bt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],wt=c=>bt[Math.floor((1-c/10)*6)];class kt{constructor(){C(this,"_mode");C(this,"_match_color");C(this,"_quiz_quiz_ls");C(this,"_quiz_deathmatch_fail");C(this,"_quiz_deathmatch_result_path");this._mode=x(void 0,{equals:!1}),this._match_color=x("white"),this._quiz_quiz_ls=x([],{equals:!1}),this._quiz_deathmatch_fail=x(0),this._quiz_deathmatch_result_path=x([])}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_quiz(){this.quiz_quiz_ls=[],this.mode="quiz-quiz"}end_quiz(){this.quiz_quiz_ls=[],this.mode="quiz"}quiz_pass_one(){this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls}quiz_fail_one(){this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){W(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){W(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz"})}}const _e=c=>(()=>{var r=Ie(),e=r.firstChild,i=e.nextSibling;return d(i,()=>`%${c.width}`),I(o=>O(e,`width: ${c.width}%`,o)),r})();class St{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(e=>Math.round(e.progress/r)).reduce((e,i)=>e+i)}}class M{constructor(r,e,i,o){this.study_id=r,this.i_chapter=e,this.score_tree=i,this.solved_paths=o}static load_from_store(r,e){let i=new se(r.id,e);return M.make(r.id,e,r.chapters[e].pgn.tree,B.set_for_saving(i.solved_paths))}static save_paths_to_store(r){let e=new se(r.study_id,r.i_chapter);e.solved_paths=r.solved_paths.get_for_saving(),e.practice_progress=r.progress}static make(r,e,i,o=new B){return new M(r,e,Le.make(i),o)}get progress(){return Math.floor(this.solved_paths.expand_paths.map(r=>{var e;return((e=this.score_tree.get_at(r))==null?void 0:e.score)??0}).reduce((r,e)=>r+e,0)*100)}get progress_map(){let r=L(()=>this.score_tree.progress_paths);const e=L(()=>r.map(i=>[i.filter(o=>o.length%2===1).map(o=>this.score_tree.get_at(o).score).reduce((o,z)=>o+z,0),i.filter(o=>o.length%2===0).map(o=>this.score_tree.get_at(o).score).reduce((o,z)=>o+z,0)]));return r.map((i,o)=>{let z=i[0],w=i[i.length-1],E=e[o][0],P=e[o][1],h=p(()=>this.solved_paths.expand_paths),T=p(()=>h().filter(m=>i.some($=>$.join("")===m.join("")))),R=p(()=>T().filter(m=>m.length%2===1).map(m=>this.score_tree.get_at(m).score).reduce((m,$)=>m+$,0)),Y=p(()=>T().filter(m=>m.length%2===0).map(m=>this.score_tree.get_at(m).score).reduce((m,$)=>m+$,0));return{color:wt(z.length/20+w.length/10),total:E*2,black:p(()=>Y()/P),white:p(()=>R()/E),path:w}}).reverse()}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),M.save_paths_to_store(this)}}const Lt=()=>{const c=ke(),[r]=Se(c.id,Ee.read_study);return(()=>{var e=Oe();return d(e,u(Q,{get when(){return!r.loading},fallback:"Loading...",get children(){return u(Ct,{get study(){return r()}})}})),e})()},Ct=c=>{const r=()=>c.study;let e=new kt,i=new Pe;const[o,z]=x(Ye.i_chapter??0);let w=p(()=>{const s=r();return new St(s.chapters.map((_,g)=>M.load_from_store(s,g)))}),E=p(()=>w().chapters[o()]);const P=p(()=>r().chapters[o()]),h=p(()=>{e.mode;let s=P();return Re.make(s.pgn.tree.clone)}),T=p(()=>{if(e.mode==="quiz-quiz")return e.i_quiz_quiz===15});f(()=>{e.mode==="quiz-quiz"&&(e.i_quiz_quiz===15||L(()=>{h().set_random_cursor_hide_rest(),e.match_color=h().cursor_after_color}))}),f(()=>{e.mode==="quiz-deathmatch"&&e.match_color==="black"&&setTimeout(()=>{h().reveal_one_random()},400)}),f(()=>{h().solved_paths.replace_all(E().solved_paths)});const R=p(()=>{let s=h().tree;return L(()=>M.make(r().name,o(),s,new B))});f(()=>{if(e.mode!=="match"&&e.mode!=="moves")return;L(()=>R()).solved_paths.replace_all(h().solved_paths)}),f(D(()=>[R(),E()],(s,_)=>{if(_){let[g,k]=_;k.merge_and_save_stats(g)}})),f(D(()=>i.add_uci,s=>{if(!s)return;h().try_next_uci_fail(s)?(Y(),e.mode==="quiz-quiz"&&e.quiz_pass_one()):(e.mode==="match"&&setTimeout(()=>{h().on_wheel(-1)},100),e.mode==="quiz-quiz"&&e.quiz_fail_one(),e.mode==="quiz-deathmatch"&&(e.quiz_deathmatch_fail_result=-1,e.quiz_deathmatch_result_path=h().cursor_path.slice(0,-1)))})),f(()=>{let{mode:s,match_color:_}=e;s==="match"&&_==="black"&&Y()}),f(D(()=>h().fen_last_move,s=>{if(s){let[_,g]=s;i.on_set_fen_uci(_,g)}else i.on_set_fen_uci(Qe)}));const Y=()=>{let s=()=>h().is_cursor_path_at_a_leaf;s()?e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=h().cursor_path):e.mode==="match"||e.mode:(e.mode==="match"||e.mode==="quiz-deathmatch")&&setTimeout(()=>{h().reveal_one_random(),s()&&(e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=h().cursor_path):e.mode==="match"||e.mode)},400)};f(D(()=>i.on_wheel,s=>{s&&h().on_wheel(s)}));const m=s=>{s.key==="f"&&e.flip_match_color()};te(()=>{document.addEventListener("keypress",m)}),re(()=>{document.removeEventListener("keypress",m)});const $=je(s=>{const _=s.target;_.tagName!=="PIECE"&&_.tagName!=="SQUARE"&&_.tagName!=="CG-BOARD"||(s.preventDefault(),i.set_on_wheel(Math.sign(s.deltaY)))});f(()=>{e.match_color=r().orientation??"white"});const ne=p(()=>R().progress_map);let A;te(()=>{A.addEventListener("wheel",$,{passive:!1})}),re(()=>{A.removeEventListener("wheel",$)});const H=s=>{let _=e.mode;if(s==="practice"){if(_===void 0||_==="match"||_==="moves")return" active"}else if(_==="quiz"||_==="quiz-quiz"||_==="quiz-deathmatch")return" active";return""},he=p(()=>e.mode!==void 0&&!T()),ce=p(D(()=>e.quiz_deathmatch_result_path,s=>{var k,S;let _=s.length,g=(S=(k=h().tree)==null?void 0:k.all_leaves.map(q=>q.path).filter(q=>!h().failed_paths.find(N=>N.join("")===q.join(""))).filter(q=>q.join("").startsWith(s.join("")))[0])==null?void 0:S.length;return`${_} out of ${g}`}));return(()=>{var s=ut(),_=s.firstChild,g=_.firstChild,k=g.nextSibling,S=k.firstChild,q=S.firstChild,N=S.nextSibling,K=_.nextSibling,U=K.nextSibling,ue=U.nextSibling,J=ue.firstChild,V=J.firstChild,de=V.firstChild,me=de.nextSibling,pe=V.nextSibling,ve=pe.firstChild,fe=J.nextSibling,X=fe.firstChild,ge=X.nextSibling,Z=ge.firstChild,F=Z.firstChild,ee=F.nextSibling,$e=Z.nextSibling;return Ce(t=>A=t,s),d(q,()=>r().name),d(S,u(_e,{get width(){return w().progress}}),null),d(N,u(ae,{get each(){return r().chapters},children:(t,l)=>(()=>{var n=dt(),b=n.firstChild,v=b.firstChild;return v.nextSibling,n.$$click=()=>z(l()),d(v,()=>t.name),d(b,u(_e,{get width(){var j;return((j=w())==null?void 0:j.chapters[l()].progress)??0}}),null),I(()=>G(n,l()===o()?"active":"")),n})()})),d(K,u(Te,{get orientation(){return e.match_color},get movable(){return he()},get doPromotion(){return i.promotion},get onMoveAfter(){return i.on_move_after},get fen_uci(){return i.fen_uci},get color(){return i.turnColor},get dests(){return i.dests}})),d(U,u(ae,{get each(){return ne()},children:t=>(()=>{var l=mt(),n=l.firstChild,b=n.nextSibling;return l.$$click=v=>h().try_set_cursor_path(t.path),I(v=>{var j=`background: ${t.color}; height: ${Math.round(t.total*100)}%`,ze=`height: ${Math.round(t.white()*100)}%`,qe=`height: ${Math.round(t.black()*100)}%`;return v.e=O(l,j,v.e),v.t=O(n,ze,v.t),v.a=O(b,qe,v.a),v},{e:void 0,t:void 0,a:void 0}),l})()})),d(me,()=>P().name),d(X,u(De,{get lala(){return h()}})),F.$$click=()=>e.mode=void 0,ee.$$click=()=>e.mode="quiz",d($e,u(ye,{get children(){return[u(y,{get when(){return e.mode==="quiz"},get children(){return[le(),Ae(),Ne(),(()=>{var t=Fe();return t.$$click=()=>e.mode="quiz-quiz",t})(),(()=>{var t=Ge();return t.$$click=()=>e.mode="quiz-deathmatch",t})()]}}),u(y,{get when(){return e.mode==="quiz-deathmatch"},get children(){return[We(),u(Q,{get when(){return e.quiz_deathmatch_fail_result!==0},get fallback(){return[pt(),vt(),(()=>{var t=ft(),l=t.firstChild;return l.$$click=()=>e.end_deathmatch(),t})()]},get children(){return[(()=>{var t=Be();return t.firstChild,d(t,u(Q,{get when(){return e.quiz_deathmatch_fail_result>0},get fallback(){return oe()},get children(){return[" ",ie()]}}),null),t})(),(()=>{var t=He();return t.firstChild,d(t,ce,null),t})(),(()=>{var t=Ke(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>e.restart_deathmatch(),n.$$click=()=>e.end_deathmatch(),t})()]}})]}}),u(y,{get when(){return e.mode==="quiz-quiz"},get children(){return[Ue(),u(Q,{get when(){return T()},get fallback(){return[gt(),$t(),(()=>{var t=zt(),l=t.firstChild;return d(t,()=>e.i_quiz_quiz,l),t})(),(()=>{var t=qt(),l=t.firstChild;return l.$$click=()=>e.end_quiz(),t})()]},get children(){return[(()=>{var t=Je();return t.firstChild,d(t,u(Q,{get when(){return e.quiz_pass>10},get fallback(){return oe()},get children(){return[" ",ie()]}}),null),t})(),(()=>{var t=Ve(),l=t.firstChild,n=l.nextSibling;return n.nextSibling,d(t,()=>e.quiz_pass,n),t})(),(()=>{var t=Xe(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>e.restart_quiz(),n.$$click=()=>e.end_quiz(),t})()]}})]}}),u(y,{get when(){return e.mode===void 0},get children(){return[le(),Ze(),et(),(()=>{var t=tt();return t.$$click=()=>e.mode="moves",t})(),(()=>{var t=rt();return t.$$click=()=>e.mode="match",t})()]}}),u(y,{get when(){return e.mode==="match"},get children(){return[at(),(()=>{var t=st(),l=t.firstChild,n=l.nextSibling;return n.nextSibling,d(t,()=>e.match_color,n),t})(),lt(),it(),(()=>{var t=ot(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>{W(()=>{e.mode="match",e.flip_match_color()})},n.$$click=()=>e.mode=void 0,t})()]}}),u(y,{get when(){return e.mode==="moves"},get children(){return[_t(),nt(),ht(),(()=>{var t=ct(),l=t.firstChild,n=l.nextSibling;return l.$$click=()=>{e.mode="moves"},n.$$click=()=>e.mode=void 0,t})()]}})]}})),I(t=>{var l=P().site,n="tab"+H("practice"),b="tab"+H("quiz");return l!==t.e&&xe(ve,"href",t.e=l),n!==t.t&&G(F,t.t=n),b!==t.a&&G(ee,t.a=b),t},{e:void 0,t:void 0,a:void 0}),s})()};Me(["click"]);export{Lt as default};
