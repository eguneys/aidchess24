import{J as A,Y as ke,Z as Se,t as n,i as c,c as o,ap as Ce,h as Me,g as Te,a7 as xe,a8 as Ae,a3 as Pe,a4 as T,b as i,aa as Le,K as Fe,m as E,U as Re,l as y,ab as Ie,A as Ne,F as Q,ag as Be,Q as Ee,ah as qe,ai as De,W as q,aj as Ge,ao as Ue,e as We,f as je,s as He,aq as Je,ar as Ke,d as Qe}from"./index-u7SVa4Ow.js";import{createRepeatProps as Ye}from"./List-C90-GFvH.js";import{b as Ze,a as x,P as ze,n as Oe}from"./random-Dv0laS5a.js";var Ve=n("<span class=time-ago>");function Xe(_){const[b,d]=A(""),p=()=>{const h=new Date().getTime(),s=Math.round((h-_.timestamp)/1e3);if(s<60)d(`${s} seconds ago`);else if(s<3600){const r=Math.round(s/60);d(`${r} minutes ago`)}else if(s<86400){const r=Math.round(s/3600);d(`${r} hours ago`)}else if(s<604800){const r=Math.round(s/86400);d(`${r} days ago`)}else if(s<2592e3){const r=Math.round(s/604800);d(`${r} weeks ago`)}else if(s<31536e3){const r=Math.round(s/2592e3);d(`${r} months ago`)}else{const r=Math.round(s/31536e3);d(`${r} years ago`)}};return ke(()=>{p();const h=setInterval(p,6e4);Se(()=>clearInterval(h))}),(()=>{var h=Ve();return c(h,b),h})()}var et=n("<div class=title>"),tt=n("<div class=filter><span class=label>Filter:</span><span class=value></span> moves"),st=n("<div class=due-moves><span class=label>Due:</span><span class=value></span> moves left"),at=n("<div class=header>"),nt=n("<div class=board-wrap>"),rt=n("<button>Hint: Show Previous Moves"),lt=n("<button>Goto Next Due Move"),ot=n("<div class=controls>"),it=n("<div class=replay-wrap>"),_t=n("<div class=underboard><div class=move-history><h4>Latest Attempts for this Move</h4><div class=attempts></div></div><div class=session-history><h4>Latest Attempts for Today </h4><div class=attempts>"),ct=n("<main class=repeat-show>"),ut=n('<div class="Loading ...">'),dt=n("<div class=loading>Loading.."),pt=n("<div class=no-dues><span>Great; No due moves at this time."),ht=n("<span class=idle>..."),mt=n("<button>Show Answer"),vt=n("<span class=ply>"),ft=n("<div><i>");const St=()=>o(wt,{}),gt=Je(new Ke({}));function wt(){let _=Ce(gt),[b]=Me(),d=b.filter??"white";const p=()=>{switch(d){case"first-ten":return"First Ten";case"ten-twenty":return"First Ten to Twenty";case"twenty-plus":return"Twenty Plus";case"white":return"White";case"black":return"Black"}};let[h,{goto_path:s,goto_path_if_can:r,set_failed_path:k,set_success_path:C,set_hide_after_path:g,add_child_san_to_current_path:Z,save_due_move_if_not:z,add_attempt_with_spaced_repetition:O,load_study:V,load_chapters_for_sections:X,load_due_moves:ee,load_replay_tree_by_due_move:te}]=Te(),w=xe(h);Ae(w);const se=()=>h.replay_tree,D=()=>w.fen,ae=()=>w.last_move;let u=Ye();const ne=()=>{X(u.selected_section_ids)},re=()=>{let e=u.selected_study_id,t=u.selected_section_ids;e&&t.length>0&&ee(e,t)};let le=Pe();T(()=>V(le.id)),T(ne),T(re);const G=i(()=>{switch(d){case"first-ten":return u.due_first_ten;case"ten-twenty":return u.due_ten_twenty;case"twenty-plus":return u.due_twenty_plus;case"white":return u.due_white;case"black":return u.due_black}}),U=i(()=>{switch(d){case"first-ten":return u.all_first_ten;case"ten-twenty":return u.all_ten_twenty;case"twenty-plus":return u.all_twenty_plus;case"white":return u.all_white;case"black":return u.all_black}}),[P,L]=A(),oe=i(e=>{let t=G();if(P()!==void 0)return e;if(t.length>0)return Ze(t)}),[W,j]=A(),m=i(()=>W()??oe());T(()=>{let e=m();e&&te(e)});const ie=i(()=>m()===void 0),F=i(()=>P()!==void 0),_e=i(()=>m()?.tree_step_node.step.san),H=i(()=>Le(m()?.tree_step_node.step.before_fen??Fe)),ce=i(()=>!F()),[R,ue]=A(),I=e=>{if(e){let t=m();g(Ue(t.tree_step_node.step.path))}else g("");ue(e)},de=e=>{r(e)};async function $(e){L(e),g(void 0);let t=m();await O(_,t,e),await z(t),e.includes("solved")&&await new Promise(a=>{setTimeout(()=>{J(),a(void 0)},800)})}const J=()=>{q(()=>{L(void 0),I(!1),j(void 0)})},pe=e=>{let t=U()?.find(a=>a.id===e.repeat_due_move_id);t&&q(()=>{L(void 0),I(!1),j(t)})},he=async(e,t)=>{let l=Be(D()),v=l.turn,N=l.board.get(Ee(e)),M=e+t;N.role==="pawn"&&(t[1]==="8"&&v==="white"||t[1]==="1"&&v==="black")&&(M+="q");let B=qe(M),f=De(l,B),S=await Z(f);q(()=>{g(void 0),s(S.step.path);const be=W()!==void 0;f===_e()?(R()?$("solved-with-hint"):$(be?"solved-with-hint":"solved"),C(S.step.path)):(R()?$("failed-with-hint"):$("failed"),k(S.step.path))})},me=()=>{$("failed-with-skip");let e=m().tree_step_node.step.path;k(e),s(e)},K=i(()=>m()?.attempts),ve=i(()=>{let e=U()?.map(t=>t.attempts[0]).filter(Boolean)??[];return e.sort((t,a)=>t.created_at-a.created_at),e}),fe=i(()=>{let e=K();if(e)return e[0]}),ge=e=>{pe(e)},we=e=>{e>0?r(w.get_next_path):r(w.get_prev_path)};let $e=i(()=>{let e=w.step_at_cursor_path;if(!e)return[];let t=P();if(!t)return[];if(h.replay_tree.failed_path===e.step.path)return x(e.step.uci,e.step.san,"✗");if(h.replay_tree.success_path===e.step.path)return t.includes("hint")?x(e.step.uci,e.step.san,"✓"):x(e.step.uci,e.step.san,"!");let a=e.nags?.[0];return a?x(e.step.uci,e.step.san,Ge(a)):[]});const ye=i(()=>!0);return(()=>{var e=ct();return c(e,o(E,{get fallback(){return ut()},get children(){return[(()=>{var t=at();return c(t,o(E,{get children(){return[(()=>{var a=et();return c(a,()=>u.study?.name),a})(),(()=>{var a=tt(),l=a.firstChild,v=l.nextSibling;return c(v,p),a})(),(()=>{var a=st(),l=a.firstChild,v=l.nextSibling;return c(v,()=>G().length),a})()]}})),t})(),(()=>{var t=nt();return Re(t,"wheel",Oe(we)),c(t,o(ze,{get shapes(){return $e()},get orientation(){return H()},get color(){return H()},get movable(){return ce()},get fen(){return D()},get last_move(){return ae()},play_orig_key:he})),t})(),(()=>{var t=it();return c(t,o(E,{get fallback(){return dt()},get children(){return o(y,{get when(){return!ie()},get fallback(){return(()=>{var a=pt();return a.firstChild,c(a,o(Ne,{href:"/repetition",children:"Go Back to Repetitions"}),null),a})()},get children(){return[o(Ie,{handle_goto_path:de,get replay_tree(){return se()},lose_focus:!1}),(()=>{var a=ot();return c(a,o(y,{get when(){return ye()},get fallback(){return ht()},get children(){return[o(y,{get when(){return i(()=>!F())()&&!R()},get children(){var l=rt();return l.$$click=()=>I(!0),l}}),o(y,{get when(){return F()},get fallback(){return(()=>{var l=mt();return l.$$click=me,l})()},get children(){var l=lt();return l.$$click=J,l}})]}})),a})()]}})}})),t})(),(()=>{var t=_t(),a=t.firstChild,l=a.firstChild,v=l.nextSibling,N=a.nextSibling,M=N.firstChild,B=M.nextSibling;return c(v,o(Q,{get each(){return K()},children:(f,S)=>o(Y,{get latest(){return S()===0},attempt:f,time:!0})})),c(B,o(Q,{get each(){return ve()},children:f=>o(Y,{get latest(){return f===fe()},attempt:f,time:!1,on_click:()=>ge(f)})})),t})()]}})),e})()}function Y(_){const b=i(()=>" "+_.attempt.attempt_result),d=()=>_.attempt.attempt_result.includes("skip")?"":_.attempt.attempt_result.includes("solved")?_.attempt.attempt_result.includes("hint")?"":"":"";return(()=>{var p=ft(),h=p.firstChild;return p.$$click=()=>_.on_click?.(),c(p,o(y,{get when(){return _.ply},get children(){var s=vt();return c(s,()=>_.ply),s}}),null),c(p,o(y,{get when(){return _.time},get children(){return o(Xe,{get timestamp(){return _.attempt.created_at}})}}),null),We(s=>{var r="attempt"+b(),k=!!_.latest,C=!_.time,g=d();return r!==s.e&&je(p,s.e=r),k!==s.t&&p.classList.toggle("latest",s.t=k),C!==s.a&&p.classList.toggle("selectable",s.a=C),g!==s.o&&He(h,"data-icon",s.o=g),s},{e:void 0,t:void 0,a:void 0,o:void 0}),p})()}Qe(["click"]);export{St as default};
