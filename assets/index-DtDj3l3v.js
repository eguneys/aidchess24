function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./Home-BWoApIqT.js","./Home-BTJQSNo7.css","./Repertoires-B-ksy4yX.js","./studyrepo-BOobqToQ.js","./Repertoires-4K12HHA8.css","./Contact-C4nbnnn0.js","./Contact-Czd8NoDg.css","./Repertoire-CUqW71Br.js","./Chessboard-C-a4dFIu.js","./Chessboard-D4RFxl74.css","./Chesstree2-CtmN7WsG.js","./Chesstree2-CQftyPyf.css","./SessionStore-Cb2KfySi.js","./scroll-DnAhRpRC.js","./ChessTreeWithTools-CVrga3gv.js","./ChessTreeWithTools-CF2ZkcWS.css","./Repertoire-ExV0q36o.css","./Repertoire-B2XaNGkm.css","./Masters-Dm2Dkztr.js","./Repertoire-DFuGbbLP.css","./Tactics-D69c-R19.js","./Endgames-JHNTMP56.js","./Dashboard-Cb-BX9au.js","./Dashboard-RLv5pL-P.css","./Explorer-CfKOGHaq.js","./Explorer-C5Jaa2SQ.css","./Challenges-DXJhifzE.js","./Challenges-BnvE14Xx.css","./Widen-DkdTZcxD.js","./Widen-C2NYzIsW.css","./SixthDraw-BhDYUvn6.js","./SixthDraw-B0t_HS86.css","./Beta-BnmDnIPj.js","./Beta-KTxtW9A-.css","./Show2-AR9eXAKF.js","./Show2-C7q4uyW_.css","./PlayDues-khnySPML.js","./PlayDues-BxbrRfXN.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();const ie={context:void 0,registry:void 0};function Bn(t){ie.context=t}const Ya=(t,e)=>t===e,Je=Symbol("solid-proxy"),$i=Symbol("solid-track"),Sr={equals:Ya};let $n=null,Co=Do;const ut=1,Rr=2,So={owned:null,cleanups:null,context:null,owner:null},Si={};var le=null;let Ri=null,Xa=null,ge=null,Be=null,Xe=null,Br=0;function qn(t,e){const n=ge,i=le,o=t.length===0,u=e===void 0?i:e,l=o?So:{owned:null,cleanups:null,context:u?u.context:null,owner:u},h=o?t:()=>t(()=>ke(()=>qr(l)));le=l,ge=null;try{return at(h,!0)}finally{ge=n,le=i}}function Ke(t,e){e=e?Object.assign({},Sr,e):Sr;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},i=o=>(typeof o=="function"&&(o=o(n.value)),Ko(n,o));return[No.bind(n),i]}function Ys(t,e,n){const i=Hn(t,e,!0,ut);wn(i)}function ot(t,e,n){const i=Hn(t,e,!1,ut);wn(i)}function Ja(t,e,n){Co=au;const i=Hn(t,e,!1,ut);(!n||!n.render)&&(i.user=!0),Xe?Xe.push(i):wn(i)}function be(t,e,n){n=n?Object.assign({},Sr,n):Sr;const i=Hn(t,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,wn(i),No.bind(i)}function Za(t){return t&&typeof t=="object"&&"then"in t}function eu(t,e,n){let i,o,u;arguments.length===2&&typeof e=="object"||arguments.length===1?(i=!0,o=t,u=e||{}):(i=t,o=e,u=n||{});let l=null,h=Si,m=null,k=!1,g="initialValue"in u,S=typeof i=="function"&&be(i);const N=new Set,[L,D]=(u.storage||Ke)(u.initialValue),[z,Q]=Ke(void 0),[X,he]=Ke(void 0,{equals:!1}),[ne,ce]=Ke(g?"ready":"unresolved");if(ie.context){m=`${ie.context.id}${ie.context.count++}`;let ye;u.ssrLoadFrom==="initial"?h=u.initialValue:ie.load&&(ye=ie.load(m))&&(h=ye)}function me(ye,Y,ee,Pe){return l===ye&&(l=null,Pe!==void 0&&(g=!0),(ye===h||Y===h)&&u.onHydrated&&queueMicrotask(()=>u.onHydrated(Pe,{value:Y})),h=Si,xe(Y,ee)),Y}function xe(ye,Y){at(()=>{Y===void 0&&D(()=>ye),ce(Y!==void 0?"errored":g?"ready":"unresolved"),Q(Y);for(const ee of N.keys())ee.decrement();N.clear()},!1)}function Ee(){const ye=iu,Y=L(),ee=z();if(ee!==void 0&&!l)throw ee;return ge&&!ge.user&&ye&&Ys(()=>{X(),l&&(ye.resolved||N.has(ye)||(ye.increment(),N.add(ye)))}),Y}function Ge(ye=!0){if(ye!==!1&&k)return;k=!1;const Y=S?S():i;if(Y==null||Y===!1){me(l,ke(L));return}const ee=h!==Si?h:ke(()=>o(Y,{value:L(),refetching:ye}));return Za(ee)?(l=ee,"value"in ee?(ee.status==="success"?me(l,ee.value,void 0,Y):me(l,void 0,void 0,Y),ee):(k=!0,queueMicrotask(()=>k=!1),at(()=>{ce(g?"refreshing":"pending"),he()},!1),ee.then(Pe=>me(ee,Pe,void 0,Y),Pe=>me(ee,void 0,jo(Pe),Y)))):(me(l,ee,void 0,Y),ee)}return Object.defineProperties(Ee,{state:{get:()=>ne()},error:{get:()=>z()},loading:{get(){const ye=ne();return ye==="pending"||ye==="refreshing"}},latest:{get(){if(!g)return Ee();const ye=z();if(ye&&!l)throw ye;return L()}}}),S?Ys(()=>Ge(!1)):Ge(!1),[Ee,{refetch:Ge,mutate:D}]}function tu(t){return at(t,!1)}function ke(t){if(ge===null)return t();const e=ge;ge=null;try{return t()}finally{ge=e}}function Ro(t,e,n){const i=Array.isArray(t);let o,u=n&&n.defer;return l=>{let h;if(i){h=Array(t.length);for(let k=0;k<t.length;k++)h[k]=t[k]()}else h=t();if(u){u=!1;return}const m=ke(()=>e(h,o,l));return o=h,m}}function dh(t){Ja(()=>ke(t))}function Vt(t){return le===null||(le.cleanups===null?le.cleanups=[t]:le.cleanups.push(t)),t}function nu(t,e){$n||($n=Symbol("error")),le=Hn(void 0,void 0,!0),le.context={...le.context,[$n]:[e]};try{return t()}catch(n){Wn(n)}finally{le=le.owner}}function qi(){return ge}function To(){return le}function Mo(t,e){const n=le,i=ge;le=t,ge=null;try{return at(e,!0)}catch(o){Wn(o)}finally{le=n,ge=i}}function ru(t){const e=ge,n=le;return Promise.resolve().then(()=>{ge=e,le=n;let i;return at(t,!1),ge=le=null,i?i.done:void 0})}function Gn(t,e){const n=Symbol("context");return{id:n,Provider:uu(n),defaultValue:t}}function Lr(t){return le&&le.context&&le.context[t.id]!==void 0?le.context[t.id]:t.defaultValue}function $r(t){const e=be(t),n=be(()=>Fi(e()));return n.toArray=()=>{const i=n();return Array.isArray(i)?i:i!=null?[i]:[]},n}let iu;function No(){if(this.sources&&this.state)if(this.state===ut)wn(this);else{const t=Be;Be=null,at(()=>Mr(this),!1),Be=t}if(ge){const t=this.observers?this.observers.length:0;ge.sources?(ge.sources.push(this),ge.sourceSlots.push(t)):(ge.sources=[this],ge.sourceSlots=[t]),this.observers?(this.observers.push(ge),this.observerSlots.push(ge.sources.length-1)):(this.observers=[ge],this.observerSlots=[ge.sources.length-1])}return this.value}function Ko(t,e,n){let i=t.value;return(!t.comparator||!t.comparator(i,e))&&(t.value=e,t.observers&&t.observers.length&&at(()=>{for(let o=0;o<t.observers.length;o+=1){const u=t.observers[o],l=Ri&&Ri.running;l&&Ri.disposed.has(u),(l?!u.tState:!u.state)&&(u.pure?Be.push(u):Xe.push(u),u.observers&&Io(u)),l||(u.state=ut)}if(Be.length>1e6)throw Be=[],new Error},!1)),e}function wn(t){if(!t.fn)return;qr(t);const e=Br;su(t,t.value,e)}function su(t,e,n){let i;const o=le,u=ge;ge=le=t;try{i=t.fn(e)}catch(l){return t.pure&&(t.state=ut,t.owned&&t.owned.forEach(qr),t.owned=null),t.updatedAt=n+1,Wn(l)}finally{ge=u,le=o}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Ko(t,i):t.value=i,t.updatedAt=n)}function Hn(t,e,n,i=ut,o){const u={fn:t,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:le,context:le?le.context:null,pure:n};return le===null||le!==So&&(le.owned?le.owned.push(u):le.owned=[u]),u}function Tr(t){if(t.state===0)return;if(t.state===Rr)return Mr(t);if(t.suspense&&ke(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Br);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===ut)wn(t);else if(t.state===Rr){const i=Be;Be=null,at(()=>Mr(t,e[0]),!1),Be=i}}function at(t,e){if(Be)return t();let n=!1;e||(Be=[]),Xe?n=!0:Xe=[],Br++;try{const i=t();return ou(n),i}catch(i){n||(Xe=null),Be=null,Wn(i)}}function ou(t){if(Be&&(Do(Be),Be=null),t)return;const e=Xe;Xe=null,e.length&&at(()=>Co(e),!1)}function Do(t){for(let e=0;e<t.length;e++)Tr(t[e])}function au(t){let e,n=0;for(e=0;e<t.length;e++){const i=t[e];i.user?t[n++]=i:Tr(i)}if(ie.context){if(ie.count){ie.effects||(ie.effects=[]),ie.effects.push(...t.slice(0,n));return}else ie.effects&&(t=[...ie.effects,...t],n+=ie.effects.length,delete ie.effects);Bn()}for(e=0;e<n;e++)Tr(t[e])}function Mr(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const i=t.sources[n];if(i.sources){const o=i.state;o===ut?i!==e&&(!i.updatedAt||i.updatedAt<Br)&&Tr(i):o===Rr&&Mr(i,e)}}}function Io(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=Rr,n.pure?Be.push(n):Xe.push(n),n.observers&&Io(n))}}function qr(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),i=t.sourceSlots.pop(),o=n.observers;if(o&&o.length){const u=o.pop(),l=n.observerSlots.pop();i<o.length&&(u.sourceSlots[l]=i,o[i]=u,n.observerSlots[i]=l)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)qr(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function jo(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Xs(t,e,n){try{for(const i of e)i(t)}catch(i){Wn(i,n&&n.owner||null)}}function Wn(t,e=le){const n=$n&&e&&e.context&&e.context[$n],i=jo(t);if(!n)throw i;Xe?Xe.push({fn(){Xs(i,n,e)},state:ut}):Xs(i,n,e)}function Fi(t){if(typeof t=="function"&&!t.length)return Fi(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const i=Fi(t[n]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return e}return t}function uu(t,e){return function(i){let o;return ot(()=>o=ke(()=>(le.context={...le.context,[t]:i.value},$r(()=>i.children))),void 0),o}}function ph(t){const[e,n]=Ke(void 0,{equals:!1});if("subscribe"in t){const i=t.subscribe(o=>n(()=>o));Vt(()=>"unsubscribe"in i?i.unsubscribe():i())}else{const i=t(n);Vt(i)}return e}const cu=Symbol("fallback");function Js(t){for(let e=0;e<t.length;e++)t[e]()}function lu(t,e,n={}){let i=[],o=[],u=[],l=0,h=e.length>1?[]:null;return Vt(()=>Js(u)),()=>{let m=t()||[],k,g;return m[$i],ke(()=>{let N=m.length,L,D,z,Q,X,he,ne,ce,me;if(N===0)l!==0&&(Js(u),u=[],i=[],o=[],l=0,h&&(h=[])),n.fallback&&(i=[cu],o[0]=qn(xe=>(u[0]=xe,n.fallback())),l=1);else if(l===0){for(o=new Array(N),g=0;g<N;g++)i[g]=m[g],o[g]=qn(S);l=N}else{for(z=new Array(N),Q=new Array(N),h&&(X=new Array(N)),he=0,ne=Math.min(l,N);he<ne&&i[he]===m[he];he++);for(ne=l-1,ce=N-1;ne>=he&&ce>=he&&i[ne]===m[ce];ne--,ce--)z[ce]=o[ne],Q[ce]=u[ne],h&&(X[ce]=h[ne]);for(L=new Map,D=new Array(ce+1),g=ce;g>=he;g--)me=m[g],k=L.get(me),D[g]=k===void 0?-1:k,L.set(me,g);for(k=he;k<=ne;k++)me=i[k],g=L.get(me),g!==void 0&&g!==-1?(z[g]=o[k],Q[g]=u[k],h&&(X[g]=h[k]),g=D[g],L.set(me,g)):u[k]();for(g=he;g<N;g++)g in z?(o[g]=z[g],u[g]=Q[g],h&&(h[g]=X[g],h[g](g))):o[g]=qn(S);o=o.slice(0,l=N),i=m.slice(0)}return o});function S(N){if(u[g]=N,h){const[L,D]=Ke(g);return h[g]=D,e(m[g],L)}return e(m[g])}}}function J(t,e){return ke(()=>t(e||{}))}function Pr(){return!0}const Ui={get(t,e,n){return e===Je?n:t.get(e)},has(t,e){return e===Je?!0:t.has(e)},set:Pr,deleteProperty:Pr,getOwnPropertyDescriptor(t,e){return{configurable:!0,enumerable:!0,get(){return t.get(e)},set:Pr,deleteProperty:Pr}},ownKeys(t){return t.keys()}};function Ti(t){return(t=typeof t=="function"?t():t)?t:{}}function hu(){for(let t=0,e=this.length;t<e;++t){const n=this[t]();if(n!==void 0)return n}}function Vi(...t){let e=!1;for(let l=0;l<t.length;l++){const h=t[l];e=e||!!h&&Je in h,t[l]=typeof h=="function"?(e=!0,be(h)):h}if(e)return new Proxy({get(l){for(let h=t.length-1;h>=0;h--){const m=Ti(t[h])[l];if(m!==void 0)return m}},has(l){for(let h=t.length-1;h>=0;h--)if(l in Ti(t[h]))return!0;return!1},keys(){const l=[];for(let h=0;h<t.length;h++)l.push(...Object.keys(Ti(t[h])));return[...new Set(l)]}},Ui);const n={},i=Object.create(null);for(let l=t.length-1;l>=0;l--){const h=t[l];if(!h)continue;const m=Object.getOwnPropertyNames(h);for(let k=m.length-1;k>=0;k--){const g=m[k];if(g==="__proto__"||g==="constructor")continue;const S=Object.getOwnPropertyDescriptor(h,g);if(!i[g])i[g]=S.get?{enumerable:!0,configurable:!0,get:hu.bind(n[g]=[S.get.bind(h)])}:S.value!==void 0?S:void 0;else{const N=n[g];N&&(S.get?N.push(S.get.bind(h)):S.value!==void 0&&N.push(()=>S.value))}}}const o={},u=Object.keys(i);for(let l=u.length-1;l>=0;l--){const h=u[l],m=i[h];m&&m.get?Object.defineProperty(o,h,m):o[h]=m?m.value:void 0}return o}function fu(t,...e){if(Je in t){const o=new Set(e.length>1?e.flat():e[0]),u=e.map(l=>new Proxy({get(h){return l.includes(h)?t[h]:void 0},has(h){return l.includes(h)&&h in t},keys(){return l.filter(h=>h in t)}},Ui));return u.push(new Proxy({get(l){return o.has(l)?void 0:t[l]},has(l){return o.has(l)?!1:l in t},keys(){return Object.keys(t).filter(l=>!o.has(l))}},Ui)),u}const n={},i=e.map(()=>({}));for(const o of Object.getOwnPropertyNames(t)){const u=Object.getOwnPropertyDescriptor(t,o),l=!u.get&&!u.set&&u.enumerable&&u.writable&&u.configurable;let h=!1,m=0;for(const k of e)k.includes(o)&&(h=!0,l?i[m][o]=u.value:Object.defineProperty(i[m],o,u)),++m;h||(l?n[o]=u.value:Object.defineProperty(n,o,u))}return[...i,n]}function qe(t){let e,n;const i=o=>{const u=ie.context;if(u){const[h,m]=Ke();ie.count||(ie.count=0),ie.count++,(n||(n=t())).then(k=>{Bn(u),ie.count--,m(()=>k.default),Bn()}),e=h}else if(!e){const[h]=eu(()=>(n||(n=t())).then(m=>m.default));e=h}let l;return be(()=>(l=e())&&ke(()=>{if(!u)return l(o);const h=ie.context;Bn(u);const m=l(o);return Bn(h),m}))};return i.preload=()=>n||((n=t()).then(o=>e=()=>o.default),n),i}let du=0;function pu(){const t=ie.context;return t?`${t.id}${t.count++}`:`cl-${du++}`}const Bo=t=>`Stale read from <${t}>.`;function mh(t){const e="fallback"in t&&{fallback:()=>t.fallback};return be(lu(()=>t.each,t.children,e||void 0))}function Lo(t){const e=t.keyed,n=be(()=>t.when,void 0,{equals:(i,o)=>e?i===o:!i==!o});return be(()=>{const i=n();if(i){const o=t.children;return typeof o=="function"&&o.length>0?ke(()=>o(e?i:()=>{if(!ke(n))throw Bo("Show");return t.when})):o}return t.fallback},void 0,void 0)}function yh(t){let e=!1;const n=(u,l)=>(e?u[1]===l[1]:!u[1]==!l[1])&&u[2]===l[2],i=$r(()=>t.children),o=be(()=>{let u=i();Array.isArray(u)||(u=[u]);for(let l=0;l<u.length;l++){const h=u[l].when;if(h)return e=!!u[l].keyed,[l,h,u[l]]}return[-1]},void 0,{equals:n});return be(()=>{const[u,l,h]=o();if(u<0)return t.fallback;const m=h.children;return typeof m=="function"&&m.length>0?ke(()=>m(e?l:()=>{if(ke(o)[0]!==u)throw Bo("Match");return h.when})):m},void 0,void 0)}function gh(t){return t}let cn;function Zs(){cn&&[...cn].forEach(t=>t())}function mu(t){let e;ie.context&&ie.load&&(e=ie.load(ie.context.id+ie.context.count));const[n,i]=Ke(e,void 0);return cn||(cn=new Set),cn.add(i),Vt(()=>cn.delete(i)),be(()=>{let o;if(o=n()){const u=t.fallback;return typeof u=="function"&&u.length?ke(()=>u(o,()=>i())):u}return nu(()=>t.children,i)},void 0,void 0)}const yu=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],gu=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...yu]),vu=new Set(["innerHTML","textContent","innerText","children"]),bu=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),wu=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function _u(t,e){const n=wu[t];return typeof n=="object"?n[e]?n.$:void 0:n}const ku=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),xu={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function Eu(t,e,n){let i=n.length,o=e.length,u=i,l=0,h=0,m=e[o-1].nextSibling,k=null;for(;l<o||h<u;){if(e[l]===n[h]){l++,h++;continue}for(;e[o-1]===n[u-1];)o--,u--;if(o===l){const g=u<i?h?n[h-1].nextSibling:n[u-h]:m;for(;h<u;)t.insertBefore(n[h++],g)}else if(u===h)for(;l<o;)(!k||!k.has(e[l]))&&e[l].remove(),l++;else if(e[l]===n[u-1]&&n[h]===e[o-1]){const g=e[--o].nextSibling;t.insertBefore(n[h++],e[l++].nextSibling),t.insertBefore(n[--u],g),e[o]=n[u]}else{if(!k){k=new Map;let S=h;for(;S<u;)k.set(n[S],S++)}const g=k.get(e[l]);if(g!=null)if(h<g&&g<u){let S=l,N=1,L;for(;++S<o&&S<u&&!((L=k.get(e[S]))==null||L!==g+N);)N++;if(N>g-h){const D=e[l];for(;h<g;)t.insertBefore(n[h++],D)}else t.replaceChild(n[h++],e[l++])}else l++;else e[l++].remove()}}}const eo="_$DX_DELEGATE";function Au(t,e,n,i={}){let o;return qn(u=>{o=u,e===document?t():Qe(e,t(),e.firstChild?null:void 0,n)},i.owner),()=>{o(),e.textContent=""}}function os(t,e,n){let i;const o=()=>{const l=document.createElement("template");return l.innerHTML=t,n?l.content.firstChild.firstChild:l.content.firstChild},u=e?()=>ke(()=>document.importNode(i||(i=o()),!0)):()=>(i||(i=o())).cloneNode(!0);return u.cloneNode=u,u}function $o(t,e=window.document){const n=e[eo]||(e[eo]=new Set);for(let i=0,o=t.length;i<o;i++){const u=t[i];n.has(u)||(n.add(u),e.addEventListener(u,Mu))}}function zi(t,e,n){ie.context||(n==null?t.removeAttribute(e):t.setAttribute(e,n))}function Ou(t,e,n,i){ie.context||(i==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,i))}function qo(t,e){ie.context||(e==null?t.removeAttribute("class"):t.className=e)}function Pu(t,e,n,i){if(i)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const o=n[0];t.addEventListener(e,n[0]=u=>o.call(t,n[1],u))}else t.addEventListener(e,n)}function Cu(t,e,n={}){const i=Object.keys(e||{}),o=Object.keys(n);let u,l;for(u=0,l=o.length;u<l;u++){const h=o[u];!h||h==="undefined"||e[h]||(to(t,h,!1),delete n[h])}for(u=0,l=i.length;u<l;u++){const h=i[u],m=!!e[h];!h||h==="undefined"||n[h]===m||!m||(to(t,h,!0),n[h]=m)}return n}function Su(t,e,n){if(!e)return n?zi(t,"style"):e;const i=t.style;if(typeof e=="string")return i.cssText=e;typeof n=="string"&&(i.cssText=n=void 0),n||(n={}),e||(e={});let o,u;for(u in n)e[u]==null&&i.removeProperty(u),delete n[u];for(u in e)o=e[u],o!==n[u]&&(i.setProperty(u,o),n[u]=o);return n}function Gi(t,e={},n,i){const o={};return i||ot(()=>o.children=yn(t,e.children,o.children)),ot(()=>e.ref&&e.ref(t)),ot(()=>Ru(t,e,n,!0,o,!0)),o}function vh(t,e,n){return ke(()=>t(e,n))}function Qe(t,e,n,i){if(n!==void 0&&!i&&(i=[]),typeof e!="function")return yn(t,e,i,n);ot(o=>yn(t,e(),o,n),i)}function Ru(t,e,n,i,o={},u=!1){e||(e={});for(const l in o)if(!(l in e)){if(l==="children")continue;o[l]=no(t,l,null,o[l],n,u)}for(const l in e){if(l==="children"){i||yn(t,e.children);continue}const h=e[l];o[l]=no(t,l,h,o[l],n,u)}}function Tu(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function to(t,e,n){const i=e.trim().split(/\s+/);for(let o=0,u=i.length;o<u;o++)t.classList.toggle(i[o],n)}function no(t,e,n,i,o,u){let l,h,m,k,g;if(e==="style")return Su(t,n,i);if(e==="classList")return Cu(t,n,i);if(n===i)return i;if(e==="ref")u||n(t);else if(e.slice(0,3)==="on:"){const S=e.slice(3);i&&t.removeEventListener(S,i),n&&t.addEventListener(S,n)}else if(e.slice(0,10)==="oncapture:"){const S=e.slice(10);i&&t.removeEventListener(S,i,!0),n&&t.addEventListener(S,n,!0)}else if(e.slice(0,2)==="on"){const S=e.slice(2).toLowerCase(),N=ku.has(S);if(!N&&i){const L=Array.isArray(i)?i[0]:i;t.removeEventListener(S,L)}(N||n)&&(Pu(t,S,n,N),N&&$o([S]))}else if(e.slice(0,5)==="attr:")zi(t,e.slice(5),n);else if((g=e.slice(0,5)==="prop:")||(m=vu.has(e))||!o&&((k=_u(e,t.tagName))||(h=gu.has(e)))||(l=t.nodeName.includes("-"))){if(g)e=e.slice(5),h=!0;else if(ie.context)return n;e==="class"||e==="className"?qo(t,n):l&&!h&&!m?t[Tu(e)]=n:t[k||e]=n}else{const S=o&&e.indexOf(":")>-1&&xu[e.split(":")[0]];S?Ou(t,S,e,n):zi(t,bu[e]||e,n)}return n}function Mu(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),ie.registry&&!ie.done&&(ie.done=_$HY.done=!0);n;){const i=n[e];if(i&&!n.disabled){const o=n[`${e}Data`];if(o!==void 0?i.call(n,o,t):i.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function yn(t,e,n,i,o){if(ie.context){!n&&(n=[...t.childNodes]);let h=[];for(let m=0;m<n.length;m++){const k=n[m];k.nodeType===8&&k.data.slice(0,2)==="!$"?k.remove():h.push(k)}n=h}for(;typeof n=="function";)n=n();if(e===n)return n;const u=typeof e,l=i!==void 0;if(t=l&&n[0]&&n[0].parentNode||t,u==="string"||u==="number"){if(ie.context)return n;if(u==="number"&&(e=e.toString()),l){let h=n[0];h&&h.nodeType===3?h.data!==e&&(h.data=e):h=document.createTextNode(e),n=rn(t,n,i,h)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||u==="boolean"){if(ie.context)return n;n=rn(t,n,i)}else{if(u==="function")return ot(()=>{let h=e();for(;typeof h=="function";)h=h();n=yn(t,h,n,i)}),()=>n;if(Array.isArray(e)){const h=[],m=n&&Array.isArray(n);if(Hi(h,e,n,o))return ot(()=>n=yn(t,h,n,i,!0)),()=>n;if(ie.context){if(!h.length)return n;if(i===void 0)return[...t.childNodes];let k=h[0],g=[k];for(;(k=k.nextSibling)!==i;)g.push(k);return n=g}if(h.length===0){if(n=rn(t,n,i),l)return n}else m?n.length===0?ro(t,h,i):Eu(t,n,h):(n&&rn(t),ro(t,h));n=h}else if(e.nodeType){if(ie.context&&e.parentNode)return n=l?[e]:e;if(Array.isArray(n)){if(l)return n=rn(t,n,i,e);rn(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Hi(t,e,n,i){let o=!1;for(let u=0,l=e.length;u<l;u++){let h=e[u],m=n&&n[t.length],k;if(!(h==null||h===!0||h===!1))if((k=typeof h)=="object"&&h.nodeType)t.push(h);else if(Array.isArray(h))o=Hi(t,h,m)||o;else if(k==="function")if(i){for(;typeof h=="function";)h=h();o=Hi(t,Array.isArray(h)?h:[h],Array.isArray(m)?m:[m])||o}else t.push(h),o=!0;else{const g=String(h);m&&m.nodeType===3&&m.data===g?t.push(m):t.push(document.createTextNode(g))}}return o}function ro(t,e,n=null){for(let i=0,o=e.length;i<o;i++)t.insertBefore(e[i],n)}function rn(t,e,n,i){if(n===void 0)return t.textContent="";const o=i||document.createTextNode("");if(e.length){let u=!1;for(let l=e.length-1;l>=0;l--){const h=e[l];if(o!==h){const m=h.parentNode===t;!u&&!l?m?t.replaceChild(o,h):t.insertBefore(o,n):m&&h.remove()}else u=!0}}else t.insertBefore(o,n);return[o]}const Nu=!1,Ku="modulepreload",Du=function(t,e){return new URL(t,e).href},io={},Fe=function(e,n,i){let o=Promise.resolve();if(n&&n.length>0){const u=document.getElementsByTagName("link");o=Promise.all(n.map(l=>{if(l=Du(l,i),l in io)return;io[l]=!0;const h=l.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!i)for(let S=u.length-1;S>=0;S--){const N=u[S];if(N.href===l&&(!h||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":Ku,h||(g.as="script",g.crossOrigin=""),g.href=l,document.head.appendChild(g),h)return new Promise((S,N)=>{g.addEventListener("load",S),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${l}`)))})}))}return o.then(()=>e()).catch(u=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=u,window.dispatchEvent(l),!l.defaultPrevented)throw u})};function Fo(){let t=new Set;function e(o){return t.add(o),()=>t.delete(o)}let n=!1;function i(o,u){if(n)return!(n=!1);const l={to:o,options:u,defaultPrevented:!1,preventDefault:()=>l.defaultPrevented=!0};for(const h of t)h.listener({...l,from:h.location,retry:m=>{m&&(n=!0),h.navigate(o,{...u,resolve:!1})}});return!l.defaultPrevented}return{subscribe:e,confirm:i}}let Wi;function as(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),Wi=window.history.state._depth}as();function Iu(t){return{...t,_depth:window.history.state&&window.history.state._depth}}function ju(t,e){let n=!1;return()=>{const i=Wi;as();const o=i==null?null:Wi-i;if(n){n=!1;return}o&&e(o)?(n=!0,window.history.go(-o)):t()}}const Bu=/^(?:[a-z0-9]+:)?\/\//i,Lu=/^\/+|(\/)\/+$/g,Uo="http://sr";function qt(t,e=!1){const n=t.replace(Lu,"$1");return n?e||/^[?#]/.test(n)?n:"/"+n:""}function Cr(t,e,n){if(Bu.test(e))return;const i=qt(t),o=n&&qt(n);let u="";return!o||e.startsWith("/")?u=i:o.toLowerCase().indexOf(i.toLowerCase())!==0?u=i+o:u=o,(u||"/")+qt(e,!u)}function $u(t,e){if(t==null)throw new Error(e);return t}function qu(t,e){return qt(t).replace(/\/*(\*.*)?$/g,"")+qt(e)}function Vo(t){const e={};return t.searchParams.forEach((n,i)=>{e[i]=n}),e}function Fu(t,e,n){const[i,o]=t.split("/*",2),u=i.split("/").filter(Boolean),l=u.length;return h=>{const m=h.split("/").filter(Boolean),k=m.length-l;if(k<0||k>0&&o===void 0&&!e)return null;const g={path:l?"":"/",params:{}},S=N=>n===void 0?void 0:n[N];for(let N=0;N<l;N++){const L=u[N],D=m[N],z=L[0]===":",Q=z?L.slice(1):L;if(z&&Mi(D,S(Q)))g.params[Q]=D;else if(z||!Mi(D,L))return null;g.path+=`/${D}`}if(o){const N=k?m.slice(-k).join("/"):"";if(Mi(N,S(o)))g.params[o]=N;else return null}return g}}function Mi(t,e){const n=i=>i.localeCompare(t,void 0,{sensitivity:"base"})===0;return e===void 0?!0:typeof e=="string"?n(e):typeof e=="function"?e(t):Array.isArray(e)?e.some(n):e instanceof RegExp?e.test(t):!1}function Uu(t){const[e,n]=t.pattern.split("/*",2),i=e.split("/").filter(Boolean);return i.reduce((o,u)=>o+(u.startsWith(":")?2:3),i.length-(n===void 0?0:1))}function zo(t){const e=new Map,n=To();return new Proxy({},{get(i,o){return e.has(o)||Mo(n,()=>e.set(o,be(()=>t()[o]))),e.get(o)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(t())}})}function Vu(t,e){const n=new URLSearchParams(t);Object.entries(e).forEach(([o,u])=>{u==null||u===""?n.delete(o):n.set(o,String(u))});const i=n.toString();return i?`?${i}`:""}function Go(t){let e=/(\/?\:[^\/]+)\?/.exec(t);if(!e)return[t];let n=t.slice(0,e.index),i=t.slice(e.index+e[0].length);const o=[n,n+=e[1]];for(;e=/^(\/\:[^\/]+)\?/.exec(i);)o.push(n+=e[1]),i=i.slice(e[0].length);return Go(i).reduce((u,l)=>[...u,...o.map(h=>h+l)],[])}const zu=100,Ho=Gn(),us=Gn(),Qn=()=>$u(Lr(Ho),"<A> and 'use' router primitives can be only used inside a Route."),Wo=()=>Lr(us)||Qn().base,Gu=t=>{const e=Wo();return be(()=>e.resolvePath(t()))},Hu=t=>{const e=Qn();return be(()=>{const n=t();return n!==void 0?e.renderPath(n):n})},Qo=()=>Qn().navigatorFactory(),Fr=()=>Qn().location,bh=()=>Wo().params,wh=()=>{const t=Fr(),e=Qo(),n=(i,o)=>{const u=ke(()=>t.pathname+Vu(t.search,i)+t.hash);e(u,{scroll:!1,resolve:!1,...o})};return[t.query,n]},Wu=t=>{const e=Qn().beforeLeave.subscribe({listener:t,location:Fr(),navigate:Qo()});Vt(e)};function Qu(t,e=""){const{component:n,load:i,children:o,info:u}=t,l=!o||Array.isArray(o)&&!o.length,h={key:t,component:n,load:i,info:u};return Yo(t.path).reduce((m,k)=>{for(const g of Go(k)){const S=qu(e,g);let N=l?S:S.split("/*",1)[0];N=N.split("/").map(L=>L.startsWith(":")||L.startsWith("*")?L:encodeURIComponent(L)).join("/"),m.push({...h,originalPath:g,pattern:N,matcher:Fu(N,!l,t.matchFilters)})}return m},[])}function Yu(t,e=0){return{routes:t,score:Uu(t[t.length-1])*1e4-e,matcher(n){const i=[];for(let o=t.length-1;o>=0;o--){const u=t[o],l=u.matcher(n);if(!l)return null;i.unshift({...l,route:u})}return i}}}function Yo(t){return Array.isArray(t)?t:[t]}function Xo(t,e="",n=[],i=[]){const o=Yo(t);for(let u=0,l=o.length;u<l;u++){const h=o[u];if(h&&typeof h=="object"){h.hasOwnProperty("path")||(h.path="");const m=Qu(h,e);for(const k of m){n.push(k);const g=Array.isArray(h.children)&&h.children.length===0;if(h.children&&!g)Xo(h.children,k.pattern,n,i);else{const S=Yu([...n],i.length);i.push(S)}n.pop()}}}return n.length?i:i.sort((u,l)=>l.score-u.score)}function Jo(t,e){for(let n=0,i=t.length;n<i;n++){const o=t[n].matcher(e);if(o)return o}return[]}function Xu(t,e){const n=new URL(Uo),i=be(m=>{const k=t();try{return new URL(k,n)}catch{return console.error(`Invalid path ${k}`),m}},n,{equals:(m,k)=>m.href===k.href}),o=be(()=>i().pathname),u=be(()=>i().search,!0),l=be(()=>i().hash),h=()=>"";return{get pathname(){return o()},get search(){return u()},get hash(){return l()},get state(){return e()},get key(){return h()},query:zo(Ro(u,()=>Vo(i())))}}let Et;function Ju(t,e,n,i={}){const{signal:[o,u],utils:l={}}=t,h=l.parsePath||(Y=>Y),m=l.renderPath||(Y=>Y),k=l.beforeLeave||Fo(),g=Cr("",i.base||"");if(g===void 0)throw new Error(`${g} is not a valid base path`);g&&!o().value&&u({value:g,replace:!0,scroll:!1});const[S,N]=Ke(!1),L=async Y=>{N(!0);try{await ru(Y)}finally{N(!1)}},[D,z]=Ke(o().value),[Q,X]=Ke(o().state),he=Xu(D,Q),ne=[],ce=Ke([]),me={pattern:g,params:{},path:()=>g,outlet:()=>null,resolvePath(Y){return Cr(g,Y)}};return ot(()=>{const{value:Y,state:ee}=o();ke(()=>{Y!==D()&&L(()=>{Et="native",z(Y),X(ee),Zs(),ce[1]([])}).then(()=>{Et=void 0})})}),{base:me,location:he,isRouting:S,renderPath:m,parsePath:h,navigatorFactory:Ee,beforeLeave:k,preloadRoute:ye,singleFlight:i.singleFlight===void 0?!0:i.singleFlight,submissions:ce};function xe(Y,ee,Pe){ke(()=>{if(typeof ee=="number"){ee&&(l.go?l.go(ee):console.warn("Router integration does not support relative routing"));return}const{replace:He,resolve:kn,scroll:Ze,state:ct}={replace:!1,resolve:!0,scroll:!0,...Pe},et=kn?Y.resolvePath(ee):Cr("",ee);if(et===void 0)throw new Error(`Path '${ee}' is not a routable path`);if(ne.length>=zu)throw new Error("Too many redirects");const tt=D();if((et!==tt||ct!==Q())&&!Nu){if(k.confirm(et,Pe)){const yt=ne.push({value:tt,replace:He,scroll:Ze,state:Q()});L(()=>{Et="navigate",z(et),X(ct),Zs(),ce[1]([])}).then(()=>{ne.length===yt&&(Et=void 0,Ge({value:et,state:ct}))})}}})}function Ee(Y){return Y=Y||Lr(us)||me,(ee,Pe)=>xe(Y,ee,Pe)}function Ge(Y){const ee=ne[0];ee&&((Y.value!==ee.value||Y.state!==ee.state)&&u({...Y,replace:ee.replace,scroll:ee.scroll}),ne.length=0)}function ye(Y,ee){const Pe=Jo(n(),Y.pathname),He=Et;Et="preload";for(let kn in Pe){const{route:Ze,params:ct}=Pe[kn];Ze.component&&Ze.component.preload&&Ze.component.preload();const{load:et}=Ze;ee&&et&&Mo(e(),()=>et({params:ct,location:{pathname:Y.pathname,search:Y.search,hash:Y.hash,query:Vo(Y),state:null,key:""},intent:"preload"}))}Et=He}}function Zu(t,e,n,i,o){const{base:u,location:l}=t,{pattern:h,component:m,load:k}=i().route,g=be(()=>i().path);m&&m.preload&&m.preload();const S=k?k({params:o,location:l,intent:Et||"initial"}):void 0;return{parent:e,pattern:h,path:g,params:o,outlet:()=>m?J(m,{params:o,location:l,data:S,get children(){return n()}}):n(),resolvePath(L){return Cr(u.path(),L,g())}}}const ec=t=>e=>{const{base:n}=e,i=$r(()=>e.children),o=be(()=>Xo(i(),e.base||""));let u;const l=Ju(t,()=>u,o,{base:n,singleFlight:e.singleFlight}),h=l.location;return t.create&&t.create(l),J(Ho.Provider,{value:l,get children(){return J(tc,{location:h,get root(){return e.root},get load(){return e.rootLoad},get children(){return[be(()=>(u=To())&&null),J(nc,{routerState:l,get branches(){return o()}})]}})}})};function tc(t){const e=t.location,n=be(()=>t.load&&ke(()=>t.load({params:{},location:e,intent:"preload"})));return J(Lo,{get when(){return t.root},keyed:!0,get fallback(){return t.children},children:i=>J(i,{params:{},location:e,get data(){return n()},get children(){return t.children}})})}function nc(t){const e=be(()=>Jo(t.branches,t.routerState.location.pathname)),n=zo(()=>{const l=e(),h={};for(let m=0;m<l.length;m++)Object.assign(h,l[m].params);return h}),i=[];let o;const u=be(Ro(e,(l,h,m)=>{let k=h&&l.length===h.length;const g=[];for(let S=0,N=l.length;S<N;S++){const L=h&&h[S],D=l[S];m&&L&&D.route.key===L.route.key?g[S]=m[S]:(k=!1,i[S]&&i[S](),qn(z=>{i[S]=z,g[S]=Zu(t.routerState,g[S-1]||t.routerState.base,so(()=>u()[S+1]),()=>e()[S],n)}))}return i.splice(l.length).forEach(S=>S()),m&&k?m:(o=g[0],g)}));return so(()=>u()&&o)()}const so=t=>()=>J(Lo,{get when(){return t()},keyed:!0,children:e=>J(us.Provider,{value:e,get children(){return e.outlet()}})}),Ce=t=>{const e=$r(()=>t.children);return Vi(t,{get children(){return e()}})};function rc([t,e],n,i){return[n?()=>n(t()):t,i?o=>e(i(o)):e]}function ic(t){if(t==="#")return null;try{return document.querySelector(t)}catch{return null}}function sc(t){let e=!1;const n=o=>typeof o=="string"?{value:o}:o,i=rc(Ke(n(t.get()),{equals:(o,u)=>o.value===u.value}),void 0,o=>(!e&&t.set(o),o));return t.init&&Vt(t.init((o=t.get())=>{e=!0,i[1](n(o)),e=!1})),ec({signal:i,create:t.create,utils:t.utils})}function oc(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function ac(t,e){const n=ic(`#${t}`);n?n.scrollIntoView():e&&window.scrollTo(0,0)}const uc=new Map;function cc(t=!0,e=!1,n="/_server"){return i=>{const o=i.base.path(),u=i.navigatorFactory(i.base);let l={};function h(D){return D.namespaceURI==="http://www.w3.org/2000/svg"}function m(D){if(D.defaultPrevented||D.button!==0||D.metaKey||D.altKey||D.ctrlKey||D.shiftKey)return;const z=D.composedPath().find(me=>me instanceof Node&&me.nodeName.toUpperCase()==="A");if(!z||e&&!z.hasAttribute("link"))return;const Q=h(z),X=Q?z.href.baseVal:z.href;if((Q?z.target.baseVal:z.target)||!X&&!z.hasAttribute("state"))return;const ne=(z.getAttribute("rel")||"").split(/\s+/);if(z.hasAttribute("download")||ne&&ne.includes("external"))return;const ce=Q?new URL(X,document.baseURI):new URL(X);if(!(ce.origin!==window.location.origin||o&&ce.pathname&&!ce.pathname.toLowerCase().startsWith(o.toLowerCase())))return[z,ce]}function k(D){const z=m(D);if(!z)return;const[Q,X]=z,he=i.parsePath(X.pathname+X.search+X.hash),ne=Q.getAttribute("state");D.preventDefault(),u(he,{resolve:!1,replace:Q.hasAttribute("replace"),scroll:!Q.hasAttribute("noscroll"),state:ne&&JSON.parse(ne)})}function g(D){const z=m(D);if(!z)return;const[Q,X]=z;l[X.pathname]||i.preloadRoute(X,Q.getAttribute("preload")!=="false")}function S(D){const z=m(D);if(!z)return;const[Q,X]=z;l[X.pathname]||(l[X.pathname]=setTimeout(()=>{i.preloadRoute(X,Q.getAttribute("preload")!=="false"),delete l[X.pathname]},200))}function N(D){const z=m(D);if(!z)return;const[,Q]=z;l[Q.pathname]&&(clearTimeout(l[Q.pathname]),delete l[Q.pathname])}function L(D){let z=D.submitter&&D.submitter.hasAttribute("formaction")?D.submitter.getAttribute("formaction"):D.target.getAttribute("action");if(!z)return;if(!z.startsWith("https://action/")){const X=new URL(z,Uo);if(z=i.parsePath(X.pathname+X.search),!z.startsWith(n))return}if(D.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const Q=uc.get(z);if(Q){D.preventDefault();const X=new FormData(D.target);D.submitter&&D.submitter.name&&X.append(D.submitter.name,D.submitter.value),Q.call({r:i,f:D.target},X)}}$o(["click","submit"]),document.addEventListener("click",k),t&&(document.addEventListener("mouseover",S),document.addEventListener("mouseout",N),document.addEventListener("focusin",g),document.addEventListener("touchstart",g)),document.addEventListener("submit",L),Vt(()=>{document.removeEventListener("click",k),t&&(document.removeEventListener("mouseover",S),document.removeEventListener("mouseout",N),document.removeEventListener("focusin",g),document.removeEventListener("touchstart",g)),document.removeEventListener("submit",L)})}}function lc(t){const e=t.replace(/^.*?#/,"");if(!e.startsWith("/")){const[,n="/"]=window.location.hash.split("#",2);return`${n}#${e}`}return e}function hc(t){const e=()=>window.location.hash.slice(1),n=Fo();return sc({get:e,set({value:i,replace:o,scroll:u,state:l}){o?window.history.replaceState(Iu(l),"","#"+i):window.location.hash=i;const h=i.indexOf("#"),m=h>=0?i.slice(h+1):"";ac(m,u),as()},init:i=>oc(window,"hashchange",ju(i,o=>!n.confirm(o&&o<0?o:e()))),create:cc(t.preload,t.explicitLinks,t.actionBase),utils:{go:i=>window.history.go(i),renderPath:i=>`#${i}`,parsePath:lc,beforeLeave:n}})(t)}var fc=os("<a>");function pt(t){t=Vi({inactiveClass:"inactive",activeClass:"active"},t);const[,e]=fu(t,["href","state","class","activeClass","inactiveClass","end"]),n=Gu(()=>t.href),i=Hu(n),o=Fr(),u=be(()=>{const l=n();if(l===void 0)return[!1,!1];const h=qt(l.split(/[?#]/,1)[0]).toLowerCase(),m=qt(o.pathname).toLowerCase();return[t.end?h===m:m.startsWith(h),h===m]});return(()=>{var l=fc();return Gi(l,Vi(e,{get href(){return i()||t.href},get state(){return JSON.stringify(t.state)},get classList(){return{...t.class&&{[t.class]:!0},[t.inactiveClass]:!u()[0],[t.activeClass]:u()[0],...e.classList}},link:"",get"aria-current"(){return u()[1]?"page":void 0}}),!1,!1),l})()}const Qi=Symbol("store-raw"),fn=Symbol("store-node"),mt=Symbol("store-has"),Zo=Symbol("store-self");function ea(t){let e=t[Je];if(!e&&(Object.defineProperty(t,Je,{value:e=new Proxy(t,mc)}),!Array.isArray(t))){const n=Object.keys(t),i=Object.getOwnPropertyDescriptors(t);for(let o=0,u=n.length;o<u;o++){const l=n[o];i[l].get&&Object.defineProperty(t,l,{enumerable:i[l].enumerable,get:i[l].get.bind(e)})}}return e}function Pt(t){let e;return t!=null&&typeof t=="object"&&(t[Je]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function gn(t,e=new Set){let n,i,o,u;if(n=t!=null&&t[Qi])return n;if(!Pt(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let l=0,h=t.length;l<h;l++)o=t[l],(i=gn(o,e))!==o&&(t[l]=i)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const l=Object.keys(t),h=Object.getOwnPropertyDescriptors(t);for(let m=0,k=l.length;m<k;m++)u=l[m],!h[u].get&&(o=t[u],(i=gn(o,e))!==o&&(t[u]=i))}return t}function Nr(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function Fn(t,e,n){if(t[e])return t[e];const[i,o]=Ke(n,{equals:!1,internal:!0});return i.$=o,t[e]=i}function dc(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===Je||e===fn||(delete n.value,delete n.writable,n.get=()=>t[Je][e]),n}function ta(t){qi()&&Fn(Nr(t,fn),Zo)()}function pc(t){return ta(t),Reflect.ownKeys(t)}const mc={get(t,e,n){if(e===Qi)return t;if(e===Je)return n;if(e===$i)return ta(t),n;const i=Nr(t,fn),o=i[e];let u=o?o():t[e];if(e===fn||e===mt||e==="__proto__")return u;if(!o){const l=Object.getOwnPropertyDescriptor(t,e);qi()&&(typeof u!="function"||t.hasOwnProperty(e))&&!(l&&l.get)&&(u=Fn(i,e,u)())}return Pt(u)?ea(u):u},has(t,e){return e===Qi||e===Je||e===$i||e===fn||e===mt||e==="__proto__"?!0:(qi()&&Fn(Nr(t,mt),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:pc,getOwnPropertyDescriptor:dc};function ze(t,e,n,i=!1){if(!i&&t[e]===n)return;const o=t[e],u=t.length;n===void 0?(delete t[e],t[mt]&&t[mt][e]&&o!==void 0&&t[mt][e].$()):(t[e]=n,t[mt]&&t[mt][e]&&o===void 0&&t[mt][e].$());let l=Nr(t,fn),h;if((h=Fn(l,e,o))&&h.$(()=>n),Array.isArray(t)&&t.length!==u){for(let m=t.length;m<u;m++)(h=l[m])&&h.$();(h=Fn(l,"length",u))&&h.$(t.length)}(h=l[Zo])&&h.$()}function na(t,e){const n=Object.keys(e);for(let i=0;i<n.length;i+=1){const o=n[i];ze(t,o,e[o])}}function yc(t,e){if(typeof e=="function"&&(e=e(t)),e=gn(e),Array.isArray(e)){if(t===e)return;let n=0,i=e.length;for(;n<i;n++){const o=e[n];t[n]!==o&&ze(t,n,o)}ze(t,"length",i)}else na(t,e)}function Ln(t,e,n=[]){let i,o=t;if(e.length>1){i=e.shift();const l=typeof i,h=Array.isArray(t);if(Array.isArray(i)){for(let m=0;m<i.length;m++)Ln(t,[i[m]].concat(e),n);return}else if(h&&l==="function"){for(let m=0;m<t.length;m++)i(t[m],m)&&Ln(t,[m].concat(e),n);return}else if(h&&l==="object"){const{from:m=0,to:k=t.length-1,by:g=1}=i;for(let S=m;S<=k;S+=g)Ln(t,[S].concat(e),n);return}else if(e.length>1){Ln(t[i],e,[i].concat(n));return}o=t[i],n=[i].concat(n)}let u=e[0];typeof u=="function"&&(u=u(o,n),u===o)||i===void 0&&u==null||(u=gn(u),i===void 0||Pt(o)&&Pt(u)&&!Array.isArray(u)?na(o,u):ze(t,i,u))}function _h(...[t,e]){const n=gn(t||{}),i=Array.isArray(n),o=ea(n);function u(...l){tu(()=>{i&&l.length===1?yc(n,l[0]):Ln(n,l)})}return[o,u]}const Yi=Symbol("store-root");function un(t,e,n,i,o){const u=e[n];if(t===u)return;const l=Array.isArray(t);if(n!==Yi&&(!Pt(t)||!Pt(u)||l!==Array.isArray(u)||o&&t[o]!==u[o])){ze(e,n,t);return}if(l){if(t.length&&u.length&&(!i||o&&t[0]&&t[0][o]!=null)){let k,g,S,N,L,D,z,Q;for(S=0,N=Math.min(u.length,t.length);S<N&&(u[S]===t[S]||o&&u[S]&&t[S]&&u[S][o]===t[S][o]);S++)un(t[S],u,S,i,o);const X=new Array(t.length),he=new Map;for(N=u.length-1,L=t.length-1;N>=S&&L>=S&&(u[N]===t[L]||o&&u[S]&&t[S]&&u[N][o]===t[L][o]);N--,L--)X[L]=u[N];if(S>L||S>N){for(g=S;g<=L;g++)ze(u,g,t[g]);for(;g<t.length;g++)ze(u,g,X[g]),un(t[g],u,g,i,o);u.length>t.length&&ze(u,"length",t.length);return}for(z=new Array(L+1),g=L;g>=S;g--)D=t[g],Q=o&&D?D[o]:D,k=he.get(Q),z[g]=k===void 0?-1:k,he.set(Q,g);for(k=S;k<=N;k++)D=u[k],Q=o&&D?D[o]:D,g=he.get(Q),g!==void 0&&g!==-1&&(X[g]=u[k],g=z[g],he.set(Q,g));for(g=S;g<t.length;g++)g in X?(ze(u,g,X[g]),un(t[g],u,g,i,o)):ze(u,g,t[g])}else for(let k=0,g=t.length;k<g;k++)un(t[k],u,k,i,o);u.length>t.length&&ze(u,"length",t.length);return}const h=Object.keys(t);for(let k=0,g=h.length;k<g;k++)un(t[h[k]],u,h[k],i,o);const m=Object.keys(u);for(let k=0,g=m.length;k<g;k++)t[m[k]]===void 0&&ze(u,m[k],void 0)}function gc(t,e={}){const{merge:n,key:i="id"}=e,o=gn(t);return u=>{if(!Pt(u)||!Pt(o))return o;const l=un(o,{[Yi]:u},Yi,n,i);return l===void 0?u:l}}const vc=Gn(),bc=["title","meta"],oo=[],ao=["name","http-equiv","content","charset","media"].concat(["property"]),uo=(t,e)=>{const n=Object.fromEntries(Object.entries(t.props).filter(([i])=>e.includes(i)).sort());return(Object.hasOwn(n,"name")||Object.hasOwn(n,"property"))&&(n.name=n.name||n.property,delete n.property),t.tag+JSON.stringify(n)};function wc(){if(!ie.context){const n=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(n,i=>i.parentNode.removeChild(i))}const t=new Map;function e(n){if(n.ref)return n.ref;let i=document.querySelector(`[data-sm="${n.id}"]`);return i?(i.tagName.toLowerCase()!==n.tag&&(i.parentNode&&i.parentNode.removeChild(i),i=document.createElement(n.tag)),i.removeAttribute("data-sm")):i=document.createElement(n.tag),i}return{addTag(n){if(bc.indexOf(n.tag)!==-1){const u=n.tag==="title"?oo:ao,l=uo(n,u);t.has(l)||t.set(l,[]);let h=t.get(l),m=h.length;h=[...h,n],t.set(l,h);let k=e(n);n.ref=k,Gi(k,n.props);let g=null;for(var i=m-1;i>=0;i--)if(h[i]!=null){g=h[i];break}return k.parentNode!=document.head&&document.head.appendChild(k),g&&g.ref&&document.head.removeChild(g.ref),m}let o=e(n);return n.ref=o,Gi(o,n.props),o.parentNode!=document.head&&document.head.appendChild(o),-1},removeTag(n,i){const o=n.tag==="title"?oo:ao,u=uo(n,o);if(n.ref){const l=t.get(u);if(l){if(n.ref.parentNode){n.ref.parentNode.removeChild(n.ref);for(let h=i-1;h>=0;h--)l[h]!=null&&document.head.appendChild(l[h].ref)}l[i]=null,t.set(u,l)}else n.ref.parentNode&&n.ref.parentNode.removeChild(n.ref)}}}}const _c=t=>{const e=wc();return J(vc.Provider,{value:e,get children(){return t.children}})};function kc(t){let e,n;return function(...i){const o=this,u=()=>{n=void 0,e=t.apply(o,i).finally(()=>{e=void 0,n&&n()})};e?n=u:u()}}function xc(t,e){return kc(function(...n){return e.apply(this,n),new Promise(i=>setTimeout(i,t))})}var Ec=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Ac=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),Oc=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function Pc(t){if(!t)return"";let e="";for(const n in t){if(!Oc.includes(n))continue;const i=t[n];e+=i instanceof Date?`; ${n}=${i.toUTCString()}`:typeof i=="boolean"?`; ${n}`:`; ${n}=${i}`}return e}function Cc(t,e){return t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`)?.pop()??null}var co;try{co=Ec("solid-start/server").useRequest}catch{co=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var sn=Ac({_read:()=>document.cookie,_write:(t,e,n)=>{document.cookie=`${t}=${e}${Pc(n)}`},getItem:(t,e)=>Cc(sn._read(e),t),setItem:(t,e,n)=>{sn._write(t,e,n);{const o=Object.assign(new Event("storage"),{key:t,oldValue:null,newValue:e,url:globalThis.document.URL,storageArea:sn});window.dispatchEvent(o)}},removeItem:(t,e)=>{sn._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let n=null,i=0;return sn._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(o,u)=>(!n&&u&&i++===t&&(n=u),"")),n},getLength:t=>{let e=0;return sn._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,n=>(e+=n?1:0,"")),e},get length(){return this.getLength()}});function Sc(t,e={}){const n=e.storage||globalThis.localStorage;if(!n)return t;const i=e.storageOptions,o=e.name||`storage-${pu()}`,u=e.serialize||JSON.stringify.bind(JSON),l=e.deserialize||JSON.parse.bind(JSON),h=n.getItem(o,i),m=typeof t[0]=="function"?g=>t[1](()=>l(g)):g=>t[1](gc(l(g)));let k=!0;return h instanceof Promise?h.then(g=>k&&g&&m(g)):h&&m(h),[t[0],typeof t[0]=="function"?g=>{const S=t[1](g);return g?n.setItem(o,u(S),i):n.removeItem(o,i),k=!1,S}:(...g)=>{t[1](...g);const S=u(ke(()=>t[0]));n.setItem(o,S,i),k=!1}]}const Rc=(t,e,n)=>Sc(Ke(t),{name:`.aidchess.v${n??1}.${e}`});class ra{ctx=Mc();sounds=new Map;paths=new Map;theme="standard";volumeStorage=Rc("1","sound.volume");enabled=()=>this.theme!=="silent";resolvePath(e){return this.enabled()?`sound/${this.theme}/${e[0].toUpperCase()+e.slice(1)}`:void 0}getVolume=()=>{const e=parseFloat(this.volumeStorage[0]());return e>=0?e:.7};async play(e,n=1){if(!this.enabled())return;const i=await this.load(e);i&&await i.play(this.getVolume()*n)}async load(e,n){if(!this.ctx||(n?this.paths.set(e,n):n=this.paths.get(e)??this.resolvePath(e),!n))return;if(this.sounds.has(n))return this.sounds.get(n);const i=await fetch(`${n}.mp3`);if(!i.ok)throw new Error(`${n}.mp3 failed ${i.status}`);const o=await i.arrayBuffer(),u=await new Promise((h,m)=>{this.ctx?.decodeAudioData.length===1?this.ctx?.decodeAudioData(o).then(h).catch(m):this.ctx?.decodeAudioData(o,h,m)}),l=new Tc(this.ctx,u);return this.sounds.set(n,l),l}preloadBoardSounds(){for(const e of["move","capture","check","genericNotify"])this.load(e)}throttled=xc(200,e=>this.play(e));setVolume=e=>this.volumeStorage[1](e.toString());async move(e){e?.name?this.throttled(e.name):(e?.san?.includes("x")?this.throttled("capture"):this.throttled("move"),(e?.san?.includes("#")||e?.san?.includes("+"))&&this.throttled("check"))}}class Tc{constructor(e,n){this.buffer=n,this.rewire(e)}node;ctx;play(e=1){this.node.gain.setValueAtTime(e,this.ctx.currentTime);const n=this.ctx.createBufferSource();return n.buffer=this.buffer,n.connect(this.node),new Promise(i=>{n.onended=()=>{n.disconnect(),i()},n.start(0)})}rewire(e){this.node?.disconnect(),this.ctx=e,this.node=this.ctx.createGain(),this.node.connect(this.ctx.destination)}}function Mc(){return new AudioContext}const ia=Gn(new ra);function Nc(t){return J(ia.Provider,{value:new ra,get children(){return t.children}})}function kh(){return Lr(ia)}var lo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var sa={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(lo,function(){var n=function(r,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(a[f]=c[f])})(r,s)},i=function(){return(i=Object.assign||function(r){for(var s,a=1,c=arguments.length;a<c;a++)for(var f in s=arguments[a])Object.prototype.hasOwnProperty.call(s,f)&&(r[f]=s[f]);return r}).apply(this,arguments)};function o(r,s,a){if(a||arguments.length===2)for(var c,f=0,d=s.length;f<d;f++)!c&&f in s||((c=c||Array.prototype.slice.call(s,0,f))[f]=s[f]);return r.concat(c||Array.prototype.slice.call(s))}var u=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:lo,l=Object.keys,h=Array.isArray;function m(r,s){return typeof s!="object"||l(s).forEach(function(a){r[a]=s[a]}),r}typeof Promise>"u"||u.Promise||(u.Promise=Promise);var k=Object.getPrototypeOf,g={}.hasOwnProperty;function S(r,s){return g.call(r,s)}function N(r,s){typeof s=="function"&&(s=s(k(r))),(typeof Reflect>"u"?l:Reflect.ownKeys)(s).forEach(function(a){D(r,a,s[a])})}var L=Object.defineProperty;function D(r,s,a,c){L(r,s,m(a&&S(a,"get")&&typeof a.get=="function"?{get:a.get,set:a.set,configurable:!0}:{value:a,configurable:!0,writable:!0},c))}function z(r){return{from:function(s){return r.prototype=Object.create(s.prototype),D(r.prototype,"constructor",r),{extend:N.bind(null,r.prototype)}}}}var Q=Object.getOwnPropertyDescriptor,X=[].slice;function he(r,s,a){return X.call(r,s,a)}function ne(r,s){return s(r)}function ce(r){if(!r)throw new Error("Assertion Failed")}function me(r){u.setImmediate?setImmediate(r):setTimeout(r,0)}function xe(r,s){if(typeof s=="string"&&S(r,s))return r[s];if(!s)return r;if(typeof s!="string"){for(var a=[],c=0,f=s.length;c<f;++c){var d=xe(r,s[c]);a.push(d)}return a}var p=s.indexOf(".");if(p!==-1){var y=r[s.substr(0,p)];return y==null?void 0:xe(y,s.substr(p+1))}}function Ee(r,s,a){if(r&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof s!="string"&&"length"in s){ce(typeof a!="string"&&"length"in a);for(var c=0,f=s.length;c<f;++c)Ee(r,s[c],a[c])}else{var d,p,y=s.indexOf(".");y!==-1?(d=s.substr(0,y),(p=s.substr(y+1))===""?a===void 0?h(r)&&!isNaN(parseInt(d))?r.splice(d,1):delete r[d]:r[d]=a:Ee(y=!(y=r[d])||!S(r,d)?r[d]={}:y,p,a)):a===void 0?h(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=a}}function Ge(r){var s,a={};for(s in r)S(r,s)&&(a[s]=r[s]);return a}var ye=[].concat;function Y(r){return ye.apply([],r)}var ft="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Y([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(s){return s+r+"Array"})}))).filter(function(r){return u[r]}),ee=new Set(ft.map(function(r){return u[r]})),Pe=null;function He(r){return Pe=new WeakMap,r=function s(a){if(!a||typeof a!="object")return a;var c=Pe.get(a);if(c)return c;if(h(a)){c=[],Pe.set(a,c);for(var f=0,d=a.length;f<d;++f)c.push(s(a[f]))}else if(ee.has(a.constructor))c=a;else{var p,y=k(a);for(p in c=y===Object.prototype?{}:Object.create(y),Pe.set(a,c),a)S(a,p)&&(c[p]=s(a[p]))}return c}(r),Pe=null,r}var kn={}.toString;function Ze(r){return kn.call(r).slice(8,-1)}var ct=typeof Symbol<"u"?Symbol.iterator:"@@iterator",et=typeof ct=="symbol"?function(r){var s;return r!=null&&(s=r[ct])&&s.apply(r)}:function(){return null};function tt(r,s){return s=r.indexOf(s),0<=s&&r.splice(s,1),0<=s}var yt={};function lt(r){var s,a,c,f;if(arguments.length===1){if(h(r))return r.slice();if(this===yt&&typeof r=="string")return[r];if(f=et(r)){for(a=[];!(c=f.next()).done;)a.push(c.value);return a}if(r==null)return[r];if(typeof(s=r.length)!="number")return[r];for(a=new Array(s);s--;)a[s]=r[s];return a}for(s=arguments.length,a=new Array(s);s--;)a[s]=arguments[s];return a}var zr=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},An=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(An),va={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Wt(r,s){this.name=r,this.message=s}function ms(r,s){return r+". Errors: "+Object.keys(s).map(function(a){return s[a].toString()}).filter(function(a,c,f){return f.indexOf(a)===c}).join(`
`)}function Zn(r,s,a,c){this.failures=s,this.failedKeys=c,this.successCount=a,this.message=ms(r,s)}function Qt(r,s){this.name="BulkError",this.failures=Object.keys(s).map(function(a){return s[a]}),this.failuresByPos=s,this.message=ms(r,this.failures)}z(Wt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),z(Zn).from(Wt),z(Qt).from(Wt);var Gr=Ve.reduce(function(r,s){return r[s]=s+"Error",r},{}),ba=Wt,W=Ve.reduce(function(r,s){var a=s+"Error";function c(f,d){this.name=a,f?typeof f=="string"?(this.message="".concat(f).concat(d?`
 `+d:""),this.inner=d||null):typeof f=="object"&&(this.message="".concat(f.name," ").concat(f.message),this.inner=f):(this.message=va[s]||a,this.inner=null)}return z(c).from(ba),r[s]=c,r},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var ys=An.reduce(function(r,s){return r[s+"Error"]=W[s],r},{}),er=Ve.reduce(function(r,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(r[s+"Error"]=W[s]),r},{});function ve(){}function xn(r){return r}function wa(r,s){return r==null||r===xn?s:function(a){return s(r(a))}}function St(r,s){return function(){r.apply(this,arguments),s.apply(this,arguments)}}function _a(r,s){return r===ve?s:function(){var a=r.apply(this,arguments);a!==void 0&&(arguments[0]=a);var c=this.onsuccess,f=this.onerror;this.onsuccess=null,this.onerror=null;var d=s.apply(this,arguments);return c&&(this.onsuccess=this.onsuccess?St(c,this.onsuccess):c),f&&(this.onerror=this.onerror?St(f,this.onerror):f),d!==void 0?d:a}}function ka(r,s){return r===ve?s:function(){r.apply(this,arguments);var a=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?St(a,this.onsuccess):a),c&&(this.onerror=this.onerror?St(c,this.onerror):c)}}function xa(r,s){return r===ve?s:function(a){var c=r.apply(this,arguments);m(a,c);var f=this.onsuccess,d=this.onerror;return this.onsuccess=null,this.onerror=null,a=s.apply(this,arguments),f&&(this.onsuccess=this.onsuccess?St(f,this.onsuccess):f),d&&(this.onerror=this.onerror?St(d,this.onerror):d),c===void 0?a===void 0?void 0:a:m(c,a)}}function Ea(r,s){return r===ve?s:function(){return s.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Hr(r,s){return r===ve?s:function(){var a=r.apply(this,arguments);if(a&&typeof a.then=="function"){for(var c=this,f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];return a.then(function(){return s.apply(c,d)})}return s.apply(this,arguments)}}er.ModifyError=Zn,er.DexieError=Wt,er.BulkError=Qt;var nt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gs(r){nt=r}var En={},vs=100,ft=typeof Promise>"u"?[]:function(){var r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,k(r),r];var s=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[s,k(s),r]}(),An=ft[0],Ve=ft[1],ft=ft[2],Ve=Ve&&Ve.then,Rt=An&&An.constructor,Wr=!!ft,On=function(r,s){Pn.push([r,s]),tr&&(queueMicrotask(Oa),tr=!1)},Qr=!0,tr=!0,Tt=[],nr=[],Yr=xn,gt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ve,pgp:!1,env:{},finalize:ve},H=gt,Pn=[],Mt=0,rr=[];function V(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=H;if(typeof r!="function"){if(r!==En)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Jr(this,this._value))}this._state=null,this._value=null,++s.ref,function a(c,f){try{f(function(d){if(c._state===null){if(d===c)throw new TypeError("A promise cannot be resolved with itself.");var p=c._lib&&Yt();d&&typeof d.then=="function"?a(c,function(y,b){d instanceof V?d._then(y,b):d.then(y,b)}):(c._state=!0,c._value=d,ws(c)),p&&Xt()}},Jr.bind(null,c))}catch(d){Jr(c,d)}}(this,r)}var Xr={get:function(){var r=H,s=ar;function a(c,f){var d=this,p=!r.global&&(r!==H||s!==ar),y=p&&!bt(),b=new V(function(_,A){Zr(d,new bs(ks(c,r,p,y),ks(f,r,p,y),_,A,r))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return a.prototype=En,a},set:function(r){D(this,"then",r&&r.prototype===En?Xr:{get:function(){return r},set:Xr.set})}};function bs(r,s,a,c,f){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof s=="function"?s:null,this.resolve=a,this.reject=c,this.psd=f}function Jr(r,s){var a,c;nr.push(s),r._state===null&&(a=r._lib&&Yt(),s=Yr(s),r._state=!1,r._value=s,c=r,Tt.some(function(f){return f._value===c._value})||Tt.push(c),ws(r),a&&Xt())}function ws(r){var s=r._listeners;r._listeners=[];for(var a=0,c=s.length;a<c;++a)Zr(r,s[a]);var f=r._PSD;--f.ref||f.finalize(),Mt===0&&(++Mt,On(function(){--Mt==0&&ei()},[]))}function Zr(r,s){if(r._state!==null){var a=r._state?s.onFulfilled:s.onRejected;if(a===null)return(r._state?s.resolve:s.reject)(r._value);++s.psd.ref,++Mt,On(Aa,[a,r,s])}else r._listeners.push(s)}function Aa(r,s,a){try{var c,f=s._value;!s._state&&nr.length&&(nr=[]),c=nt&&s._consoleTask?s._consoleTask.run(function(){return r(f)}):r(f),s._state||nr.indexOf(f)!==-1||function(d){for(var p=Tt.length;p;)if(Tt[--p]._value===d._value)return Tt.splice(p,1)}(s),a.resolve(c)}catch(d){a.reject(d)}finally{--Mt==0&&ei(),--a.psd.ref||a.psd.finalize()}}function Oa(){Nt(gt,function(){Yt()&&Xt()})}function Yt(){var r=Qr;return tr=Qr=!1,r}function Xt(){var r,s,a;do for(;0<Pn.length;)for(r=Pn,Pn=[],a=r.length,s=0;s<a;++s){var c=r[s];c[0].apply(null,c[1])}while(0<Pn.length);tr=Qr=!0}function ei(){var r=Tt;Tt=[],r.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)});for(var s=rr.slice(0),a=s.length;a;)s[--a]()}function ir(r){return new V(En,!1,r)}function _e(r,s){var a=H;return function(){var c=Yt(),f=H;try{return wt(a,!0),r.apply(this,arguments)}catch(d){s&&s(d)}finally{wt(f,!1),c&&Xt()}}}N(V.prototype,{then:Xr,_then:function(r,s){Zr(this,new bs(null,null,r,s,H))},catch:function(r){if(arguments.length===1)return this.then(null,r);var s=r,a=arguments[1];return typeof s=="function"?this.then(null,function(c){return(c instanceof s?a:ir)(c)}):this.then(null,function(c){return(c&&c.name===s?a:ir)(c)})},finally:function(r){return this.then(function(s){return V.resolve(r()).then(function(){return s})},function(s){return V.resolve(r()).then(function(){return ir(s)})})},timeout:function(r,s){var a=this;return r<1/0?new V(function(c,f){var d=setTimeout(function(){return f(new W.Timeout(s))},r);a.then(c,f).finally(clearTimeout.bind(null,d))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&D(V.prototype,Symbol.toStringTag,"Dexie.Promise"),gt.env=_s(),N(V,{all:function(){var r=lt.apply(null,arguments).map(ur);return new V(function(s,a){r.length===0&&s([]);var c=r.length;r.forEach(function(f,d){return V.resolve(f).then(function(p){r[d]=p,--c||s(r)},a)})})},resolve:function(r){return r instanceof V?r:r&&typeof r.then=="function"?new V(function(s,a){r.then(s,a)}):new V(En,!0,r)},reject:ir,race:function(){var r=lt.apply(null,arguments).map(ur);return new V(function(s,a){r.map(function(c){return V.resolve(c).then(s,a)})})},PSD:{get:function(){return H},set:function(r){return H=r}},totalEchoes:{get:function(){return ar}},newPSD:vt,usePSD:Nt,scheduler:{get:function(){return On},set:function(r){On=r}},rejectionMapper:{get:function(){return Yr},set:function(r){Yr=r}},follow:function(r,s){return new V(function(a,c){return vt(function(f,d){var p=H;p.unhandleds=[],p.onunhandled=d,p.finalize=St(function(){var y,b=this;y=function(){b.unhandleds.length===0?f():d(b.unhandleds[0])},rr.push(function _(){y(),rr.splice(rr.indexOf(_),1)}),++Mt,On(function(){--Mt==0&&ei()},[])},p.finalize),r()},s,a,c)})}}),Rt&&(Rt.allSettled&&D(V,"allSettled",function(){var r=lt.apply(null,arguments).map(ur);return new V(function(s){r.length===0&&s([]);var a=r.length,c=new Array(a);r.forEach(function(f,d){return V.resolve(f).then(function(p){return c[d]={status:"fulfilled",value:p}},function(p){return c[d]={status:"rejected",reason:p}}).then(function(){return--a||s(c)})})})}),Rt.any&&typeof AggregateError<"u"&&D(V,"any",function(){var r=lt.apply(null,arguments).map(ur);return new V(function(s,a){r.length===0&&a(new AggregateError([]));var c=r.length,f=new Array(c);r.forEach(function(d,p){return V.resolve(d).then(function(y){return s(y)},function(y){f[p]=y,--c||a(new AggregateError(f))})})})}),Rt.withResolvers&&(V.withResolvers=Rt.withResolvers));var Re={awaits:0,echoes:0,id:0},Pa=0,sr=[],or=0,ar=0,Ca=0;function vt(r,s,a,c){var f=H,d=Object.create(f);return d.parent=f,d.ref=0,d.global=!1,d.id=++Ca,gt.env,d.env=Wr?{Promise:V,PromiseProp:{value:V,configurable:!0,writable:!0},all:V.all,race:V.race,allSettled:V.allSettled,any:V.any,resolve:V.resolve,reject:V.reject}:{},s&&m(d,s),++f.ref,d.finalize=function(){--this.parent.ref||this.parent.finalize()},c=Nt(d,r,a,c),d.ref===0&&d.finalize(),c}function Jt(){return Re.id||(Re.id=++Pa),++Re.awaits,Re.echoes+=vs,Re.id}function bt(){return!!Re.awaits&&(--Re.awaits==0&&(Re.id=0),Re.echoes=Re.awaits*vs,!0)}function ur(r){return Re.echoes&&r&&r.constructor===Rt?(Jt(),r.then(function(s){return bt(),s},function(s){return bt(),Ae(s)})):r}function Sa(){var r=sr[sr.length-1];sr.pop(),wt(r,!1)}function wt(r,s){var a,c=H;(s?!Re.echoes||or++&&r===H:!or||--or&&r===H)||queueMicrotask(s?function(f){++ar,Re.echoes&&--Re.echoes!=0||(Re.echoes=Re.awaits=Re.id=0),sr.push(H),wt(f,!0)}.bind(null,r):Sa),r!==H&&(H=r,c===gt&&(gt.env=_s()),Wr&&(a=gt.env.Promise,s=r.env,(c.global||r.global)&&(Object.defineProperty(u,"Promise",s.PromiseProp),a.all=s.all,a.race=s.race,a.resolve=s.resolve,a.reject=s.reject,s.allSettled&&(a.allSettled=s.allSettled),s.any&&(a.any=s.any))))}function _s(){var r=u.Promise;return Wr?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Nt(r,s,a,c,f){var d=H;try{return wt(r,!0),s(a,c,f)}finally{wt(d,!1)}}function ks(r,s,a,c){return typeof r!="function"?r:function(){var f=H;a&&Jt(),wt(s,!0);try{return r.apply(this,arguments)}finally{wt(f,!1),c&&queueMicrotask(bt)}}}function ti(r){Promise===Rt&&Re.echoes===0?or===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+Ve).indexOf("[native code]")===-1&&(Jt=bt=ve);var Ae=V.reject,Kt="",ht="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xs="String expected.",Zt=[],cr="__dbnames",ni="readonly",ri="readwrite";function Dt(r,s){return r?s?function(){return r.apply(this,arguments)&&s.apply(this,arguments)}:r:s}var Es={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function lr(r){return typeof r!="string"||/\./.test(r)?function(s){return s}:function(s){return s[r]===void 0&&r in s&&delete(s=He(s))[r],s}}function As(){throw W.Type()}function fe(r,s){try{var a=Os(r),c=Os(s);if(a!==c)return a==="Array"?1:c==="Array"?-1:a==="binary"?1:c==="binary"?-1:a==="string"?1:c==="string"?-1:a==="Date"?1:c!=="Date"?NaN:-1;switch(a){case"number":case"Date":case"string":return s<r?1:r<s?-1:0;case"binary":return function(f,d){for(var p=f.length,y=d.length,b=p<y?p:y,_=0;_<b;++_)if(f[_]!==d[_])return f[_]<d[_]?-1:1;return p===y?0:p<y?-1:1}(Ps(r),Ps(s));case"Array":return function(f,d){for(var p=f.length,y=d.length,b=p<y?p:y,_=0;_<b;++_){var A=fe(f[_],d[_]);if(A!==0)return A}return p===y?0:p<y?-1:1}(r,s)}}catch{}return NaN}function Os(r){var s=typeof r;return s!="object"?s:ArrayBuffer.isView(r)?"binary":(r=Ze(r),r==="ArrayBuffer"?"binary":r)}function Ps(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}var Cs=(we.prototype._trans=function(r,s,a){var c=this._tx||H.trans,f=this.name,d=nt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function p(_,A,v){if(!v.schema[f])throw new W.NotFound("Table "+f+" not part of transaction");return s(v.idbtrans,v)}var y=Yt();try{var b=c&&c.db._novip===this.db._novip?c===H.trans?c._promise(r,p,a):vt(function(){return c._promise(r,p,a)},{trans:c,transless:H.transless||H}):function _(A,v,P,w){if(A.idbdb&&(A._state.openComplete||H.letThrough||A._vip)){var E=A._createTransaction(v,P,A._dbSchema);try{E.create(),A._state.PR1398_maxLoop=3}catch(O){return O.name===Gr.InvalidState&&A.isOpen()&&0<--A._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),A.close({disableAutoOpen:!1}),A.open().then(function(){return _(A,v,P,w)})):Ae(O)}return E._promise(v,function(O,x){return vt(function(){return H.trans=E,w(O,x,E)})}).then(function(O){if(v==="readwrite")try{E.idbtrans.commit()}catch{}return v==="readonly"?O:E._completion.then(function(){return O})})}if(A._state.openComplete)return Ae(new W.DatabaseClosed(A._state.dbOpenError));if(!A._state.isBeingOpened){if(!A._state.autoOpen)return Ae(new W.DatabaseClosed);A.open().catch(ve)}return A._state.dbReadyPromise.then(function(){return _(A,v,P,w)})}(this.db,r,[this.name],p);return d&&(b._consoleTask=d,b=b.catch(function(_){return console.trace(_),Ae(_)})),b}finally{y&&Xt()}},we.prototype.get=function(r,s){var a=this;return r&&r.constructor===Object?this.where(r).first(s):r==null?Ae(new W.Type("Invalid argument to Table.get()")):this._trans("readonly",function(c){return a.core.get({trans:c,key:r}).then(function(f){return a.hook.reading.fire(f)})}).then(s)},we.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(h(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var s=l(r);if(s.length===1)return this.where(s[0]).equals(r[s[0]]);var a=this.schema.indexes.concat(this.schema.primKey).filter(function(y){if(y.compound&&s.every(function(_){return 0<=y.keyPath.indexOf(_)})){for(var b=0;b<s.length;++b)if(s.indexOf(y.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(y,b){return y.keyPath.length-b.keyPath.length})[0];if(a&&this.db._maxKey!==Kt){var d=a.keyPath.slice(0,s.length);return this.where(d).equals(d.map(function(b){return r[b]}))}!a&&nt&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var c=this.schema.idxByName;function f(y,b){return fe(y,b)===0}var p=s.reduce(function(v,b){var _=v[0],A=v[1],v=c[b],P=r[b];return[_||v,_||!v?Dt(A,v&&v.multi?function(w){return w=xe(w,b),h(w)&&w.some(function(E){return f(P,E)})}:function(w){return f(P,xe(w,b))}):A]},[null,null]),d=p[0],p=p[1];return d?this.where(d.name).equals(r[d.keyPath]).filter(p):a?this.filter(p):this.where(s).equals("")},we.prototype.filter=function(r){return this.toCollection().and(r)},we.prototype.count=function(r){return this.toCollection().count(r)},we.prototype.offset=function(r){return this.toCollection().offset(r)},we.prototype.limit=function(r){return this.toCollection().limit(r)},we.prototype.each=function(r){return this.toCollection().each(r)},we.prototype.toArray=function(r){return this.toCollection().toArray(r)},we.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},we.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,h(r)?"[".concat(r.join("+"),"]"):r))},we.prototype.reverse=function(){return this.toCollection().reverse()},we.prototype.mapToClass=function(r){var s,a=this.db,c=this.name;function f(){return s!==null&&s.apply(this,arguments)||this}(this.schema.mappedClass=r).prototype instanceof As&&(function(b,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function A(){this.constructor=b}n(b,_),b.prototype=_===null?Object.create(_):(A.prototype=_.prototype,new A)}(f,s=r),Object.defineProperty(f.prototype,"db",{get:function(){return a},enumerable:!1,configurable:!0}),f.prototype.table=function(){return c},r=f);for(var d=new Set,p=r.prototype;p;p=k(p))Object.getOwnPropertyNames(p).forEach(function(b){return d.add(b)});function y(b){if(!b)return b;var _,A=Object.create(r.prototype);for(_ in b)if(!d.has(_))try{A[_]=b[_]}catch{}return A}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=y,this.hook("reading",y),r},we.prototype.defineClass=function(){return this.mapToClass(function(r){m(this,r)})},we.prototype.add=function(r,s){var a=this,c=this.schema.primKey,f=c.auto,d=c.keyPath,p=r;return d&&f&&(p=lr(d)(r)),this._trans("readwrite",function(y){return a.core.mutate({trans:y,type:"add",keys:s!=null?[s]:null,values:[p]})}).then(function(y){return y.numFailures?V.reject(y.failures[0]):y.lastResult}).then(function(y){if(d)try{Ee(r,d,y)}catch{}return y})},we.prototype.update=function(r,s){return typeof r!="object"||h(r)?this.where(":id").equals(r).modify(s):(r=xe(r,this.schema.primKey.keyPath),r===void 0?Ae(new W.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(s))},we.prototype.put=function(r,s){var a=this,c=this.schema.primKey,f=c.auto,d=c.keyPath,p=r;return d&&f&&(p=lr(d)(r)),this._trans("readwrite",function(y){return a.core.mutate({trans:y,type:"put",values:[p],keys:s!=null?[s]:null})}).then(function(y){return y.numFailures?V.reject(y.failures[0]):y.lastResult}).then(function(y){if(d)try{Ee(r,d,y)}catch{}return y})},we.prototype.delete=function(r){var s=this;return this._trans("readwrite",function(a){return s.core.mutate({trans:a,type:"delete",keys:[r]})}).then(function(a){return a.numFailures?V.reject(a.failures[0]):void 0})},we.prototype.clear=function(){var r=this;return this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"deleteRange",range:Es})}).then(function(s){return s.numFailures?V.reject(s.failures[0]):void 0})},we.prototype.bulkGet=function(r){var s=this;return this._trans("readonly",function(a){return s.core.getMany({keys:r,trans:a}).then(function(c){return c.map(function(f){return s.hook.reading.fire(f)})})})},we.prototype.bulkAdd=function(r,s,a){var c=this,f=Array.isArray(s)?s:void 0,d=(a=a||(f?void 0:s))?a.allKeys:void 0;return this._trans("readwrite",function(p){var _=c.schema.primKey,y=_.auto,_=_.keyPath;if(_&&f)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(f&&f.length!==r.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var b=r.length,_=_&&y?r.map(lr(_)):r;return c.core.mutate({trans:p,type:"add",keys:f,values:_,wantResults:d}).then(function(E){var v=E.numFailures,P=E.results,w=E.lastResult,E=E.failures;if(v===0)return d?P:w;throw new Qt("".concat(c.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),E)})})},we.prototype.bulkPut=function(r,s,a){var c=this,f=Array.isArray(s)?s:void 0,d=(a=a||(f?void 0:s))?a.allKeys:void 0;return this._trans("readwrite",function(p){var _=c.schema.primKey,y=_.auto,_=_.keyPath;if(_&&f)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(f&&f.length!==r.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var b=r.length,_=_&&y?r.map(lr(_)):r;return c.core.mutate({trans:p,type:"put",keys:f,values:_,wantResults:d}).then(function(E){var v=E.numFailures,P=E.results,w=E.lastResult,E=E.failures;if(v===0)return d?P:w;throw new Qt("".concat(c.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),E)})})},we.prototype.bulkUpdate=function(r){var s=this,a=this.core,c=r.map(function(p){return p.key}),f=r.map(function(p){return p.changes}),d=[];return this._trans("readwrite",function(p){return a.getMany({trans:p,keys:c,cache:"clone"}).then(function(y){var b=[],_=[];r.forEach(function(v,P){var w=v.key,E=v.changes,O=y[P];if(O){for(var x=0,C=Object.keys(E);x<C.length;x++){var R=C[x],T=E[R];if(R===s.schema.primKey.keyPath){if(fe(T,w)!==0)throw new W.Constraint("Cannot update primary key in bulkUpdate()")}else Ee(O,R,T)}d.push(P),b.push(w),_.push(O)}});var A=b.length;return a.mutate({trans:p,type:"put",keys:b,values:_,updates:{keys:c,changeSpecs:f}}).then(function(v){var P=v.numFailures,w=v.failures;if(P===0)return A;for(var E=0,O=Object.keys(w);E<O.length;E++){var x,C=O[E],R=d[Number(C)];R!=null&&(x=w[C],delete w[C],w[R]=x)}throw new Qt("".concat(s.name,".bulkUpdate(): ").concat(P," of ").concat(A," operations failed"),w)})})})},we.prototype.bulkDelete=function(r){var s=this,a=r.length;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:r})}).then(function(p){var f=p.numFailures,d=p.lastResult,p=p.failures;if(f===0)return d;throw new Qt("".concat(s.name,".bulkDelete(): ").concat(f," of ").concat(a," operations failed"),p)})},we);function we(){}function Cn(r){function s(p,y){if(y){for(var b=arguments.length,_=new Array(b-1);--b;)_[b-1]=arguments[b];return a[p].subscribe.apply(null,_),r}if(typeof p=="string")return a[p]}var a={};s.addEventType=d;for(var c=1,f=arguments.length;c<f;++c)d(arguments[c]);return s;function d(p,y,b){if(typeof p!="object"){var _;y=y||Ea;var A={subscribers:[],fire:b=b||ve,subscribe:function(v){A.subscribers.indexOf(v)===-1&&(A.subscribers.push(v),A.fire=y(A.fire,v))},unsubscribe:function(v){A.subscribers=A.subscribers.filter(function(P){return P!==v}),A.fire=A.subscribers.reduce(y,b)}};return a[p]=s[p]=A}l(_=p).forEach(function(v){var P=_[v];if(h(P))d(v,_[v][0],_[v][1]);else{if(P!=="asap")throw new W.InvalidArgument("Invalid event config");var w=d(v,xn,function(){for(var E=arguments.length,O=new Array(E);E--;)O[E]=arguments[E];w.subscribers.forEach(function(x){me(function(){x.apply(null,O)})})})}})}}function Sn(r,s){return z(s).from({prototype:r}),s}function en(r,s){return!(r.filter||r.algorithm||r.or)&&(s?r.justLimit:!r.replayFilter)}function ii(r,s){r.filter=Dt(r.filter,s)}function si(r,s,a){var c=r.replayFilter;r.replayFilter=c?function(){return Dt(c(),s())}:s,r.justLimit=a&&!c}function hr(r,s){if(r.isPrimKey)return s.primaryKey;var a=s.getIndexByKeyPath(r.index);if(!a)throw new W.Schema("KeyPath "+r.index+" on object store "+s.name+" is not indexed");return a}function Ss(r,s,a){var c=hr(r,s.schema);return s.openCursor({trans:a,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:c,range:r.range}})}function fr(r,s,a,c){var f=r.replayFilter?Dt(r.filter,r.replayFilter()):r.filter;if(r.or){var d={},p=function(y,b,_){var A,v;f&&!f(b,_,function(P){return b.stop(P)},function(P){return b.fail(P)})||((v=""+(A=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(A)),S(d,v)||(d[v]=!0,s(y,b,_)))};return Promise.all([r.or._iterate(p,a),Rs(Ss(r,c,a),r.algorithm,p,!r.keysOnly&&r.valueMapper)])}return Rs(Ss(r,c,a),Dt(r.algorithm,f),s,!r.keysOnly&&r.valueMapper)}function Rs(r,s,a,c){var f=_e(c?function(d,p,y){return a(c(d),p,y)}:a);return r.then(function(d){if(d)return d.start(function(){var p=function(){return d.continue()};s&&!s(d,function(y){return p=y},function(y){d.stop(y),p=ve},function(y){d.fail(y),p=ve})||f(d.value,d,function(y){return p=y}),p()})})}var ft=Symbol(),Rn=(Ts.prototype.execute=function(r){if(this.add!==void 0){var s=this.add;if(h(s))return o(o([],h(r)?r:[],!0),s,!0).sort();if(typeof s=="number")return(Number(r)||0)+s;if(typeof s=="bigint")try{return BigInt(r)+s}catch{return BigInt(0)+s}throw new TypeError("Invalid term ".concat(s))}if(this.remove!==void 0){var a=this.remove;if(h(a))return h(r)?r.filter(function(c){return!a.includes(c)}).sort():[];if(typeof a=="number")return Number(r)-a;if(typeof a=="bigint")try{return BigInt(r)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return s=(s=this.replacePrefix)===null||s===void 0?void 0:s[0],s&&typeof r=="string"&&r.startsWith(s)?this.replacePrefix[1]+r.substring(s.length):r},Ts);function Ts(r){Object.assign(this,r)}var Ra=(pe.prototype._read=function(r,s){var a=this._ctx;return a.error?a.table._trans(null,Ae.bind(null,a.error)):a.table._trans("readonly",r).then(s)},pe.prototype._write=function(r){var s=this._ctx;return s.error?s.table._trans(null,Ae.bind(null,s.error)):s.table._trans("readwrite",r,"locked")},pe.prototype._addAlgorithm=function(r){var s=this._ctx;s.algorithm=Dt(s.algorithm,r)},pe.prototype._iterate=function(r,s){return fr(this._ctx,r,s,this._ctx.table.core)},pe.prototype.clone=function(r){var s=Object.create(this.constructor.prototype),a=Object.create(this._ctx);return r&&m(a,r),s._ctx=a,s},pe.prototype.raw=function(){return this._ctx.valueMapper=null,this},pe.prototype.each=function(r){var s=this._ctx;return this._read(function(a){return fr(s,r,a,s.table.core)})},pe.prototype.count=function(r){var s=this;return this._read(function(a){var c=s._ctx,f=c.table.core;if(en(c,!0))return f.count({trans:a,query:{index:hr(c,f.schema),range:c.range}}).then(function(p){return Math.min(p,c.limit)});var d=0;return fr(c,function(){return++d,!1},a,f).then(function(){return d})}).then(r)},pe.prototype.sortBy=function(r,s){var a=r.split(".").reverse(),c=a[0],f=a.length-1;function d(b,_){return _?d(b[a[_]],_-1):b[c]}var p=this._ctx.dir==="next"?1:-1;function y(b,_){return fe(d(b,f),d(_,f))*p}return this.toArray(function(b){return b.sort(y)}).then(s)},pe.prototype.toArray=function(r){var s=this;return this._read(function(a){var c=s._ctx;if(c.dir==="next"&&en(c,!0)&&0<c.limit){var f=c.valueMapper,d=hr(c,c.table.core.schema);return c.table.core.query({trans:a,limit:c.limit,values:!0,query:{index:d,range:c.range}}).then(function(y){return y=y.result,f?y.map(f):y})}var p=[];return fr(c,function(y){return p.push(y)},a,c.table.core).then(function(){return p})},r)},pe.prototype.offset=function(r){var s=this._ctx;return r<=0||(s.offset+=r,en(s)?si(s,function(){var a=r;return function(c,f){return a===0||(a===1?--a:f(function(){c.advance(a),a=0}),!1)}}):si(s,function(){var a=r;return function(){return--a<0}})),this},pe.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),si(this._ctx,function(){var s=r;return function(a,c,f){return--s<=0&&c(f),0<=s}},!0),this},pe.prototype.until=function(r,s){return ii(this._ctx,function(a,c,f){return!r(a.value)||(c(f),s)}),this},pe.prototype.first=function(r){return this.limit(1).toArray(function(s){return s[0]}).then(r)},pe.prototype.last=function(r){return this.reverse().first(r)},pe.prototype.filter=function(r){var s;return ii(this._ctx,function(a){return r(a.value)}),(s=this._ctx).isMatch=Dt(s.isMatch,r),this},pe.prototype.and=function(r){return this.filter(r)},pe.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},pe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},pe.prototype.desc=function(){return this.reverse()},pe.prototype.eachKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(a,c){r(c.key,c)})},pe.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},pe.prototype.eachPrimaryKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(a,c){r(c.primaryKey,c)})},pe.prototype.keys=function(r){var s=this._ctx;s.keysOnly=!s.isMatch;var a=[];return this.each(function(c,f){a.push(f.key)}).then(function(){return a}).then(r)},pe.prototype.primaryKeys=function(r){var s=this._ctx;if(s.dir==="next"&&en(s,!0)&&0<s.limit)return this._read(function(c){var f=hr(s,s.table.core.schema);return s.table.core.query({trans:c,values:!1,limit:s.limit,query:{index:f,range:s.range}})}).then(function(c){return c.result}).then(r);s.keysOnly=!s.isMatch;var a=[];return this.each(function(c,f){a.push(f.primaryKey)}).then(function(){return a}).then(r)},pe.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},pe.prototype.firstKey=function(r){return this.limit(1).keys(function(s){return s[0]}).then(r)},pe.prototype.lastKey=function(r){return this.reverse().firstKey(r)},pe.prototype.distinct=function(){var r=this._ctx,r=r.index&&r.table.schema.idxByName[r.index];if(!r||!r.multi)return this;var s={};return ii(this._ctx,function(f){var c=f.primaryKey.toString(),f=S(s,c);return s[c]=!0,!f}),this},pe.prototype.modify=function(r){var s=this,a=this._ctx;return this._write(function(c){var f,d,p;p=typeof r=="function"?r:(f=l(r),d=f.length,function(x){for(var C=!1,R=0;R<d;++R){var T=f[R],M=r[T],I=xe(x,T);M instanceof Rn?(Ee(x,T,M.execute(I)),C=!0):I!==M&&(Ee(x,T,M),C=!0)}return C});function y(x,T){var R=T.failures,T=T.numFailures;E+=x-T;for(var M=0,I=l(R);M<I.length;M++){var $=I[M];w.push(R[$])}}var b=a.table.core,_=b.schema.primaryKey,A=_.outbound,v=_.extractKey,P=s.db._options.modifyChunkSize||200,w=[],E=0,O=[];return s.clone().primaryKeys().then(function(x){function C(T){var M=Math.min(P,x.length-T);return b.getMany({trans:c,keys:x.slice(T,T+M),cache:"immutable"}).then(function(I){for(var $=[],j=[],B=A?[]:null,F=[],q=0;q<M;++q){var G=I[q],te={value:He(G),primKey:x[T+q]};p.call(te,te.value,te)!==!1&&(te.value==null?F.push(x[T+q]):A||fe(v(G),v(te.value))===0?(j.push(te.value),A&&B.push(x[T+q])):(F.push(x[T+q]),$.push(te.value)))}return Promise.resolve(0<$.length&&b.mutate({trans:c,type:"add",values:$}).then(function(ue){for(var se in ue.failures)F.splice(parseInt(se),1);y($.length,ue)})).then(function(){return(0<j.length||R&&typeof r=="object")&&b.mutate({trans:c,type:"put",keys:B,values:j,criteria:R,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<T}).then(function(ue){return y(j.length,ue)})}).then(function(){return(0<F.length||R&&r===oi)&&b.mutate({trans:c,type:"delete",keys:F,criteria:R,isAdditionalChunk:0<T}).then(function(ue){return y(F.length,ue)})}).then(function(){return x.length>T+M&&C(T+P)})})}var R=en(a)&&a.limit===1/0&&(typeof r!="function"||r===oi)&&{index:a.index,range:a.range};return C(0).then(function(){if(0<w.length)throw new Zn("Error modifying one or more objects",w,E,O);return x.length})})})},pe.prototype.delete=function(){var r=this._ctx,s=r.range;return en(r)&&(r.isPrimKey||s.type===3)?this._write(function(a){var c=r.table.core.schema.primaryKey,f=s;return r.table.core.count({trans:a,query:{index:c,range:f}}).then(function(d){return r.table.core.mutate({trans:a,type:"deleteRange",range:f}).then(function(p){var y=p.failures;if(p.lastResult,p.results,p=p.numFailures,p)throw new Zn("Could not delete some values",Object.keys(y).map(function(b){return y[b]}),d-p);return d-p})})}):this.modify(oi)},pe);function pe(){}var oi=function(r,s){return s.value=null};function Ta(r,s){return r<s?-1:r===s?0:1}function Ma(r,s){return s<r?-1:r===s?0:1}function Ue(r,s,a){return r=r instanceof Ns?new r.Collection(r):r,r._ctx.error=new(a||TypeError)(s),r}function tn(r){return new r.Collection(r,function(){return Ms("")}).limit(0)}function dr(r,s,a,c){var f,d,p,y,b,_,A,v=a.length;if(!a.every(function(E){return typeof E=="string"}))return Ue(r,xs);function P(E){f=E==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},d=E==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},p=E==="next"?Ta:Ma;var O=a.map(function(x){return{lower:d(x),upper:f(x)}}).sort(function(x,C){return p(x.lower,C.lower)});y=O.map(function(x){return x.upper}),b=O.map(function(x){return x.lower}),A=(_=E)==="next"?"":c}P("next"),r=new r.Collection(r,function(){return _t(y[0],b[v-1]+c)}),r._ondirectionchange=function(E){P(E)};var w=0;return r._addAlgorithm(function(E,O,x){var C=E.key;if(typeof C!="string")return!1;var R=d(C);if(s(R,b,w))return!0;for(var T=null,M=w;M<v;++M){var I=function($,j,B,F,q,G){for(var te=Math.min($.length,F.length),ue=-1,se=0;se<te;++se){var We=j[se];if(We!==F[se])return q($[se],B[se])<0?$.substr(0,se)+B[se]+B.substr(se+1):q($[se],F[se])<0?$.substr(0,se)+F[se]+B.substr(se+1):0<=ue?$.substr(0,ue)+j[ue]+B.substr(ue+1):null;q($[se],We)<0&&(ue=se)}return te<F.length&&G==="next"?$+B.substr($.length):te<$.length&&G==="prev"?$.substr(0,B.length):ue<0?null:$.substr(0,ue)+F[ue]+B.substr(ue+1)}(C,R,y[M],b[M],p,_);I===null&&T===null?w=M+1:(T===null||0<p(T,I))&&(T=I)}return O(T!==null?function(){E.continue(T+A)}:x),!1}),r}function _t(r,s,a,c){return{type:2,lower:r,upper:s,lowerOpen:a,upperOpen:c}}function Ms(r){return{type:1,lower:r,upper:r}}var Ns=(Object.defineProperty(Te.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Te.prototype.between=function(r,s,a,c){a=a!==!1,c=c===!0;try{return 0<this._cmp(r,s)||this._cmp(r,s)===0&&(a||c)&&(!a||!c)?tn(this):new this.Collection(this,function(){return _t(r,s,!a,!c)})}catch{return Ue(this,ht)}},Te.prototype.equals=function(r){return r==null?Ue(this,ht):new this.Collection(this,function(){return Ms(r)})},Te.prototype.above=function(r){return r==null?Ue(this,ht):new this.Collection(this,function(){return _t(r,void 0,!0)})},Te.prototype.aboveOrEqual=function(r){return r==null?Ue(this,ht):new this.Collection(this,function(){return _t(r,void 0,!1)})},Te.prototype.below=function(r){return r==null?Ue(this,ht):new this.Collection(this,function(){return _t(void 0,r,!1,!0)})},Te.prototype.belowOrEqual=function(r){return r==null?Ue(this,ht):new this.Collection(this,function(){return _t(void 0,r)})},Te.prototype.startsWith=function(r){return typeof r!="string"?Ue(this,xs):this.between(r,r+Kt,!0,!0)},Te.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):dr(this,function(s,a){return s.indexOf(a[0])===0},[r],Kt)},Te.prototype.equalsIgnoreCase=function(r){return dr(this,function(s,a){return s===a[0]},[r],"")},Te.prototype.anyOfIgnoreCase=function(){var r=lt.apply(yt,arguments);return r.length===0?tn(this):dr(this,function(s,a){return a.indexOf(s)!==-1},r,"")},Te.prototype.startsWithAnyOfIgnoreCase=function(){var r=lt.apply(yt,arguments);return r.length===0?tn(this):dr(this,function(s,a){return a.some(function(c){return s.indexOf(c)===0})},r,Kt)},Te.prototype.anyOf=function(){var r=this,s=lt.apply(yt,arguments),a=this._cmp;try{s.sort(a)}catch{return Ue(this,ht)}if(s.length===0)return tn(this);var c=new this.Collection(this,function(){return _t(s[0],s[s.length-1])});c._ondirectionchange=function(d){a=d==="next"?r._ascending:r._descending,s.sort(a)};var f=0;return c._addAlgorithm(function(d,p,y){for(var b=d.key;0<a(b,s[f]);)if(++f===s.length)return p(y),!1;return a(b,s[f])===0||(p(function(){d.continue(s[f])}),!1)}),c},Te.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Te.prototype.noneOf=function(){var r=lt.apply(yt,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return Ue(this,ht)}var s=r.reduce(function(a,c){return a?a.concat([[a[a.length-1][1],c]]):[[-1/0,c]]},null);return s.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},Te.prototype.inAnyRange=function(C,s){var a=this,c=this._cmp,f=this._ascending,d=this._descending,p=this._min,y=this._max;if(C.length===0)return tn(this);if(!C.every(function(R){return R[0]!==void 0&&R[1]!==void 0&&f(R[0],R[1])<=0}))return Ue(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);var b=!s||s.includeLowers!==!1,_=s&&s.includeUppers===!0,A,v=f;function P(R,T){return v(R[0],T[0])}try{(A=C.reduce(function(R,T){for(var M=0,I=R.length;M<I;++M){var $=R[M];if(c(T[0],$[1])<0&&0<c(T[1],$[0])){$[0]=p($[0],T[0]),$[1]=y($[1],T[1]);break}}return M===I&&R.push(T),R},[])).sort(P)}catch{return Ue(this,ht)}var w=0,E=_?function(R){return 0<f(R,A[w][1])}:function(R){return 0<=f(R,A[w][1])},O=b?function(R){return 0<d(R,A[w][0])}:function(R){return 0<=d(R,A[w][0])},x=E,C=new this.Collection(this,function(){return _t(A[0][0],A[A.length-1][1],!b,!_)});return C._ondirectionchange=function(R){v=R==="next"?(x=E,f):(x=O,d),A.sort(P)},C._addAlgorithm(function(R,T,M){for(var I,$=R.key;x($);)if(++w===A.length)return T(M),!1;return!E(I=$)&&!O(I)||(a._cmp($,A[w][1])===0||a._cmp($,A[w][0])===0||T(function(){v===f?R.continue(A[w][0]):R.continue(A[w][1])}),!1)}),C},Te.prototype.startsWithAnyOf=function(){var r=lt.apply(yt,arguments);return r.every(function(s){return typeof s=="string"})?r.length===0?tn(this):this.inAnyRange(r.map(function(s){return[s,s+Kt]})):Ue(this,"startsWithAnyOf() only works with strings")},Te);function Te(){}function rt(r){return _e(function(s){return Tn(s),r(s.target.error),!1})}function Tn(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var Mn="storagemutated",ai="x-storagemutated-1",kt=Cn(null,Mn),Na=(it.prototype._lock=function(){return ce(!H.global),++this._reculock,this._reculock!==1||H.global||(H.lockOwnerFor=this),this},it.prototype._unlock=function(){if(ce(!H.global),--this._reculock==0)for(H.global||(H.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Nt(r[1],r[0])}catch{}}return this},it.prototype._locked=function(){return this._reculock&&H.lockOwnerFor!==this},it.prototype.create=function(r){var s=this;if(!this.mode)return this;var a=this.db.idbdb,c=this.db._state.dbOpenError;if(ce(!this.idbtrans),!r&&!a)switch(c&&c.name){case"DatabaseClosedError":throw new W.DatabaseClosed(c);case"MissingAPIError":throw new W.MissingAPI(c.message,c);default:throw new W.OpenFailed(c)}if(!this.active)throw new W.TransactionInactive;return ce(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||a).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=_e(function(f){Tn(f),s._reject(r.error)}),r.onabort=_e(function(f){Tn(f),s.active&&s._reject(new W.Abort(r.error)),s.active=!1,s.on("abort").fire(f)}),r.oncomplete=_e(function(){s.active=!1,s._resolve(),"mutatedParts"in r&&kt.storagemutated.fire(r.mutatedParts)}),this},it.prototype._promise=function(r,s,a){var c=this;if(r==="readwrite"&&this.mode!=="readwrite")return Ae(new W.ReadOnly("Transaction is readonly"));if(!this.active)return Ae(new W.TransactionInactive);if(this._locked())return new V(function(d,p){c._blockedFuncs.push([function(){c._promise(r,s,a).then(d,p)},H])});if(a)return vt(function(){var d=new V(function(p,y){c._lock();var b=s(p,y,c);b&&b.then&&b.then(p,y)});return d.finally(function(){return c._unlock()}),d._lib=!0,d});var f=new V(function(d,p){var y=s(d,p,c);y&&y.then&&y.then(d,p)});return f._lib=!0,f},it.prototype._root=function(){return this.parent?this.parent._root():this},it.prototype.waitFor=function(r){var s,a=this._root(),c=V.resolve(r);a._waitingFor?a._waitingFor=a._waitingFor.then(function(){return c}):(a._waitingFor=c,a._waitingQueue=[],s=a.idbtrans.objectStore(a.storeNames[0]),function d(){for(++a._spinCount;a._waitingQueue.length;)a._waitingQueue.shift()();a._waitingFor&&(s.get(-1/0).onsuccess=d)}());var f=a._waitingFor;return new V(function(d,p){c.then(function(y){return a._waitingQueue.push(_e(d.bind(null,y)))},function(y){return a._waitingQueue.push(_e(p.bind(null,y)))}).finally(function(){a._waitingFor===f&&(a._waitingFor=null)})})},it.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))},it.prototype.table=function(r){var s=this._memoizedTables||(this._memoizedTables={});if(S(s,r))return s[r];var a=this.schema[r];if(!a)throw new W.NotFound("Table "+r+" not part of transaction");return a=new this.db.Table(r,a,this),a.core=this.db.core.table(r),s[r]=a},it);function it(){}function ui(r,s,a,c,f,d,p){return{name:r,keyPath:s,unique:a,multi:c,auto:f,compound:d,src:(a&&!p?"&":"")+(c?"*":"")+(f?"++":"")+Ks(s)}}function Ks(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function ci(r,s,a){return{name:r,primKey:s,indexes:a,mappedClass:null,idxByName:(c=function(f){return[f.name,f]},a.reduce(function(f,d,p){return p=c(d,p),p&&(f[p[0]]=p[1]),f},{}))};var c}var Nn=function(r){try{return r.only([[]]),Nn=function(){return[[]]},[[]]}catch{return Nn=function(){return Kt},Kt}};function li(r){return r==null?function(){}:typeof r=="string"?(s=r).split(".").length===1?function(a){return a[s]}:function(a){return xe(a,s)}:function(a){return xe(a,r)};var s}function Ds(r){return[].slice.call(r)}var Ka=0;function Kn(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Da(r,s,b){function c(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=x.lower,E=x.upper,O=x.lowerOpen,x=x.upperOpen;return w===void 0?E===void 0?null:s.upperBound(E,!!x):E===void 0?s.lowerBound(w,!!O):s.bound(w,E,!!O,!!x)}function f(P){var w,E=P.name;return{name:E,schema:P,mutate:function(O){var x=O.trans,C=O.type,R=O.keys,T=O.values,M=O.range;return new Promise(function(I,$){I=_e(I);var j=x.objectStore(E),B=j.keyPath==null,F=C==="put"||C==="add";if(!F&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var q,G=(R||T||{length:1}).length;if(R&&T&&R.length!==T.length)throw new Error("Given keys array must have same length as given values array.");if(G===0)return I({numFailures:0,failures:{},results:[],lastResult:void 0});function te(Le){++We,Tn(Le)}var ue=[],se=[],We=0;if(C==="deleteRange"){if(M.type===4)return I({numFailures:We,failures:se,results:[],lastResult:void 0});M.type===3?ue.push(q=j.clear()):ue.push(q=j.delete(c(M)))}else{var B=F?B?[T,R]:[T,null]:[R,null],oe=B[0],Ie=B[1];if(F)for(var je=0;je<G;++je)ue.push(q=Ie&&Ie[je]!==void 0?j[C](oe[je],Ie[je]):j[C](oe[je])),q.onerror=te;else for(je=0;je<G;++je)ue.push(q=j[C](oe[je])),q.onerror=te}function Or(Le){Le=Le.target.result,ue.forEach(function(Bt,Ci){return Bt.error!=null&&(se[Ci]=Bt.error)}),I({numFailures:We,failures:se,results:C==="delete"?R:ue.map(function(Bt){return Bt.result}),lastResult:Le})}q.onerror=function(Le){te(Le),Or(Le)},q.onsuccess=Or})},getMany:function(O){var x=O.trans,C=O.keys;return new Promise(function(R,T){R=_e(R);for(var M,I=x.objectStore(E),$=C.length,j=new Array($),B=0,F=0,q=function(ue){ue=ue.target,j[ue._pos]=ue.result,++F===B&&R(j)},G=rt(T),te=0;te<$;++te)C[te]!=null&&((M=I.get(C[te]))._pos=te,M.onsuccess=q,M.onerror=G,++B);B===0&&R(j)})},get:function(O){var x=O.trans,C=O.key;return new Promise(function(R,T){R=_e(R);var M=x.objectStore(E).get(C);M.onsuccess=function(I){return R(I.target.result)},M.onerror=rt(T)})},query:(w=_,function(O){return new Promise(function(x,C){x=_e(x);var R,T,M,B=O.trans,I=O.values,$=O.limit,q=O.query,j=$===1/0?void 0:$,F=q.index,q=q.range,B=B.objectStore(E),F=F.isPrimaryKey?B:B.index(F.name),q=c(q);if($===0)return x({result:[]});w?((j=I?F.getAll(q,j):F.getAllKeys(q,j)).onsuccess=function(G){return x({result:G.target.result})},j.onerror=rt(C)):(R=0,T=!I&&"openKeyCursor"in F?F.openKeyCursor(q):F.openCursor(q),M=[],T.onsuccess=function(G){var te=T.result;return te?(M.push(I?te.value:te.primaryKey),++R===$?x({result:M}):void te.continue()):x({result:M})},T.onerror=rt(C))})}),openCursor:function(O){var x=O.trans,C=O.values,R=O.query,T=O.reverse,M=O.unique;return new Promise(function(I,$){I=_e(I);var F=R.index,j=R.range,B=x.objectStore(E),B=F.isPrimaryKey?B:B.index(F.name),F=T?M?"prevunique":"prev":M?"nextunique":"next",q=!C&&"openKeyCursor"in B?B.openKeyCursor(c(j),F):B.openCursor(c(j),F);q.onerror=rt($),q.onsuccess=_e(function(G){var te,ue,se,We,oe=q.result;oe?(oe.___id=++Ka,oe.done=!1,te=oe.continue.bind(oe),ue=(ue=oe.continuePrimaryKey)&&ue.bind(oe),se=oe.advance.bind(oe),We=function(){throw new Error("Cursor not stopped")},oe.trans=x,oe.stop=oe.continue=oe.continuePrimaryKey=oe.advance=function(){throw new Error("Cursor not started")},oe.fail=_e($),oe.next=function(){var Ie=this,je=1;return this.start(function(){return je--?Ie.continue():Ie.stop()}).then(function(){return Ie})},oe.start=function(Ie){function je(){if(q.result)try{Ie()}catch(Le){oe.fail(Le)}else oe.done=!0,oe.start=function(){throw new Error("Cursor behind last entry")},oe.stop()}var Or=new Promise(function(Le,Bt){Le=_e(Le),q.onerror=rt(Bt),oe.fail=Bt,oe.stop=function(Ci){oe.stop=oe.continue=oe.continuePrimaryKey=oe.advance=We,Le(Ci)}});return q.onsuccess=_e(function(Le){q.onsuccess=je,je()}),oe.continue=te,oe.continuePrimaryKey=ue,oe.advance=se,je(),Or},I(oe)):I(null)},$)})},count:function(O){var x=O.query,C=O.trans,R=x.index,T=x.range;return new Promise(function(M,I){var $=C.objectStore(E),j=R.isPrimaryKey?$:$.index(R.name),$=c(T),j=$?j.count($):j.count();j.onsuccess=_e(function(B){return M(B.target.result)}),j.onerror=rt(I)})}}}var d,p,y,A=(p=b,y=Ds((d=r).objectStoreNames),{schema:{name:d.name,tables:y.map(function(P){return p.objectStore(P)}).map(function(P){var w=P.keyPath,x=P.autoIncrement,E=h(w),O={},x={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w==null,compound:E,keyPath:w,autoIncrement:x,unique:!0,extractKey:li(w)},indexes:Ds(P.indexNames).map(function(C){return P.index(C)}).map(function(M){var R=M.name,T=M.unique,I=M.multiEntry,M=M.keyPath,I={name:R,compound:h(M),keyPath:M,unique:T,multiEntry:I,extractKey:li(M)};return O[Kn(M)]=I}),getIndexByKeyPath:function(C){return O[Kn(C)]}};return O[":id"]=x.primaryKey,w!=null&&(O[Kn(w)]=x.primaryKey),x})},hasGetAll:0<y.length&&"getAll"in p.objectStore(y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=A.schema,_=A.hasGetAll,A=b.tables.map(f),v={};return A.forEach(function(P){return v[P.name]=P}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(P){if(!v[P])throw new Error("Table '".concat(P,"' not found"));return v[P]},MIN_KEY:-1/0,MAX_KEY:Nn(s),schema:b}}function Ia(r,s,a,c){var f=a.IDBKeyRange;return a.indexedDB,{dbcore:(c=Da(s,f,c),r.dbcore.reduce(function(d,p){return p=p.create,i(i({},d),p(d))},c))}}function pr(r,c){var a=c.db,c=Ia(r._middlewares,a,r._deps,c);r.core=c.dbcore,r.tables.forEach(function(f){var d=f.name;r.core.schema.tables.some(function(p){return p.name===d})&&(f.core=r.core.table(d),r[d]instanceof r.Table&&(r[d].core=f.core))})}function mr(r,s,a,c){a.forEach(function(f){var d=c[f];s.forEach(function(p){var y=function b(_,A){return Q(_,A)||(_=k(_))&&b(_,A)}(p,f);(!y||"value"in y&&y.value===void 0)&&(p===r.Transaction.prototype||p instanceof r.Transaction?D(p,f,{get:function(){return this.table(f)},set:function(b){L(this,f,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):p[f]=new r.Table(f,d))})})}function hi(r,s){s.forEach(function(a){for(var c in a)a[c]instanceof r.Table&&delete a[c]})}function ja(r,s){return r._cfg.version-s._cfg.version}function Ba(r,s,a,c){var f=r._dbSchema;a.objectStoreNames.contains("$meta")&&!f.$meta&&(f.$meta=ci("$meta",js("")[0],[]),r._storeNames.push("$meta"));var d=r._createTransaction("readwrite",r._storeNames,f);d.create(a),d._completion.catch(c);var p=d._reject.bind(d),y=H.transless||H;vt(function(){return H.trans=d,H.transless=y,s!==0?(pr(r,a),_=s,((b=d).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(A){return A??_}):V.resolve(_)).then(function(A){return P=A,w=d,E=a,O=[],A=(v=r)._versions,x=v._dbSchema=gr(0,v.idbdb,E),(A=A.filter(function(C){return C._cfg.version>=P})).length!==0?(A.forEach(function(C){O.push(function(){var R=x,T=C._cfg.dbschema;vr(v,R,E),vr(v,T,E),x=v._dbSchema=T;var M=fi(R,T);M.add.forEach(function(F){di(E,F[0],F[1].primKey,F[1].indexes)}),M.change.forEach(function(F){if(F.recreate)throw new W.Upgrade("Not yet support for changing primary key");var q=E.objectStore(F.name);F.add.forEach(function(G){return yr(q,G)}),F.change.forEach(function(G){q.deleteIndex(G.name),yr(q,G)}),F.del.forEach(function(G){return q.deleteIndex(G)})});var I=C._cfg.contentUpgrade;if(I&&C._cfg.version>P){pr(v,E),w._memoizedTables={};var $=Ge(T);M.del.forEach(function(F){$[F]=R[F]}),hi(v,[v.Transaction.prototype]),mr(v,[v.Transaction.prototype],l($),$),w.schema=$;var j,B=zr(I);return B&&Jt(),M=V.follow(function(){var F;(j=I(w))&&B&&(F=bt.bind(null,null),j.then(F,F))}),j&&typeof j.then=="function"?V.resolve(j):M.then(function(){return j})}}),O.push(function(R){var T,M,I=C._cfg.dbschema;T=I,M=R,[].slice.call(M.db.objectStoreNames).forEach(function($){return T[$]==null&&M.db.deleteObjectStore($)}),hi(v,[v.Transaction.prototype]),mr(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),w.schema=v._dbSchema}),O.push(function(R){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===C._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(T){return T!=="$meta"})):R.objectStore("$meta").put(C._cfg.version,"version"))})}),function C(){return O.length?V.resolve(O.shift()(w.idbtrans)).then(C):V.resolve()}().then(function(){Is(x,E)})):V.resolve();var v,P,w,E,O,x}).catch(p)):(l(f).forEach(function(A){di(a,A,f[A].primKey,f[A].indexes)}),pr(r,a),void V.follow(function(){return r.on.populate.fire(d)}).catch(p));var b,_})}function La(r,s){Is(r._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var a=gr(0,r.idbdb,s);vr(r,r._dbSchema,s);for(var c=0,f=fi(a,r._dbSchema).change;c<f.length;c++){var d=function(p){if(p.change.length||p.recreate)return console.warn("Unable to patch indexes of table ".concat(p.name," because it has changes on the type of index or primary key.")),{value:void 0};var y=s.objectStore(p.name);p.add.forEach(function(b){nt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(p.name,".").concat(b.src)),yr(y,b)})}(f[c]);if(typeof d=="object")return d.value}}function fi(r,s){var a,c={del:[],add:[],change:[]};for(a in r)s[a]||c.del.push(a);for(a in s){var f=r[a],d=s[a];if(f){var p={name:a,def:d,recreate:!1,del:[],add:[],change:[]};if(""+(f.primKey.keyPath||"")!=""+(d.primKey.keyPath||"")||f.primKey.auto!==d.primKey.auto)p.recreate=!0,c.change.push(p);else{var y=f.idxByName,b=d.idxByName,_=void 0;for(_ in y)b[_]||p.del.push(_);for(_ in b){var A=y[_],v=b[_];A?A.src!==v.src&&p.change.push(v):p.add.push(v)}(0<p.del.length||0<p.add.length||0<p.change.length)&&c.change.push(p)}}else c.add.push([a,d])}return c}function di(r,s,a,c){var f=r.db.createObjectStore(s,a.keyPath?{keyPath:a.keyPath,autoIncrement:a.auto}:{autoIncrement:a.auto});return c.forEach(function(d){return yr(f,d)}),f}function Is(r,s){l(r).forEach(function(a){s.db.objectStoreNames.contains(a)||(nt&&console.debug("Dexie: Creating missing table",a),di(s,a,r[a].primKey,r[a].indexes))})}function yr(r,s){r.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function gr(r,s,a){var c={};return he(s.objectStoreNames,0).forEach(function(f){for(var d=a.objectStore(f),p=ui(Ks(_=d.keyPath),_||"",!0,!1,!!d.autoIncrement,_&&typeof _!="string",!0),y=[],b=0;b<d.indexNames.length;++b){var A=d.index(d.indexNames[b]),_=A.keyPath,A=ui(A.name,_,!!A.unique,!!A.multiEntry,!1,_&&typeof _!="string",!1);y.push(A)}c[f]=ci(f,p,y)}),c}function vr(r,s,a){for(var c=a.db.objectStoreNames,f=0;f<c.length;++f){var d=c[f],p=a.objectStore(d);r._hasGetAll="getAll"in p;for(var y=0;y<p.indexNames.length;++y){var b=p.indexNames[y],_=p.index(b).keyPath,A=typeof _=="string"?_:"["+he(_).join("+")+"]";!s[d]||(_=s[d].idxByName[A])&&(_.name=b,delete s[d].idxByName[A],s[d].idxByName[b]=_)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function js(r){return r.split(",").map(function(s,a){var c=(s=s.trim()).replace(/([&*]|\+\+)/g,""),f=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return ui(c,f||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),h(f),a===0)})}var $a=(br.prototype._parseStoresSpec=function(r,s){l(r).forEach(function(a){if(r[a]!==null){var c=js(r[a]),f=c.shift();if(f.unique=!0,f.multi)throw new W.Schema("Primary key cannot be multi-valued");c.forEach(function(d){if(d.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),s[a]=ci(a,f,c)}})},br.prototype.stores=function(a){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?m(this._cfg.storesSource,a):a;var a=s._versions,c={},f={};return a.forEach(function(d){m(c,d._cfg.storesSource),f=d._cfg.dbschema={},d._parseStoresSpec(c,f)}),s._dbSchema=f,hi(s,[s._allTables,s,s.Transaction.prototype]),mr(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],l(f),f),s._storeNames=l(f),this},br.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Hr(this._cfg.contentUpgrade||ve,r),this},br);function br(){}function pi(r,s){var a=r._dbNamesDB;return a||(a=r._dbNamesDB=new dt(cr,{addons:[],indexedDB:r,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),a.table("dbnames")}function mi(r){return r&&typeof r.databases=="function"}function yi(r){return vt(function(){return H.letThrough=!0,r()})}function gi(r){return!("from"in r)}var De=function(r,s){if(!this){var a=new De;return r&&"d"in r&&m(a,r),a}m(this,arguments.length?{d:1,from:r,to:1<arguments.length?s:r}:{d:0})};function Dn(r,s,a){var c=fe(s,a);if(!isNaN(c)){if(0<c)throw RangeError();if(gi(r))return m(r,{from:s,to:a,d:1});var f=r.l,c=r.r;if(fe(a,r.from)<0)return f?Dn(f,s,a):r.l={from:s,to:a,d:1,l:null,r:null},Ls(r);if(0<fe(s,r.to))return c?Dn(c,s,a):r.r={from:s,to:a,d:1,l:null,r:null},Ls(r);fe(s,r.from)<0&&(r.from=s,r.l=null,r.d=c?c.d+1:1),0<fe(a,r.to)&&(r.to=a,r.r=null,r.d=r.l?r.l.d+1:1),a=!r.r,f&&!r.l&&In(r,f),c&&a&&In(r,c)}}function In(r,s){gi(s)||function a(c,b){var d=b.from,p=b.to,y=b.l,b=b.r;Dn(c,d,p),y&&a(c,y),b&&a(c,b)}(r,s)}function Bs(r,s){var a=wr(s),c=a.next();if(c.done)return!1;for(var f=c.value,d=wr(r),p=d.next(f.from),y=p.value;!c.done&&!p.done;){if(fe(y.from,f.to)<=0&&0<=fe(y.to,f.from))return!0;fe(f.from,y.from)<0?f=(c=a.next(y.from)).value:y=(p=d.next(f.from)).value}return!1}function wr(r){var s=gi(r)?null:{s:0,n:r};return{next:function(a){for(var c=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,c)for(;s.n.l&&fe(a,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!c||fe(a,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function Ls(r){var s,a,c=(((s=r.r)===null||s===void 0?void 0:s.d)||0)-(((a=r.l)===null||a===void 0?void 0:a.d)||0),f=1<c?"r":c<-1?"l":"";f&&(s=f=="r"?"l":"r",a=i({},r),c=r[f],r.from=c.from,r.to=c.to,r[f]=c[f],a[f]=c[s],(r[s]=a).d=$s(a)),r.d=$s(r)}function $s(a){var s=a.r,a=a.l;return(s?a?Math.max(s.d,a.d):s.d:a?a.d:0)+1}function _r(r,s){return l(s).forEach(function(a){r[a]?In(r[a],s[a]):r[a]=function c(f){var d,p,y={};for(d in f)S(f,d)&&(p=f[d],y[d]=!p||typeof p!="object"||ee.has(p.constructor)?p:c(p));return y}(s[a])}),r}function vi(r,s){return r.all||s.all||Object.keys(r).some(function(a){return s[a]&&Bs(s[a],r[a])})}N(De.prototype,((Ve={add:function(r){return In(this,r),this},addKey:function(r){return Dn(this,r,r),this},addKeys:function(r){var s=this;return r.forEach(function(a){return Dn(s,a,a)}),this},hasKey:function(r){var s=wr(this).next(r).value;return s&&fe(s.from,r)<=0&&0<=fe(s.to,r)}})[ct]=function(){return wr(this)},Ve));var It={},bi={},wi=!1;function kr(r){_r(bi,r),wi||(wi=!0,setTimeout(function(){wi=!1,_i(bi,!(bi={}))},0))}function _i(r,s){s===void 0&&(s=!1);var a=new Set;if(r.all)for(var c=0,f=Object.values(It);c<f.length;c++)qs(p=f[c],r,a,s);else for(var d in r){var p,y=/^idb\:\/\/(.*)\/(.*)\//.exec(d);y&&(d=y[1],y=y[2],(p=It["idb://".concat(d,"/").concat(y)])&&qs(p,r,a,s))}a.forEach(function(b){return b()})}function qs(r,s,a,c){for(var f=[],d=0,p=Object.entries(r.queries.query);d<p.length;d++){for(var y=p[d],b=y[0],_=[],A=0,v=y[1];A<v.length;A++){var P=v[A];vi(s,P.obsSet)?P.subscribers.forEach(function(x){return a.add(x)}):c&&_.push(P)}c&&f.push([b,_])}if(c)for(var w=0,E=f;w<E.length;w++){var O=E[w],b=O[0],_=O[1];r.queries.query[b]=_}}function qa(r){var s=r._state,a=r._deps.indexedDB;if(s.isBeingOpened||r.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?Ae(s.dbOpenError):r});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var c=s.openCanceller,f=Math.round(10*r.verno),d=!1;function p(){if(s.openCanceller!==c)throw new W.DatabaseClosed("db.open() was cancelled")}function y(){return new V(function(P,w){if(p(),!a)throw new W.MissingAPI;var E=r.name,O=s.autoSchema||!f?a.open(E):a.open(E,f);if(!O)throw new W.MissingAPI;O.onerror=rt(w),O.onblocked=_e(r._fireOnBlocked),O.onupgradeneeded=_e(function(x){var C;A=O.transaction,s.autoSchema&&!r._options.allowEmptyDB?(O.onerror=Tn,A.abort(),O.result.close(),(C=a.deleteDatabase(E)).onsuccess=C.onerror=_e(function(){w(new W.NoSuchDatabase("Database ".concat(E," doesnt exist")))})):(A.onerror=rt(w),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,v=x<1,r.idbdb=O.result,d&&La(r,A),Ba(r,x/10,A,w))},w),O.onsuccess=_e(function(){A=null;var x,C,R,T,M,I=r.idbdb=O.result,$=he(I.objectStoreNames);if(0<$.length)try{var j=I.transaction((T=$).length===1?T[0]:T,"readonly");if(s.autoSchema)C=I,R=j,(x=r).verno=C.version/10,R=x._dbSchema=gr(0,C,R),x._storeNames=he(C.objectStoreNames,0),mr(x,[x._allTables],l(R),R);else if(vr(r,r._dbSchema,j),((M=fi(gr(0,(M=r).idbdb,j),M._dbSchema)).add.length||M.change.some(function(B){return B.add.length||B.change.length}))&&!d)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),I.close(),f=I.version+1,d=!0,P(y());pr(r,j)}catch{}Zt.push(r),I.onversionchange=_e(function(B){s.vcFired=!0,r.on("versionchange").fire(B)}),I.onclose=_e(function(B){r.on("close").fire(B)}),v&&(M=r._deps,j=E,I=M.indexedDB,M=M.IDBKeyRange,mi(I)||j===cr||pi(I,M).put({name:j}).catch(ve)),P()},w)}).catch(function(P){switch(P?.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),y();break;case"VersionError":if(0<f)return f=0,y()}return V.reject(P)})}var b,_=s.dbReadyResolve,A=null,v=!1;return V.race([c,(typeof navigator>"u"?V.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function w(){return indexedDB.databases().finally(P)}b=setInterval(w,100),w()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(y)]).then(function(){return p(),s.onReadyBeingFired=[],V.resolve(yi(function(){return r.on.ready.fire(r.vip)})).then(function P(){if(0<s.onReadyBeingFired.length){var w=s.onReadyBeingFired.reduce(Hr,ve);return s.onReadyBeingFired=[],V.resolve(yi(function(){return w(r.vip)})).then(P)}})}).finally(function(){s.openCanceller===c&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(P){s.dbOpenError=P;try{A&&A.abort()}catch{}return c===s.openCanceller&&r._close(),Ae(P)}).finally(function(){s.openComplete=!0,_()}).then(function(){var P;return v&&(P={},r.tables.forEach(function(w){w.schema.indexes.forEach(function(E){E.name&&(P["idb://".concat(r.name,"/").concat(w.name,"/").concat(E.name)]=new De(-1/0,[[[]]]))}),P["idb://".concat(r.name,"/").concat(w.name,"/")]=P["idb://".concat(r.name,"/").concat(w.name,"/:dels")]=new De(-1/0,[[[]]])}),kt(Mn).fire(P),_i(P,!0)),r})}function ki(r){function s(d){return r.next(d)}var a=f(s),c=f(function(d){return r.throw(d)});function f(d){return function(b){var y=d(b),b=y.value;return y.done?b:b&&typeof b.then=="function"?b.then(a,c):h(b)?Promise.all(b).then(a,c):a(b)}}return f(s)()}function xr(r,s,a){for(var c=h(r)?r.slice():[r],f=0;f<a;++f)c.push(s);return c}var Fa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return i(i({},r),{table:function(s){var a=r.table(s),c=a.schema,f={},d=[];function p(v,P,w){var E=Kn(v),O=f[E]=f[E]||[],x=v==null?0:typeof v=="string"?1:v.length,C=0<P,C=i(i({},w),{name:C?"".concat(E,"(virtual-from:").concat(w.name,")"):w.name,lowLevelIndex:w,isVirtual:C,keyTail:P,keyLength:x,extractKey:li(v),unique:!C&&w.unique});return O.push(C),C.isPrimaryKey||d.push(C),1<x&&p(x===2?v[0]:v.slice(0,x-1),P+1,w),O.sort(function(R,T){return R.keyTail-T.keyTail}),C}s=p(c.primaryKey.keyPath,0,c.primaryKey),f[":id"]=[s];for(var y=0,b=c.indexes;y<b.length;y++){var _=b[y];p(_.keyPath,0,_)}function A(v){var P,w=v.query.index;return w.isVirtual?i(i({},v),{query:{index:w.lowLevelIndex,range:(P=v.query.range,w=w.keyTail,{type:P.type===1?2:P.type,lower:xr(P.lower,P.lowerOpen?r.MAX_KEY:r.MIN_KEY,w),lowerOpen:!0,upper:xr(P.upper,P.upperOpen?r.MIN_KEY:r.MAX_KEY,w),upperOpen:!0})}}):v}return i(i({},a),{schema:i(i({},c),{primaryKey:s,indexes:d,getIndexByKeyPath:function(v){return(v=f[Kn(v)])&&v[0]}}),count:function(v){return a.count(A(v))},query:function(v){return a.query(A(v))},openCursor:function(v){var P=v.query.index,w=P.keyTail,E=P.isVirtual,O=P.keyLength;return E?a.openCursor(A(v)).then(function(C){return C&&x(C)}):a.openCursor(v);function x(C){return Object.create(C,{continue:{value:function(R){R!=null?C.continue(xr(R,v.reverse?r.MAX_KEY:r.MIN_KEY,w)):v.unique?C.continue(C.key.slice(0,O).concat(v.reverse?r.MIN_KEY:r.MAX_KEY,w)):C.continue()}},continuePrimaryKey:{value:function(R,T){C.continuePrimaryKey(xr(R,r.MAX_KEY,w),T)}},primaryKey:{get:function(){return C.primaryKey}},key:{get:function(){var R=C.key;return O===1?R[0]:R.slice(0,O)}},value:{get:function(){return C.value}}})}}})}})}};function xi(r,s,a,c){return a=a||{},c=c||"",l(r).forEach(function(f){var d,p,y;S(s,f)?(d=r[f],p=s[f],typeof d=="object"&&typeof p=="object"&&d&&p?(y=Ze(d))!==Ze(p)?a[c+f]=s[f]:y==="Object"?xi(d,p,a,c+f+"."):d!==p&&(a[c+f]=s[f]):d!==p&&(a[c+f]=s[f])):a[c+f]=void 0}),l(s).forEach(function(f){S(r,f)||(a[c+f]=s[f])}),a}function Ei(r,s){return s.type==="delete"?s.keys:s.keys||s.values.map(r.extractKey)}var Ua={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return i(i({},r),{table:function(s){var a=r.table(s),c=a.schema.primaryKey;return i(i({},a),{mutate:function(f){var d=H.trans,p=d.table(s).hook,y=p.deleting,b=p.creating,_=p.updating;switch(f.type){case"add":if(b.fire===ve)break;return d._promise("readwrite",function(){return A(f)},!0);case"put":if(b.fire===ve&&_.fire===ve)break;return d._promise("readwrite",function(){return A(f)},!0);case"delete":if(y.fire===ve)break;return d._promise("readwrite",function(){return A(f)},!0);case"deleteRange":if(y.fire===ve)break;return d._promise("readwrite",function(){return function v(P,w,E){return a.query({trans:P,values:!1,query:{index:c,range:w},limit:E}).then(function(O){var x=O.result;return A({type:"delete",keys:x,trans:P}).then(function(C){return 0<C.numFailures?Promise.reject(C.failures[0]):x.length<E?{failures:[],numFailures:0,lastResult:void 0}:v(P,i(i({},w),{lower:x[x.length-1],lowerOpen:!0}),E)})})}(f.trans,f.range,1e4)},!0)}return a.mutate(f);function A(v){var P,w,E,O=H.trans,x=v.keys||Ei(c,v);if(!x)throw new Error("Keys missing");return(v=v.type==="add"||v.type==="put"?i(i({},v),{keys:x}):i({},v)).type!=="delete"&&(v.values=o([],v.values,!0)),v.keys&&(v.keys=o([],v.keys,!0)),P=a,E=x,((w=v).type==="add"?Promise.resolve([]):P.getMany({trans:w.trans,keys:E,cache:"immutable"})).then(function(C){var R=x.map(function(T,M){var I,$,j,B=C[M],F={onerror:null,onsuccess:null};return v.type==="delete"?y.fire.call(F,T,B,O):v.type==="add"||B===void 0?(I=b.fire.call(F,T,v.values[M],O),T==null&&I!=null&&(v.keys[M]=T=I,c.outbound||Ee(v.values[M],c.keyPath,T))):(I=xi(B,v.values[M]),($=_.fire.call(F,I,T,B,O))&&(j=v.values[M],Object.keys($).forEach(function(q){S(j,q)?j[q]=$[q]:Ee(j,q,$[q])}))),F});return a.mutate(v).then(function(T){for(var M=T.failures,I=T.results,$=T.numFailures,T=T.lastResult,j=0;j<x.length;++j){var B=(I||x)[j],F=R[j];B==null?F.onerror&&F.onerror(M[j]):F.onsuccess&&F.onsuccess(v.type==="put"&&C[j]?v.values[j]:B)}return{failures:M,results:I,numFailures:$,lastResult:T}}).catch(function(T){return R.forEach(function(M){return M.onerror&&M.onerror(T)}),Promise.reject(T)})})}}})}})}};function Fs(r,s,a){try{if(!s||s.keys.length<r.length)return null;for(var c=[],f=0,d=0;f<s.keys.length&&d<r.length;++f)fe(s.keys[f],r[d])===0&&(c.push(a?He(s.values[f]):s.values[f]),++d);return c.length===r.length?c:null}catch{return null}}var Va={stack:"dbcore",level:-1,create:function(r){return{table:function(s){var a=r.table(s);return i(i({},a),{getMany:function(c){if(!c.cache)return a.getMany(c);var f=Fs(c.keys,c.trans._cache,c.cache==="clone");return f?V.resolve(f):a.getMany(c).then(function(d){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?He(d):d},d})},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),a.mutate(c)}})}}}};function Us(r,s){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function Vs(r,s){switch(r){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var za={stack:"dbcore",level:0,name:"Observability",create:function(r){var s=r.schema.name,a=new De(r.MIN_KEY,r.MAX_KEY);return i(i({},r),{transaction:function(c,f,d){if(H.subscr&&f!=="readonly")throw new W.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(H.querier));return r.transaction(c,f,d)},table:function(c){var f=r.table(c),d=f.schema,p=d.primaryKey,v=d.indexes,y=p.extractKey,b=p.outbound,_=p.autoIncrement&&v.filter(function(w){return w.compound&&w.keyPath.includes(p.keyPath)}),A=i(i({},f),{mutate:function(w){function E(q){return q="idb://".concat(s,"/").concat(c,"/").concat(q),T[q]||(T[q]=new De)}var O,x,C,R=w.trans,T=w.mutatedParts||(w.mutatedParts={}),M=E(""),I=E(":dels"),$=w.type,F=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[Ei(p,w).filter(function(q){return q}),w.values]:[],j=F[0],B=F[1],F=w.trans._cache;return h(j)?(M.addKeys(j),(F=$==="delete"||j.length===B.length?Fs(j,F):null)||I.addKeys(j),(F||B)&&(O=E,x=F,C=B,d.indexes.forEach(function(q){var G=O(q.name||"");function te(se){return se!=null?q.extractKey(se):null}function ue(se){return q.multiEntry&&h(se)?se.forEach(function(We){return G.addKey(We)}):G.addKey(se)}(x||C).forEach(function(se,Ie){var oe=x&&te(x[Ie]),Ie=C&&te(C[Ie]);fe(oe,Ie)!==0&&(oe!=null&&ue(oe),Ie!=null&&ue(Ie))})}))):j?(B={from:(B=j.lower)!==null&&B!==void 0?B:r.MIN_KEY,to:(B=j.upper)!==null&&B!==void 0?B:r.MAX_KEY},I.add(B),M.add(B)):(M.add(a),I.add(a),d.indexes.forEach(function(q){return E(q.name).add(a)})),f.mutate(w).then(function(q){return!j||w.type!=="add"&&w.type!=="put"||(M.addKeys(q.results),_&&_.forEach(function(G){var te=w.values.map(function(se){return G.extractKey(se)}),ue=G.keyPath.findIndex(function(se){return se===p.keyPath});q.results.forEach(function(se){return te[ue]=se}),E(G.name).addKeys(te)})),R.mutatedParts=_r(R.mutatedParts||{},T),q})}}),v=function(E){var O=E.query,E=O.index,O=O.range;return[E,new De((E=O.lower)!==null&&E!==void 0?E:r.MIN_KEY,(O=O.upper)!==null&&O!==void 0?O:r.MAX_KEY)]},P={get:function(w){return[p,new De(w.key)]},getMany:function(w){return[p,new De().addKeys(w.keys)]},count:v,query:v,openCursor:v};return l(P).forEach(function(w){A[w]=function(E){var O=H.subscr,x=!!O,C=Us(H,f)&&Vs(w,E)?E.obsSet={}:O;if(x){var R=function(B){return B="idb://".concat(s,"/").concat(c,"/").concat(B),C[B]||(C[B]=new De)},T=R(""),M=R(":dels"),O=P[w](E),x=O[0],O=O[1];if((w==="query"&&x.isPrimaryKey&&!E.values?M:R(x.name||"")).add(O),!x.isPrimaryKey){if(w!=="count"){var I=w==="query"&&b&&E.values&&f.query(i(i({},E),{values:!1}));return f[w].apply(this,arguments).then(function(B){if(w==="query"){if(b&&E.values)return I.then(function(te){return te=te.result,T.addKeys(te),B});var F=E.values?B.result.map(y):B.result;(E.values?T:M).addKeys(F)}else if(w==="openCursor"){var q=B,G=E.values;return q&&Object.create(q,{key:{get:function(){return M.addKey(q.primaryKey),q.key}},primaryKey:{get:function(){var te=q.primaryKey;return M.addKey(te),te}},value:{get:function(){return G&&T.addKey(q.primaryKey),q.value}}})}return B})}M.add(a)}}return f[w].apply(this,arguments)}}),A}})}};function zs(r,s,a){if(a.numFailures===0)return s;if(s.type==="deleteRange")return null;var c=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1;return a.numFailures===c?null:(s=i({},s),h(s.keys)&&(s.keys=s.keys.filter(function(f,d){return!(d in a.failures)})),"values"in s&&h(s.values)&&(s.values=s.values.filter(function(f,d){return!(d in a.failures)})),s)}function Ai(r,s){return a=r,((c=s).lower===void 0||(c.lowerOpen?0<fe(a,c.lower):0<=fe(a,c.lower)))&&(r=r,(s=s).upper===void 0||(s.upperOpen?fe(r,s.upper)<0:fe(r,s.upper)<=0));var a,c}function Gs(r,s,P,c,f,d){if(!P||P.length===0)return r;var p=s.query.index,y=p.multiEntry,b=s.query.range,_=c.schema.primaryKey.extractKey,A=p.extractKey,v=(p.lowLevelIndex||p).extractKey,P=P.reduce(function(w,E){var O=w,x=[];if(E.type==="add"||E.type==="put")for(var C=new De,R=E.values.length-1;0<=R;--R){var T,M=E.values[R],I=_(M);C.hasKey(I)||(T=A(M),(y&&h(T)?T.some(function(q){return Ai(q,b)}):Ai(T,b))&&(C.addKey(I),x.push(M)))}switch(E.type){case"add":var $=new De().addKeys(s.values?w.map(function(G){return _(G)}):w),O=w.concat(s.values?x.filter(function(G){return G=_(G),!$.hasKey(G)&&($.addKey(G),!0)}):x.map(function(G){return _(G)}).filter(function(G){return!$.hasKey(G)&&($.addKey(G),!0)}));break;case"put":var j=new De().addKeys(E.values.map(function(G){return _(G)}));O=w.filter(function(G){return!j.hasKey(s.values?_(G):G)}).concat(s.values?x:x.map(function(G){return _(G)}));break;case"delete":var B=new De().addKeys(E.keys);O=w.filter(function(G){return!B.hasKey(s.values?_(G):G)});break;case"deleteRange":var F=E.range;O=w.filter(function(G){return!Ai(_(G),F)})}return O},r);return P===r?r:(P.sort(function(w,E){return fe(v(w),v(E))||fe(_(w),_(E))}),s.limit&&s.limit<1/0&&(P.length>s.limit?P.length=s.limit:r.length===s.limit&&P.length<s.limit&&(f.dirty=!0)),d?Object.freeze(P):P)}function Hs(r,s){return fe(r.lower,s.lower)===0&&fe(r.upper,s.upper)===0&&!!r.lowerOpen==!!s.lowerOpen&&!!r.upperOpen==!!s.upperOpen}function Ga(r,s){return function(a,c,f,d){if(a===void 0)return c!==void 0?-1:0;if(c===void 0)return 1;if((c=fe(a,c))===0){if(f&&d)return 0;if(f)return 1;if(d)return-1}return c}(r.lower,s.lower,r.lowerOpen,s.lowerOpen)<=0&&0<=function(a,c,f,d){if(a===void 0)return c!==void 0?1:0;if(c===void 0)return-1;if((c=fe(a,c))===0){if(f&&d)return 0;if(f)return-1;if(d)return 1}return c}(r.upper,s.upper,r.upperOpen,s.upperOpen)}function Ha(r,s,a,c){r.subscribers.add(a),c.addEventListener("abort",function(){var f,d;r.subscribers.delete(a),r.subscribers.size===0&&(f=r,d=s,setTimeout(function(){f.subscribers.size===0&&tt(d,f)},3e3))})}var Wa={stack:"dbcore",level:0,name:"Cache",create:function(r){var s=r.schema.name;return i(i({},r),{transaction:function(a,c,f){var d,p,y=r.transaction(a,c,f);return c==="readwrite"&&(p=(d=new AbortController).signal,f=function(b){return function(){if(d.abort(),c==="readwrite"){for(var _=new Set,A=0,v=a;A<v.length;A++){var P=v[A],w=It["idb://".concat(s,"/").concat(P)];if(w){var E=r.table(P),O=w.optimisticOps.filter(function(G){return G.trans===y});if(y._explicit&&b&&y.mutatedParts)for(var x=0,C=Object.values(w.queries.query);x<C.length;x++)for(var R=0,T=($=C[x]).slice();R<T.length;R++)vi((j=T[R]).obsSet,y.mutatedParts)&&(tt($,j),j.subscribers.forEach(function(G){return _.add(G)}));else if(0<O.length){w.optimisticOps=w.optimisticOps.filter(function(G){return G.trans!==y});for(var M=0,I=Object.values(w.queries.query);M<I.length;M++)for(var $,j,B,F=0,q=($=I[M]).slice();F<q.length;F++)(j=q[F]).res!=null&&y.mutatedParts&&(b&&!j.dirty?(B=Object.isFrozen(j.res),B=Gs(j.res,j.req,O,E,j,B),j.dirty?(tt($,j),j.subscribers.forEach(function(G){return _.add(G)})):B!==j.res&&(j.res=B,j.promise=V.resolve({result:B}))):(j.dirty&&tt($,j),j.subscribers.forEach(function(G){return _.add(G)})))}}}_.forEach(function(G){return G()})}}},y.addEventListener("abort",f(!1),{signal:p}),y.addEventListener("error",f(!1),{signal:p}),y.addEventListener("complete",f(!0),{signal:p})),y},table:function(a){var c=r.table(a),f=c.schema.primaryKey;return i(i({},c),{mutate:function(d){var p=H.trans;if(f.outbound||p.db._options.cache==="disabled"||p.explicit||p.idbtrans.mode!=="readwrite")return c.mutate(d);var y=It["idb://".concat(s,"/").concat(a)];return y?(p=c.mutate(d),d.type!=="add"&&d.type!=="put"||!(50<=d.values.length||Ei(f,d).some(function(b){return b==null}))?(y.optimisticOps.push(d),d.mutatedParts&&kr(d.mutatedParts),p.then(function(b){0<b.numFailures&&(tt(y.optimisticOps,d),(b=zs(0,d,b))&&y.optimisticOps.push(b),d.mutatedParts&&kr(d.mutatedParts))}),p.catch(function(){tt(y.optimisticOps,d),d.mutatedParts&&kr(d.mutatedParts)})):p.then(function(b){var _=zs(0,i(i({},d),{values:d.values.map(function(A,v){var P;return b.failures[v]?A:(A=(P=f.keyPath)!==null&&P!==void 0&&P.includes(".")?He(A):i({},A),Ee(A,f.keyPath,b.results[v]),A)})}),b);y.optimisticOps.push(_),queueMicrotask(function(){return d.mutatedParts&&kr(d.mutatedParts)})}),p):c.mutate(d)},query:function(d){if(!Us(H,c)||!Vs("query",d))return c.query(d);var p=((_=H.trans)===null||_===void 0?void 0:_.db._options.cache)==="immutable",v=H,y=v.requery,b=v.signal,_=function(E,O,x,C){var R=It["idb://".concat(E,"/").concat(O)];if(!R)return[];if(!(O=R.queries[x]))return[null,!1,R,null];var T=O[(C.query?C.query.index.name:null)||""];if(!T)return[null,!1,R,null];switch(x){case"query":var M=T.find(function(I){return I.req.limit===C.limit&&I.req.values===C.values&&Hs(I.req.query.range,C.query.range)});return M?[M,!0,R,T]:[T.find(function(I){return("limit"in I.req?I.req.limit:1/0)>=C.limit&&(!C.values||I.req.values)&&Ga(I.req.query.range,C.query.range)}),!1,R,T];case"count":return M=T.find(function(I){return Hs(I.req.query.range,C.query.range)}),[M,!!M,R,T]}}(s,a,"query",d),A=_[0],v=_[1],P=_[2],w=_[3];return A&&v?A.obsSet=d.obsSet:(v=c.query(d).then(function(E){var O=E.result;if(A&&(A.res=O),p){for(var x=0,C=O.length;x<C;++x)Object.freeze(O[x]);Object.freeze(O)}else E.result=He(O);return E}).catch(function(E){return w&&A&&tt(w,A),Promise.reject(E)}),A={obsSet:d.obsSet,promise:v,subscribers:new Set,type:"query",req:d,dirty:!1},w?w.push(A):(w=[A],(P=P||(It["idb://".concat(s,"/").concat(a)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[d.query.index.name||""]=w)),Ha(A,w,y,b),A.promise.then(function(E){return{result:Gs(E.result,d,P?.optimisticOps,c,A,p)}})}})}})}};function Er(r,s){return new Proxy(r,{get:function(a,c,f){return c==="db"?s:Reflect.get(a,c,f)}})}var dt=(Oe.prototype.version=function(r){if(isNaN(r)||r<.1)throw new W.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var s=this._versions,a=s.filter(function(c){return c._cfg.version===r})[0];return a||(a=new this.Version(r),s.push(a),s.sort(ja),a.stores({}),this._state.autoSchema=!1,a)},Oe.prototype._whenReady=function(r){var s=this;return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?r():new V(function(a,c){if(s._state.openComplete)return c(new W.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void c(new W.DatabaseClosed);s.open().catch(ve)}s._state.dbReadyPromise.then(a,c)}).then(r)},Oe.prototype.use=function(r){var s=r.stack,a=r.create,c=r.level,f=r.name;return f&&this.unuse({stack:s,name:f}),r=this._middlewares[s]||(this._middlewares[s]=[]),r.push({stack:s,create:a,level:c??10,name:f}),r.sort(function(d,p){return d.level-p.level}),this},Oe.prototype.unuse=function(r){var s=r.stack,a=r.name,c=r.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(f){return c?f.create!==c:!!a&&f.name!==a})),this},Oe.prototype.open=function(){var r=this;return Nt(gt,function(){return qa(r)})},Oe.prototype._close=function(){var r=this._state,s=Zt.indexOf(this);if(0<=s&&Zt.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new V(function(a){r.dbReadyResolve=a}),r.openCanceller=new V(function(a,c){r.cancelOpen=c}))},Oe.prototype.close=function(a){var s=(a===void 0?{disableAutoOpen:!0}:a).disableAutoOpen,a=this._state;s?(a.isBeingOpened&&a.cancelOpen(new W.DatabaseClosed),this._close(),a.autoOpen=!1,a.dbOpenError=new W.DatabaseClosed):(this._close(),a.autoOpen=this._options.autoOpen||a.isBeingOpened,a.openComplete=!1,a.dbOpenError=null)},Oe.prototype.delete=function(r){var s=this;r===void 0&&(r={disableAutoOpen:!0});var a=0<arguments.length&&typeof arguments[0]!="object",c=this._state;return new V(function(f,d){function p(){s.close(r);var y=s._deps.indexedDB.deleteDatabase(s.name);y.onsuccess=_e(function(){var b,_,A;b=s._deps,_=s.name,A=b.indexedDB,b=b.IDBKeyRange,mi(A)||_===cr||pi(A,b).delete(_).catch(ve),f()}),y.onerror=rt(d),y.onblocked=s._fireOnBlocked}if(a)throw new W.InvalidArgument("Invalid closeOptions argument to db.delete()");c.isBeingOpened?c.dbReadyPromise.then(p):p()})},Oe.prototype.backendDB=function(){return this.idbdb},Oe.prototype.isOpen=function(){return this.idbdb!==null},Oe.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Oe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Oe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Oe.prototype,"tables",{get:function(){var r=this;return l(this._allTables).map(function(s){return r._allTables[s]})},enumerable:!1,configurable:!0}),Oe.prototype.transaction=function(){var r=function(s,a,c){var f=arguments.length;if(f<2)throw new W.InvalidArgument("Too few arguments");for(var d=new Array(f-1);--f;)d[f-1]=arguments[f];return c=d.pop(),[s,Y(d),c]}.apply(this,arguments);return this._transaction.apply(this,r)},Oe.prototype._transaction=function(r,s,a){var c=this,f=H.trans;f&&f.db===this&&r.indexOf("!")===-1||(f=null);var d,p,y=r.indexOf("?")!==-1;r=r.replace("!","").replace("?","");try{if(p=s.map(function(_){if(_=_ instanceof c.Table?_.name:_,typeof _!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return _}),r=="r"||r===ni)d=ni;else{if(r!="rw"&&r!=ri)throw new W.InvalidArgument("Invalid transaction mode: "+r);d=ri}if(f){if(f.mode===ni&&d===ri){if(!y)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&p.forEach(function(_){if(f&&f.storeNames.indexOf(_)===-1){if(!y)throw new W.SubTransaction("Table "+_+" not included in parent transaction.");f=null}}),y&&f&&!f.active&&(f=null)}}catch(_){return f?f._promise(null,function(A,v){v(_)}):Ae(_)}var b=function _(A,v,P,w,E){return V.resolve().then(function(){var O=H.transless||H,x=A._createTransaction(v,P,A._dbSchema,w);if(x.explicit=!0,O={trans:x,transless:O},w)x.idbtrans=w.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,A._state.PR1398_maxLoop=3}catch(T){return T.name===Gr.InvalidState&&A.isOpen()&&0<--A._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),A.close({disableAutoOpen:!1}),A.open().then(function(){return _(A,v,P,null,E)})):Ae(T)}var C,R=zr(E);return R&&Jt(),O=V.follow(function(){var T;(C=E.call(x,x))&&(R?(T=bt.bind(null,null),C.then(T,T)):typeof C.next=="function"&&typeof C.throw=="function"&&(C=ki(C)))},O),(C&&typeof C.then=="function"?V.resolve(C).then(function(T){return x.active?T:Ae(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):O.then(function(){return C})).then(function(T){return w&&x._resolve(),x._completion.then(function(){return T})}).catch(function(T){return x._reject(T),Ae(T)})})}.bind(null,this,d,p,f,a);return f?f._promise(d,b,"lock"):H.trans?Nt(H.transless,function(){return c._whenReady(b)}):this._whenReady(b)},Oe.prototype.table=function(r){if(!S(this._allTables,r))throw new W.InvalidTable("Table ".concat(r," does not exist"));return this._allTables[r]},Oe);function Oe(r,s){var a=this;this._middlewares={},this.verno=0;var c=Oe.dependencies;this._options=s=i({addons:Oe.addons,autoOpen:!0,indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},c=s.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var f,d,p,y,b,_={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ve,dbReadyPromise:null,cancelOpen:ve,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};_.dbReadyPromise=new V(function(v){_.dbReadyResolve=v}),_.openCanceller=new V(function(v,P){_.cancelOpen=P}),this._state=_,this.name=r,this.on=Cn(this,"populate","blocked","versionchange","close",{ready:[Hr,ve]}),this.on.ready.subscribe=ne(this.on.ready.subscribe,function(v){return function(P,w){Oe.vip(function(){var E,O=a._state;O.openComplete?(O.dbOpenError||V.resolve().then(P),w&&v(P)):O.onReadyBeingFired?(O.onReadyBeingFired.push(P),w&&v(P)):(v(P),E=a,w||v(function x(){E.on.ready.unsubscribe(P),E.on.ready.unsubscribe(x)}))})}}),this.Collection=(f=this,Sn(Ra.prototype,function(C,x){this.db=f;var w=Es,E=null;if(x)try{w=x()}catch(R){E=R}var O=C._ctx,x=O.table,C=x.hook.reading.fire;this._ctx={table:x,index:O.index,isPrimKey:!O.index||x.schema.primKey.keyPath&&O.index===x.schema.primKey.name,range:w,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:E,or:O.or,valueMapper:C!==xn?C:null}})),this.Table=(d=this,Sn(Cs.prototype,function(v,P,w){this.db=d,this._tx=w,this.name=v,this.schema=P,this.hook=d._allTables[v]?d._allTables[v].hook:Cn(null,{creating:[_a,ve],reading:[wa,xn],updating:[xa,ve],deleting:[ka,ve]})})),this.Transaction=(p=this,Sn(Na.prototype,function(v,P,w,E,O){var x=this;this.db=p,this.mode=v,this.storeNames=P,this.schema=w,this.chromeTransactionDurability=E,this.idbtrans=null,this.on=Cn(this,"complete","error","abort"),this.parent=O||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new V(function(C,R){x._resolve=C,x._reject=R}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(C){var R=x.active;return x.active=!1,x.on.error.fire(C),x.parent?x.parent._reject(C):R&&x.idbtrans&&x.idbtrans.abort(),Ae(C)})})),this.Version=(y=this,Sn($a.prototype,function(v){this.db=y,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,Sn(Ns.prototype,function(v,P,w){if(this.db=b,this._ctx={table:v,index:P===":id"?null:P,or:w},this._cmp=this._ascending=fe,this._descending=function(E,O){return fe(O,E)},this._max=function(E,O){return 0<fe(E,O)?E:O},this._min=function(E,O){return fe(E,O)<0?E:O},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new W.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(a.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(a.name,"'. Closing db now to resume the delete request.")),a.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(a.name,"') was blocked")):console.warn("Upgrade '".concat(a.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=Nn(s.IDBKeyRange),this._createTransaction=function(v,P,w,E){return new a.Transaction(v,P,w,a._options.chromeTransactionDurability,E)},this._fireOnBlocked=function(v){a.on("blocked").fire(v),Zt.filter(function(P){return P.name===a.name&&P!==a&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(v)})},this.use(Va),this.use(Wa),this.use(za),this.use(Fa),this.use(Ua);var A=new Proxy(this,{get:function(v,P,w){if(P==="_vip")return!0;if(P==="table")return function(O){return Er(a.table(O),A)};var E=Reflect.get(v,P,w);return E instanceof Cs?Er(E,A):P==="tables"?E.map(function(O){return Er(O,A)}):P==="_createTransaction"?function(){return Er(E.apply(this,arguments),A)}:E}});this.vip=A,c.forEach(function(v){return v(a)})}var Ar,Ve=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Qa=(Oi.prototype.subscribe=function(r,s,a){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:s,complete:a})},Oi.prototype[Ve]=function(){return this},Oi);function Oi(r){this._subscribe=r}try{Ar={indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange}}catch{Ar={indexedDB:null,IDBKeyRange:null}}function Ws(r){var s,a=!1,c=new Qa(function(f){var d=zr(r),p,y=!1,b={},_={},A={get closed(){return y},unsubscribe:function(){y||(y=!0,p&&p.abort(),v&&kt.storagemutated.unsubscribe(w))}};f.start&&f.start(A);var v=!1,P=function(){return ti(E)},w=function(O){_r(b,O),vi(_,b)&&P()},E=function(){var O,x,C;!y&&Ar.indexedDB&&(b={},O={},p&&p.abort(),p=new AbortController,C=function(R){var T=Yt();try{d&&Jt();var M=vt(r,R);return M=d?M.finally(bt):M}finally{T&&Xt()}}(x={subscr:O,signal:p.signal,requery:P,querier:r,trans:null}),Promise.resolve(C).then(function(R){a=!0,s=R,y||x.signal.aborted||(b={},function(T){for(var M in T)if(S(T,M))return;return 1}(_=O)||v||(kt(Mn,w),v=!0),ti(function(){return!y&&f.next&&f.next(R)}))},function(R){a=!1,["DatabaseClosedError","AbortError"].includes(R?.name)||y||ti(function(){y||f.error&&f.error(R)})}))};return setTimeout(P,0),A});return c.hasValue=function(){return a},c.getValue=function(){return s},c}var jt=dt;function Pi(r){var s=xt;try{xt=!0,kt.storagemutated.fire(r),_i(r,!0)}finally{xt=s}}N(jt,i(i({},er),{delete:function(r){return new jt(r,{addons:[]}).delete()},exists:function(r){return new jt(r,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return s=jt.dependencies,a=s.indexedDB,s=s.IDBKeyRange,(mi(a)?Promise.resolve(a.databases()).then(function(c){return c.map(function(f){return f.name}).filter(function(f){return f!==cr})}):pi(a,s).toCollection().primaryKeys()).then(r)}catch{return Ae(new W.MissingAPI)}var s,a},defineClass:function(){return function(r){m(this,r)}},ignoreTransaction:function(r){return H.trans?Nt(H.transless,r):r()},vip:yi,async:function(r){return function(){try{var s=ki(r.apply(this,arguments));return s&&typeof s.then=="function"?s:V.resolve(s)}catch(a){return Ae(a)}}},spawn:function(r,s,a){try{var c=ki(r.apply(a,s||[]));return c&&typeof c.then=="function"?c:V.resolve(c)}catch(f){return Ae(f)}},currentTransaction:{get:function(){return H.trans||null}},waitFor:function(r,s){return s=V.resolve(typeof r=="function"?jt.ignoreTransaction(r):r).timeout(s||6e4),H.trans?H.trans.waitFor(s):s},Promise:V,debug:{get:function(){return nt},set:function(r){gs(r)}},derive:z,extend:m,props:N,override:ne,Events:Cn,on:kt,liveQuery:Ws,extendObservabilitySet:_r,getByKeyPath:xe,setByKeyPath:Ee,delByKeyPath:function(r,s){typeof s=="string"?Ee(r,s,void 0):"length"in s&&[].map.call(s,function(a){Ee(r,a,void 0)})},shallowClone:Ge,deepClone:He,getObjectDiff:xi,cmp:fe,asap:me,minKey:-1/0,addons:[],connections:Zt,errnames:Gr,dependencies:Ar,cache:It,semVer:"4.0.9",version:"4.0.9".split(".").map(function(r){return parseInt(r)}).reduce(function(r,s,a){return r+s/Math.pow(10,2*a)})})),jt.maxKey=Nn(jt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(kt(Mn,function(r){xt||(r=new CustomEvent(ai,{detail:r}),xt=!0,dispatchEvent(r),xt=!1)}),addEventListener(ai,function(r){r=r.detail,xt||Pi(r)}));var nn,xt=!1,Qs=function(){};return typeof BroadcastChannel<"u"&&((Qs=function(){(nn=new BroadcastChannel(ai)).onmessage=function(r){return r.data&&Pi(r.data)}})(),typeof nn.unref=="function"&&nn.unref(),kt(Mn,function(r){xt||nn.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!dt.disableBfCache&&r.persisted){nt&&console.debug("Dexie: handling persisted pagehide"),nn?.close();for(var s=0,a=Zt;s<a.length;s++)a[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!dt.disableBfCache&&r.persisted&&(nt&&console.debug("Dexie: handling persisted pageshow"),Qs(),Pi({all:new De(-1/0,[[]])}))})),V.rejectionMapper=function(r,s){return!r||r instanceof Wt||r instanceof TypeError||r instanceof SyntaxError||!r.name||!ys[r.name]?r:(s=new ys[r.name](s||r.message,r),"stack"in r&&D(s,"stack",{get:function(){return this.inner.stack}}),s)},gs(nt),i(dt,Object.freeze({__proto__:null,Dexie:dt,liveQuery:Ws,Entity:As,cmp:fe,PropModSymbol:ft,PropModification:Rn,replacePrefix:function(r,s){return new Rn({replacePrefix:[r,s]})},add:function(r){return new Rn({add:r})},remove:function(r){return new Rn({remove:r})},default:dt,RangeSet:De,mergeRanges:In,rangesOverlap:Bs}),{default:dt}),dt})})(sa);var Dc=sa.exports;const Xi=Kc(Dc),ho=Symbol.for("Dexie"),Kr=globalThis[ho]||(globalThis[ho]=Xi);if(Xi.semVer!==Kr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Xi.semVer} and ${Kr.semVer}`);const{liveQuery:xh,mergeRanges:Eh,rangesOverlap:Ah,RangeSet:Oh,cmp:Ph,Entity:Yn,PropModSymbol:Ch,PropModification:Sh,replacePrefix:Rh,add:Th,remove:Mh}=Kr;var de=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(de||{}),U=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(U||{});class ae{static card(e){return{...e,state:ae.state(e.state),due:ae.time(e.due),last_review:e.last_review?ae.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),i=e.slice(1).toLowerCase(),o=U[`${n}${i}`];if(o===void 0)throw new Error(`Invalid rating:[${e}]`);return o}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),i=e.slice(1).toLowerCase(),o=de[`${n}${i}`];if(o===void 0)throw new Error(`Invalid state:[${e}]`);return o}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){const n=Date.parse(e);if(isNaN(n))throw new Error(`Invalid date:[${e}]`);return new Date(n)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:ae.time(e.due),rating:ae.rating(e.rating),state:ae.state(e.state),review:ae.time(e.review)}}}const Ic=.9,jc=36500,Bc=[.4072,1.1829,3.1262,15.4722,7.2102,.5316,1.0651,.0234,1.616,.1544,1.0824,1.9813,.0953,.2975,2.2042,.2407,2.9466,.5034,.6567],Lc=!1,$c=!0,fo=t=>{let e=Bc;return t?.w&&(t.w.length===19?e=t?.w:t.w.length===17&&(e=t?.w.concat([0,0]),e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),console.debug("[FSRS V5]auto fill w to 19 length"))),{request_retention:t?.request_retention||Ic,maximum_interval:t?.maximum_interval||jc,w:e,enable_fuzz:t?.enable_fuzz??Lc,enable_short_term:t?.enable_short_term??$c}};function Dr(t,e){const n={due:t?ae.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:de.New,last_review:void 0};return e&&typeof e=="function"?e(n):n}Date.prototype.scheduler=function(t,e){return qc(this,t,e)},Date.prototype.diff=function(t,e){return Fc(this,t,e)},Date.prototype.format=function(){return Uc(this)},Date.prototype.dueFormat=function(t,e,n){return Vc(this,t,e,n)};function qc(t,e,n){return new Date(n?zt(t).getTime()+e*24*60*60*1e3:zt(t).getTime()+e*60*1e3)}function Fc(t,e,n){if(!t||!e)throw new Error("Invalid date");const i=zt(t).getTime()-zt(e).getTime();let o=0;switch(n){case"days":o=Math.floor(i/(24*60*60*1e3));break;case"minutes":o=Math.floor(i/(60*1e3));break}return o}function Uc(t){const e=zt(t),n=e.getFullYear(),i=e.getMonth()+1,o=e.getDate(),u=e.getHours(),l=e.getMinutes(),h=e.getSeconds();return`${n}-${jn(i)}-${jn(o)} ${jn(u)}:${jn(l)}:${jn(h)}`}function jn(t){return t<10?`0${t}`:`${t}`}const Ni=[60,60,24,31,12],Ki=["second","min","hour","day","month","year"];function Vc(t,e,n,i=Ki){t=zt(t),e=zt(e),i.length!==Ki.length&&(i=Ki);let o=t.getTime()-e.getTime(),u;for(o/=1e3,u=0;u<Ni.length&&!(o<Ni[u]);u++)o/=Ni[u];return`${Math.floor(o)}${n?i[u]:""}`}function zt(t){return ae.time(t)}const zc=[U.Again,U.Hard,U.Good,U.Easy],Gc=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function Hc(t,e,n){let i=1;for(const l of Gc)i+=l.factor*Math.max(Math.min(t,l.end)-l.start,0);t=Math.min(t,n);let o=Math.max(2,Math.round(t-i));const u=Math.min(Math.round(t+i),n);return t>e&&(o=Math.max(o,e+1)),o=Math.min(o,u),{min_ivl:o,max_ivl:u}}function Di(t,e,n){return Math.min(Math.max(t,e),n)}class Wc{c;s0;s1;s2;constructor(e){const n=Qc();this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),e==null&&(e=+new Date),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function Qc(){let t=4022871197;return function(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296}return(t>>>0)*23283064365386963e-26}}function Yc(t){const e=new Wc(t),n=()=>e.next();return n.int32=()=>e.next()*4294967296|0,n.double=()=>n()+(n()*2097152|0)*11102230246251565e-32,n.state=()=>e.state,n.importState=i=>(e.state=i,n),n}const po=-.5,mo=19/81;class Xc{param;intervalModifier;_seed;constructor(e){this.param=new Proxy(fo(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(e,1/po)-1)/mo).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){const e=this;return{set:function(n,i,o){return i==="request_retention"&&Number.isFinite(o)&&(e.intervalModifier=e.calculate_interval_modifier(Number(o))),Reflect.set(n,i,o),!0}}}update_parameters(e){const n=fo(e);for(const i in n)if(i in this.param){const o=i;this.param[o]=n[o]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return this.constrain_difficulty(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1)}apply_fuzz(e,n){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);const i=Yc(this._seed)(),{min_ivl:o,max_ivl:u}=Hc(e,n,this.param.maximum_interval);return Math.floor(i*(u-o+1)+o)}next_interval(e,n){const i=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(i,n)}next_difficulty(e,n){const i=e-this.param.w[6]*(n-3);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(U.Easy),i))}constrain_difficulty(e){return Math.min(Math.max(+e.toFixed(8),1),10)}mean_reversion(e,n){return+(this.param.w[7]*e+(1-this.param.w[7])*n).toFixed(8)}next_recall_stability(e,n,i,o){const u=U.Hard===o?this.param.w[15]:1,l=U.Easy===o?this.param.w[16]:1;return+Di(n*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(n,-this.param.w[9])*(Math.exp((1-i)*this.param.w[10])-1)*u*l),.01,36500).toFixed(8)}next_forget_stability(e,n,i){return+Di(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(n+1,this.param.w[13])-1)*Math.exp((1-i)*this.param.w[14]),.01,36500).toFixed(8)}next_short_term_stability(e,n){return+Di(e*Math.exp(this.param.w[17]*(n-3+this.param.w[18])),.01,36500).toFixed(8)}forgetting_curve(e,n){return+Math.pow(1+mo*e/n,po).toFixed(8)}}class oa{last;current;review_time;next=new Map;algorithm;constructor(e,n,i){this.algorithm=i,this.last=ae.card(e),this.current=ae.card(e),this.review_time=ae.time(n),this.init()}init(){const{state:e,last_review:n}=this.current;let i=0;e!==de.New&&n&&(i=this.review_time.diff(n,"days")),this.current.last_review=this.review_time,this.current.elapsed_days=i,this.current.reps+=1,this.initSeed()}preview(){return{[U.Again]:this.review(U.Again),[U.Hard]:this.review(U.Hard),[U.Good]:this.review(U.Good),[U.Easy]:this.review(U.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const e of zc)yield this.review(e)}review(e){const{state:n}=this.last;let i;switch(n){case de.New:i=this.newState(e);break;case de.Learning:case de.Relearning:i=this.learningState(e);break;case de.Review:i=this.reviewState(e);break}if(i)return i;throw new Error("Invalid grade")}initSeed(){const e=this.review_time.getTime(),n=this.current.reps,i=this.current.difficulty*this.current.stability;this.algorithm.seed=`${e}_${n}_${i}`}buildLog(e){const{last_review:n,due:i,elapsed_days:o}=this.last;return{rating:e,state:this.current.state,due:n||i,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:o,scheduled_days:this.current.scheduled_days,review:this.review_time}}}class yo extends oa{newState(e){const n=this.next.get(e);if(n)return n;const i=ae.card(this.current);switch(i.difficulty=this.algorithm.init_difficulty(e),i.stability=this.algorithm.init_stability(e),e){case U.Again:i.scheduled_days=0,i.due=this.review_time.scheduler(1),i.state=de.Learning;break;case U.Hard:i.scheduled_days=0,i.due=this.review_time.scheduler(5),i.state=de.Learning;break;case U.Good:i.scheduled_days=0,i.due=this.review_time.scheduler(10),i.state=de.Learning;break;case U.Easy:{const u=this.algorithm.next_interval(i.stability,this.current.elapsed_days);i.scheduled_days=u,i.due=this.review_time.scheduler(u,!0),i.state=de.Review;break}default:throw new Error("Invalid grade")}const o={card:i,log:this.buildLog(e)};return this.next.set(e,o),o}learningState(e){const n=this.next.get(e);if(n)return n;const{state:i,difficulty:o,stability:u}=this.last,l=ae.card(this.current),h=this.current.elapsed_days;switch(l.difficulty=this.algorithm.next_difficulty(o,e),l.stability=this.algorithm.next_short_term_stability(u,e),e){case U.Again:{l.scheduled_days=0,l.due=this.review_time.scheduler(5,!1),l.state=i;break}case U.Hard:{l.scheduled_days=0,l.due=this.review_time.scheduler(10),l.state=i;break}case U.Good:{const k=this.algorithm.next_interval(l.stability,h);l.scheduled_days=k,l.due=this.review_time.scheduler(k,!0),l.state=de.Review;break}case U.Easy:{const k=this.algorithm.next_short_term_stability(u,U.Good),g=this.algorithm.next_interval(k,h),S=Math.max(this.algorithm.next_interval(l.stability,h),g+1);l.scheduled_days=S,l.due=this.review_time.scheduler(S,!0),l.state=de.Review;break}default:throw new Error("Invalid grade")}const m={card:l,log:this.buildLog(e)};return this.next.set(e,m),m}reviewState(e){const n=this.next.get(e);if(n)return n;const i=this.current.elapsed_days,{difficulty:o,stability:u}=this.last,l=this.algorithm.forgetting_curve(i,u),h=ae.card(this.current),m=ae.card(this.current),k=ae.card(this.current),g=ae.card(this.current);this.next_ds(h,m,k,g,o,u,l),this.next_interval(h,m,k,g,i),this.next_state(h,m,k,g),h.lapses+=1;const S={card:h,log:this.buildLog(U.Again)},N={card:m,log:super.buildLog(U.Hard)},L={card:k,log:super.buildLog(U.Good)},D={card:g,log:super.buildLog(U.Easy)};return this.next.set(U.Again,S),this.next.set(U.Hard,N),this.next.set(U.Good,L),this.next.set(U.Easy,D),this.next.get(e)}next_ds(e,n,i,o,u,l,h){e.difficulty=this.algorithm.next_difficulty(u,U.Again),e.stability=this.algorithm.next_forget_stability(u,l,h),n.difficulty=this.algorithm.next_difficulty(u,U.Hard),n.stability=this.algorithm.next_recall_stability(u,l,h,U.Hard),i.difficulty=this.algorithm.next_difficulty(u,U.Good),i.stability=this.algorithm.next_recall_stability(u,l,h,U.Good),o.difficulty=this.algorithm.next_difficulty(u,U.Easy),o.stability=this.algorithm.next_recall_stability(u,l,h,U.Easy)}next_interval(e,n,i,o,u){let l,h;l=this.algorithm.next_interval(n.stability,u),h=this.algorithm.next_interval(i.stability,u),l=Math.min(l,h),h=Math.max(h,l+1);const m=Math.max(this.algorithm.next_interval(o.stability,u),h+1);e.scheduled_days=0,e.due=this.review_time.scheduler(5),n.scheduled_days=l,n.due=this.review_time.scheduler(l,!0),i.scheduled_days=h,i.due=this.review_time.scheduler(h,!0),o.scheduled_days=m,o.due=this.review_time.scheduler(m,!0)}next_state(e,n,i,o){e.state=de.Relearning,n.state=de.Review,i.state=de.Review,o.state=de.Review}}class go extends oa{newState(e){const n=this.next.get(e);if(n)return n;this.current.scheduled_days=0,this.current.elapsed_days=0;const i=ae.card(this.current),o=ae.card(this.current),u=ae.card(this.current),l=ae.card(this.current);return this.init_ds(i,o,u,l),this.next_interval(i,o,u,l,0),this.next_state(i,o,u,l),this.update_next(i,o,u,l),this.next.get(e)}init_ds(e,n,i,o){e.difficulty=this.algorithm.init_difficulty(U.Again),e.stability=this.algorithm.init_stability(U.Again),n.difficulty=this.algorithm.init_difficulty(U.Hard),n.stability=this.algorithm.init_stability(U.Hard),i.difficulty=this.algorithm.init_difficulty(U.Good),i.stability=this.algorithm.init_stability(U.Good),o.difficulty=this.algorithm.init_difficulty(U.Easy),o.stability=this.algorithm.init_stability(U.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){const n=this.next.get(e);if(n)return n;const i=this.current.elapsed_days,{difficulty:o,stability:u}=this.last,l=this.algorithm.forgetting_curve(i,u),h=ae.card(this.current),m=ae.card(this.current),k=ae.card(this.current),g=ae.card(this.current);return this.next_ds(h,m,k,g,o,u,l),this.next_interval(h,m,k,g,i),this.next_state(h,m,k,g),h.lapses+=1,this.update_next(h,m,k,g),this.next.get(e)}next_ds(e,n,i,o,u,l,h){e.difficulty=this.algorithm.next_difficulty(u,U.Again),e.stability=this.algorithm.next_forget_stability(u,l,h),n.difficulty=this.algorithm.next_difficulty(u,U.Hard),n.stability=this.algorithm.next_recall_stability(u,l,h,U.Hard),i.difficulty=this.algorithm.next_difficulty(u,U.Good),i.stability=this.algorithm.next_recall_stability(u,l,h,U.Good),o.difficulty=this.algorithm.next_difficulty(u,U.Easy),o.stability=this.algorithm.next_recall_stability(u,l,h,U.Easy)}next_interval(e,n,i,o,u){let l,h,m,k;l=this.algorithm.next_interval(e.stability,u),h=this.algorithm.next_interval(n.stability,u),m=this.algorithm.next_interval(i.stability,u),k=this.algorithm.next_interval(o.stability,u),l=Math.min(l,h),h=Math.max(h,l+1),m=Math.max(m,h+1),k=Math.max(k,m+1),e.scheduled_days=l,e.due=this.review_time.scheduler(l,!0),n.scheduled_days=h,n.due=this.review_time.scheduler(h,!0),i.scheduled_days=m,i.due=this.review_time.scheduler(m,!0),o.scheduled_days=k,o.due=this.review_time.scheduler(k,!0)}next_state(e,n,i,o){e.state=de.Review,n.state=de.Review,i.state=de.Review,o.state=de.Review}update_next(e,n,i,o){const u={card:e,log:this.buildLog(U.Again)},l={card:n,log:super.buildLog(U.Hard)},h={card:i,log:super.buildLog(U.Good)},m={card:o,log:super.buildLog(U.Easy)};this.next.set(U.Again,u),this.next.set(U.Hard,l),this.next.set(U.Good,h),this.next.set(U.Easy,m)}}class Jc{fsrs;constructor(e){this.fsrs=e}replay(e,n,i){return this.fsrs.next(e,n,i)}handleManualRating(e,n,i,o,u,l,h){if(typeof n>"u")throw new Error("reschedule: state is required for manual rating");let m,k;if(n===de.New)m={rating:U.Manual,state:n,due:h??i,stability:e.stability,difficulty:e.difficulty,elapsed_days:o,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:i},k=Dr(i),k.last_review=i;else{if(typeof h>"u")throw new Error("reschedule: due is required for manual rating");const g=h.diff(i,"days");m={rating:U.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:o,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:i},k={...e,state:n,due:h,last_review:i,stability:u||e.stability,difficulty:l||e.difficulty,elapsed_days:o,scheduled_days:g,reps:e.reps+1}}return{card:k,log:m}}reschedule(e,n){const i=[];let o=Dr(e.due);for(const u of n){let l;if(u.review=ae.time(u.review),u.rating===U.Manual){let h=0;o.state!==de.New&&o.last_review&&(h=u.review.diff(o.last_review,"days")),l=this.handleManualRating(o,u.state,u.review,h,u.stability,u.difficulty,u.due?ae.time(u.due):void 0)}else l=this.replay(o,u.review,u.rating);i.push(l),o=l.card}return i}calculateManualRecord(e,n,i,o){if(!i)return null;const{card:u,log:l}=i,h=ae.card(e);return h.due.getTime()===u.due.getTime()?null:(h.scheduled_days=u.due.diff(h.due,"days"),this.handleManualRating(h,u.state,ae.time(n),l.elapsed_days,o?u.stability:void 0,o?u.difficulty:void 0,u.due))}}class Zc extends Xc{Scheduler;constructor(e){super(e);const{enable_short_term:n}=this.parameters;this.Scheduler=n?yo:go}params_handler_proxy(){const e=this;return{set:function(n,i,o){return i==="request_retention"&&Number.isFinite(o)?e.intervalModifier=e.calculate_interval_modifier(Number(o)):i==="enable_short_term"&&(e.Scheduler=o===!0?yo:go),Reflect.set(n,i,o),!0}}}repeat(e,n,i){const o=this.Scheduler,u=new o(e,n,this).preview();return i&&typeof i=="function"?i(u):u}next(e,n,i,o){const u=this.Scheduler,l=new u(e,n,this),h=ae.rating(i);if(h===U.Manual)throw new Error("Cannot review a manual rating");const m=l.review(h);return o&&typeof o=="function"?o(m):m}get_retrievability(e,n,i=!0){const o=ae.card(e);n=n?ae.time(n):new Date;const u=o.state!==de.New?Math.max(n.diff(o.last_review,"days"),0):0,l=o.state!==de.New?this.forgetting_curve(u,+o.stability.toFixed(8)):0;return i?`${(l*100).toFixed(2)}%`:l}rollback(e,n,i){const o=ae.card(e),u=ae.review_log(n);if(u.rating===U.Manual)throw new Error("Cannot rollback a manual rating");let l,h,m;switch(u.state){case de.New:l=u.due,h=void 0,m=0;break;case de.Learning:case de.Relearning:case de.Review:l=u.review,h=u.due,m=o.lapses-(u.rating===U.Again&&u.state===de.Review?1:0);break}const k={...o,due:l,stability:u.stability,difficulty:u.difficulty,elapsed_days:u.last_elapsed_days,scheduled_days:u.scheduled_days,reps:Math.max(0,o.reps-1),lapses:Math.max(0,m),state:u.state,last_review:h};return i&&typeof i=="function"?i(k):k}forget(e,n,i=!1,o){const u=ae.card(e);n=ae.time(n);const l=u.state===de.New?0:n.diff(u.last_review,"days"),h={rating:U.Manual,state:u.state,due:u.due,stability:u.stability,difficulty:u.difficulty,elapsed_days:0,last_elapsed_days:u.elapsed_days,scheduled_days:l,review:n},m={card:{...u,due:n,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:u.reps,lapses:i?0:u.lapses,state:de.New,last_review:u.last_review},log:h};return o&&typeof o=="function"?o(m):m}reschedule(e,n=[],i={}){const{recordLogHandler:o,reviewsOrderBy:u,skipManual:l=!0,now:h=new Date,update_memory_state:m=!1}=i;u&&typeof u=="function"&&n.sort(u),l&&(n=n.filter(D=>D.rating!==U.Manual));const k=new Jc(this),g=k.reschedule(i.first_card||Dr(),n),S=g.length,N=ae.card(e),L=k.calculateManualRecord(N,h,S?g[S-1]:void 0,m);return o&&typeof o=="function"?{collections:g.map(o),reschedule_item:L?o(L):null}:{collections:g,reschedule_item:L}}}const Ir=["a","b","c","d","e","f","g","h"],aa=["1","2","3","4","5","6","7","8"],Gt=["white","black"],Ye=["pawn","knight","bishop","rook","queen","king"],el=["a","h"],Un=t=>"role"in t,Z=t=>t!==void 0,Me=t=>t==="white"?"black":"white",Ht=t=>t>>3,$e=t=>t&7,Ji=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,Ft=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function dn(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function pn(t){if(t.length===2)return Ji(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const Ot=t=>Ir[$e(t)]+aa[Ht(t)],cs=t=>{if(t[1]==="@"&&t.length===4){const e=dn(t[0]),n=pn(t.slice(2));if(e&&Z(n))return{role:e,to:n}}else if(t.length===4||t.length===5){const e=pn(t.slice(0,2)),n=pn(t.slice(2,4));let i;if(t.length===5&&(i=dn(t[4]),!i))return;if(Z(e)&&Z(n))return{from:e,to:n,promotion:i}}},vo=t=>Un(t)?`${Ft(t.role).toUpperCase()}@${Ot(t.to)}`:Ot(t.from)+Ot(t.to)+(t.promotion?Ft(t.promotion):""),ls=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,hs=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,bo=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),Zi=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),wo=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,Zi(t));class K{constructor(e,n){this.lo=e|0,this.hi=n|0}static fromSquare(e){return e>=32?new K(0,1<<e-32):new K(1<<e,0)}static fromRank(e){return new K(255,0).shl64(8*e)}static fromFile(e){return new K(16843009<<e,16843009<<e)}static empty(){return new K(0,0)}static full(){return new K(4294967295,4294967295)}static corners(){return new K(129,2164260864)}static center(){return new K(402653184,24)}static backranks(){return new K(255,4278190080)}static backrank(e){return e==="white"?new K(255,0):new K(0,4278190080)}static lightSquares(){return new K(1437226410,1437226410)}static darkSquares(){return new K(2857740885,2857740885)}complement(){return new K(~this.lo,~this.hi)}xor(e){return new K(this.lo^e.lo,this.hi^e.hi)}union(e){return new K(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new K(this.lo&e.lo,this.hi&e.hi)}diff(e){return new K(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?K.empty():e>=32?new K(this.hi>>>e-32,0):e>0?new K(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?K.empty():e>=32?new K(0,this.lo<<e-32):e>0?new K(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new K(Zi(this.hi),Zi(this.lo))}rbit64(){return new K(wo(this.hi),wo(this.lo))}minus64(e){const n=this.lo-e.lo,i=(n&e.lo&1)+(e.lo>>>1)+(n>>>1)>>>31;return new K(n,this.hi-(e.hi+i))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return bo(this.lo)+bo(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,n){return n?this.with(e):this.without(e)}with(e){return e>=32?new K(this.lo,this.hi|1<<e-32):new K(this.lo|1<<e,this.hi)}without(e){return e>=32?new K(this.lo,this.hi&~(1<<e-32)):new K(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new K(this.lo,this.hi^1<<e-32):new K(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new K(this.lo&this.lo-1,this.hi):new K(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,n=this.hi;for(;e!==0;){const i=31-Math.clz32(e&-e);e^=1<<i,yield i}for(;n!==0;){const i=31-Math.clz32(n&-n);n^=1<<i,yield 32+i}}*reversed(){let e=this.lo,n=this.hi;for(;n!==0;){const i=31-Math.clz32(n);n^=1<<i,yield 32+i}for(;e!==0;){const i=31-Math.clz32(e);e^=1<<i,yield i}}}const jr=(t,e)=>{let n=K.empty();for(const i of e){const o=t+i;0<=o&&o<64&&Math.abs($e(t)-$e(o))<=2&&(n=n.with(o))}return n},Ct=t=>{const e=[];for(let n=0;n<64;n++)e[n]=t(n);return e},tl=Ct(t=>jr(t,[-9,-8,-7,-1,1,7,8,9])),nl=Ct(t=>jr(t,[-17,-15,-10,-6,6,10,15,17])),rl={white:Ct(t=>jr(t,[7,9])),black:Ct(t=>jr(t,[-7,-9]))},Ur=t=>tl[t],Vr=t=>nl[t],Xn=(t,e)=>rl[t][e],es=Ct(t=>K.fromFile($e(t)).without(t)),ts=Ct(t=>K.fromRank(Ht(t)).without(t)),ns=Ct(t=>{const e=new K(134480385,2151686160),n=8*(Ht(t)-$e(t));return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),rs=Ct(t=>{const e=new K(270549120,16909320),n=8*(Ht(t)+$e(t)-7);return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),is=(t,e,n)=>{let i=n.intersect(e),o=i.bswap64();return i=i.minus64(t),o=o.minus64(t.bswap64()),i.xor(o.bswap64()).intersect(e)},il=(t,e)=>is(K.fromSquare(t),es[t],e),sl=(t,e)=>{const n=ts[t];let i=e.intersect(n),o=i.rbit64();return i=i.minus64(K.fromSquare(t)),o=o.minus64(K.fromSquare(63-t)),i.xor(o.rbit64()).intersect(n)},vn=(t,e)=>{const n=K.fromSquare(t);return is(n,ns[t],e).xor(is(n,rs[t],e))},bn=(t,e)=>il(t,e).xor(sl(t,e)),fs=(t,e)=>vn(t,e).xor(bn(t,e)),ol=(t,e,n)=>{switch(t.role){case"pawn":return Xn(t.color,e);case"knight":return Vr(e);case"bishop":return vn(e,n);case"rook":return bn(e,n);case"queen":return fs(e,n);case"king":return Ur(e)}},ua=(t,e)=>{const n=K.fromSquare(e);return ts[t].intersects(n)?ts[t].with(t):rs[t].intersects(n)?rs[t].with(t):ns[t].intersects(n)?ns[t].with(t):es[t].intersects(n)?es[t].with(t):K.empty()},Vn=(t,e)=>ua(t,e).intersect(K.full().shl64(t).xor(K.full().shl64(e))).withoutFirst();class mn{constructor(){}static default(){const e=new mn;return e.reset(),e}reset(){this.occupied=new K(65535,4294901760),this.promoted=K.empty(),this.white=new K(65535,0),this.black=new K(0,4294901760),this.pawn=new K(65280,16711680),this.knight=new K(66,1107296256),this.bishop=new K(36,603979776),this.rook=new K(129,2164260864),this.queen=new K(8,134217728),this.king=new K(16,268435456)}static empty(){const e=new mn;return e.clear(),e}clear(){this.occupied=K.empty(),this.promoted=K.empty();for(const e of Gt)this[e]=K.empty();for(const e of Ye)this[e]=K.empty()}clone(){const e=new mn;e.occupied=this.occupied,e.promoted=this.promoted;for(const n of Gt)e[n]=this[n];for(const n of Ye)e[n]=this[n];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const n of Ye)if(this[n].has(e))return n}get(e){const n=this.getColor(e);if(!n)return;const i=this.getRole(e),o=this.promoted.has(e);return{color:n,role:i,promoted:o}}take(e){const n=this.get(e);return n&&(this.occupied=this.occupied.without(e),this[n.color]=this[n.color].without(e),this[n.role]=this[n.role].without(e),n.promoted&&(this.promoted=this.promoted.without(e))),n}set(e,n){const i=this.take(e);return this.occupied=this.occupied.with(e),this[n.color]=this[n.color].with(e),this[n.role]=this[n.role].with(e),n.promoted&&(this.promoted=this.promoted.with(e)),i}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,n){return this[e].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class st{constructor(){}static empty(){const e=new st;for(const n of Ye)e[n]=0;return e}static fromBoard(e,n){const i=new st;for(const o of Ye)i[o]=e.pieces(n,o).size();return i}clone(){const e=new st;for(const n of Ye)e[n]=this[n];return e}equals(e){return Ye.every(n=>this[n]===e[n])}add(e){const n=new st;for(const i of Ye)n[i]=this[i]+e[i];return n}subtract(e){const n=new st;for(const i of Ye)n[i]=this[i]-e[i];return n}nonEmpty(){return Ye.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Lt{constructor(e,n){this.white=e,this.black=n}static empty(){return new Lt(st.empty(),st.empty())}static fromBoard(e){return new Lt(st.fromBoard(e,"white"),st.fromBoard(e,"black"))}clone(){return new Lt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new Lt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new Lt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class zn{constructor(e,n){this.white=e,this.black=n}static default(){return new zn(3,3)}clone(){return new zn(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}class ca{unwrap(e,n){const i=this._chain(o=>re.ok(e?e(o):o),o=>n?re.ok(n(o)):re.err(o));if(i.isErr)throw i.error;return i.value}map(e,n){return this._chain(i=>re.ok(e(i)),i=>re.err(n?n(i):i))}chain(e,n){return this._chain(e,n||(i=>re.err(i)))}}class al extends ca{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,n){return e(this.value)}}class ul extends ca{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,n){return n(this.error)}}var re;(function(t){t.ok=function(e){return new al(e)},t.err=function(e){return new ul(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let u=0;u<e.length;u++){const l=e[u];if(l.isErr)return l;o.push(l.value)}return t.ok(o)}const n={},i=Object.keys(e);for(let o=0;o<i.length;o++){const u=e[i[o]];if(u.isErr)return u;n[i[o]]=u.value}return t.ok(n)}})(re||(re={}));var At;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(At||(At={}));class on extends Error{}const cl=(t,e,n,i)=>n[e].intersect(bn(t,i).intersect(n.rooksAndQueens()).union(vn(t,i).intersect(n.bishopsAndQueens())).union(Vr(t).intersect(n.knight)).union(Ur(t).intersect(n.king)).union(Xn(Me(e),t).intersect(n.pawn)));class $t{constructor(){}static default(){const e=new $t;return e.castlingRights=K.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new K(14,0),h:new K(96,0)},black:{a:new K(0,234881024),h:new K(0,1610612736)}},e}static empty(){const e=new $t;return e.castlingRights=K.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:K.empty(),h:K.empty()},black:{a:K.empty(),h:K.empty()}},e}clone(){const e=new $t;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,n,i,o){const u=ls(e,n),l=hs(e,n);this.castlingRights=this.castlingRights.with(o),this.rook[e][n]=o,this.path[e][n]=Vn(o,l).with(l).union(Vn(i,u).with(u)).without(i).without(o)}static fromSetup(e){const n=$t.empty(),i=e.castlingRights.intersect(e.board.rook);for(const o of Gt){const u=K.backrank(o),l=e.board.kingOf(o);if(!Z(l)||!u.has(l))continue;const h=i.intersect(e.board[o]).intersect(u),m=h.first();Z(m)&&m<l&&n.add(o,"a",l,m);const k=h.last();Z(k)&&l<k&&n.add(o,"h",l,k)}return n}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const n of Gt)for(const i of el)this.rook[n][i]===e&&(this.rook[n][i]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(K.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class ll{constructor(e){this.rules=e}reset(){this.board=mn.default(),this.pockets=void 0,this.turn="white",this.castles=$t.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=K.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=$t.fromSetup(e),this.epSquare=hl(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,n,i){return cl(e,n,this.board,i)}playCaptureAt(e,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[Me(n.color)][n.promoted?"pawn":n.role]++}ctx(){const e=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!Z(n))return{king:n,blockers:K.empty(),checkers:K.empty(),variantEnd:e,mustCapture:!1};const i=bn(n,K.empty()).intersect(this.board.rooksAndQueens()).union(vn(n,K.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[Me(this.turn)]);let o=K.empty();for(const l of i){const h=Vn(n,l).intersect(this.board.occupied);h.moreThanOne()||(o=o.union(h))}const u=this.kingAttackers(n,Me(this.turn),this.board.occupied);return{king:n,blockers:o,checkers:u,variantEnd:e,mustCapture:!1}}clone(){var e,n;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return re.err(new on(At.Empty));if(this.board.king.size()!==2)return re.err(new on(At.Kings));if(!Z(this.board.kingOf(this.turn)))return re.err(new on(At.Kings));const e=this.board.kingOf(Me(this.turn));return Z(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?re.err(new on(At.OppositeCheck)):K.backranks().intersects(this.board.pawn)?re.err(new on(At.PawnsOnBackrank)):re.ok(void 0):re.err(new on(At.Kings))}dropDests(e){return K.empty()}dests(e,n){if(n=n||this.ctx(),n.variantEnd)return K.empty();const i=this.board.get(e);if(!i||i.color!==this.turn)return K.empty();let o,u;if(i.role==="pawn"){o=Xn(this.turn,e).intersect(this.board[Me(this.turn)]);const l=this.turn==="white"?8:-8,h=e+l;if(0<=h&&h<64&&!this.board.occupied.has(h)){o=o.with(h);const m=this.turn==="white"?e<16:e>=48,k=h+l;m&&!this.board.occupied.has(k)&&(o=o.with(k))}Z(this.epSquare)&&dl(this,e,n)&&(u=K.fromSquare(this.epSquare))}else i.role==="bishop"?o=vn(e,this.board.occupied):i.role==="knight"?o=Vr(e):i.role==="rook"?o=bn(e,this.board.occupied):i.role==="queen"?o=fs(e,this.board.occupied):o=Ur(e);if(o=o.diff(this.board[this.turn]),Z(n.king)){if(i.role==="king"){const l=this.board.occupied.without(e);for(const h of o)this.kingAttackers(h,Me(this.turn),l).nonEmpty()&&(o=o.without(h));return o.union(_o(this,"a",n)).union(_o(this,"h",n))}if(n.checkers.nonEmpty()){const l=n.checkers.singleSquare();if(!Z(l))return K.empty();o=o.intersect(Vn(l,n.king).with(l))}n.blockers.has(e)&&(o=o.intersect(ua(e,n.king)))}return u&&(o=o.union(u)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[Me(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(K.darkSquares())||!this.board.bishop.intersects(K.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,n;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:fl(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return Gt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,n){if(Un(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&K.backranks().has(e.to)?!1:this.dropDests(n).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&K.backranks().has(e.to)))return!1;const i=this.dests(e.from,n);return i.has(e.to)||i.has(pl(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return Z(e)&&this.kingAttackers(e,Me(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const n=this.variantOutcome(e);return n||(e=e||this.ctx(),this.isCheckmate(e)?{winner:Me(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const n=new Map;if(e.variantEnd)return n;for(const i of this.board[this.turn])n.set(i,this.dests(i,e));return n}play(e){const n=this.turn,i=this.epSquare,o=la(this,e);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=Me(n),Un(e))this.board.set(e.to,{role:e.role,color:n}),this.pockets&&this.pockets[n][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const u=this.board.take(e.from);if(!u)return;let l;if(u.role==="pawn"){this.halfmoves=0,e.to===i&&(l=this.board.take(e.to+(n==="white"?-8:8)));const h=e.from-e.to;Math.abs(h)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(u.role=e.promotion,u.promoted=!!this.pockets)}else if(u.role==="rook")this.castles.discardRook(e.from);else if(u.role==="king"){if(o){const h=this.castles.rook[n][o];if(Z(h)){const m=this.board.take(h);this.board.set(ls(n,o),u),m&&this.board.set(hs(n,o),m)}}this.castles.discardColor(n)}if(!o){const h=this.board.set(e.to,u)||l;h&&this.playCaptureAt(e.to,h)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Jn extends ll{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const n=new this;return n.setupUnchecked(e),n.validate().map(i=>n)}clone(){return super.clone()}}const hl=(t,e)=>{if(!Z(e))return;const n=t.turn==="white"?5:2,i=t.turn==="white"?8:-8;if(Ht(e)!==n||t.board.occupied.has(e+i))return;const o=e-i;if(!(!t.board.pawn.has(o)||!t.board[Me(t.turn)].has(o)))return e},fl=t=>{if(!Z(t.epSquare))return;const e=t.ctx(),i=t.board.pieces(t.turn,"pawn").intersect(Xn(Me(t.turn),t.epSquare));for(const o of i)if(t.dests(o,e).has(t.epSquare))return t.epSquare},dl=(t,e,n)=>{if(!Z(t.epSquare)||!Xn(t.turn,e).has(t.epSquare))return!1;if(!Z(n.king))return!0;const i=t.turn==="white"?8:-8,o=t.epSquare-i;return t.kingAttackers(n.king,Me(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},_o=(t,e,n)=>{if(!Z(n.king)||n.checkers.nonEmpty())return K.empty();const i=t.castles.rook[t.turn][e];if(!Z(i)||t.castles.path[t.turn][e].intersects(t.board.occupied))return K.empty();const o=ls(t.turn,e),u=Vn(n.king,o),l=t.board.occupied.without(n.king);for(const k of u)if(t.kingAttackers(k,Me(t.turn),l).nonEmpty())return K.empty();const h=hs(t.turn,e),m=t.board.occupied.toggle(n.king).toggle(i).toggle(h);return t.kingAttackers(o,Me(t.turn),m).nonEmpty()?K.empty():K.fromSquare(i)},la=(t,e)=>{if(Un(e))return;const n=e.to-e.from;if(!(Math.abs(n)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return n>0?"h":"a"},pl=(t,e)=>{const n=la(t,e);if(!n)return e;const i=t.castles.rook[t.turn][n];return{from:e.from,to:Z(i)?i:e.to}},ml=(t,e)=>{const n=new Map,i=t.ctx();for(const[o,u]of t.allDests(i))if(u.nonEmpty()){const l=Array.from(u,Ot);!e?.chess960&&o===i.king&&$e(o)===4&&(u.has(0)?l.push("c1"):u.has(56)&&l.push("c8"),u.has(7)?l.push("g1"):u.has(63)&&l.push("g8")),n.set(Ot(o),l)}return n},yl="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",gl=yl+" w KQkq -",ha=gl+" 0 1";var Se;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(Se||(Se={}));class Ne extends Error{}const vl=(t,e,n)=>{let i=t.indexOf(e);for(;n-- >0&&i!==-1;)i=t.indexOf(e,i+e.length);return i},ln=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,fa=t=>{const e=dn(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},Ii=t=>{const e=mn.empty();let n=7,i=0;for(let o=0;o<t.length;o++){const u=t[o];if(u==="/"&&i===8)i=0,n--;else{const l=parseInt(u,10);if(l>0)i+=l;else{if(i>=8||n<0)return re.err(new Ne(Se.Board));const h=i+n*8,m=fa(u);if(!m)return re.err(new Ne(Se.Board));t[o+1]==="~"&&(m.promoted=!0,o++),e.set(h,m),i++}}}return n!==0||i!==8?re.err(new Ne(Se.Board)):re.ok(e)},ko=t=>{if(t.length>64)return re.err(new Ne(Se.Pockets));const e=Lt.empty();for(const n of t){const i=fa(n);if(!i)return re.err(new Ne(Se.Pockets));e[i.color][i.role]++}return re.ok(e)},bl=(t,e)=>{let n=K.empty();if(e==="-")return re.ok(n);for(const i of e){const o=i.toLowerCase(),u=i===o?"black":"white",l=u==="white"?0:7;if("a"<=o&&o<="h")n=n.with(Ji(o.charCodeAt(0)-97,l));else if(o==="k"||o==="q"){const h=t[u].intersect(K.backrank(u)).intersect(t.rook.union(t.king)),m=o==="k"?h.last():h.first();n=n.with(Z(m)&&t.rook.has(m)?m:Ji(o==="k"?7:0,l))}else return re.err(new Ne(Se.Castling))}return Gt.some(i=>K.backrank(i).intersect(n).size()>2)?re.err(new Ne(Se.Castling)):re.ok(n)},xo=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const n=ln(e[1]),i=ln(e[2]);return!Z(n)||n>3||!Z(i)||i>3?re.err(new Ne(Se.RemainingChecks)):re.ok(new zn(3-n,3-i))}else if(e.length===2){const n=ln(e[0]),i=ln(e[1]);return!Z(n)||n>3||!Z(i)||i>3?re.err(new Ne(Se.RemainingChecks)):re.ok(new zn(n,i))}else return re.err(new Ne(Se.RemainingChecks))},_n=t=>{const e=t.split(/[\s_]+/),n=e.shift();let i,o=re.ok(void 0);if(n.endsWith("]")){const h=n.indexOf("[");if(h===-1)return re.err(new Ne(Se.Fen));i=Ii(n.slice(0,h)),o=ko(n.slice(h+1,-1))}else{const h=vl(n,"/",7);h===-1?i=Ii(n):(i=Ii(n.slice(0,h)),o=ko(n.slice(h+1)))}let u;const l=e.shift();if(!Z(l)||l==="w")u="white";else if(l==="b")u="black";else return re.err(new Ne(Se.Turn));return i.chain(h=>{const m=e.shift(),k=Z(m)?bl(h,m):re.ok(K.empty()),g=e.shift();let S;if(Z(g)&&g!=="-"&&(S=pn(g),!Z(S)))return re.err(new Ne(Se.EpSquare));let N=e.shift(),L;Z(N)&&N.includes("+")&&(L=xo(N),N=e.shift());const D=Z(N)?ln(N):0;if(!Z(D))return re.err(new Ne(Se.Halfmoves));const z=e.shift(),Q=Z(z)?ln(z):1;if(!Z(Q))return re.err(new Ne(Se.Fullmoves));const X=e.shift();let he=re.ok(void 0);if(Z(X)){if(Z(L))return re.err(new Ne(Se.RemainingChecks));he=xo(X)}else Z(L)&&(he=L);return e.length>0?re.err(new Ne(Se.Fen)):o.chain(ne=>k.chain(ce=>he.map(me=>({board:h,pockets:ne,turn:u,castlingRights:ce,remainingChecks:me,epSquare:S,halfmoves:D,fullmoves:Math.max(1,Q)}))))})},wl=t=>{let e=Ft(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},_l=t=>{let e="",n=0;for(let i=7;i>=0;i--)for(let o=0;o<8;o++){const u=o+i*8,l=t.get(u);l?(n>0&&(e+=n,n=0),e+=wl(l)):n++,o===7&&(n>0&&(e+=n,n=0),i!==0&&(e+="/"))}return e},Eo=t=>Ye.map(e=>Ft(e).repeat(t[e])).join(""),kl=t=>Eo(t.white).toUpperCase()+Eo(t.black),xl=(t,e)=>{let n="";for(const i of Gt){const o=K.backrank(i);let u=t.kingOf(i);Z(u)&&!o.has(u)&&(u=void 0);const l=t.pieces(i,"rook").intersect(o);for(const h of e.intersect(o).reversed())if(h===l.first()&&Z(u)&&h<u)n+=i==="white"?"Q":"q";else if(h===l.last()&&Z(u)&&u<h)n+=i==="white"?"K":"k";else{const m=Ir[$e(h)];n+=i==="white"?m.toUpperCase():m}}return n||"-"},El=t=>`${t.white}+${t.black}`,da=(t,e)=>[_l(t.board)+(t.pockets?`[${kl(t.pockets)}]`:""),t.turn[0],xl(t.board,t.castlingRights),Z(t.epSquare)?Ot(t.epSquare):"-",...t.remainingChecks?[El(t.remainingChecks)]:[],...e?.epd?[]:[Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))]].join(" "),Al=(t,e)=>{let n="";if(Un(e))e.role!=="pawn"&&(n=Ft(e.role).toUpperCase()),n+="@"+Ot(e.to);else{const i=t.board.getRole(e.from);if(!i)return"--";if(i==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))n=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||i==="pawn"&&$e(e.from)!==$e(e.to);if(i!=="pawn"){n=Ft(i).toUpperCase();let u;if(i==="king"?u=Ur(e.to).intersect(t.board.king):i==="queen"?u=fs(e.to,t.board.occupied).intersect(t.board.queen):i==="rook"?u=bn(e.to,t.board.occupied).intersect(t.board.rook):i==="bishop"?u=vn(e.to,t.board.occupied).intersect(t.board.bishop):u=Vr(e.to).intersect(t.board.knight),u=u.intersect(t.board[t.turn]).without(e.from),u.nonEmpty()){const l=t.ctx();for(const h of u)t.dests(h,l).has(e.to)||(u=u.without(h));if(u.nonEmpty()){let h=!1,m=u.intersects(K.fromRank(Ht(e.from)));u.intersects(K.fromFile($e(e.from)))?h=!0:m=!0,m&&(n+=Ir[$e(e.from)]),h&&(n+=aa[Ht(e.from)])}}}else o&&(n=Ir[$e(e.from)]);o&&(n+="x"),n+=Ot(e.to),e.promotion&&(n+="="+Ft(e.promotion).toUpperCase())}}return n},Ol=(t,e)=>{var n;const i=Al(t,e);return t.play(e),!((n=t.outcome())===null||n===void 0)&&n.winner?i+"#":t.isCheck()?i+"+":i},pa=(t,e)=>Ol(t.clone(),e),Ao=(t,e)=>{const n=t.ctx(),i=e.match(/^([NBRQK])?([a-h])?([1-8])?[-x]?([a-h][1-8])(?:=?([nbrqkNBRQK]))?[+#]?$/);if(!i){let g;if(e==="O-O"||e==="O-O+"||e==="O-O#"?g="h":(e==="O-O-O"||e==="O-O-O+"||e==="O-O-O#")&&(g="a"),g){const L=t.castles.rook[t.turn][g];return!Z(n.king)||!Z(L)||!t.dests(n.king,n).has(L)?void 0:{from:n.king,to:L}}const S=e.match(/^([pnbrqkPNBRQK])?@([a-h][1-8])[+#]?$/);if(!S)return;const N={role:S[1]?dn(S[1]):"pawn",to:pn(S[2])};return t.isLegal(N,n)?N:void 0}const o=i[1]?dn(i[1]):"pawn",u=pn(i[4]),l=i[5]?dn(i[5]):void 0;if(!!l!==(o==="pawn"&&K.backranks().has(u))||l==="king"&&t.rules!=="antichess")return;let h=t.board.pieces(t.turn,o);o==="pawn"&&!i[2]?h=h.intersect(K.fromFile($e(u))):i[2]&&(h=h.intersect(K.fromFile(i[2].charCodeAt(0)-97))),i[3]&&(h=h.intersect(K.fromRank(i[3].charCodeAt(0)-49)));const m=o==="pawn"?K.fromFile($e(u)):K.empty();h=h.intersect(m.union(ol({color:Me(t.turn),role:o},u,t.board.occupied)));let k;for(const g of h)if(t.dests(g,n).has(u)){if(Z(k))return;k=g}if(Z(k))return{from:k,to:u,promotion:l}},Pl=(t=ds)=>({headers:t(),moves:new ma});let ma=class{constructor(){this.children=[]}*mainlineNodes(){let e=this;for(;e.children.length;){const n=e.children[0];yield n,e=n}}*mainline(){for(const e of this.mainlineNodes())yield e.data}end(){let e=this;for(;e.children.length;)e=e.children[0];return e}};class Cl extends ma{constructor(e){super(),this.data=e}}const ds=()=>new Map([["Event","?"],["Site","?"],["Date","????.??.??"],["Round","?"],["White","?"],["Black","?"],["Result","*"]]),Oo="\uFEFF",ji=t=>/^\s*$/.test(t),Bi=t=>t.startsWith("%");class Sl extends Error{}class Rl{constructor(e,n=ds,i=1e6){this.emitGame=e,this.initHeaders=n,this.maxBudget=i,this.lineBuf=[],this.resetGame(),this.state=0}resetGame(){this.budget=this.maxBudget,this.found=!1,this.state=1,this.game=Pl(this.initHeaders),this.stack=[{parent:this.game.moves,root:!0}],this.commentBuf=[]}consumeBudget(e){if(this.budget-=e,this.budget<0)throw new Sl("ERR_PGN_BUDGET")}parse(e,n){if(!(this.budget<0))try{let i=0;for(;;){const o=e.indexOf(`
`,i);if(o===-1)break;const u=o>i&&e[o-1]==="\r"?o-1:o;this.consumeBudget(o-i),this.lineBuf.push(e.slice(i,u)),i=o+1,this.handleLine()}this.consumeBudget(e.length-i),this.lineBuf.push(e.slice(i)),n?.stream||(this.handleLine(),this.emit(void 0))}catch(i){this.emit(i)}}handleLine(){let e=!0,n=this.lineBuf.join("");this.lineBuf=[];e:for(;;)switch(this.state){case 0:n.startsWith(Oo)&&(n=n.slice(Oo.length)),this.state=1;case 1:if(ji(n)||Bi(n))return;this.found=!0,this.state=2;case 2:{if(Bi(n))return;let i=!0;for(;i;)i=!1,n=n.replace(/^\s*\[([A-Za-z0-9][A-Za-z0-9_+#=:-]*)\s+"((?:[^"\\]|\\"|\\\\)*)"\]/,(o,u,l)=>(this.consumeBudget(200),this.game.headers.set(u,l.replace(/\\"/g,'"').replace(/\\\\/g,"\\")),i=!0,e=!1,""));if(ji(n))return;this.state=3}case 3:{if(e){if(Bi(n))return;if(ji(n))return this.emit(void 0)}const i=/(?:[NBKRQ]?[a-h]?[1-8]?[-x]?[a-h][1-8](?:=?[nbrqkNBRQK])?|[pnbrqkPNBRQK]?@[a-h][1-8]|O-O-O|0-0-0|O-O|0-0)[+#]?|--|Z0|0000|@@@@|{|;|\$\d{1,4}|[?!]{1,2}|\(|\)|\*|1-0|0-1|1\/2-1\/2/g;let o;for(;o=i.exec(n);){const u=this.stack[this.stack.length-1];let l=o[0];if(l===";")return;if(l.startsWith("$"))this.handleNag(parseInt(l.slice(1),10));else if(l==="!")this.handleNag(1);else if(l==="?")this.handleNag(2);else if(l==="!!")this.handleNag(3);else if(l==="??")this.handleNag(4);else if(l==="!?")this.handleNag(5);else if(l==="?!")this.handleNag(6);else if(l==="1-0"||l==="0-1"||l==="1/2-1/2"||l==="*")this.stack.length===1&&l!=="*"&&this.game.headers.set("Result",l);else if(l==="(")this.consumeBudget(100),this.stack.push({parent:u.parent,root:!1});else if(l===")")this.stack.length>1&&this.stack.pop();else if(l==="{"){const h=i.lastIndex,m=n[h]===" "?h+1:h;n=n.slice(m),this.state=4;continue e}else this.consumeBudget(100),l==="Z0"||l==="0000"||l==="@@@@"?l="--":l.startsWith("0")&&(l=l.replace(/0/g,"O")),u.node&&(u.parent=u.node),u.node=new Cl({san:l,startingComments:u.startingComments}),u.startingComments=void 0,u.root=!1,u.parent.children.push(u.node)}return}case 4:{const i=n.indexOf("}");if(i===-1){this.commentBuf.push(n);return}else{const o=i>0&&n[i-1]===" "?i-1:i;this.commentBuf.push(n.slice(0,o)),this.handleComment(),n=n.slice(i),this.state=3,e=!1}}}}handleNag(e){var n;this.consumeBudget(50);const i=this.stack[this.stack.length-1];i.node&&((n=i.node.data).nags||(n.nags=[]),i.node.data.nags.push(e))}handleComment(){var e,n;this.consumeBudget(100);const i=this.stack[this.stack.length-1],o=this.commentBuf.join(`
`);this.commentBuf=[],i.node?((e=i.node.data).comments||(e.comments=[]),i.node.data.comments.push(o)):i.root?((n=this.game).comments||(n.comments=[]),this.game.comments.push(o)):(i.startingComments||(i.startingComments=[]),i.startingComments.push(o))}emit(e){if(this.state===4&&this.handleComment(),e)return this.emitGame(this.game,e);this.found&&this.emitGame(this.game,void 0),this.resetGame()}}const Tl=(t,e=ds)=>{const n=[];return new Rl(i=>n.push(i),e,NaN).parse(t),n},Ml=(t,e)=>t==="white"?e:-e,ya=t=>2/(1+Math.exp(-.00368208*t))-1,Nl=t=>ya(Math.min(Math.max(-1e3,t),1e3)),Kl=t=>{const n=(21-Math.min(10,Math.abs(t)))*100*(t>0?1:-1);return ya(n)},Dl=t=>typeof t.mate<"u"?Kl(t.mate):Nl(t.cp),Po=(t,e)=>Ml(t,Dl(e)),Il=(t,e,n)=>103.1668*Math.exp(-.04354*(Po(t,e)*100-Po(t,n)*100))-3.1669;class jl{async request_move_data(e,n){console.log(e,n);let i={cp:Math.random()*1e3},o={cp:i.cp-Math.random()*200},u=Il("white",i,o),l=$l(n).slice(0,4);return{before_cp:i,after_cp:o,accuracy:u,multi_pvs4:l}}}const Bl=new jl;function Kh(t,e){let n=_n(t).unwrap(),i=Jn.fromSetup(n).unwrap(),o=cs(e);return i.play(o),da(i.toSetup())}function Dh(t,e){let n=_n(t).unwrap(),i=Jn.fromSetup(n).unwrap(),o=cs(e);return pa(i,o)}const Ll=t=>_n(t).unwrap().turn;function $l(t){let e=Jn.fromSetup(_n(t).unwrap()).unwrap(),n=[];for(let[i,o]of ml(e))n.push(...o.map(u=>i+u));return n}class ps{constructor(e,n){this.headers=e,this.tree=n}static make_many=e=>Tl(e).flatMap(n=>{let i=n.headers.get("Event"),o=n.headers.get("Site"),u=n.headers.get("White"),l=n.headers.get("Black"),h=n.headers.get("Puzzle"),m=n.headers.get("Section"),k=n.headers.get("Chapter"),g=n.headers.get("Orientation"),S=g==="white"?"white":g==="black"?"black":void 0,N=n.headers.get("FEN"),L=N??ha,D=Jn.fromSetup(_n(L).unwrap()).unwrap(),z=n.moves.children.map(ne=>{let ce=ne.data.san,me=Ao(D,ce);return[vo(me)]}),Q=hn.make(L,z);n.moves.children.forEach(ne=>{X(Q,ne,D,[])});function X(ne,ce,me,xe){let Ee=Ao(me,ce.data.san),Ge=me.clone();Ge.play(Ee);let ye=vo(Ee),Y=ce.data.nags;ne.append_uci(ye,xe),ne.set_nags([...xe,ye],Y),ce.children.forEach(ee=>{X(ne,ee,Ge,[...xe,ye])})}return new ps({event:i,site:o,white:u,black:l,puzzle:h,section:m,chapter:k,fen:N,orientation:S},Q)});get event(){return this.headers.event}get site(){return this.headers.site}get white(){return this.headers.white}get black(){return this.headers.black}get puzzle(){return this.headers.puzzle}get section(){return this.headers.section}get chapter(){return this.headers.chapter}get fen(){return this.headers.fen}get orientation(){return this.headers.orientation}}class Ut{constructor(e){this.data=e,this._children=Ke([])}static color_of(e){return Ll(e.data.before_fen)}static make=e=>new Ut(e);get clone(){let e=new Ut({...this.data});return e.children=this.children.map(n=>n.clone),e}get all_leaves(){return this.children.length===0?[this]:this.children.flatMap(e=>e.all_leaves)}get length(){if(this.children.length>1)return 1;if(this.children.length===0)return 0;let e=1,n=this.children[0];for(;n?.children.length===1;)e++,n=n.children[0];return e}get nb_first_variations(){return this.children_first_variations?.length??0}get first_node_with_variations(){if(this.children.length!==0)return this.children.length===1?this.children[0].first_node_with_variations:this}get children_first_variations(){return this.first_node_with_variations?.children}get children(){return this._children[0]()}set children(e){this._children[1](e)}get all_nodes(){return[this.data,...this.children.flatMap(e=>e.all_nodes)]}_children}class ss{constructor(e){this.root=e}static make=e=>{function n(h,m){let k=h.data.path.length,g=h.length,S=h.nb_first_variations,N=-m*100+1/(k/40)*10+g/20*10+(S+1)*100,L=Ut.make({path:h.data.path,uci:h.data.uci,score:N}),D=h.children.length+m,z=D*(D+1)/2;return L.children=h.children.map((Q,X)=>n(Q,(X+m)/z)),L}function i(h){return h.data.score+h.children.map(k=>i(k)).reduce((k,g)=>k+g,0)}function o(h,m){h.data.score/=m,h.children.forEach(k=>o(k,m))}let u=e.root.map(h=>n(h,1)),l=u.map(h=>i(h)).reduce((h,m)=>h+m,0);return u.forEach(h=>o(h,l)),new ss(u)};get clone(){return new ss(this.root.map(e=>e.clone))}get progress_paths(){function e(i,o,u){o.push(i.data.path),i.children.length===0?u.push(o):i.children.length===1?e(i.children[0],o,u):(u.push(o),i.children.forEach(l=>{e(l,[],u)}))}let n=[];return this.root.forEach(i=>e(i,[],n)),n}_traverse_path(e){let n,i=this.root;for(let o of e){if(n=i.find(u=>u.data.uci===o),!n)return;i=n.children}return n}get_children(e){return this._traverse_path(e)?.children.map(i=>i.data)}get_at(e){return this._traverse_path(e)?.data}delete_at(e){const n=this._traverse_path(e.slice(0,-1));n&&(n.children=n.children.filter(i=>i.data.path.join("")!==e.join("")))}}class hn{constructor(e){this.root=e}static make=(e,n)=>{let i=n.map(u=>u[0]),o=new hn(i.map(u=>Ut.make(hn.make_data(e,u,1,[]))));return n.forEach(u=>o.append_ucis(u)),o};get before_fen(){return this.root[0]?.data.before_fen??ha}get initial_color(){if(this.root[0])return Ut.color_of(this.root[0])}get clone(){return new hn(this.root.map(e=>e.clone))}static make_data(e,n,i,o){let u=_n(e).unwrap(),l=Jn.fromSetup(u).unwrap(),h=cs(n),m=pa(l,h);return l.play(h),{path:[...o,n],ply:i,before_fen:e,san:m,after_fen:da(l.toSetup()),uci:n}}_traverse_path(e){let n,i=this.root;for(let o of e){if(n=i.find(u=>u.data.uci===o),!n)return;i=n.children}return n}_find_path(e){let n=[],i=[],o,u=this.root,l=!1;for(let h of e)if(l)i.push(h);else{let m=u?.find(k=>k.data.uci===h);m?(n.push(h),o=m,u=ke(()=>o?.children)):(l=!0,i.push(h))}return[n,o,i]}get all_moves(){return this.root.flatMap(e=>e.all_nodes)}get all_leaves(){return this.root.flatMap(e=>e.all_leaves.map(n=>n.data))}get_children(e){return this._traverse_path(e)?.children.map(i=>i.data)}async request_ceval_and_get_at(e){let n=this.get_at(e);if(n)return n.eval_accuracy=await Bl.request_move_data(n.before_fen,n.after_fen),n}siblings_of(e){return e.length===1?this.root:this._traverse_path(e.slice(0,-1))?.children}collect_branch_sums(e){let n=[],i=this.root,o=this.root.length>1;for(let u of e){let l=i.find(h=>h.data.uci===u);if(!l)return;o&&(n.push(l.data),o=!1),l.children.length>1&&(o=!0),i=l.children}return n}get_at(e){return this._traverse_path(e)?.data}delete_at(e){const n=this._traverse_path(e.slice(0,-1));n&&(n.children=n.children.filter(i=>i.data.path.join("")!==e.join("")))}set_nags(e,n){let i=this._traverse_path(e);i&&(i.data.nags=n)}append_uci(e,n=[]){this.append_ucis([...n,e])}append_ucis(e){let[n,i,o]=this._find_path(e);if(i!==void 0)for(let u of o){let l=Ut.make(hn.make_data(i.data.after_fen,u,i.data.ply+1,n)),h=ke(()=>i.children);i.children=[...h,l],i=l,n=[...n,u]}}}function Li(t){let e="",n=[];return ps.make_many(t).map(i=>{let o,u;[e,o,u]=i.event.split(":").map(m=>m.trim()),u===void 0&&(u=o);let h=n.find(m=>m.name===o);h||n.push(h={name:o,chapters:[]}),h.chapters.push({name:u,pgn:i})}),{name:e,sections:n}}class ql extends Kr{studies;sections;chapters;moves;due_cards;get all_tables(){return[this.studies,this.sections,this.chapters,this.moves,this.due_cards]}remove_database(){this.delete()}constructor(){super("RepertoiresDB"),this.version(1).stores({studies:"++id, name, import_lichess_id",sections:"++id, study_id, name",chapters:"++id, section_id, name",moves:"++id, chapter_id, before_fen, path",due_cards:"++id, before_fen, section_id, move_ids*"}),this.studies.mapToClass(Fl),this.sections.mapToClass(Ul),this.chapters.mapToClass(Vl),this.moves.mapToClass(zl),this.due_cards.mapToClass(Gl)}async get_study_by_id(e){return await this.studies.where("id").equals(e).first()}async get_study_imported_by_id(e){let n=await this.get_study_by_id(e);if(n)return Li(n.pgn_text)}async get_study_by_lichess_id(e){return await this.studies.where("import_lichess_id").equals(e).first()}async remove_study_by_lichess_id(e){let n=await this.studies.where("import_lichess_id").equals(e).first();n&&this.remove_study_by_id(n.id)}async remove_study_by_id(e){await this.transaction("rw",this.all_tables,async()=>{await this.studies.delete(e);let n=(await this.sections.where("study_id").equals(e).toArray()).map(o=>o.id);await this.sections.bulkDelete(n);let i=(await this.chapters.where("section_id").anyOf(n).toArray()).map(o=>o.id);await this.chapters.bulkDelete(i),await this.moves.where("chapter_id").anyOf(i).delete(),await this.due_cards.where("section_id").anyOf(n).delete()})}async import_study_from_lichess_id(e,n){let i=Li(n);await this.transaction("rw",this.all_tables,async()=>{await this.remove_study_by_lichess_id(e);let o=await this.studies.add({name:i.name,import_lichess_id:e,imported_as_pgn_text:!1,pgn_text:n});await this.insert_study_rest(i,o)})}async import_study_from_pgn_text(e){let n=e,i=Li(n);await this.transaction("rw",this.all_tables,async()=>{let o=await this.studies.add({name:i.name,imported_as_pgn_text:!0,pgn_text:n});await this.insert_study_rest(i,o)})}async insert_study_rest(e,n){let i=await this.sections.bulkAdd(e.sections.map(N=>({name:N.name,study_id:n})),{allKeys:!0}),o=e.sections.flatMap((N,L)=>N.chapters.map(D=>({section_id:i[L],name:D.name}))),u=await this.chapters.bulkAdd(o,{allKeys:!0}),h=e.sections.flatMap(N=>N.chapters.map(L=>L.pgn)).flatMap((N,L)=>N.tree.all_moves.map(D=>({chapter_id:u[L],before_fen:D.before_fen,path:D.path.join(" "),data:D}))),m=await this.moves.bulkAdd(h,{allKeys:!0});const k=N=>o[u.indexOf(N)].section_id;let g={};h.forEach((N,L)=>{if(!g[N.before_fen]){let D=k(N.chapter_id);g[N.before_fen]={section_id:D,move_ids:[]}}g[N.before_fen].move_ids.push(m[L])});let S=Object.keys(g).map(N=>({before_fen:N,...g[N],card:Dr()}));await this.due_cards.bulkAdd(S)}async play_due_move(e,n){let i=await this.due_cards.where("before_fen").equals(e).toArray();const o=new Zc({});let u;switch(n){case"again":u=U.Again;break;case"easy":u=U.Easy;break;case"hard":u=U.Hard;break}i.forEach(l=>{let h=o.repeat(l.card,new Date)[u].card;this.due_cards.update(l.id,{card:h})})}}class Fl extends Yn{id;name;import_lichess_id;imported_as_pgn_text;pgn_text}class Ul extends Yn{id;study_id;name}class Vl extends Yn{id;section_id;name}class zl extends Yn{id;chapter_id;before_fen;path;data}class Gl extends Yn{id;section_id;before_fen;move_ids;card}const Hl=Gn(),Wl=t=>J(Hl.Provider,{value:new ql,get children(){return t.children}});var Ql=os('<header id=top><div class=site-title-nav><input type=checkbox id=tn-tg class="topnav-toggle fullscreen-toggle"><label for=tn-tg class=fullscreen-mask></label><label for=tn-tg class=hbg><span class=hbg__in></span></label><h1 class=site-title> <small></small> </h1><nav id=topnav><section></section><section></section><section></section><section></section><section></section><section></section></nav></div><div class=site-buttons><div class=dasher>'),Yl=os("<div><div class=main>");const Xl=qe(()=>Fe(()=>import("./Home-BWoApIqT.js"),__vite__mapDeps([0,1]),import.meta.url)),Jl=qe(()=>Fe(()=>import("./Repertoires-B-ksy4yX.js"),__vite__mapDeps([2,3,4]),import.meta.url)),an=qe(()=>Fe(()=>import("./Contact-C4nbnnn0.js"),__vite__mapDeps([5,6]),import.meta.url)),Zl=qe(()=>Fe(()=>import("./Repertoire-CUqW71Br.js"),__vite__mapDeps([7,3,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),eh=qe(()=>Fe(()=>import("./Masters-Dm2Dkztr.js"),__vite__mapDeps([18,3,19]),import.meta.url)),th=qe(()=>Fe(()=>import("./Tactics-D69c-R19.js"),__vite__mapDeps([20,3,8,9,10,11,17]),import.meta.url)),nh=qe(()=>Fe(()=>import("./Endgames-JHNTMP56.js"),__vite__mapDeps([21,3,19]),import.meta.url)),rh=qe(()=>Fe(()=>import("./Dashboard-Cb-BX9au.js"),__vite__mapDeps([22,3,12,23]),import.meta.url)),ih=qe(()=>Fe(()=>import("./Explorer-CfKOGHaq.js"),__vite__mapDeps([24,8,9,10,11,3,13,25]),import.meta.url)),sh=qe(()=>Fe(()=>import("./Challenges-DXJhifzE.js"),__vite__mapDeps([26,27]),import.meta.url)),oh=qe(()=>Fe(()=>import("./Widen-DkdTZcxD.js"),__vite__mapDeps([28,8,9,29]),import.meta.url)),ah=qe(()=>Fe(()=>import("./SixthDraw-BhDYUvn6.js"),__vite__mapDeps([30,8,9,10,11,31]),import.meta.url)),ga=qe(()=>Fe(()=>import("./Beta-BnmDnIPj.js"),__vite__mapDeps([32,33]),import.meta.url)),uh=qe(()=>Fe(()=>import("./Show2-AR9eXAKF.js").then(t=>t.S),__vite__mapDeps([34,35]),import.meta.url)),ch=qe(()=>Fe(()=>import("./PlayDues-khnySPML.js"),__vite__mapDeps([36,8,9,14,10,11,15,34,35,37]),import.meta.url)),lh=()=>J(_c,{get children(){return J(Wl,{get children(){return J(Nc,{get children(){return J(hc,{root:hh,get children(){return[J(Ce,{path:"/",component:Xl}),J(Ce,{path:"/sixth",component:ah}),J(Ce,{path:"/repeat",component:uh}),J(Ce,{path:"/repeat/:id",component:ch}),J(Ce,{path:"/widen",component:oh}),J(Ce,{path:"/beta",component:ga}),J(Ce,{path:"/explorer",component:ih}),J(Ce,{path:"/challenges",component:sh}),J(Ce,{path:"/repertoires",component:Jl}),J(Ce,{path:"/openings/:id",component:Zl}),J(Ce,{path:"/masters/:id",component:eh}),J(Ce,{path:"/tactics/:id",component:th}),J(Ce,{path:"/endgames/:id",component:nh}),J(Ce,{path:"/contact",component:an}),J(Ce,{path:"/terms",component:an}),J(Ce,{path:"/privacy",component:an}),J(Ce,{path:"/about",component:an}),J(Ce,{path:"/donate",component:an}),J(Ce,{path:"/thanks",component:an}),J(Ce,{path:"/dashboard",component:rh})]}})}})}})}}),hh=t=>{let e=Fr(),n=be(()=>e.pathname.split("/")[1]);const i=()=>{let l=n();return`on-${l===""?"home":l}`},[o,u]=Ke(!1,{equals:!1});return Wu(()=>{u(!1)}),[(()=>{var l=Ql(),h=l.firstChild,m=h.firstChild,k=m.nextSibling,g=k.nextSibling,S=g.nextSibling,N=S.firstChild,L=N.nextSibling,D=S.nextSibling,z=D.firstChild,Q=z.nextSibling,X=Q.nextSibling,he=X.nextSibling,ne=he.nextSibling,ce=ne.nextSibling,me=h.nextSibling,xe=me.firstChild;return Qe(S,J(pt,{href:"/",children:"aidchess.com"}),N),Qe(L,J(pt,{class:"beta",href:"/beta",children:"beta"})),Qe(z,J(pt,{class:"home",href:"/",children:"aidchess.com"})),Qe(Q,J(pt,{href:"/spider",children:"Spider Chess"})),Qe(X,J(pt,{href:"/widen",children:"Widen"})),Qe(he,J(pt,{href:"/repertoires",children:"Repertoires"})),Qe(ne,J(pt,{href:"/repeat",children:"Repeat"})),Qe(ce,J(pt,{class:"site-title-nav__donate",href:"/donate",children:"Donate"})),Qe(xe,J(pt,{href:"/dashboard",children:"Dashboard"})),ot(()=>m.checked=o()),l})(),(()=>{var l=Yl(),h=l.firstChild;return Qe(h,J(mu,{fallback:m=>ga(),get children(){return t.children}})),ot(()=>qo(l,"main-wrap "+i())),l})()]},fh=document.getElementById("root");Au(()=>J(lh,{}),fh);export{gc as $,pt as A,Rc as B,lu as C,Ll as D,Kh as E,mh as F,Dh as G,wh as H,ha as I,cs as J,Ht as K,Ot as L,gh as M,hn as N,Vi as O,ps as P,Jn as Q,Hl as R,Lo as S,_n as T,ml as U,da as V,pn as W,pa as X,ph as Y,xh as Z,_h as _,Ke as a,vh as b,J as c,$o as d,Qo as e,Fr as f,be as g,yh as h,Qe as i,ot as j,qo as k,bh as l,eu as m,Ja as n,kh as o,ke as p,Ro as q,dh as r,zi as s,os as t,Lr as u,Vt as v,Su as w,tu as x,ss as y,Sc as z};
