import{k as V,H as L,c as s,S as p,N as X,f as r,i as _,l as Z,a as g,D as ee,I as te,n as F,r as ne,u as re,d as se,t as c,J as H,q,x as I,m as ae}from"./index-DjH-B4QQ.js";import{a as oe,D as ie}from"./types-lsVOugvr.js";import{S as ue,C as le}from"./Chessboard-C_MAVDVD.js";import{C as ce,a as _e}from"./ChessTreeWithTools-DULzsCm6.js";import"./Chesstree2-DSQIOUsH.js";var de=c("<div class=repeat-dues>"),he=c("<p>Completed All Due Moves."),pe=c("<div class=header><h3></h3><p></p><p> Due Moves"),ge=c("<div class=board-wrap>"),me=c("<div class=info>"),ve=c("<div class=replay-wrap><div class=replay-header><div class=title><h3></h3><h4>"),fe=c("<button>Hint: Show Previous Moves"),we=c("<button>Show Answer"),$e=c("<button>Next Due"),be=c("<span>Repeat Not Found");function ye(n){return n[Math.floor(Math.random()*n.length)]}const Fe=()=>{let n=V();const d=parseInt(n.id),a=L(H),l=oe(()=>a.repeat_by_id(d));return s(p,{get when(){return l()},get fallback(){return s(xe,{})},children:t=>s(Se,{get repeats(){return t()}})})},Se=n=>{const[d]=X(),a=r(()=>n.repeats),l=r(()=>new ie(a())),t=r(()=>{switch(d.filter){case"white":return l().due_white;case"black":return l().due_black;case"first-ten":return l().due_10;case"ten-twenty":return l().due_10_20;case"twenty-plus":return l().due_20plus;default:return l().due}}),M=r(()=>{switch(d.filter){case"white":return"White Only";case"black":return"Black Only";case"first-ten":return"First 10 moves";case"ten-twenty":return"10-20 moves";case"twenty-plus":return"20+ moves";default:return"All moves"}}),y=r(()=>ye(t()));return(()=>{var S=de();return _(S,s(p,{get when(){return y()},get fallback(){return he()},children:C=>[(()=>{var i=pe(),m=i.firstChild,v=m.nextSibling,k=v.nextSibling,N=k.firstChild;return _(m,()=>a().name),_(v,M),_(k,()=>t().length,N),i})(),s(Ce,{get repeats(){return a()},get due_move(){return C()}})]})),S})()},Ce=n=>{const[d]=Z(()=>n.due_move.ucis[0].section.study_id,a=>ae.read_section_study(a));return s(p,{get when(){return d()},children:a=>s(ke,{get on_wheel(){return n.on_wheel},get repeats(){return n.repeats},get due_move(){return n.due_move},get study(){return a()}})})},ke=n=>{const d=L(H),a=r(()=>n.study),l=r(()=>n.repeats),t=r(()=>n.due_move),M=r(()=>a().sections.find(e=>e.name===t().ucis[0].section.section_name)),y=r(()=>M().chapters.find(e=>e.name===t().ucis[0].section.chapter_name)),[S,C]=g(void 0),i=new ue;let[m,v]=g(void 0);const k=r(()=>ee(t()?.fen??te));F(()=>{i.on_set_fen_uci(t().fen)}),F(q(t,()=>{I(()=>{f(void 0),x([]),R(t().ucis[0].path.slice(0,-1))})}));const[N,R]=g(t().ucis[0].path.slice(0,-1),{equals:!1}),[O,x]=g([]);F(q(()=>i.add_uci,e=>{if(!e)return;const o=t();let[w,$]=e;const P=o.ucis.map(U=>U.san);let b="✓",u="✗";const A=h();let D=b;P.includes($)?(D=b,A||f("easy")):(D=u,(!A||A==="hard")&&f("again")),C(_e(w,$,D)),D===u?x(void 0):v(setTimeout(E,600))}));const W=([e,o])=>{console.log("on fen last move",e,o),i.on_set_fen_uci(e,o)},B=()=>{if(h()==="again")return!1;f("hard"),x(t().ucis[0].path)},J=()=>{I(()=>{f("again"),x(void 0),R(t().ucis[0].path)})},[h,f]=g(void 0),E=()=>{const e=l().id,o=t().fen,w=h();I(()=>{C(void 0),d.play_due_move(e,o,w??"again"),v(void 0)})},Q=r(()=>{const e=h();return!(!e||e==="hard")}),Y=r(()=>h()===void 0),j=r(()=>h()!=="again"),z=r(()=>{let e=m(),o=h();return e===void 0&&o!=="again"}),[G,K]=g(void 0,{equals:!1});let T;return ne(()=>{T.addEventListener("wheel",e=>{K(Math.sign(e.deltaY))},{passive:!0})}),[(()=>{var e=ge();return re(o=>T=o,e),_(e,s(le,{get shapes(){return S()},get orientation(){return k()},get movable(){return z()},get doPromotion(){return i.promotion},get onMoveAfter(){return i.on_move_after},get fen_uci(){return i.fen_uci},get color(){return i.turnColor},get dests(){return i.dests}})),e})(),(()=>{var e=ve(),o=e.firstChild,w=o.firstChild,$=w.firstChild,P=$.nextSibling;return _($,()=>a().name),_(P,()=>y().name),_(e,s(ce,{get hide_after_path(){return O()},get on_wheel(){return G()},get pgn(){return y().pgn},on_fen_last_move:W,get cursor_path(){return N()},get children(){var b=me();return _(b,s(p,{get when(){return m()},get fallback(){return[s(p,{get when(){return Y()},get children(){var u=fe();return u.$$click=B,u}}),s(p,{get when(){return j()},get children(){var u=we();return u.$$click=J,u}}),s(p,{get when(){return Q()},get children(){var u=$e();return u.$$click=E,u}})]},get children(){return[]}})),b}}),null),e})()]},xe=()=>be();se(["click"]);export{Fe as default};
