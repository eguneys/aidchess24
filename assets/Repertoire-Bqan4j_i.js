var te=Object.defineProperty;var re=(e,t,r)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var F=(e,t,r)=>(re(e,typeof t!="symbol"?t+"":t,r),r);import{$ as se,h as A,j as le,k as ne,l as oe,m as ie,b as V,n as S,o as x,p as ae,i as g,c as b,F as ce,f as U,g as de,S as W,s as ee,e as he,M as Y,q as ue,r as _e,d as fe,t as p}from"./index-CieTCD5Z.js";/* empty css                   */import{S as me}from"./studyrepo-CZkIEMXu.js";import{S as pe,C as ve}from"./Shalala-BxhKUs65.js";import{C as $e,T as ge}from"./Chesstree2-CFtTJbiJ.js";import{I as we,M as be}from"./chess_pgn_logic-C35QEtMW.js";const ye=Symbol("store-raw"),Se=Symbol("store-node"),R=Symbol("store-has"),Ce=Symbol("store-self");function J(e){let t;return e!=null&&typeof e=="object"&&(e[se]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function B(e,t=new Set){let r,i,n,o;if(r=e!=null&&e[ye])return r;if(!J(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let _=0,c=e.length;_<c;_++)n=e[_],(i=B(n,t))!==n&&(e[_]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const _=Object.keys(e),c=Object.getOwnPropertyDescriptors(e);for(let f=0,d=_.length;f<d;f++)o=_[f],!c[o].get&&(n=e[o],(i=B(n,t))!==n&&(e[o]=i))}return e}function Oe(e,t){let r=e[t];return r||Object.defineProperty(e,t,{value:r=Object.create(null)}),r}function H(e,t,r){if(e[t])return e[t];const[i,n]=A(r,{equals:!1,internal:!0});return i.$=n,e[t]=i}function k(e,t,r,i=!1){if(!i&&e[t]===r)return;const n=e[t],o=e.length;r===void 0?(delete e[t],e[R]&&e[R][t]&&n!==void 0&&e[R][t].$()):(e[t]=r,e[R]&&e[R][t]&&n===void 0&&e[R][t].$());let _=Oe(e,Se),c;if((c=H(_,t,n))&&c.$(()=>r),Array.isArray(e)&&e.length!==o){for(let f=e.length;f<o;f++)(c=_[f])&&c.$();(c=H(_,"length",o))&&c.$(e.length)}(c=_[Ce])&&c.$()}const G=Symbol("store-root");function T(e,t,r,i,n){const o=t[r];if(e===o)return;const _=Array.isArray(e);if(r!==G&&(!J(e)||!J(o)||_!==Array.isArray(o)||n&&e[n]!==o[n])){k(t,r,e);return}if(_){if(e.length&&o.length&&(!i||n&&e[0]&&e[0][n]!=null)){let d,l,u,w,$,y,m,s;for(u=0,w=Math.min(o.length,e.length);u<w&&(o[u]===e[u]||n&&o[u]&&e[u]&&o[u][n]===e[u][n]);u++)T(e[u],o,u,i,n);const a=new Array(e.length),h=new Map;for(w=o.length-1,$=e.length-1;w>=u&&$>=u&&(o[w]===e[$]||n&&o[u]&&e[u]&&o[w][n]===e[$][n]);w--,$--)a[$]=o[w];if(u>$||u>w){for(l=u;l<=$;l++)k(o,l,e[l]);for(;l<e.length;l++)k(o,l,a[l]),T(e[l],o,l,i,n);o.length>e.length&&k(o,"length",e.length);return}for(m=new Array($+1),l=$;l>=u;l--)y=e[l],s=n&&y?y[n]:y,d=h.get(s),m[l]=d===void 0?-1:d,h.set(s,l);for(d=u;d<=w;d++)y=o[d],s=n&&y?y[n]:y,l=h.get(s),l!==void 0&&l!==-1&&(a[l]=o[d],l=m[l],h.set(s,l));for(l=u;l<e.length;l++)l in a?(k(o,l,a[l]),T(e[l],o,l,i,n)):k(o,l,e[l])}else for(let d=0,l=e.length;d<l;d++)T(e[d],o,d,i,n);o.length>e.length&&k(o,"length",e.length);return}const c=Object.keys(e);for(let d=0,l=c.length;d<l;d++)T(e[c[d]],o,c[d],i,n);const f=Object.keys(o);for(let d=0,l=f.length;d<l;d++)e[f[d]]===void 0&&k(o,f[d],void 0)}function ke(e,t={}){const{merge:r,key:i="id"}=t,n=B(e);return o=>{if(!J(o)||!J(n))return n;const _=T(n,{[G]:o},G,r,i);return _===void 0?o:_}}var Ae=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Pe=e=>(typeof e.clear=="function"||(e.clear=()=>{let t;for(;t=e.key(0);)e.removeItem(t)}),e),xe=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function Ee(e){if(!e)return"";let t="";for(const r in e){if(!xe.includes(r))continue;const i=e[r];t+=i instanceof Date?`; ${r}=${i.toUTCString()}`:typeof i=="boolean"?`; ${r}`:`; ${r}=${i}`}return t}function Ie(e,t){var r;return((r=e.match(`(^|;)\\s*${t}\\s*=\\s*([^;]+)`))==null?void 0:r.pop())??null}var Q;try{Q=Ae("solid-start/server").useRequest}catch{Q=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var N=Pe({_read:()=>document.cookie,_write:(e,t,r)=>{document.cookie=`${e}=${t}${Ee(r)}`},getItem:(e,t)=>Ie(N._read(t),e),setItem:(e,t,r)=>{N._write(e,t,r);{const n=Object.assign(new Event("storage"),{key:e,oldValue:null,newValue:t,url:globalThis.document.URL,storageArea:N});window.dispatchEvent(n)}},removeItem:(e,t)=>{N._write(e,"deleted",{...t,expires:new Date(0)})},key:(e,t)=>{let r=null,i=0;return N._read(t).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(n,o)=>(!r&&o&&i++===e&&(r=o),"")),r},getLength:e=>{let t=0;return N._read(e).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,r=>(t+=r?1:0,"")),t},get length(){return this.getLength()}});function Me(e,t={}){const r=t.storage||globalThis.localStorage;if(!r)return e;const i=t.storageOptions,n=t.name||`storage-${le()}`,o=t.serialize||JSON.stringify.bind(JSON),_=t.deserialize||JSON.parse.bind(JSON),c=r.getItem(n,i),f=typeof e[0]=="function"?l=>e[1](()=>_(l)):l=>e[1](ke(_(l)));let d=!0;return c instanceof Promise?c.then(l=>d&&l&&f(l)):c&&f(c),[e[0],typeof e[0]=="function"?l=>{const u=e[1](l);return l?r.setItem(n,o(u),i):r.removeItem(n,i),d=!1,u}:(...l)=>{e[1](...l);const u=o(ne(()=>e[0]));r.setItem(n,u,i),d=!1}]}class X{constructor(t,r){F(this,"_solved_paths");this.study_name=t,this._solved_paths=Me(A([]),{name:`.repertoire_stat.name.${t}.chapter.${r}`})}set solved_paths(t){this._solved_paths[1](t)}get solved_paths(){return this._solved_paths[0]()}}var qe=p("<div class=progress><div class=bar></div><h3>"),Re=p("<div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul>"),Ne=p("<div class=repertoire>"),Te=p("<li><div><h3></h3> "),je=p("<div class=board-wrap>"),Le=p("<div class=eval-gauge><div class=white style=height:100%> </div><div class=score>"),ze=p("<small> Click on variations to expand. "),De=p("<small> Your goal is to guess every move correctly to fill up the progress bar. "),Fe=p("<h2>Select a Practice Option"),Je=p("<button><span> Play all Moves "),Ke=p("<button><span> Play as Match "),Ue=p("<h2>Play as Match"),Ve=p("<small> Try to guess the moves for <!>."),We=p("<small> AI will play the next move, picking a random variation. "),Ye=p("<small> Moves will be hidden once the game is started. "),Be=p("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Ge=p("<h2>Play all moves"),He=p("<small>Try to guess the moves for both sides."),Qe=p("<small>Moves will be hidden once you start."),Xe=p("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Ze=p("<div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>");class et{constructor(){F(this,"_mode");F(this,"_match_color");this._mode=A(void 0,{equals:!1}),this._match_color=A("white")}get mode(){return this._mode[0]()}set mode(t){this._mode[1](t)}get match_color(){return this._match_color[0]()}set match_color(t){this._match_color[1](t)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}}const Z=e=>(()=>{var t=qe(),r=t.firstChild,i=r.nextSibling;return g(i,()=>`%${e.width}`),U(n=>ee(r,`width: ${e.width}%`,n)),t})();class tt{constructor(t){this.chapters=t}get progress(){let t=this.chapters.length;return this.chapters.map(r=>Math.round(r.progress/t)).reduce((r,i)=>r+i)}}class j{constructor(t,r){F(this,"_solved_paths");this.score_tree=t,this._solved_paths=A(r,{equals:!1})}static load_from_store(t,r){let i=new X(t.name,r);return j.make(t.chapters[r].pgn.tree,i.solved_paths)}static save_paths_to_store(t,r,i){let n=new X(t.name,r);n.solved_paths=i.solved_paths}static make(t,r=[]){return new j(be.make(t),r)}get solved_paths(){return this._solved_paths[0]()}set solved_paths(t){this._solved_paths[1](t)}get progress(){return Math.floor(this.solved_paths.map(t=>{var r;return((r=this.score_tree.get_at(t))==null?void 0:r.score)??0}).reduce((t,r)=>t+r,0)*100)}merge_stats(t){this.solved_paths=rt(this.solved_paths,t.solved_paths)}}const dt=()=>{const e=oe(),[t]=ie(e.id,me.read_study);let r=V(()=>{const s=t();if(s)return new tt(s.chapters.map((a,h)=>j.load_from_store(s,h)))}),i=V(()=>{var s;return(s=r())==null?void 0:s.chapters[n()]});const[n,o]=A(0),_=V(()=>{var s;return(s=t())==null?void 0:s.chapters[n()]});let c=new pe,[f,d]=A(void 0);S(()=>{m.mode;let s=_();if(s){let a=ge.make(s.pgn.tree.clone);a.solved_paths=i().solved_paths,d(a)}});let[l,u]=A(void 0);S(x(()=>m.mode,s=>{if(s!==void 0){let a=f().tree;u(j.make(a))}})),S(x(()=>{var s;return(s=f())==null?void 0:s.solved_paths},s=>{if(s){let a=l();a&&(a.solved_paths=s)}}));const w=()=>{let s=t(),a=n(),h=i();!s||!h||(h.merge_stats(l()),j.save_paths_to_store(s,a,h))};S(x(()=>m.mode,s=>{s||w()})),S(()=>{let{mode:s,match_color:a}=m;s==="match"&&a==="black"&&setTimeout(()=>{var h;(h=f())==null||h.reveal_one_random()},400)}),S(x(()=>c.add_uci,s=>{var h;if(!s)return;((h=f())==null?void 0:h.try_next_uci_fail(s))&&m.mode==="match"&&setTimeout(()=>{var C;(C=f())==null||C.reveal_one_random()},400)})),S(x(()=>{var s;return(s=f())==null?void 0:s.solved_paths},s=>{})),S(x(()=>{var s;return(s=f())==null?void 0:s.fen_last_move},s=>{if(s){let[a,h]=s;c.on_set_fen_uci(a,h)}else c.on_set_fen_uci(we)})),S(x(()=>c.on_wheel,s=>{var a;s&&((a=f())==null||a.on_wheel(s))}));const $=s=>{s.key==="f"&&m.flip_match_color()};document.addEventListener("keypress",$),ae(()=>{document.removeEventListener("keypress",$)});const y=s=>{const a=s.target;a.tagName!=="PIECE"&&a.tagName!=="SQUARE"&&a.tagName!=="CG-BOARD"||(s.preventDefault(),c.set_on_wheel(Math.sign(s.deltaY)))};let m=new et;return S(()=>{var s;m.match_color=((s=t())==null?void 0:s.orientation)??"white"}),(()=>{var s=Ne();return s.addEventListener("wheel",y),g(s,b(W,{get when(){return!t.loading},fallback:"Loading...",get children(){var a=Re(),h=a.firstChild,C=h.nextSibling,O=C.firstChild,L=O.firstChild,E=O.nextSibling;return g(L,()=>t().name),g(O,b(Z,{get width(){var I;return((I=r())==null?void 0:I.progress)??0}}),null),g(E,b(ce,{get each(){return t().chapters},children:(I,z)=>(()=>{var M=Te(),D=M.firstChild,K=D.firstChild;return K.nextSibling,M.$$click=()=>o(z()),g(K,()=>I.name),g(D,b(Z,{get width(){var v;return((v=r())==null?void 0:v.chapters[z()].progress)??0}}),null),U(()=>de(M,z()===n()?"active":"")),M})()})),a}}),null),g(s,b(W,{get when(){return _()},children:a=>[(()=>{var h=je();return g(h,b(ve,{get orientation(){return m.match_color},get movable(){return m.mode!==void 0},get doPromotion(){return c.promotion},get onMoveAfter(){return c.on_move_after},get fen_uci(){return c.fen_uci},get color(){return c.turnColor},get dests(){return c.dests}})),h})(),(()=>{var h=Le(),C=h.firstChild,O=C.nextSibling;return U(L=>{var E;return ee(O,`height: ${((E=l())==null?void 0:E.progress)??0}%`,L)}),h})(),(()=>{var h=Ze(),C=h.firstChild,O=C.firstChild,L=O.firstChild,E=L.nextSibling,I=O.nextSibling,z=I.firstChild,M=C.nextSibling,D=M.firstChild,K=D.nextSibling;return g(E,()=>a().name),g(D,b(W,{get when(){return f()},children:v=>b($e,{get lala(){return v()}})})),g(K,b(he,{get children(){return[b(Y,{get when(){return m.mode===void 0},get children(){return[ze(),De(),Fe(),(()=>{var v=Je();return v.$$click=()=>m.mode="moves",v})(),(()=>{var v=Ke();return v.$$click=()=>m.mode="match",v})()]}}),b(Y,{get when(){return m.mode==="match"},get children(){return[Ue(),(()=>{var v=Ve(),P=v.firstChild,q=P.nextSibling;return q.nextSibling,g(v,()=>m.match_color,q),v})(),We(),Ye(),(()=>{var v=Be(),P=v.firstChild,q=P.nextSibling;return P.$$click=()=>{ue(()=>{m.mode="match",m.flip_match_color()})},q.$$click=()=>m.mode=void 0,v})()]}}),b(Y,{get when(){return m.mode==="moves"},get children(){return[Ge(),He(),Qe(),(()=>{var v=Xe(),P=v.firstChild,q=P.nextSibling;return P.$$click=()=>{m.mode="moves"},q.$$click=()=>m.mode=void 0,v})()]}})]}})),U(()=>_e(z,"href",a().site)),h})()]}),null),s})()};function rt(e,t){return[...new Set([...e,...t])]}fe(["click"]);export{dt as default};
