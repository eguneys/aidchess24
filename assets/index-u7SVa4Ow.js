const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-C8JKiqaP.js","assets/Home-OYlkU4dT.css","assets/Contact-Cde5BfpP.js","assets/Contact-DI9B5wA9.css","assets/Beta-BNxFdZXP.js","assets/Beta-Ba2oikMa.css","assets/List-D8px1dBx.js","assets/List-CE3C3CI1.css","assets/Show-BwOoJoCl.js","assets/random-Dv0laS5a.js","assets/random-C7HFkO0p.css","assets/Show-WJI_hxio.css","assets/List-C90-GFvH.js","assets/List-DE0o7Jrc.css","assets/Show-CdPWXhLp.js","assets/Show-GJ83gIsB.css"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const se={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Na(this.context.count)},getNextContextId(){return Na(this.context.count++)}};function Na(t){const e=String(t),n=e.length-1;return se.context.id+(n?String.fromCharCode(96+n):"")+e}function Rt(t){se.context=t}const po=!1,yo=(t,e)=>t===e,pt=Symbol("solid-proxy"),_o=typeof Proxy=="function",hs=Symbol("solid-track"),ti={equals:yo};let fr=null,mo=Eo;const Ye=1,hr=2,go={owned:null,cleanups:null,context:null,owner:null},ns={};var ue=null;let G=null,tc=null,ge=null,qe=null,$e=null,li=0;function Mn(t,e){const n=ge,r=ue,s=t.length===0,o=e===void 0?r:e,c=s?go:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=s?t:()=>t(()=>De(()=>Ft(c)));ue=c,ge=null;try{return rt(l,!0)}finally{ge=n,ue=r}}function Re(t,e){e=e?Object.assign({},ti,e):ti;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(G&&G.running&&G.sources.has(n)?s=s(n.tValue):s=s(n.value)),xo(n,s));return[ko.bind(n),r]}function Da(t,e,n){const r=Hn(t,e,!0,Ye);_n(r)}function nt(t,e,n){const r=Hn(t,e,!1,Ye);_n(r)}function fi(t,e,n){mo=cc;const r=Hn(t,e,!1,Ye),s=hn&&bt(hn);s&&(r.suspense=s),r.user=!0,$e?$e.push(r):_n(r)}function ne(t,e,n){n=n?Object.assign({},ti,n):ti;const r=Hn(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,_n(r),ko.bind(r)}function nc(t){return t&&typeof t=="object"&&"then"in t}function wo(t,e,n){let r,s,o;typeof e=="function"?(r=t,s=e,o=n||{}):(r=!0,s=t,o=e||{});let c=null,l=ns,p=null,y=!1,_=!1,g="initialValue"in o,C=typeof r=="function"&&ne(r);const $=new Set,[L,R]=(o.storage||Re)(o.initialValue),[I,W]=Re(void 0),[j,B]=Re(void 0,{equals:!1}),[U,Q]=Re(g?"ready":"unresolved");se.context&&(p=se.getNextContextId(),o.ssrLoadFrom==="initial"?l=o.initialValue:se.load&&se.has(p)&&(l=se.load(p)));function ee(we,Se,Ee,Ue){return c===we&&(c=null,Ue!==void 0&&(g=!0),(we===l||Se===l)&&o.onHydrated&&queueMicrotask(()=>o.onHydrated(Ue,{value:Se})),l=ns,G&&we&&y?(G.promises.delete(we),y=!1,rt(()=>{G.running=!0,ce(Se,Ee)},!1)):ce(Se,Ee)),Se}function ce(we,Se){rt(()=>{Se===void 0&&R(()=>we),Q(Se!==void 0?"errored":g?"ready":"unresolved"),W(Se);for(const Ee of $.keys())Ee.decrement();$.clear()},!1)}function Ce(){const we=hn&&bt(hn),Se=L(),Ee=I();if(Ee!==void 0&&!c)throw Ee;return ge&&!ge.user&&we&&Da(()=>{j(),c&&(we.resolved&&G&&y?G.promises.add(c):$.has(we)||(we.increment(),$.add(we)))}),Se}function je(we=!0){if(we!==!1&&_)return;_=!1;const Se=C?C():r;if(y=G&&G.running,Se==null||Se===!1){ee(c,De(L));return}G&&c&&G.promises.delete(c);const Ee=l!==ns?l:De(()=>s(Se,{value:L(),refetching:we}));return nc(Ee)?(c=Ee,"value"in Ee?(Ee.status==="success"?ee(c,Ee.value,void 0,Se):ee(c,void 0,ps(Ee.value),Se),Ee):(_=!0,queueMicrotask(()=>_=!1),rt(()=>{Q(g?"refreshing":"pending"),B()},!1),Ee.then(Ue=>ee(Ee,Ue,void 0,Se),Ue=>ee(Ee,void 0,ps(Ue),Se)))):(ee(c,Ee,void 0,Se),Ee)}return Object.defineProperties(Ce,{state:{get:()=>U()},error:{get:()=>I()},loading:{get(){const we=U();return we==="pending"||we==="refreshing"}},latest:{get(){if(!g)return Ce();const we=I();if(we&&!c)throw we;return L()}}}),C?Da(()=>je(!1)):je(!1),[Ce,{refetch:je,mutate:R}]}function kd(t,e=yo,n){const r=new Map,s=Hn(o=>{const c=t();for(const[l,p]of r.entries())if(e(l,c)!==e(l,o))for(const y of p.values())y.state=Ye,y.pure?qe.push(y):$e.push(y);return c},void 0,!0,Ye);return _n(s),o=>{const c=ge;if(c){let l;(l=r.get(o))?l.add(c):r.set(o,l=new Set([c])),Vt(()=>{l.delete(c),!l.size&&r.delete(o)})}return e(o,G&&G.running&&G.sources.has(s)?s.tValue:s.value)}}function ht(t){return rt(t,!1)}function De(t){if(ge===null)return t();const e=ge;ge=null;try{return t()}finally{ge=e}}function gr(t,e,n){const r=Array.isArray(t);let s,o=n&&n.defer;return c=>{let l;if(r){l=Array(t.length);for(let y=0;y<t.length;y++)l[y]=t[y]()}else l=t();if(o)return o=!1,c;const p=De(()=>e(l,s,c));return s=l,p}}function rc(t){fi(()=>De(t))}function Vt(t){return ue===null||(ue.cleanups===null?ue.cleanups=[t]:ue.cleanups.push(t)),t}function ic(t,e){fr||(fr=Symbol("error")),ue=Hn(void 0,void 0,!0),ue.context={...ue.context,[fr]:[e]},G&&G.running&&G.sources.add(ue);try{return t()}catch(n){wr(n)}finally{ue=ue.owner}}function ds(){return ge}function $s(){return ue}function vo(t,e){const n=ue,r=ge;ue=t,ge=null;try{return rt(e,!0)}catch(s){wr(s)}finally{ue=n,ge=r}}function bo(t){if(G&&G.running)return t(),G.done;const e=ge,n=ue;return Promise.resolve().then(()=>{ge=e,ue=n;let r;return hn&&(r=G||(G={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),r.done||(r.done=new Promise(s=>r.resolve=s)),r.running=!0),rt(t,!1),ge=ue=null,r?r.done:void 0})}const[sc,$a]=Re(!1);function xd(){return[sc,bo]}function ac(t){$e.push.apply($e,t),t.length=0}function Tt(t,e){const n=Symbol("context");return{id:n,Provider:lc(n),defaultValue:t}}function bt(t){let e;return ue&&ue.context&&(e=ue.context[t.id])!==void 0?e:t.defaultValue}function Fn(t){const e=ne(t),n=ne(()=>ys(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let hn;function oc(){return hn||(hn=Tt())}function ko(){const t=G&&G.running;if(this.sources&&(t?this.tState:this.state))if((t?this.tState:this.state)===Ye)_n(this);else{const e=qe;qe=null,rt(()=>ri(this),!1),qe=e}if(ge){const e=this.observers?this.observers.length:0;ge.sources?(ge.sources.push(this),ge.sourceSlots.push(e)):(ge.sources=[this],ge.sourceSlots=[e]),this.observers?(this.observers.push(ge),this.observerSlots.push(ge.sources.length-1)):(this.observers=[ge],this.observerSlots=[ge.sources.length-1])}return t&&G.sources.has(this)?this.tValue:this.value}function xo(t,e,n){let r=G&&G.running&&G.sources.has(t)?t.tValue:t.value;if(!t.comparator||!t.comparator(r,e)){if(G){const s=G.running;(s||!n&&G.sources.has(t))&&(G.sources.add(t),t.tValue=e),s||(t.value=e)}else t.value=e;t.observers&&t.observers.length&&rt(()=>{for(let s=0;s<t.observers.length;s+=1){const o=t.observers[s],c=G&&G.running;c&&G.disposed.has(o)||((c?!o.tState:!o.state)&&(o.pure?qe.push(o):$e.push(o),o.observers&&Ao(o)),c?o.tState=Ye:o.state=Ye)}if(qe.length>1e6)throw qe=[],new Error},!1)}return e}function _n(t){if(!t.fn)return;Ft(t);const e=li;Ma(t,G&&G.running&&G.sources.has(t)?t.tValue:t.value,e),G&&!G.running&&G.sources.has(t)&&queueMicrotask(()=>{rt(()=>{G&&(G.running=!0),ge=ue=t,Ma(t,t.tValue,e),ge=ue=null},!1)})}function Ma(t,e,n){let r;const s=ue,o=ge;ge=ue=t;try{r=t.fn(e)}catch(c){return t.pure&&(G&&G.running?(t.tState=Ye,t.tOwned&&t.tOwned.forEach(Ft),t.tOwned=void 0):(t.state=Ye,t.owned&&t.owned.forEach(Ft),t.owned=null)),t.updatedAt=n+1,wr(c)}finally{ge=o,ue=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?xo(t,r,!0):G&&G.running&&t.pure?(G.sources.add(t),t.tValue=r):t.value=r,t.updatedAt=n)}function Hn(t,e,n,r=Ye,s){const o={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:ue,context:ue?ue.context:null,pure:n};return G&&G.running&&(o.state=0,o.tState=r),ue===null||ue!==go&&(G&&G.running&&ue.pure?ue.tOwned?ue.tOwned.push(o):ue.tOwned=[o]:ue.owned?ue.owned.push(o):ue.owned=[o]),o}function ni(t){const e=G&&G.running;if((e?t.tState:t.state)===0)return;if((e?t.tState:t.state)===hr)return ri(t);if(t.suspense&&De(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<li);){if(e&&G.disposed.has(t))return;(e?t.tState:t.state)&&n.push(t)}for(let r=n.length-1;r>=0;r--){if(t=n[r],e){let s=t,o=n[r+1];for(;(s=s.owner)&&s!==o;)if(G.disposed.has(s))return}if((e?t.tState:t.state)===Ye)_n(t);else if((e?t.tState:t.state)===hr){const s=qe;qe=null,rt(()=>ri(t,n[0]),!1),qe=s}}}function rt(t,e){if(qe)return t();let n=!1;e||(qe=[]),$e?n=!0:$e=[],li++;try{const r=t();return uc(n),r}catch(r){n||($e=null),qe=null,wr(r)}}function uc(t){if(qe&&(Eo(qe),qe=null),t)return;let e;if(G){if(!G.promises.size&&!G.queue.size){const r=G.sources,s=G.disposed;$e.push.apply($e,G.effects),e=G.resolve;for(const o of $e)"tState"in o&&(o.state=o.tState),delete o.tState;G=null,rt(()=>{for(const o of s)Ft(o);for(const o of r){if(o.value=o.tValue,o.owned)for(let c=0,l=o.owned.length;c<l;c++)Ft(o.owned[c]);o.tOwned&&(o.owned=o.tOwned),delete o.tValue,delete o.tOwned,o.tState=0}$a(!1)},!1)}else if(G.running){G.running=!1,G.effects.push.apply(G.effects,$e),$e=null,$a(!0);return}}const n=$e;$e=null,n.length&&rt(()=>mo(n),!1),e&&e()}function Eo(t){for(let e=0;e<t.length;e++)ni(t[e])}function cc(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:ni(r)}if(se.context){if(se.count){se.effects||(se.effects=[]),se.effects.push(...t.slice(0,n));return}Rt()}for(se.effects&&(se.done||!se.count)&&(t=[...se.effects,...t],n+=se.effects.length,delete se.effects),e=0;e<n;e++)ni(t[e])}function ri(t,e){const n=G&&G.running;n?t.tState=0:t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];if(s.sources){const o=n?s.tState:s.state;o===Ye?s!==e&&(!s.updatedAt||s.updatedAt<li)&&ni(s):o===hr&&ri(s,e)}}}function Ao(t){const e=G&&G.running;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(e?!r.tState:!r.state)&&(e?r.tState=hr:r.state=hr,r.pure?qe.push(r):$e.push(r),r.observers&&Ao(r))}}function Ft(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const o=s.pop(),c=n.observerSlots.pop();r<s.length&&(o.sourceSlots[c]=r,s[r]=o,n.observerSlots[r]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ft(t.tOwned[e]);delete t.tOwned}if(G&&G.running&&t.pure)So(t,!0);else if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ft(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}G&&G.running?t.tState=0:t.state=0}function So(t,e){if(e||(t.tState=0,G.disposed.add(t)),t.owned)for(let n=0;n<t.owned.length;n++)So(t.owned[n])}function ps(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function ja(t,e,n){try{for(const r of e)r(t)}catch(r){wr(r,n&&n.owner||null)}}function wr(t,e=ue){const n=fr&&e&&e.context&&e.context[fr],r=ps(t);if(!n)throw r;$e?$e.push({fn(){ja(r,n,e)},state:Ye}):ja(r,n,e)}function ys(t){if(typeof t=="function"&&!t.length)return ys(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=ys(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function lc(t,e){return function(r){let s;return nt(()=>s=De(()=>(ue.context={...ue.context,[t]:r.value},Fn(()=>r.children))),void 0),s}}const fc=Symbol("fallback");function Ia(t){for(let e=0;e<t.length;e++)t[e]()}function hc(t,e,n={}){let r=[],s=[],o=[],c=0,l=e.length>1?[]:null;return Vt(()=>Ia(o)),()=>{let p=t()||[],y=p.length,_,g;return p[hs],De(()=>{let $,L,R,I,W,j,B,U,Q;if(y===0)c!==0&&(Ia(o),o=[],r=[],s=[],c=0,l&&(l=[])),n.fallback&&(r=[fc],s[0]=Mn(ee=>(o[0]=ee,n.fallback())),c=1);else if(c===0){for(s=new Array(y),g=0;g<y;g++)r[g]=p[g],s[g]=Mn(C);c=y}else{for(R=new Array(y),I=new Array(y),l&&(W=new Array(y)),j=0,B=Math.min(c,y);j<B&&r[j]===p[j];j++);for(B=c-1,U=y-1;B>=j&&U>=j&&r[B]===p[U];B--,U--)R[U]=s[B],I[U]=o[B],l&&(W[U]=l[B]);for($=new Map,L=new Array(U+1),g=U;g>=j;g--)Q=p[g],_=$.get(Q),L[g]=_===void 0?-1:_,$.set(Q,g);for(_=j;_<=B;_++)Q=r[_],g=$.get(Q),g!==void 0&&g!==-1?(R[g]=s[_],I[g]=o[_],l&&(W[g]=l[_]),g=L[g],$.set(Q,g)):o[_]();for(g=j;g<y;g++)g in R?(s[g]=R[g],o[g]=I[g],l&&(l[g]=W[g],l[g](g))):s[g]=Mn(C);s=s.slice(0,c=y),r=p.slice(0)}return s});function C($){if(o[g]=$,l){const[L,R]=Re(g);return l[g]=R,e(p[g],L)}return e(p[g])}}}function te(t,e){return De(()=>t(e||{}))}function Yr(){return!0}const _s={get(t,e,n){return e===pt?n:t.get(e)},has(t,e){return e===pt?!0:t.has(e)},set:Yr,deleteProperty:Yr,getOwnPropertyDescriptor(t,e){return{configurable:!0,enumerable:!0,get(){return t.get(e)},set:Yr,deleteProperty:Yr}},ownKeys(t){return t.keys()}};function rs(t){return(t=typeof t=="function"?t():t)?t:{}}function dc(){for(let t=0,e=this.length;t<e;++t){const n=this[t]();if(n!==void 0)return n}}function Ct(...t){let e=!1;for(let c=0;c<t.length;c++){const l=t[c];e=e||!!l&&pt in l,t[c]=typeof l=="function"?(e=!0,ne(l)):l}if(_o&&e)return new Proxy({get(c){for(let l=t.length-1;l>=0;l--){const p=rs(t[l])[c];if(p!==void 0)return p}},has(c){for(let l=t.length-1;l>=0;l--)if(c in rs(t[l]))return!0;return!1},keys(){const c=[];for(let l=0;l<t.length;l++)c.push(...Object.keys(rs(t[l])));return[...new Set(c)]}},_s);const n={},r=Object.create(null);for(let c=t.length-1;c>=0;c--){const l=t[c];if(!l)continue;const p=Object.getOwnPropertyNames(l);for(let y=p.length-1;y>=0;y--){const _=p[y];if(_==="__proto__"||_==="constructor")continue;const g=Object.getOwnPropertyDescriptor(l,_);if(!r[_])r[_]=g.get?{enumerable:!0,configurable:!0,get:dc.bind(n[_]=[g.get.bind(l)])}:g.value!==void 0?g:void 0;else{const C=n[_];C&&(g.get?C.push(g.get.bind(l)):g.value!==void 0&&C.push(()=>g.value))}}}const s={},o=Object.keys(r);for(let c=o.length-1;c>=0;c--){const l=o[c],p=r[l];p&&p.get?Object.defineProperty(s,l,p):s[l]=p?p.value:void 0}return s}function pc(t,...e){if(_o&&pt in t){const s=new Set(e.length>1?e.flat():e[0]),o=e.map(c=>new Proxy({get(l){return c.includes(l)?t[l]:void 0},has(l){return c.includes(l)&&l in t},keys(){return c.filter(l=>l in t)}},_s));return o.push(new Proxy({get(c){return s.has(c)?void 0:t[c]},has(c){return s.has(c)?!1:c in t},keys(){return Object.keys(t).filter(c=>!s.has(c))}},_s)),o}const n={},r=e.map(()=>({}));for(const s of Object.getOwnPropertyNames(t)){const o=Object.getOwnPropertyDescriptor(t,s),c=!o.get&&!o.set&&o.enumerable&&o.writable&&o.configurable;let l=!1,p=0;for(const y of e)y.includes(s)&&(l=!0,c?r[p][s]=o.value:Object.defineProperty(r[p],s,o)),++p;l||(c?n[s]=o.value:Object.defineProperty(n,s,o))}return[...r,n]}function Ht(t){let e,n;const r=s=>{const o=se.context;if(o){const[l,p]=Re();se.count||(se.count=0),se.count++,(n||(n=t())).then(y=>{!se.done&&Rt(o),se.count--,p(()=>y.default),Rt()}),e=l}else if(!e){const[l]=wo(()=>(n||(n=t())).then(p=>p.default));e=l}let c;return ne(()=>(c=e())?De(()=>{if(!o||se.done)return c(s);const l=se.context;Rt(o);const p=c(s);return Rt(l),p}):"")};return r.preload=()=>n||((n=t()).then(s=>e=()=>s.default),n),r}let yc=0;function _c(){return se.context?se.getNextContextId():`cl-${yc++}`}const Oo=t=>`Stale read from <${t}>.`;function Po(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ne(hc(()=>t.each,t.children,e||void 0))}function dt(t){const e=t.keyed,n=ne(()=>t.when,void 0,void 0),r=e?n:ne(n,void 0,{equals:(s,o)=>!s==!o});return ne(()=>{const s=r();if(s){const o=t.children;return typeof o=="function"&&o.length>0?De(()=>o(e?s:()=>{if(!De(r))throw Oo("Show");return n()})):o}return t.fallback},void 0,void 0)}function Ed(t){const e=Fn(()=>t.children),n=ne(()=>{const r=e(),s=Array.isArray(r)?r:[r];let o=()=>{};for(let c=0;c<s.length;c++){const l=c,p=s[c],y=o,_=ne(()=>y()?void 0:p.when,void 0,void 0),g=p.keyed?_:ne(_,void 0,{equals:(C,$)=>!C==!$});o=()=>y()||(g()?[l,_,p]:void 0)}return o});return ne(()=>{const r=n()();if(!r)return t.fallback;const[s,o,c]=r,l=c.children;return typeof l=="function"&&l.length>0?De(()=>l(c.keyed?o():()=>{if(De(n)()?.[0]!==s)throw Oo("Match");return o()})):l},void 0,void 0)}function Ad(t){return t}let Dn;function mc(){Dn&&[...Dn].forEach(t=>t())}function gc(t){let e;se.context&&se.load&&(e=se.load(se.getContextId()));const[n,r]=Re(e,void 0);return Dn||(Dn=new Set),Dn.add(r),Vt(()=>Dn.delete(r)),ne(()=>{let s;if(s=n()){const o=t.fallback;return typeof o=="function"&&o.length?De(()=>o(s,()=>r())):o}return ic(()=>t.children,r)},void 0,void 0)}const wc=Tt();function Sd(t){let e=0,n,r,s,o,c;const[l,p]=Re(!1),y=oc(),_={increment:()=>{++e===1&&p(!0)},decrement:()=>{--e===0&&p(!1)},inFallback:l,effects:[],resolved:!1},g=$s();if(se.context&&se.load){const L=se.getContextId();let R=se.load(L);if(R&&(typeof R!="object"||R.status!=="success"?s=R:se.gather(L)),s&&s!=="$$f"){const[I,W]=Re(void 0,{equals:!1});o=I,s.then(()=>{if(se.done)return W();se.gather(L),Rt(r),W(),Rt()},j=>{c=j,W()})}}const C=bt(wc);C&&(n=C.register(_.inFallback));let $;return Vt(()=>$&&$()),te(y.Provider,{value:_,get children(){return ne(()=>{if(c)throw c;if(r=se.context,o)return o(),o=void 0;r&&s==="$$f"&&Rt();const L=ne(()=>t.children);return ne(R=>{const I=_.inFallback(),{showContent:W=!0,showFallback:j=!0}=n?n():{};if((!I||s&&s!=="$$f")&&W)return _.resolved=!0,$&&$(),$=r=s=void 0,ac(_.effects),L();if(j)return $?R:Mn(B=>($=B,r&&(Rt({id:r.id+"F",count:0}),r=void 0),t.fallback),g)})})}})}const vc=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],bc=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...vc]),kc=new Set(["innerHTML","textContent","innerText","children"]),xc=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Ec=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function Ac(t,e){const n=Ec[t];return typeof n=="object"?n[e]?n.$:void 0:n}const Sc=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),Oc={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function Pc(t,e,n){let r=n.length,s=e.length,o=r,c=0,l=0,p=e[s-1].nextSibling,y=null;for(;c<s||l<o;){if(e[c]===n[l]){c++,l++;continue}for(;e[s-1]===n[o-1];)s--,o--;if(s===c){const _=o<r?l?n[l-1].nextSibling:n[o-l]:p;for(;l<o;)t.insertBefore(n[l++],_)}else if(o===l)for(;c<s;)(!y||!y.has(e[c]))&&e[c].remove(),c++;else if(e[c]===n[o-1]&&n[l]===e[s-1]){const _=e[--s].nextSibling;t.insertBefore(n[l++],e[c++].nextSibling),t.insertBefore(n[--o],_),e[s]=n[o]}else{if(!y){y=new Map;let g=l;for(;g<o;)y.set(n[g],g++)}const _=y.get(e[c]);if(_!=null)if(l<_&&_<o){let g=c,C=1,$;for(;++g<s&&g<o&&!(($=y.get(e[g]))==null||$!==_+C);)C++;if(C>_-l){const L=e[c];for(;l<_;)t.insertBefore(n[l++],L)}else t.replaceChild(n[l++],e[c++])}else c++;else e[c++].remove()}}}const Ka="_$DX_DELEGATE";function Cc(t,e,n,r={}){let s;return Mn(o=>{s=o,e===document?t():ve(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{s(),e.textContent=""}}function Xe(t,e,n,r){let s;const o=()=>{const l=document.createElement("template");return l.innerHTML=t,l.content.firstChild},c=()=>(s||(s=o())).cloneNode(!0);return c.cloneNode=c,c}function Ms(t,e=window.document){const n=e[Ka]||(e[Ka]=new Set);for(let r=0,s=t.length;r<s;r++){const o=t[r];n.has(o)||(n.add(o),e.addEventListener(o,jc))}}function ms(t,e,n){zn(t)||(n==null?t.removeAttribute(e):t.setAttribute(e,n))}function Rc(t,e,n,r){zn(t)||(r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r))}function Tc(t,e,n){zn(t)||(n?t.setAttribute(e,""):t.removeAttribute(e))}function Co(t,e){zn(t)||(e==null?t.removeAttribute("class"):t.className=e)}function Nc(t,e,n,r){if(r)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const s=n[0];t.addEventListener(e,n[0]=o=>s.call(t,n[1],o))}else t.addEventListener(e,n,typeof n!="function"&&n)}function Ro(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let o,c;for(o=0,c=s.length;o<c;o++){const l=s[o];!l||l==="undefined"||e[l]||(Ba(t,l,!1),delete n[l])}for(o=0,c=r.length;o<c;o++){const l=r[o],p=!!e[l];!l||l==="undefined"||n[l]===p||!p||(Ba(t,l,!0),n[l]=p)}return n}function Dc(t,e,n){if(!e)return n?ms(t,"style"):e;const r=t.style;if(typeof e=="string")return r.cssText=e;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),e||(e={});let s,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)s=e[o],s!==n[o]&&(r.setProperty(o,s),n[o]=s);return n}function gs(t,e={},n,r){const s={};return r||nt(()=>s.children=dr(t,e.children,s.children)),nt(()=>typeof e.ref=="function"&&js(e.ref,t)),nt(()=>$c(t,e,n,!0,s,!0)),s}function js(t,e,n){return De(()=>t(e,n))}function ve(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return dr(t,e,r,n);nt(s=>dr(t,e(),s,n),r)}function $c(t,e,n,r,s={},o=!1){e||(e={});for(const c in s)if(!(c in e)){if(c==="children")continue;s[c]=La(t,c,null,s[c],n,o,e)}for(const c in e){if(c==="children")continue;const l=e[c];s[c]=La(t,c,l,s[c],n,o,e)}}function zn(t){return!!se.context&&!se.done&&(!t||t.isConnected)}function Mc(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function Ba(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,o=r.length;s<o;s++)t.classList.toggle(r[s],n)}function La(t,e,n,r,s,o,c){let l,p,y,_,g;if(e==="style")return Dc(t,n,r);if(e==="classList")return Ro(t,n,r);if(n===r)return r;if(e==="ref")o||n(t);else if(e.slice(0,3)==="on:"){const C=e.slice(3);r&&t.removeEventListener(C,r,typeof r!="function"&&r),n&&t.addEventListener(C,n,typeof n!="function"&&n)}else if(e.slice(0,10)==="oncapture:"){const C=e.slice(10);r&&t.removeEventListener(C,r,!0),n&&t.addEventListener(C,n,!0)}else if(e.slice(0,2)==="on"){const C=e.slice(2).toLowerCase(),$=Sc.has(C);if(!$&&r){const L=Array.isArray(r)?r[0]:r;t.removeEventListener(C,L)}($||n)&&(Nc(t,C,n,$),$&&Ms([C]))}else if(e.slice(0,5)==="attr:")ms(t,e.slice(5),n);else if(e.slice(0,5)==="bool:")Tc(t,e.slice(5),n);else if((g=e.slice(0,5)==="prop:")||(y=kc.has(e))||!s&&((_=Ac(e,t.tagName))||(p=bc.has(e)))||(l=t.nodeName.includes("-")||"is"in c)){if(g)e=e.slice(5),p=!0;else if(zn(t))return n;e==="class"||e==="className"?Co(t,n):l&&!p&&!y?t[Mc(e)]=n:t[_||e]=n}else{const C=s&&e.indexOf(":")>-1&&Oc[e.split(":")[0]];C?Rc(t,C,e,n):ms(t,xc[e]||e,n)}return n}function jc(t){if(se.registry&&se.events&&se.events.find(([p,y])=>y===t))return;let e=t.target;const n=`$$${t.type}`,r=t.target,s=t.currentTarget,o=p=>Object.defineProperty(t,"target",{configurable:!0,value:p}),c=()=>{const p=e[n];if(p&&!e.disabled){const y=e[`${n}Data`];if(y!==void 0?p.call(e,y,t):p.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&o(e.host),!0},l=()=>{for(;c()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),se.registry&&!se.done&&(se.done=_$HY.done=!0),t.composedPath){const p=t.composedPath();o(p[0]);for(let y=0;y<p.length-2&&(e=p[y],!!c());y++){if(e._$host){e=e._$host,l();break}if(e.parentNode===s)break}}else l();o(r)}function dr(t,e,n,r,s){const o=zn(t);if(o){!n&&(n=[...t.childNodes]);let p=[];for(let y=0;y<n.length;y++){const _=n[y];_.nodeType===8&&_.data.slice(0,2)==="!$"?_.remove():p.push(_)}n=p}for(;typeof n=="function";)n=n();if(e===n)return n;const c=typeof e,l=r!==void 0;if(t=l&&n[0]&&n[0].parentNode||t,c==="string"||c==="number"){if(o||c==="number"&&(e=e.toString(),e===n))return n;if(l){let p=n[0];p&&p.nodeType===3?p.data!==e&&(p.data=e):p=document.createTextNode(e),n=Sn(t,n,r,p)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||c==="boolean"){if(o)return n;n=Sn(t,n,r)}else{if(c==="function")return nt(()=>{let p=e();for(;typeof p=="function";)p=p();n=dr(t,p,n,r)}),()=>n;if(Array.isArray(e)){const p=[],y=n&&Array.isArray(n);if(ws(p,e,n,s))return nt(()=>n=dr(t,p,n,r,!0)),()=>n;if(o){if(!p.length)return n;if(r===void 0)return n=[...t.childNodes];let _=p[0];if(_.parentNode!==t)return n;const g=[_];for(;(_=_.nextSibling)!==r;)g.push(_);return n=g}if(p.length===0){if(n=Sn(t,n,r),l)return n}else y?n.length===0?Fa(t,p,r):Pc(t,n,p):(n&&Sn(t),Fa(t,p));n=p}else if(e.nodeType){if(o&&e.parentNode)return n=l?[e]:e;if(Array.isArray(n)){if(l)return n=Sn(t,n,r,e);Sn(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function ws(t,e,n,r){let s=!1;for(let o=0,c=e.length;o<c;o++){let l=e[o],p=n&&n[t.length],y;if(!(l==null||l===!0||l===!1))if((y=typeof l)=="object"&&l.nodeType)t.push(l);else if(Array.isArray(l))s=ws(t,l,p)||s;else if(y==="function")if(r){for(;typeof l=="function";)l=l();s=ws(t,Array.isArray(l)?l:[l],Array.isArray(p)?p:[p])||s}else t.push(l),s=!0;else{const _=String(l);p&&p.nodeType===3&&p.data===_?t.push(p):t.push(document.createTextNode(_))}}return s}function Fa(t,e,n=null){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function Sn(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let o=!1;for(let c=e.length-1;c>=0;c--){const l=e[c];if(s!==l){const p=l.parentNode===t;!o&&!c?p?t.replaceChild(s,l):t.insertBefore(s,n):p&&l.remove()}else o=!0}}else t.insertBefore(s,n);return[s]}const Ic=!1,Kc="modulepreload",Bc=function(t){return"/"+t},qa={},zt=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");s=Promise.allSettled(n.map(p=>{if(p=Bc(p),p in qa)return;qa[p]=!0;const y=p.endsWith(".css"),_=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${_}`))return;const g=document.createElement("link");if(g.rel=y?"stylesheet":Kc,y||(g.as="script"),g.crossOrigin="",g.href=p,l&&g.setAttribute("nonce",l),document.head.appendChild(g),y)return new Promise((C,$)=>{g.addEventListener("load",C),g.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return s.then(c=>{for(const l of c||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};function To(){let t=new Set;function e(s){return t.add(s),()=>t.delete(s)}let n=!1;function r(s,o){if(n)return!(n=!1);const c={to:s,options:o,defaultPrevented:!1,preventDefault:()=>c.defaultPrevented=!0};for(const l of t)l.listener({...c,from:l.location,retry:p=>{p&&(n=!0),l.navigate(s,{...o,resolve:!1})}});return!c.defaultPrevented}return{subscribe:e,confirm:r}}let vs;function Is(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),vs=window.history.state._depth}Is();function Lc(t){return{...t,_depth:window.history.state&&window.history.state._depth}}function Fc(t,e){let n=!1;return()=>{const r=vs;Is();const s=r==null?null:vs-r;if(n){n=!1;return}s&&e(s)?(n=!0,window.history.go(-s)):t()}}const qc=/^(?:[a-z0-9]+:)?\/\//i,Uc=/^\/+|(\/)\/+$/g,No="http://sr";function ln(t,e=!1){const n=t.replace(Uc,"$1");return n?e||/^[?#]/.test(n)?n:"/"+n:""}function Jr(t,e,n){if(qc.test(e))return;const r=ln(t),s=n&&ln(n);let o="";return!s||e.startsWith("/")?o=r:s.toLowerCase().indexOf(r.toLowerCase())!==0?o=r+s:o=s,(o||"/")+ln(e,!o)}function Vc(t,e){if(t==null)throw new Error(e);return t}function Hc(t,e){return ln(t).replace(/\/*(\*.*)?$/g,"")+ln(e)}function Do(t){const e={};return t.searchParams.forEach((n,r)=>{r in e?Array.isArray(e[r])?e[r].push(n):e[r]=[e[r],n]:e[r]=n}),e}function zc(t,e,n){const[r,s]=t.split("/*",2),o=r.split("/").filter(Boolean),c=o.length;return l=>{const p=l.split("/").filter(Boolean),y=p.length-c;if(y<0||y>0&&s===void 0&&!e)return null;const _={path:c?"":"/",params:{}},g=C=>n===void 0?void 0:n[C];for(let C=0;C<c;C++){const $=o[C],L=$[0]===":",R=L?p[C]:p[C].toLowerCase(),I=L?$.slice(1):$.toLowerCase();if(L&&is(R,g(I)))_.params[I]=R;else if(L||!is(R,I))return null;_.path+=`/${R}`}if(s){const C=y?p.slice(-y).join("/"):"";if(is(C,g(s)))_.params[s]=C;else return null}return _}}function is(t,e){const n=r=>r===t;return e===void 0?!0:typeof e=="string"?n(e):typeof e=="function"?e(t):Array.isArray(e)?e.some(n):e instanceof RegExp?e.test(t):!1}function Gc(t){const[e,n]=t.pattern.split("/*",2),r=e.split("/").filter(Boolean);return r.reduce((s,o)=>s+(o.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function $o(t){const e=new Map,n=$s();return new Proxy({},{get(r,s){return e.has(s)||vo(n,()=>e.set(s,ne(()=>t()[s]))),e.get(s)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(t())}})}function Wc(t,e){const n=new URLSearchParams(t);Object.entries(e).forEach(([s,o])=>{o==null||o===""||o instanceof Array&&!o.length?n.delete(s):o instanceof Array?(n.delete(s),o.forEach(c=>{n.append(s,String(c))})):n.set(s,String(o))});const r=n.toString();return r?`?${r}`:""}function Mo(t){let e=/(\/?\:[^\/]+)\?/.exec(t);if(!e)return[t];let n=t.slice(0,e.index),r=t.slice(e.index+e[0].length);const s=[n,n+=e[1]];for(;e=/^(\/\:[^\/]+)\?/.exec(r);)s.push(n+=e[1]),r=r.slice(e[0].length);return Mo(r).reduce((o,c)=>[...o,...s.map(l=>l+c)],[])}const Qc=100,jo=Tt(),Ks=Tt(),Gn=()=>Vc(bt(jo),"<A> and 'use' router primitives can be only used inside a Route."),Yc=()=>bt(Ks)||Gn().base,Xc=t=>{const e=Yc();return ne(()=>e.resolvePath(t()))},Jc=t=>{const e=Gn();return ne(()=>{const n=t();return n!==void 0?e.renderPath(n):n})},Io=()=>Gn().navigatorFactory(),hi=()=>Gn().location,Od=()=>Gn().params,Pd=()=>{const t=hi(),e=Io(),n=(r,s)=>{const o=De(()=>Wc(t.search,r)+t.hash);e(o,{scroll:!1,resolve:!1,...s})};return[t.query,n]},Zc=t=>{const e=Gn().beforeLeave.subscribe({listener:t,location:hi(),navigate:Io()});Vt(e)};function el(t,e=""){const{component:n,preload:r,load:s,children:o,info:c}=t,l=!o||Array.isArray(o)&&!o.length,p={key:t,component:n,preload:r||s,info:c};return Ko(t.path).reduce((y,_)=>{for(const g of Mo(_)){const C=Hc(e,g);let $=l?C:C.split("/*",1)[0];$=$.split("/").map(L=>L.startsWith(":")||L.startsWith("*")?L:encodeURIComponent(L)).join("/"),y.push({...p,originalPath:_,pattern:$,matcher:zc($,!l,t.matchFilters)})}return y},[])}function tl(t,e=0){return{routes:t,score:Gc(t[t.length-1])*1e4-e,matcher(n){const r=[];for(let s=t.length-1;s>=0;s--){const o=t[s],c=o.matcher(n);if(!c)return null;r.unshift({...c,route:o})}return r}}}function Ko(t){return Array.isArray(t)?t:[t]}function Bo(t,e="",n=[],r=[]){const s=Ko(t);for(let o=0,c=s.length;o<c;o++){const l=s[o];if(l&&typeof l=="object"){l.hasOwnProperty("path")||(l.path="");const p=el(l,e);for(const y of p){n.push(y);const _=Array.isArray(l.children)&&l.children.length===0;if(l.children&&!_)Bo(l.children,y.pattern,n,r);else{const g=tl([...n],r.length);r.push(g)}n.pop()}}}return n.length?r:r.sort((o,c)=>c.score-o.score)}function ss(t,e){for(let n=0,r=t.length;n<r;n++){const s=t[n].matcher(e);if(s)return s}return[]}function nl(t,e,n){const r=new URL(No),s=ne(_=>{const g=t();try{return new URL(g,r)}catch{return console.error(`Invalid path ${g}`),_}},r,{equals:(_,g)=>_.href===g.href}),o=ne(()=>s().pathname),c=ne(()=>s().search,!0),l=ne(()=>s().hash),p=()=>"",y=gr(c,()=>Do(s()));return{get pathname(){return o()},get search(){return c()},get hash(){return l()},get state(){return e()},get key(){return p()},query:n?n(y):$o(y)}}let an;function rl(){return an}function il(t,e,n,r={}){const{signal:[s,o],utils:c={}}=t,l=c.parsePath||(be=>be),p=c.renderPath||(be=>be),y=c.beforeLeave||To(),_=Jr("",r.base||"");if(_===void 0)throw new Error(`${_} is not a valid base path`);_&&!s().value&&o({value:_,replace:!0,scroll:!1});const[g,C]=Re(!1);let $;const L=(be,ke)=>{ke.value===R()&&ke.state===W()||($===void 0&&C(!0),an=be,$=ke,bo(()=>{$===ke&&(I($.value),j($.state),mc(),Q[1](Le=>Le.filter(Nt=>Nt.pending)))}).finally(()=>{$===ke&&ht(()=>{an=void 0,be==="navigate"&&Ee($),C(!1),$=void 0})}))},[R,I]=Re(s().value),[W,j]=Re(s().state),B=nl(R,W,c.queryWrapper),U=[],Q=Re([]),ee=ne(()=>typeof r.transformUrl=="function"?ss(e(),r.transformUrl(B.pathname)):ss(e(),B.pathname)),ce=()=>{const be=ee(),ke={};for(let Le=0;Le<be.length;Le++)Object.assign(ke,be[Le].params);return ke},Ce=c.paramsWrapper?c.paramsWrapper(ce,e):$o(ce),je={pattern:_,path:()=>_,outlet:()=>null,resolvePath(be){return Jr(_,be)}};return nt(gr(s,be=>L("native",be),{defer:!0})),{base:je,location:B,params:Ce,isRouting:g,renderPath:p,parsePath:l,navigatorFactory:Se,matches:ee,beforeLeave:y,preloadRoute:Ue,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:Q};function we(be,ke,Le){De(()=>{if(typeof ke=="number"){ke&&(c.go?c.go(ke):console.warn("Router integration does not support relative routing"));return}const Nt=!ke||ke[0]==="?",{replace:ut,resolve:Je,scroll:Ze,state:xt}={replace:!1,resolve:!Nt,scroll:!0,...Le},mn=Je?be.resolvePath(ke):Jr(Nt&&B.pathname||"",ke);if(mn===void 0)throw new Error(`Path '${ke}' is not a routable path`);if(U.length>=Qc)throw new Error("Too many redirects");const Et=R();(mn!==Et||xt!==W())&&(Ic||y.confirm(mn,Le)&&(U.push({value:Et,replace:ut,scroll:Ze,state:W()}),L("navigate",{value:mn,state:xt})))})}function Se(be){return be=be||bt(Ks)||je,(ke,Le)=>we(be,ke,Le)}function Ee(be){const ke=U[0];ke&&(o({...be,replace:ke.replace,scroll:ke.scroll}),U.length=0)}function Ue(be,ke){const Le=ss(e(),be.pathname),Nt=an;an="preload";for(let ut in Le){const{route:Je,params:Ze}=Le[ut];Je.component&&Je.component.preload&&Je.component.preload();const{preload:xt}=Je;ke&&xt&&vo(n(),()=>xt({params:Ze,location:{pathname:be.pathname,search:be.search,hash:be.hash,query:Do(be),state:null,key:""},intent:"preload"}))}an=Nt}}function sl(t,e,n,r){const{base:s,location:o,params:c}=t,{pattern:l,component:p,preload:y}=r().route,_=ne(()=>r().path);p&&p.preload&&p.preload();const g=y?y({params:c,location:o,intent:an||"initial"}):void 0;return{parent:e,pattern:l,path:_,outlet:()=>p?te(p,{params:c,location:o,data:g,get children(){return n()}}):n(),resolvePath($){return Jr(s.path(),$,_())}}}const al=t=>e=>{const{base:n}=e,r=Fn(()=>e.children),s=ne(()=>Bo(r(),e.base||""));let o;const c=il(t,s,()=>o,{base:n,singleFlight:e.singleFlight,transformUrl:e.transformUrl});return t.create&&t.create(c),te(jo.Provider,{value:c,get children(){return te(ol,{routerState:c,get root(){return e.root},get preload(){return e.rootPreload||e.rootLoad},get children(){return[ne(()=>(o=$s())&&null),te(ul,{routerState:c,get branches(){return s()}})]}})}})};function ol(t){const e=t.routerState.location,n=t.routerState.params,r=ne(()=>t.preload&&De(()=>{t.preload({params:n,location:e,intent:rl()||"initial"})}));return te(dt,{get when(){return t.root},keyed:!0,get fallback(){return t.children},children:s=>te(s,{params:n,location:e,get data(){return r()},get children(){return t.children}})})}function ul(t){const e=[];let n;const r=ne(gr(t.routerState.matches,(s,o,c)=>{let l=o&&s.length===o.length;const p=[];for(let y=0,_=s.length;y<_;y++){const g=o&&o[y],C=s[y];c&&g&&C.route.key===g.route.key?p[y]=c[y]:(l=!1,e[y]&&e[y](),Mn($=>{e[y]=$,p[y]=sl(t.routerState,p[y-1]||t.routerState.base,Ua(()=>r()[y+1]),()=>t.routerState.matches()[y])}))}return e.splice(s.length).forEach(y=>y()),c&&l?c:(n=p[0],p)}));return Ua(()=>r()&&n)()}const Ua=t=>()=>te(dt,{get when(){return t()},keyed:!0,children:e=>te(Ks.Provider,{value:e,get children(){return e.outlet()}})}),We=t=>{const e=Fn(()=>t.children);return Ct(t,{get children(){return e()}})};function cl([t,e],n,r){return[t,r?s=>e(r(s)):e]}function ll(t){let e=!1;const n=s=>typeof s=="string"?{value:s}:s,r=cl(Re(n(t.get()),{equals:(s,o)=>s.value===o.value&&s.state===o.state}),void 0,s=>(!e&&t.set(s),se.registry&&!se.done&&(se.done=!0),s));return t.init&&Vt(t.init((s=t.get())=>{e=!0,r[1](n(s)),e=!1})),al({signal:r,create:t.create,utils:t.utils})}function fl(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function hl(t,e){const n=t&&document.getElementById(t);n?n.scrollIntoView():e&&window.scrollTo(0,0)}const dl=new Map;function pl(t=!0,e=!1,n="/_server",r){return s=>{const o=s.base.path(),c=s.navigatorFactory(s.base);let l,p;function y(R){return R.namespaceURI==="http://www.w3.org/2000/svg"}function _(R){if(R.defaultPrevented||R.button!==0||R.metaKey||R.altKey||R.ctrlKey||R.shiftKey)return;const I=R.composedPath().find(ee=>ee instanceof Node&&ee.nodeName.toUpperCase()==="A");if(!I||e&&!I.hasAttribute("link"))return;const W=y(I),j=W?I.href.baseVal:I.href;if((W?I.target.baseVal:I.target)||!j&&!I.hasAttribute("state"))return;const U=(I.getAttribute("rel")||"").split(/\s+/);if(I.hasAttribute("download")||U&&U.includes("external"))return;const Q=W?new URL(j,document.baseURI):new URL(j);if(!(Q.origin!==window.location.origin||o&&Q.pathname&&!Q.pathname.toLowerCase().startsWith(o.toLowerCase())))return[I,Q]}function g(R){const I=_(R);if(!I)return;const[W,j]=I,B=s.parsePath(j.pathname+j.search+j.hash),U=W.getAttribute("state");R.preventDefault(),c(B,{resolve:!1,replace:W.hasAttribute("replace"),scroll:!W.hasAttribute("noscroll"),state:U?JSON.parse(U):void 0})}function C(R){const I=_(R);if(!I)return;const[W,j]=I;r&&(j.pathname=r(j.pathname)),s.preloadRoute(j,W.getAttribute("preload")!=="false")}function $(R){clearTimeout(l);const I=_(R);if(!I)return p=null;const[W,j]=I;p!==W&&(r&&(j.pathname=r(j.pathname)),l=setTimeout(()=>{s.preloadRoute(j,W.getAttribute("preload")!=="false"),p=W},20))}function L(R){if(R.defaultPrevented)return;let I=R.submitter&&R.submitter.hasAttribute("formaction")?R.submitter.getAttribute("formaction"):R.target.getAttribute("action");if(!I)return;if(!I.startsWith("https://action/")){const j=new URL(I,No);if(I=s.parsePath(j.pathname+j.search),!I.startsWith(n))return}if(R.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const W=dl.get(I);if(W){R.preventDefault();const j=new FormData(R.target,R.submitter);W.call({r:s,f:R.target},R.target.enctype==="multipart/form-data"?j:new URLSearchParams(j))}}Ms(["click","submit"]),document.addEventListener("click",g),t&&(document.addEventListener("mousemove",$,{passive:!0}),document.addEventListener("focusin",C,{passive:!0}),document.addEventListener("touchstart",C,{passive:!0})),document.addEventListener("submit",L),Vt(()=>{document.removeEventListener("click",g),t&&(document.removeEventListener("mousemove",$),document.removeEventListener("focusin",C),document.removeEventListener("touchstart",C)),document.removeEventListener("submit",L)})}}function yl(t){const e=()=>{const r=window.location.pathname.replace(/^\/+/,"/")+window.location.search,s=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:r+window.location.hash,state:s}},n=To();return ll({get:e,set({value:r,replace:s,scroll:o,state:c}){s?window.history.replaceState(Lc(c),"",r):window.history.pushState(c,"",r),hl(decodeURIComponent(window.location.hash.slice(1)),o),Is()},init:r=>fl(window,"popstate",Fc(r,s=>{if(s&&s<0)return!n.confirm(s);{const o=e();return!n.confirm(o.value,{state:o.state})}})),create:pl(t.preload,t.explicitLinks,t.actionBase,t.transformUrl),utils:{go:r=>window.history.go(r),beforeLeave:n}})(t)}var _l=Xe("<a>");function Ot(t){t=Ct({inactiveClass:"inactive",activeClass:"active"},t);const[,e]=pc(t,["href","state","class","activeClass","inactiveClass","end"]),n=Xc(()=>t.href),r=Jc(n),s=hi(),o=ne(()=>{const c=n();if(c===void 0)return[!1,!1];const l=ln(c.split(/[?#]/,1)[0]).toLowerCase(),p=decodeURI(ln(s.pathname).toLowerCase());return[t.end?l===p:p.startsWith(l+"/")||p===l,l===p]});return(()=>{var c=_l();return gs(c,Ct(e,{get href(){return r()||t.href},get state(){return JSON.stringify(t.state)},get classList(){return{...t.class&&{[t.class]:!0},[t.inactiveClass]:!o()[0],[t.activeClass]:o()[0],...e.classList}},link:"",get"aria-current"(){return o()[1]?"page":void 0}}),!1,!1),c})()}const bs=Symbol("store-raw"),jn=Symbol("store-node"),Pt=Symbol("store-has"),Lo=Symbol("store-self");function Fo(t){let e=t[pt];if(!e&&(Object.defineProperty(t,pt,{value:e=new Proxy(t,wl)}),!Array.isArray(t))){const n=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let s=0,o=n.length;s<o;s++){const c=n[s];r[c].get&&Object.defineProperty(t,c,{enumerable:r[c].enumerable,get:r[c].get.bind(e)})}}return e}function qt(t){let e;return t!=null&&typeof t=="object"&&(t[pt]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function qn(t,e=new Set){let n,r,s,o;if(n=t!=null&&t[bs])return n;if(!qt(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let c=0,l=t.length;c<l;c++)s=t[c],(r=qn(s,e))!==s&&(t[c]=r)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const c=Object.keys(t),l=Object.getOwnPropertyDescriptors(t);for(let p=0,y=c.length;p<y;p++)o=c[p],!l[o].get&&(s=t[o],(r=qn(s,e))!==s&&(t[o]=r))}return t}function ii(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function pr(t,e,n){if(t[e])return t[e];const[r,s]=Re(n,{equals:!1,internal:!0});return r.$=s,t[e]=r}function ml(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===pt||e===jn||(delete n.value,delete n.writable,n.get=()=>t[pt][e]),n}function qo(t){ds()&&pr(ii(t,jn),Lo)()}function gl(t){return qo(t),Reflect.ownKeys(t)}const wl={get(t,e,n){if(e===bs)return t;if(e===pt)return n;if(e===hs)return qo(t),n;const r=ii(t,jn),s=r[e];let o=s?s():t[e];if(e===jn||e===Pt||e==="__proto__")return o;if(!s){const c=Object.getOwnPropertyDescriptor(t,e);ds()&&(typeof o!="function"||t.hasOwnProperty(e))&&!(c&&c.get)&&(o=pr(r,e,o)())}return qt(o)?Fo(o):o},has(t,e){return e===bs||e===pt||e===hs||e===jn||e===Pt||e==="__proto__"?!0:(ds()&&pr(ii(t,Pt),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:gl,getOwnPropertyDescriptor:ml};function at(t,e,n,r=!1){if(!r&&t[e]===n)return;const s=t[e],o=t.length;n===void 0?(delete t[e],t[Pt]&&t[Pt][e]&&s!==void 0&&t[Pt][e].$()):(t[e]=n,t[Pt]&&t[Pt][e]&&s===void 0&&t[Pt][e].$());let c=ii(t,jn),l;if((l=pr(c,e,s))&&l.$(()=>n),Array.isArray(t)&&t.length!==o){for(let p=t.length;p<o;p++)(l=c[p])&&l.$();(l=pr(c,"length",o))&&l.$(t.length)}(l=c[Lo])&&l.$()}function Uo(t,e){const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const s=n[r];at(t,s,e[s])}}function vl(t,e){if(typeof e=="function"&&(e=e(t)),e=qn(e),Array.isArray(e)){if(t===e)return;let n=0,r=e.length;for(;n<r;n++){const s=e[n];t[n]!==s&&at(t,n,s)}at(t,"length",r)}else Uo(t,e)}function lr(t,e,n=[]){let r,s=t;if(e.length>1){r=e.shift();const c=typeof r,l=Array.isArray(t);if(Array.isArray(r)){for(let p=0;p<r.length;p++)lr(t,[r[p]].concat(e),n);return}else if(l&&c==="function"){for(let p=0;p<t.length;p++)r(t[p],p)&&lr(t,[p].concat(e),n);return}else if(l&&c==="object"){const{from:p=0,to:y=t.length-1,by:_=1}=r;for(let g=p;g<=y;g+=_)lr(t,[g].concat(e),n);return}else if(e.length>1){lr(t[r],e,[r].concat(n));return}s=t[r],n=[r].concat(n)}let o=e[0];typeof o=="function"&&(o=o(s,n),o===s)||r===void 0&&o==null||(o=qn(o),r===void 0||qt(s)&&qt(o)&&!Array.isArray(o)?Uo(s,o):at(t,r,o))}function Vo(...[t,e]){const n=qn(t||{}),r=Array.isArray(n),s=Fo(n);function o(...c){ht(()=>{r&&c.length===1?vl(n,c[0]):lr(n,c)})}return[s,o]}const ks=Symbol("store-root");function Tn(t,e,n,r,s){const o=e[n];if(t===o)return;const c=Array.isArray(t);if(n!==ks&&(!qt(t)||!qt(o)||c!==Array.isArray(o)||s&&t[s]!==o[s])){at(e,n,t);return}if(c){if(t.length&&o.length&&(!r||s&&t[0]&&t[0][s]!=null)){let y,_,g,C,$,L,R,I;for(g=0,C=Math.min(o.length,t.length);g<C&&(o[g]===t[g]||s&&o[g]&&t[g]&&o[g][s]===t[g][s]);g++)Tn(t[g],o,g,r,s);const W=new Array(t.length),j=new Map;for(C=o.length-1,$=t.length-1;C>=g&&$>=g&&(o[C]===t[$]||s&&o[C]&&t[$]&&o[C][s]===t[$][s]);C--,$--)W[$]=o[C];if(g>$||g>C){for(_=g;_<=$;_++)at(o,_,t[_]);for(;_<t.length;_++)at(o,_,W[_]),Tn(t[_],o,_,r,s);o.length>t.length&&at(o,"length",t.length);return}for(R=new Array($+1),_=$;_>=g;_--)L=t[_],I=s&&L?L[s]:L,y=j.get(I),R[_]=y===void 0?-1:y,j.set(I,_);for(y=g;y<=C;y++)L=o[y],I=s&&L?L[s]:L,_=j.get(I),_!==void 0&&_!==-1&&(W[_]=o[y],_=R[_],j.set(I,_));for(_=g;_<t.length;_++)_ in W?(at(o,_,W[_]),Tn(t[_],o,_,r,s)):at(o,_,t[_])}else for(let y=0,_=t.length;y<_;y++)Tn(t[y],o,y,r,s);o.length>t.length&&at(o,"length",t.length);return}const l=Object.keys(t);for(let y=0,_=l.length;y<_;y++)Tn(t[l[y]],o,l[y],r,s);const p=Object.keys(o);for(let y=0,_=p.length;y<_;y++)t[p[y]]===void 0&&at(o,p[y],void 0)}function bl(t,e={}){const{merge:n,key:r="id"}=e,s=qn(t);return o=>{if(!qt(o)||!qt(s))return s;const c=Tn(s,{[ks]:o},ks,n,r);return c===void 0?o:c}}function di(t,e){let n,r=()=>!n||n.state==="unresolved"?void 0:n.latest;[n]=wo(()=>kl(t,De(r)),o=>o,e);const s=()=>n();return Object.defineProperty(s,"latest",{get(){return n.latest}}),s}class st{static all(){return new st}static allSettled(){return new st}static any(){return new st}static race(){return new st}static reject(){return new st}static resolve(){return new st}catch(){return new st}then(){return new st}finally(){return new st}}function kl(t,e){if(!se.context)return t(e);const n=fetch,r=Promise;try{return window.fetch=()=>new st,Promise=st,t(e)}finally{window.fetch=n,Promise=r}}const xl=Tt(),El=["title","meta"],Va=[],Ha=["name","http-equiv","content","charset","media"].concat(["property"]),za=(t,e)=>{const n=Object.fromEntries(Object.entries(t.props).filter(([r])=>e.includes(r)).sort());return(Object.hasOwn(n,"name")||Object.hasOwn(n,"property"))&&(n.name=n.name||n.property,delete n.property),t.tag+JSON.stringify(n)};function Al(){if(!se.context){const n=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(n,r=>r.parentNode.removeChild(r))}const t=new Map;function e(n){if(n.ref)return n.ref;let r=document.querySelector(`[data-sm="${n.id}"]`);return r?(r.tagName.toLowerCase()!==n.tag&&(r.parentNode&&r.parentNode.removeChild(r),r=document.createElement(n.tag)),r.removeAttribute("data-sm")):r=document.createElement(n.tag),r}return{addTag(n){if(El.indexOf(n.tag)!==-1){const o=n.tag==="title"?Va:Ha,c=za(n,o);t.has(c)||t.set(c,[]);let l=t.get(c),p=l.length;l=[...l,n],t.set(c,l);let y=e(n);n.ref=y,gs(y,n.props);let _=null;for(var r=p-1;r>=0;r--)if(l[r]!=null){_=l[r];break}return y.parentNode!=document.head&&document.head.appendChild(y),_&&_.ref&&_.ref.parentNode&&document.head.removeChild(_.ref),p}let s=e(n);return n.ref=s,gs(s,n.props),s.parentNode!=document.head&&document.head.appendChild(s),-1},removeTag(n,r){const s=n.tag==="title"?Va:Ha,o=za(n,s);if(n.ref){const c=t.get(o);if(c){if(n.ref.parentNode){n.ref.parentNode.removeChild(n.ref);for(let l=r-1;l>=0;l--)c[l]!=null&&document.head.appendChild(c[l].ref)}c[r]=null,t.set(o,c)}else n.ref.parentNode&&n.ref.parentNode.removeChild(n.ref)}}}}const Sl=t=>{const e=Al();return te(xl.Provider,{value:e,get children(){return t.children}})};var Ol=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zr={exports:{}},Cl=Zr.exports,Ga;function Rl(){return Ga||(Ga=1,function(t,e){(function(n,r){t.exports=r()})(Cl,function(){var n=function(i,a){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])})(i,a)},r=function(){return(r=Object.assign||function(i){for(var a,u=1,f=arguments.length;u<f;u++)for(var h in a=arguments[u])Object.prototype.hasOwnProperty.call(a,h)&&(i[h]=a[h]);return i}).apply(this,arguments)};function s(i,a,u){for(var f,h=0,d=a.length;h<d;h++)!f&&h in a||((f=f||Array.prototype.slice.call(a,0,h))[h]=a[h]);return i.concat(f||Array.prototype.slice.call(a))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ol,c=Object.keys,l=Array.isArray;function p(i,a){return typeof a!="object"||c(a).forEach(function(u){i[u]=a[u]}),i}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var y=Object.getPrototypeOf,_={}.hasOwnProperty;function g(i,a){return _.call(i,a)}function C(i,a){typeof a=="function"&&(a=a(y(i))),(typeof Reflect>"u"?c:Reflect.ownKeys)(a).forEach(function(u){L(i,u,a[u])})}var $=Object.defineProperty;function L(i,a,u,f){$(i,a,p(u&&g(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},f))}function R(i){return{from:function(a){return i.prototype=Object.create(a.prototype),L(i.prototype,"constructor",i),{extend:C.bind(null,i.prototype)}}}}var I=Object.getOwnPropertyDescriptor,W=[].slice;function j(i,a,u){return W.call(i,a,u)}function B(i,a){return a(i)}function U(i){if(!i)throw new Error("Assertion Failed")}function Q(i){o.setImmediate?setImmediate(i):setTimeout(i,0)}function ee(i,a){if(typeof a=="string"&&g(i,a))return i[a];if(!a)return i;if(typeof a!="string"){for(var u=[],f=0,h=a.length;f<h;++f){var d=ee(i,a[f]);u.push(d)}return u}var m=a.indexOf(".");if(m!==-1){var w=i[a.substr(0,m)];return w==null?void 0:ee(w,a.substr(m+1))}}function ce(i,a,u){if(i&&a!==void 0&&!("isFrozen"in Object&&Object.isFrozen(i)))if(typeof a!="string"&&"length"in a){U(typeof u!="string"&&"length"in u);for(var f=0,h=a.length;f<h;++f)ce(i,a[f],u[f])}else{var d,m,w=a.indexOf(".");w!==-1?(d=a.substr(0,w),(m=a.substr(w+1))===""?u===void 0?l(i)&&!isNaN(parseInt(d))?i.splice(d,1):delete i[d]:i[d]=u:ce(w=!(w=i[d])||!g(i,d)?i[d]={}:w,m,u)):u===void 0?l(i)&&!isNaN(parseInt(a))?i.splice(a,1):delete i[a]:i[a]=u}}function Ce(i){var a,u={};for(a in i)g(i,a)&&(u[a]=i[a]);return u}var je=[].concat;function we(i){return je.apply([],i)}var Qt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(we([8,16,32,64].map(function(i){return["Int","Uint","Float"].map(function(a){return a+i+"Array"})}))).filter(function(i){return o[i]}),Se=new Set(Qt.map(function(i){return o[i]})),Ee=null;function Ue(i){return Ee=new WeakMap,i=function a(u){if(!u||typeof u!="object")return u;var f=Ee.get(u);if(f)return f;if(l(u)){f=[],Ee.set(u,f);for(var h=0,d=u.length;h<d;++h)f.push(a(u[h]))}else if(Se.has(u.constructor))f=u;else{var m,w=y(u);for(m in f=w===Object.prototype?{}:Object.create(w),Ee.set(u,f),u)g(u,m)&&(f[m]=a(u[m]))}return f}(i),Ee=null,i}var be={}.toString;function ke(i){return be.call(i).slice(8,-1)}var Le=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Nt=typeof Le=="symbol"?function(i){var a;return i!=null&&(a=i[Le])&&a.apply(i)}:function(){return null};function ut(i,a){return a=i.indexOf(a),0<=a&&i.splice(a,1),0<=a}var Je={};function Ze(i){var a,u,f,h;if(arguments.length===1){if(l(i))return i.slice();if(this===Je&&typeof i=="string")return[i];if(h=Nt(i)){for(u=[];!(f=h.next()).done;)u.push(f.value);return u}if(i==null)return[i];if(typeof(a=i.length)!="number")return[i];for(u=new Array(a);a--;)u[a]=i[a];return u}for(a=arguments.length,u=new Array(a);a--;)u[a]=arguments[a];return u}var xt=typeof Symbol<"u"?function(i){return i[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],it=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xn),mn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Et(i,a){this.name=i,this.message=a}function Xs(i,a){return i+". Errors: "+Object.keys(a).map(function(u){return a[u].toString()}).filter(function(u,f,h){return h.indexOf(u)===f}).join(`
`)}function kr(i,a,u,f){this.failures=a,this.failedKeys=f,this.successCount=u,this.message=Xs(i,a)}function gn(i,a){this.name="BulkError",this.failures=Object.keys(a).map(function(u){return a[u]}),this.failuresByPos=a,this.message=Xs(i,this.failures)}R(Et).from(Error).extend({toString:function(){return this.name+": "+this.message}}),R(kr).from(Et),R(gn).from(Et);var wi=it.reduce(function(i,a){return i[a]=a+"Error",i},{}),Eu=Et,ie=it.reduce(function(i,a){var u=a+"Error";function f(h,d){this.name=u,h?typeof h=="string"?(this.message="".concat(h).concat(d?`
 `+d:""),this.inner=d||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=mn[a]||u,this.inner=null)}return R(f).from(Eu),i[a]=f,i},{});ie.Syntax=SyntaxError,ie.Type=TypeError,ie.Range=RangeError;var Js=Xn.reduce(function(i,a){return i[a+"Error"]=ie[a],i},{}),xr=it.reduce(function(i,a){return["Syntax","Type","Range"].indexOf(a)===-1&&(i[a+"Error"]=ie[a]),i},{});function Ae(){}function Qn(i){return i}function Au(i,a){return i==null||i===Qn?a:function(u){return a(i(u))}}function Wt(i,a){return function(){i.apply(this,arguments),a.apply(this,arguments)}}function Su(i,a){return i===Ae?a:function(){var u=i.apply(this,arguments);u!==void 0&&(arguments[0]=u);var f=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var d=a.apply(this,arguments);return f&&(this.onsuccess=this.onsuccess?Wt(f,this.onsuccess):f),h&&(this.onerror=this.onerror?Wt(h,this.onerror):h),d!==void 0?d:u}}function Ou(i,a){return i===Ae?a:function(){i.apply(this,arguments);var u=this.onsuccess,f=this.onerror;this.onsuccess=this.onerror=null,a.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?Wt(u,this.onsuccess):u),f&&(this.onerror=this.onerror?Wt(f,this.onerror):f)}}function Pu(i,a){return i===Ae?a:function(u){var f=i.apply(this,arguments);p(u,f);var h=this.onsuccess,d=this.onerror;return this.onsuccess=null,this.onerror=null,u=a.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?Wt(h,this.onsuccess):h),d&&(this.onerror=this.onerror?Wt(d,this.onerror):d),f===void 0?u===void 0?void 0:u:p(f,u)}}function Cu(i,a){return i===Ae?a:function(){return a.apply(this,arguments)!==!1&&i.apply(this,arguments)}}function vi(i,a){return i===Ae?a:function(){var u=i.apply(this,arguments);if(u&&typeof u.then=="function"){for(var f=this,h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];return u.then(function(){return a.apply(f,d)})}return a.apply(this,arguments)}}xr.ModifyError=kr,xr.DexieError=Et,xr.BulkError=gn;var yt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Zs(i){yt=i}var Yn={},ea=100,Qt=typeof Promise>"u"?[]:function(){var i=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[i,y(i),i];var a=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[a,y(a),i]}(),Xn=Qt[0],it=Qt[1],Qt=Qt[2],it=it&&it.then,Yt=Xn&&Xn.constructor,bi=!!Qt,Jn=function(i,a){Zn.push([i,a]),Er&&(queueMicrotask(Tu),Er=!1)},ki=!0,Er=!0,Xt=[],Ar=[],xi=Qn,Dt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ae,pgp:!1,env:{},finalize:Ae},re=Dt,Zn=[],Jt=0,Sr=[];function J(i){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var a=this._PSD=re;if(typeof i!="function"){if(i!==Yn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ai(this,this._value))}this._state=null,this._value=null,++a.ref,function u(f,h){try{h(function(d){if(f._state===null){if(d===f)throw new TypeError("A promise cannot be resolved with itself.");var m=f._lib&&wn();d&&typeof d.then=="function"?u(f,function(w,b){d instanceof J?d._then(w,b):d.then(w,b)}):(f._state=!0,f._value=d,na(f)),m&&vn()}},Ai.bind(null,f))}catch(d){Ai(f,d)}}(this,i)}var Ei={get:function(){var i=re,a=Rr;function u(f,h){var d=this,m=!i.global&&(i!==re||a!==Rr),w=m&&!Mt(),b=new J(function(x,S){Si(d,new ta(ia(f,i,m,w),ia(h,i,m,w),x,S,i))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return u.prototype=Yn,u},set:function(i){L(this,"then",i&&i.prototype===Yn?Ei:{get:function(){return i},set:Ei.set})}};function ta(i,a,u,f,h){this.onFulfilled=typeof i=="function"?i:null,this.onRejected=typeof a=="function"?a:null,this.resolve=u,this.reject=f,this.psd=h}function Ai(i,a){var u,f;Ar.push(a),i._state===null&&(u=i._lib&&wn(),a=xi(a),i._state=!1,i._value=a,f=i,Xt.some(function(h){return h._value===f._value})||Xt.push(f),na(i),u&&vn())}function na(i){var a=i._listeners;i._listeners=[];for(var u=0,f=a.length;u<f;++u)Si(i,a[u]);var h=i._PSD;--h.ref||h.finalize(),Jt===0&&(++Jt,Jn(function(){--Jt==0&&Oi()},[]))}function Si(i,a){if(i._state!==null){var u=i._state?a.onFulfilled:a.onRejected;if(u===null)return(i._state?a.resolve:a.reject)(i._value);++a.psd.ref,++Jt,Jn(Ru,[u,i,a])}else i._listeners.push(a)}function Ru(i,a,u){try{var f,h=a._value;!a._state&&Ar.length&&(Ar=[]),f=yt&&a._consoleTask?a._consoleTask.run(function(){return i(h)}):i(h),a._state||Ar.indexOf(h)!==-1||function(d){for(var m=Xt.length;m;)if(Xt[--m]._value===d._value)return Xt.splice(m,1)}(a),u.resolve(f)}catch(d){u.reject(d)}finally{--Jt==0&&Oi(),--u.psd.ref||u.psd.finalize()}}function Tu(){Zt(Dt,function(){wn()&&vn()})}function wn(){var i=ki;return Er=ki=!1,i}function vn(){var i,a,u;do for(;0<Zn.length;)for(i=Zn,Zn=[],u=i.length,a=0;a<u;++a){var f=i[a];f[0].apply(null,f[1])}while(0<Zn.length);Er=ki=!0}function Oi(){var i=Xt;Xt=[],i.forEach(function(f){f._PSD.onunhandled.call(null,f._value,f)});for(var a=Sr.slice(0),u=a.length;u;)a[--u]()}function Or(i){return new J(Yn,!1,i)}function Pe(i,a){var u=re;return function(){var f=wn(),h=re;try{return jt(u,!0),i.apply(this,arguments)}catch(d){a&&a(d)}finally{jt(h,!1),f&&vn()}}}C(J.prototype,{then:Ei,_then:function(i,a){Si(this,new ta(null,null,i,a,re))},catch:function(i){if(arguments.length===1)return this.then(null,i);var a=i,u=arguments[1];return typeof a=="function"?this.then(null,function(f){return(f instanceof a?u:Or)(f)}):this.then(null,function(f){return(f&&f.name===a?u:Or)(f)})},finally:function(i){return this.then(function(a){return J.resolve(i()).then(function(){return a})},function(a){return J.resolve(i()).then(function(){return Or(a)})})},timeout:function(i,a){var u=this;return i<1/0?new J(function(f,h){var d=setTimeout(function(){return h(new ie.Timeout(a))},i);u.then(f,h).finally(clearTimeout.bind(null,d))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(J.prototype,Symbol.toStringTag,"Dexie.Promise"),Dt.env=ra(),C(J,{all:function(){var i=Ze.apply(null,arguments).map(Tr);return new J(function(a,u){i.length===0&&a([]);var f=i.length;i.forEach(function(h,d){return J.resolve(h).then(function(m){i[d]=m,--f||a(i)},u)})})},resolve:function(i){return i instanceof J?i:i&&typeof i.then=="function"?new J(function(a,u){i.then(a,u)}):new J(Yn,!0,i)},reject:Or,race:function(){var i=Ze.apply(null,arguments).map(Tr);return new J(function(a,u){i.map(function(f){return J.resolve(f).then(a,u)})})},PSD:{get:function(){return re},set:function(i){return re=i}},totalEchoes:{get:function(){return Rr}},newPSD:$t,usePSD:Zt,scheduler:{get:function(){return Jn},set:function(i){Jn=i}},rejectionMapper:{get:function(){return xi},set:function(i){xi=i}},follow:function(i,a){return new J(function(u,f){return $t(function(h,d){var m=re;m.unhandleds=[],m.onunhandled=d,m.finalize=Wt(function(){var w,b=this;w=function(){b.unhandleds.length===0?h():d(b.unhandleds[0])},Sr.push(function x(){w(),Sr.splice(Sr.indexOf(x),1)}),++Jt,Jn(function(){--Jt==0&&Oi()},[])},m.finalize),i()},a,u,f)})}}),Yt&&(Yt.allSettled&&L(J,"allSettled",function(){var i=Ze.apply(null,arguments).map(Tr);return new J(function(a){i.length===0&&a([]);var u=i.length,f=new Array(u);i.forEach(function(h,d){return J.resolve(h).then(function(m){return f[d]={status:"fulfilled",value:m}},function(m){return f[d]={status:"rejected",reason:m}}).then(function(){return--u||a(f)})})})}),Yt.any&&typeof AggregateError<"u"&&L(J,"any",function(){var i=Ze.apply(null,arguments).map(Tr);return new J(function(a,u){i.length===0&&u(new AggregateError([]));var f=i.length,h=new Array(f);i.forEach(function(d,m){return J.resolve(d).then(function(w){return a(w)},function(w){h[m]=w,--f||u(new AggregateError(h))})})})}),Yt.withResolvers&&(J.withResolvers=Yt.withResolvers));var Ie={awaits:0,echoes:0,id:0},Nu=0,Pr=[],Cr=0,Rr=0,Du=0;function $t(i,a,u,f){var h=re,d=Object.create(h);return d.parent=h,d.ref=0,d.global=!1,d.id=++Du,Dt.env,d.env=bi?{Promise:J,PromiseProp:{value:J,configurable:!0,writable:!0},all:J.all,race:J.race,allSettled:J.allSettled,any:J.any,resolve:J.resolve,reject:J.reject}:{},a&&p(d,a),++h.ref,d.finalize=function(){--this.parent.ref||this.parent.finalize()},f=Zt(d,i,u,f),d.ref===0&&d.finalize(),f}function bn(){return Ie.id||(Ie.id=++Nu),++Ie.awaits,Ie.echoes+=ea,Ie.id}function Mt(){return!!Ie.awaits&&(--Ie.awaits==0&&(Ie.id=0),Ie.echoes=Ie.awaits*ea,!0)}function Tr(i){return Ie.echoes&&i&&i.constructor===Yt?(bn(),i.then(function(a){return Mt(),a},function(a){return Mt(),Te(a)})):i}function $u(){var i=Pr[Pr.length-1];Pr.pop(),jt(i,!1)}function jt(i,a){var u,f=re;(a?!Ie.echoes||Cr++&&i===re:!Cr||--Cr&&i===re)||queueMicrotask(a?function(h){++Rr,Ie.echoes&&--Ie.echoes!=0||(Ie.echoes=Ie.awaits=Ie.id=0),Pr.push(re),jt(h,!0)}.bind(null,i):$u),i!==re&&(re=i,f===Dt&&(Dt.env=ra()),bi&&(u=Dt.env.Promise,a=i.env,(f.global||i.global)&&(Object.defineProperty(o,"Promise",a.PromiseProp),u.all=a.all,u.race=a.race,u.resolve=a.resolve,u.reject=a.reject,a.allSettled&&(u.allSettled=a.allSettled),a.any&&(u.any=a.any))))}function ra(){var i=o.Promise;return bi?{Promise:i,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:i.all,race:i.race,allSettled:i.allSettled,any:i.any,resolve:i.resolve,reject:i.reject}:{}}function Zt(i,a,u,f,h){var d=re;try{return jt(i,!0),a(u,f,h)}finally{jt(d,!1)}}function ia(i,a,u,f){return typeof i!="function"?i:function(){var h=re;u&&bn(),jt(a,!0);try{return i.apply(this,arguments)}finally{jt(h,!1),f&&queueMicrotask(Mt)}}}function Pi(i){Promise===Yt&&Ie.echoes===0?Cr===0?i():enqueueNativeMicroTask(i):setTimeout(i,0)}(""+it).indexOf("[native code]")===-1&&(bn=Mt=Ae);var Te=J.reject,en="",At="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",sa="String expected.",kn=[],Nr="__dbnames",Ci="readonly",Ri="readwrite";function tn(i,a){return i?a?function(){return i.apply(this,arguments)&&a.apply(this,arguments)}:i:a}var aa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Dr(i){return typeof i!="string"||/\./.test(i)?function(a){return a}:function(a){return a[i]===void 0&&i in a&&delete(a=Ue(a))[i],a}}function oa(){throw ie.Type()}function ye(i,a){try{var u=ua(i),f=ua(a);if(u!==f)return u==="Array"?1:f==="Array"?-1:u==="binary"?1:f==="binary"?-1:u==="string"?1:f==="string"?-1:u==="Date"?1:f!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return a<i?1:i<a?-1:0;case"binary":return function(h,d){for(var m=h.length,w=d.length,b=m<w?m:w,x=0;x<b;++x)if(h[x]!==d[x])return h[x]<d[x]?-1:1;return m===w?0:m<w?-1:1}(ca(i),ca(a));case"Array":return function(h,d){for(var m=h.length,w=d.length,b=m<w?m:w,x=0;x<b;++x){var S=ye(h[x],d[x]);if(S!==0)return S}return m===w?0:m<w?-1:1}(i,a)}}catch{}return NaN}function ua(i){var a=typeof i;return a!="object"?a:ArrayBuffer.isView(i)?"binary":(i=ke(i),i==="ArrayBuffer"?"binary":i)}function ca(i){return i instanceof Uint8Array?i:ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i)}var la=(Oe.prototype._trans=function(i,a,u){var f=this._tx||re.trans,h=this.name,d=yt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(i==="readonly"?"read":"write"," ").concat(this.name));function m(x,S,v){if(!v.schema[h])throw new ie.NotFound("Table "+h+" not part of transaction");return a(v.idbtrans,v)}var w=wn();try{var b=f&&f.db._novip===this.db._novip?f===re.trans?f._promise(i,m,u):$t(function(){return f._promise(i,m,u)},{trans:f,transless:re.transless||re}):function x(S,v,P,k){if(S.idbdb&&(S._state.openComplete||re.letThrough||S._vip)){var A=S._createTransaction(v,P,S._dbSchema);try{A.create(),S._state.PR1398_maxLoop=3}catch(O){return O.name===wi.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,v,P,k)})):Te(O)}return A._promise(v,function(O,E){return $t(function(){return re.trans=A,k(O,E,A)})}).then(function(O){if(v==="readwrite")try{A.idbtrans.commit()}catch{}return v==="readonly"?O:A._completion.then(function(){return O})})}if(S._state.openComplete)return Te(new ie.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return Te(new ie.DatabaseClosed);S.open().catch(Ae)}return S._state.dbReadyPromise.then(function(){return x(S,v,P,k)})}(this.db,i,[this.name],m);return d&&(b._consoleTask=d,b=b.catch(function(x){return console.trace(x),Te(x)})),b}finally{w&&vn()}},Oe.prototype.get=function(i,a){var u=this;return i&&i.constructor===Object?this.where(i).first(a):i==null?Te(new ie.Type("Invalid argument to Table.get()")):this._trans("readonly",function(f){return u.core.get({trans:f,key:i}).then(function(h){return u.hook.reading.fire(h)})}).then(a)},Oe.prototype.where=function(i){if(typeof i=="string")return new this.db.WhereClause(this,i);if(l(i))return new this.db.WhereClause(this,"[".concat(i.join("+"),"]"));var a=c(i);if(a.length===1)return this.where(a[0]).equals(i[a[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(w){if(w.compound&&a.every(function(x){return 0<=w.keyPath.indexOf(x)})){for(var b=0;b<a.length;++b)if(a.indexOf(w.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(w,b){return w.keyPath.length-b.keyPath.length})[0];if(u&&this.db._maxKey!==en){var d=u.keyPath.slice(0,a.length);return this.where(d).equals(d.map(function(b){return i[b]}))}!u&&yt&&console.warn("The query ".concat(JSON.stringify(i)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var f=this.schema.idxByName;function h(w,b){return ye(w,b)===0}var m=a.reduce(function(v,b){var x=v[0],S=v[1],v=f[b],P=i[b];return[x||v,x||!v?tn(S,v&&v.multi?function(k){return k=ee(k,b),l(k)&&k.some(function(A){return h(P,A)})}:function(k){return h(P,ee(k,b))}):S]},[null,null]),d=m[0],m=m[1];return d?this.where(d.name).equals(i[d.keyPath]).filter(m):u?this.filter(m):this.where(a).equals("")},Oe.prototype.filter=function(i){return this.toCollection().and(i)},Oe.prototype.count=function(i){return this.toCollection().count(i)},Oe.prototype.offset=function(i){return this.toCollection().offset(i)},Oe.prototype.limit=function(i){return this.toCollection().limit(i)},Oe.prototype.each=function(i){return this.toCollection().each(i)},Oe.prototype.toArray=function(i){return this.toCollection().toArray(i)},Oe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Oe.prototype.orderBy=function(i){return new this.db.Collection(new this.db.WhereClause(this,l(i)?"[".concat(i.join("+"),"]"):i))},Oe.prototype.reverse=function(){return this.toCollection().reverse()},Oe.prototype.mapToClass=function(i){var a,u=this.db,f=this.name;function h(){return a!==null&&a.apply(this,arguments)||this}(this.schema.mappedClass=i).prototype instanceof oa&&(function(b,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function S(){this.constructor=b}n(b,x),b.prototype=x===null?Object.create(x):(S.prototype=x.prototype,new S)}(h,a=i),Object.defineProperty(h.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),h.prototype.table=function(){return f},i=h);for(var d=new Set,m=i.prototype;m;m=y(m))Object.getOwnPropertyNames(m).forEach(function(b){return d.add(b)});function w(b){if(!b)return b;var x,S=Object.create(i.prototype);for(x in b)if(!d.has(x))try{S[x]=b[x]}catch{}return S}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=w,this.hook("reading",w),i},Oe.prototype.defineClass=function(){return this.mapToClass(function(i){p(this,i)})},Oe.prototype.add=function(i,a){var u=this,f=this.schema.primKey,h=f.auto,d=f.keyPath,m=i;return d&&h&&(m=Dr(d)(i)),this._trans("readwrite",function(w){return u.core.mutate({trans:w,type:"add",keys:a!=null?[a]:null,values:[m]})}).then(function(w){return w.numFailures?J.reject(w.failures[0]):w.lastResult}).then(function(w){if(d)try{ce(i,d,w)}catch{}return w})},Oe.prototype.update=function(i,a){return typeof i!="object"||l(i)?this.where(":id").equals(i).modify(a):(i=ee(i,this.schema.primKey.keyPath),i===void 0?Te(new ie.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(a))},Oe.prototype.put=function(i,a){var u=this,f=this.schema.primKey,h=f.auto,d=f.keyPath,m=i;return d&&h&&(m=Dr(d)(i)),this._trans("readwrite",function(w){return u.core.mutate({trans:w,type:"put",values:[m],keys:a!=null?[a]:null})}).then(function(w){return w.numFailures?J.reject(w.failures[0]):w.lastResult}).then(function(w){if(d)try{ce(i,d,w)}catch{}return w})},Oe.prototype.delete=function(i){var a=this;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:[i]})}).then(function(u){return u.numFailures?J.reject(u.failures[0]):void 0})},Oe.prototype.clear=function(){var i=this;return this._trans("readwrite",function(a){return i.core.mutate({trans:a,type:"deleteRange",range:aa})}).then(function(a){return a.numFailures?J.reject(a.failures[0]):void 0})},Oe.prototype.bulkGet=function(i){var a=this;return this._trans("readonly",function(u){return a.core.getMany({keys:i,trans:u}).then(function(f){return f.map(function(h){return a.hook.reading.fire(h)})})})},Oe.prototype.bulkAdd=function(i,a,u){var f=this,h=Array.isArray(a)?a:void 0,d=(u=u||(h?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(m){var x=f.schema.primKey,w=x.auto,x=x.keyPath;if(x&&h)throw new ie.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==i.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var b=i.length,x=x&&w?i.map(Dr(x)):i;return f.core.mutate({trans:m,type:"add",keys:h,values:x,wantResults:d}).then(function(A){var v=A.numFailures,P=A.results,k=A.lastResult,A=A.failures;if(v===0)return d?P:k;throw new gn("".concat(f.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),A)})})},Oe.prototype.bulkPut=function(i,a,u){var f=this,h=Array.isArray(a)?a:void 0,d=(u=u||(h?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(m){var x=f.schema.primKey,w=x.auto,x=x.keyPath;if(x&&h)throw new ie.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==i.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var b=i.length,x=x&&w?i.map(Dr(x)):i;return f.core.mutate({trans:m,type:"put",keys:h,values:x,wantResults:d}).then(function(A){var v=A.numFailures,P=A.results,k=A.lastResult,A=A.failures;if(v===0)return d?P:k;throw new gn("".concat(f.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),A)})})},Oe.prototype.bulkUpdate=function(i){var a=this,u=this.core,f=i.map(function(m){return m.key}),h=i.map(function(m){return m.changes}),d=[];return this._trans("readwrite",function(m){return u.getMany({trans:m,keys:f,cache:"clone"}).then(function(w){var b=[],x=[];i.forEach(function(v,P){var k=v.key,A=v.changes,O=w[P];if(O){for(var E=0,T=Object.keys(A);E<T.length;E++){var N=T[E],D=A[N];if(N===a.schema.primKey.keyPath){if(ye(D,k)!==0)throw new ie.Constraint("Cannot update primary key in bulkUpdate()")}else ce(O,N,D)}d.push(P),b.push(k),x.push(O)}});var S=b.length;return u.mutate({trans:m,type:"put",keys:b,values:x,updates:{keys:f,changeSpecs:h}}).then(function(v){var P=v.numFailures,k=v.failures;if(P===0)return S;for(var A=0,O=Object.keys(k);A<O.length;A++){var E,T=O[A],N=d[Number(T)];N!=null&&(E=k[T],delete k[T],k[N]=E)}throw new gn("".concat(a.name,".bulkUpdate(): ").concat(P," of ").concat(S," operations failed"),k)})})})},Oe.prototype.bulkDelete=function(i){var a=this,u=i.length;return this._trans("readwrite",function(f){return a.core.mutate({trans:f,type:"delete",keys:i})}).then(function(m){var h=m.numFailures,d=m.lastResult,m=m.failures;if(h===0)return d;throw new gn("".concat(a.name,".bulkDelete(): ").concat(h," of ").concat(u," operations failed"),m)})},Oe);function Oe(){}function er(i){function a(m,w){if(w){for(var b=arguments.length,x=new Array(b-1);--b;)x[b-1]=arguments[b];return u[m].subscribe.apply(null,x),i}if(typeof m=="string")return u[m]}var u={};a.addEventType=d;for(var f=1,h=arguments.length;f<h;++f)d(arguments[f]);return a;function d(m,w,b){if(typeof m!="object"){var x;w=w||Cu;var S={subscribers:[],fire:b=b||Ae,subscribe:function(v){S.subscribers.indexOf(v)===-1&&(S.subscribers.push(v),S.fire=w(S.fire,v))},unsubscribe:function(v){S.subscribers=S.subscribers.filter(function(P){return P!==v}),S.fire=S.subscribers.reduce(w,b)}};return u[m]=a[m]=S}c(x=m).forEach(function(v){var P=x[v];if(l(P))d(v,x[v][0],x[v][1]);else{if(P!=="asap")throw new ie.InvalidArgument("Invalid event config");var k=d(v,Qn,function(){for(var A=arguments.length,O=new Array(A);A--;)O[A]=arguments[A];k.subscribers.forEach(function(E){Q(function(){E.apply(null,O)})})})}})}}function tr(i,a){return R(a).from({prototype:i}),a}function xn(i,a){return!(i.filter||i.algorithm||i.or)&&(a?i.justLimit:!i.replayFilter)}function Ti(i,a){i.filter=tn(i.filter,a)}function Ni(i,a,u){var f=i.replayFilter;i.replayFilter=f?function(){return tn(f(),a())}:a,i.justLimit=u&&!f}function $r(i,a){if(i.isPrimKey)return a.primaryKey;var u=a.getIndexByKeyPath(i.index);if(!u)throw new ie.Schema("KeyPath "+i.index+" on object store "+a.name+" is not indexed");return u}function fa(i,a,u){var f=$r(i,a.schema);return a.openCursor({trans:u,values:!i.keysOnly,reverse:i.dir==="prev",unique:!!i.unique,query:{index:f,range:i.range}})}function Mr(i,a,u,f){var h=i.replayFilter?tn(i.filter,i.replayFilter()):i.filter;if(i.or){var d={},m=function(w,b,x){var S,v;h&&!h(b,x,function(P){return b.stop(P)},function(P){return b.fail(P)})||((v=""+(S=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(S)),g(d,v)||(d[v]=!0,a(w,b,x)))};return Promise.all([i.or._iterate(m,u),ha(fa(i,f,u),i.algorithm,m,!i.keysOnly&&i.valueMapper)])}return ha(fa(i,f,u),tn(i.algorithm,h),a,!i.keysOnly&&i.valueMapper)}function ha(i,a,u,f){var h=Pe(f?function(d,m,w){return u(f(d),m,w)}:u);return i.then(function(d){if(d)return d.start(function(){var m=function(){return d.continue()};a&&!a(d,function(w){return m=w},function(w){d.stop(w),m=Ae},function(w){d.fail(w),m=Ae})||h(d.value,d,function(w){return m=w}),m()})})}var nr=(da.prototype.execute=function(i){var a=this["@@propmod"];if(a.add!==void 0){var u=a.add;if(l(u))return s(s([],l(i)?i:[],!0),u).sort();if(typeof u=="number")return(Number(i)||0)+u;if(typeof u=="bigint")try{return BigInt(i)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(a.remove!==void 0){var f=a.remove;if(l(f))return l(i)?i.filter(function(h){return!f.includes(h)}).sort():[];if(typeof f=="number")return Number(i)-f;if(typeof f=="bigint")try{return BigInt(i)-f}catch{return BigInt(0)-f}throw new TypeError("Invalid subtrahend ".concat(f))}return u=(u=a.replacePrefix)===null||u===void 0?void 0:u[0],u&&typeof i=="string"&&i.startsWith(u)?a.replacePrefix[1]+i.substring(u.length):i},da);function da(i){this["@@propmod"]=i}var Mu=(me.prototype._read=function(i,a){var u=this._ctx;return u.error?u.table._trans(null,Te.bind(null,u.error)):u.table._trans("readonly",i).then(a)},me.prototype._write=function(i){var a=this._ctx;return a.error?a.table._trans(null,Te.bind(null,a.error)):a.table._trans("readwrite",i,"locked")},me.prototype._addAlgorithm=function(i){var a=this._ctx;a.algorithm=tn(a.algorithm,i)},me.prototype._iterate=function(i,a){return Mr(this._ctx,i,a,this._ctx.table.core)},me.prototype.clone=function(i){var a=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return i&&p(u,i),a._ctx=u,a},me.prototype.raw=function(){return this._ctx.valueMapper=null,this},me.prototype.each=function(i){var a=this._ctx;return this._read(function(u){return Mr(a,i,u,a.table.core)})},me.prototype.count=function(i){var a=this;return this._read(function(u){var f=a._ctx,h=f.table.core;if(xn(f,!0))return h.count({trans:u,query:{index:$r(f,h.schema),range:f.range}}).then(function(m){return Math.min(m,f.limit)});var d=0;return Mr(f,function(){return++d,!1},u,h).then(function(){return d})}).then(i)},me.prototype.sortBy=function(i,a){var u=i.split(".").reverse(),f=u[0],h=u.length-1;function d(b,x){return x?d(b[u[x]],x-1):b[f]}var m=this._ctx.dir==="next"?1:-1;function w(b,x){return ye(d(b,h),d(x,h))*m}return this.toArray(function(b){return b.sort(w)}).then(a)},me.prototype.toArray=function(i){var a=this;return this._read(function(u){var f=a._ctx;if(f.dir==="next"&&xn(f,!0)&&0<f.limit){var h=f.valueMapper,d=$r(f,f.table.core.schema);return f.table.core.query({trans:u,limit:f.limit,values:!0,query:{index:d,range:f.range}}).then(function(w){return w=w.result,h?w.map(h):w})}var m=[];return Mr(f,function(w){return m.push(w)},u,f.table.core).then(function(){return m})},i)},me.prototype.offset=function(i){var a=this._ctx;return i<=0||(a.offset+=i,xn(a)?Ni(a,function(){var u=i;return function(f,h){return u===0||(u===1?--u:h(function(){f.advance(u),u=0}),!1)}}):Ni(a,function(){var u=i;return function(){return--u<0}})),this},me.prototype.limit=function(i){return this._ctx.limit=Math.min(this._ctx.limit,i),Ni(this._ctx,function(){var a=i;return function(u,f,h){return--a<=0&&f(h),0<=a}},!0),this},me.prototype.until=function(i,a){return Ti(this._ctx,function(u,f,h){return!i(u.value)||(f(h),a)}),this},me.prototype.first=function(i){return this.limit(1).toArray(function(a){return a[0]}).then(i)},me.prototype.last=function(i){return this.reverse().first(i)},me.prototype.filter=function(i){var a;return Ti(this._ctx,function(u){return i(u.value)}),(a=this._ctx).isMatch=tn(a.isMatch,i),this},me.prototype.and=function(i){return this.filter(i)},me.prototype.or=function(i){return new this.db.WhereClause(this._ctx.table,i,this)},me.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},me.prototype.desc=function(){return this.reverse()},me.prototype.eachKey=function(i){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,f){i(f.key,f)})},me.prototype.eachUniqueKey=function(i){return this._ctx.unique="unique",this.eachKey(i)},me.prototype.eachPrimaryKey=function(i){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,f){i(f.primaryKey,f)})},me.prototype.keys=function(i){var a=this._ctx;a.keysOnly=!a.isMatch;var u=[];return this.each(function(f,h){u.push(h.key)}).then(function(){return u}).then(i)},me.prototype.primaryKeys=function(i){var a=this._ctx;if(a.dir==="next"&&xn(a,!0)&&0<a.limit)return this._read(function(f){var h=$r(a,a.table.core.schema);return a.table.core.query({trans:f,values:!1,limit:a.limit,query:{index:h,range:a.range}})}).then(function(f){return f.result}).then(i);a.keysOnly=!a.isMatch;var u=[];return this.each(function(f,h){u.push(h.primaryKey)}).then(function(){return u}).then(i)},me.prototype.uniqueKeys=function(i){return this._ctx.unique="unique",this.keys(i)},me.prototype.firstKey=function(i){return this.limit(1).keys(function(a){return a[0]}).then(i)},me.prototype.lastKey=function(i){return this.reverse().firstKey(i)},me.prototype.distinct=function(){var i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];if(!i||!i.multi)return this;var a={};return Ti(this._ctx,function(h){var f=h.primaryKey.toString(),h=g(a,f);return a[f]=!0,!h}),this},me.prototype.modify=function(i){var a=this,u=this._ctx;return this._write(function(f){var h,d,m;m=typeof i=="function"?i:(h=c(i),d=h.length,function(E){for(var T=!1,N=0;N<d;++N){var D=h[N],M=i[D],F=ee(E,D);M instanceof nr?(ce(E,D,M.execute(F)),T=!0):F!==M&&(ce(E,D,M),T=!0)}return T});var w=u.table.core,v=w.schema.primaryKey,b=v.outbound,x=v.extractKey,S=200,v=a.db._options.modifyChunkSize;v&&(S=typeof v=="object"?v[w.name]||v["*"]||200:v);function P(E,D){var N=D.failures,D=D.numFailures;A+=E-D;for(var M=0,F=c(N);M<F.length;M++){var z=F[M];k.push(N[z])}}var k=[],A=0,O=[];return a.clone().primaryKeys().then(function(E){function T(D){var M=Math.min(S,E.length-D);return w.getMany({trans:f,keys:E.slice(D,D+M),cache:"immutable"}).then(function(F){for(var z=[],q=[],V=b?[]:null,Y=[],H=0;H<M;++H){var Z=F[H],le={value:Ue(Z),primKey:E[D+H]};m.call(le,le.value,le)!==!1&&(le.value==null?Y.push(E[D+H]):b||ye(x(Z),x(le.value))===0?(q.push(le.value),b&&V.push(E[D+H])):(Y.push(E[D+H]),z.push(le.value)))}return Promise.resolve(0<z.length&&w.mutate({trans:f,type:"add",values:z}).then(function(de){for(var pe in de.failures)Y.splice(parseInt(pe),1);P(z.length,de)})).then(function(){return(0<q.length||N&&typeof i=="object")&&w.mutate({trans:f,type:"put",keys:V,values:q,criteria:N,changeSpec:typeof i!="function"&&i,isAdditionalChunk:0<D}).then(function(de){return P(q.length,de)})}).then(function(){return(0<Y.length||N&&i===Di)&&w.mutate({trans:f,type:"delete",keys:Y,criteria:N,isAdditionalChunk:0<D}).then(function(de){return P(Y.length,de)})}).then(function(){return E.length>D+M&&T(D+S)})})}var N=xn(u)&&u.limit===1/0&&(typeof i!="function"||i===Di)&&{index:u.index,range:u.range};return T(0).then(function(){if(0<k.length)throw new kr("Error modifying one or more objects",k,A,O);return E.length})})})},me.prototype.delete=function(){var i=this._ctx,a=i.range;return xn(i)&&(i.isPrimKey||a.type===3)?this._write(function(u){var f=i.table.core.schema.primaryKey,h=a;return i.table.core.count({trans:u,query:{index:f,range:h}}).then(function(d){return i.table.core.mutate({trans:u,type:"deleteRange",range:h}).then(function(m){var w=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new kr("Could not delete some values",Object.keys(w).map(function(b){return w[b]}),d-m);return d-m})})}):this.modify(Di)},me);function me(){}var Di=function(i,a){return a.value=null};function ju(i,a){return i<a?-1:i===a?0:1}function Iu(i,a){return a<i?-1:i===a?0:1}function et(i,a,u){return i=i instanceof ya?new i.Collection(i):i,i._ctx.error=new(u||TypeError)(a),i}function En(i){return new i.Collection(i,function(){return pa("")}).limit(0)}function jr(i,a,u,f){var h,d,m,w,b,x,S,v=u.length;if(!u.every(function(A){return typeof A=="string"}))return et(i,sa);function P(A){h=A==="next"?function(E){return E.toUpperCase()}:function(E){return E.toLowerCase()},d=A==="next"?function(E){return E.toLowerCase()}:function(E){return E.toUpperCase()},m=A==="next"?ju:Iu;var O=u.map(function(E){return{lower:d(E),upper:h(E)}}).sort(function(E,T){return m(E.lower,T.lower)});w=O.map(function(E){return E.upper}),b=O.map(function(E){return E.lower}),S=(x=A)==="next"?"":f}P("next"),i=new i.Collection(i,function(){return It(w[0],b[v-1]+f)}),i._ondirectionchange=function(A){P(A)};var k=0;return i._addAlgorithm(function(A,O,E){var T=A.key;if(typeof T!="string")return!1;var N=d(T);if(a(N,b,k))return!0;for(var D=null,M=k;M<v;++M){var F=function(z,q,V,Y,H,Z){for(var le=Math.min(z.length,Y.length),de=-1,pe=0;pe<le;++pe){var tt=q[pe];if(tt!==Y[pe])return H(z[pe],V[pe])<0?z.substr(0,pe)+V[pe]+V.substr(pe+1):H(z[pe],Y[pe])<0?z.substr(0,pe)+Y[pe]+V.substr(pe+1):0<=de?z.substr(0,de)+q[de]+V.substr(de+1):null;H(z[pe],tt)<0&&(de=pe)}return le<Y.length&&Z==="next"?z+V.substr(z.length):le<z.length&&Z==="prev"?z.substr(0,V.length):de<0?null:z.substr(0,de)+Y[de]+V.substr(de+1)}(T,N,w[M],b[M],m,x);F===null&&D===null?k=M+1:(D===null||0<m(D,F))&&(D=F)}return O(D!==null?function(){A.continue(D+S)}:E),!1}),i}function It(i,a,u,f){return{type:2,lower:i,upper:a,lowerOpen:u,upperOpen:f}}function pa(i){return{type:1,lower:i,upper:i}}var ya=(Object.defineProperty(Ke.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ke.prototype.between=function(i,a,u,f){u=u!==!1,f=f===!0;try{return 0<this._cmp(i,a)||this._cmp(i,a)===0&&(u||f)&&(!u||!f)?En(this):new this.Collection(this,function(){return It(i,a,!u,!f)})}catch{return et(this,At)}},Ke.prototype.equals=function(i){return i==null?et(this,At):new this.Collection(this,function(){return pa(i)})},Ke.prototype.above=function(i){return i==null?et(this,At):new this.Collection(this,function(){return It(i,void 0,!0)})},Ke.prototype.aboveOrEqual=function(i){return i==null?et(this,At):new this.Collection(this,function(){return It(i,void 0,!1)})},Ke.prototype.below=function(i){return i==null?et(this,At):new this.Collection(this,function(){return It(void 0,i,!1,!0)})},Ke.prototype.belowOrEqual=function(i){return i==null?et(this,At):new this.Collection(this,function(){return It(void 0,i)})},Ke.prototype.startsWith=function(i){return typeof i!="string"?et(this,sa):this.between(i,i+en,!0,!0)},Ke.prototype.startsWithIgnoreCase=function(i){return i===""?this.startsWith(i):jr(this,function(a,u){return a.indexOf(u[0])===0},[i],en)},Ke.prototype.equalsIgnoreCase=function(i){return jr(this,function(a,u){return a===u[0]},[i],"")},Ke.prototype.anyOfIgnoreCase=function(){var i=Ze.apply(Je,arguments);return i.length===0?En(this):jr(this,function(a,u){return u.indexOf(a)!==-1},i,"")},Ke.prototype.startsWithAnyOfIgnoreCase=function(){var i=Ze.apply(Je,arguments);return i.length===0?En(this):jr(this,function(a,u){return u.some(function(f){return a.indexOf(f)===0})},i,en)},Ke.prototype.anyOf=function(){var i=this,a=Ze.apply(Je,arguments),u=this._cmp;try{a.sort(u)}catch{return et(this,At)}if(a.length===0)return En(this);var f=new this.Collection(this,function(){return It(a[0],a[a.length-1])});f._ondirectionchange=function(d){u=d==="next"?i._ascending:i._descending,a.sort(u)};var h=0;return f._addAlgorithm(function(d,m,w){for(var b=d.key;0<u(b,a[h]);)if(++h===a.length)return m(w),!1;return u(b,a[h])===0||(m(function(){d.continue(a[h])}),!1)}),f},Ke.prototype.notEqual=function(i){return this.inAnyRange([[-1/0,i],[i,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ke.prototype.noneOf=function(){var i=Ze.apply(Je,arguments);if(i.length===0)return new this.Collection(this);try{i.sort(this._ascending)}catch{return et(this,At)}var a=i.reduce(function(u,f){return u?u.concat([[u[u.length-1][1],f]]):[[-1/0,f]]},null);return a.push([i[i.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},Ke.prototype.inAnyRange=function(T,a){var u=this,f=this._cmp,h=this._ascending,d=this._descending,m=this._min,w=this._max;if(T.length===0)return En(this);if(!T.every(function(N){return N[0]!==void 0&&N[1]!==void 0&&h(N[0],N[1])<=0}))return et(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ie.InvalidArgument);var b=!a||a.includeLowers!==!1,x=a&&a.includeUppers===!0,S,v=h;function P(N,D){return v(N[0],D[0])}try{(S=T.reduce(function(N,D){for(var M=0,F=N.length;M<F;++M){var z=N[M];if(f(D[0],z[1])<0&&0<f(D[1],z[0])){z[0]=m(z[0],D[0]),z[1]=w(z[1],D[1]);break}}return M===F&&N.push(D),N},[])).sort(P)}catch{return et(this,At)}var k=0,A=x?function(N){return 0<h(N,S[k][1])}:function(N){return 0<=h(N,S[k][1])},O=b?function(N){return 0<d(N,S[k][0])}:function(N){return 0<=d(N,S[k][0])},E=A,T=new this.Collection(this,function(){return It(S[0][0],S[S.length-1][1],!b,!x)});return T._ondirectionchange=function(N){v=N==="next"?(E=A,h):(E=O,d),S.sort(P)},T._addAlgorithm(function(N,D,M){for(var F,z=N.key;E(z);)if(++k===S.length)return D(M),!1;return!A(F=z)&&!O(F)||(u._cmp(z,S[k][1])===0||u._cmp(z,S[k][0])===0||D(function(){v===h?N.continue(S[k][0]):N.continue(S[k][1])}),!1)}),T},Ke.prototype.startsWithAnyOf=function(){var i=Ze.apply(Je,arguments);return i.every(function(a){return typeof a=="string"})?i.length===0?En(this):this.inAnyRange(i.map(function(a){return[a,a+en]})):et(this,"startsWithAnyOf() only works with strings")},Ke);function Ke(){}function _t(i){return Pe(function(a){return rr(a),i(a.target.error),!1})}function rr(i){i.stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault()}var ir="storagemutated",$i="x-storagemutated-1",Kt=er(null,ir),Ku=(mt.prototype._lock=function(){return U(!re.global),++this._reculock,this._reculock!==1||re.global||(re.lockOwnerFor=this),this},mt.prototype._unlock=function(){if(U(!re.global),--this._reculock==0)for(re.global||(re.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var i=this._blockedFuncs.shift();try{Zt(i[1],i[0])}catch{}}return this},mt.prototype._locked=function(){return this._reculock&&re.lockOwnerFor!==this},mt.prototype.create=function(i){var a=this;if(!this.mode)return this;var u=this.db.idbdb,f=this.db._state.dbOpenError;if(U(!this.idbtrans),!i&&!u)switch(f&&f.name){case"DatabaseClosedError":throw new ie.DatabaseClosed(f);case"MissingAPIError":throw new ie.MissingAPI(f.message,f);default:throw new ie.OpenFailed(f)}if(!this.active)throw new ie.TransactionInactive;return U(this._completion._state===null),(i=this.idbtrans=i||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Pe(function(h){rr(h),a._reject(i.error)}),i.onabort=Pe(function(h){rr(h),a.active&&a._reject(new ie.Abort(i.error)),a.active=!1,a.on("abort").fire(h)}),i.oncomplete=Pe(function(){a.active=!1,a._resolve(),"mutatedParts"in i&&Kt.storagemutated.fire(i.mutatedParts)}),this},mt.prototype._promise=function(i,a,u){var f=this;if(i==="readwrite"&&this.mode!=="readwrite")return Te(new ie.ReadOnly("Transaction is readonly"));if(!this.active)return Te(new ie.TransactionInactive);if(this._locked())return new J(function(d,m){f._blockedFuncs.push([function(){f._promise(i,a,u).then(d,m)},re])});if(u)return $t(function(){var d=new J(function(m,w){f._lock();var b=a(m,w,f);b&&b.then&&b.then(m,w)});return d.finally(function(){return f._unlock()}),d._lib=!0,d});var h=new J(function(d,m){var w=a(d,m,f);w&&w.then&&w.then(d,m)});return h._lib=!0,h},mt.prototype._root=function(){return this.parent?this.parent._root():this},mt.prototype.waitFor=function(i){var a,u=this._root(),f=J.resolve(i);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return f}):(u._waitingFor=f,u._waitingQueue=[],a=u.idbtrans.objectStore(u.storeNames[0]),function d(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(a.get(-1/0).onsuccess=d)}());var h=u._waitingFor;return new J(function(d,m){f.then(function(w){return u._waitingQueue.push(Pe(d.bind(null,w)))},function(w){return u._waitingQueue.push(Pe(m.bind(null,w)))}).finally(function(){u._waitingFor===h&&(u._waitingFor=null)})})},mt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ie.Abort))},mt.prototype.table=function(i){var a=this._memoizedTables||(this._memoizedTables={});if(g(a,i))return a[i];var u=this.schema[i];if(!u)throw new ie.NotFound("Table "+i+" not part of transaction");return u=new this.db.Table(i,u,this),u.core=this.db.core.table(i),a[i]=u},mt);function mt(){}function Mi(i,a,u,f,h,d,m){return{name:i,keyPath:a,unique:u,multi:f,auto:h,compound:d,src:(u&&!m?"&":"")+(f?"*":"")+(h?"++":"")+_a(a)}}function _a(i){return typeof i=="string"?i:i?"["+[].join.call(i,"+")+"]":""}function ji(i,a,u){return{name:i,primKey:a,indexes:u,mappedClass:null,idxByName:(f=function(h){return[h.name,h]},u.reduce(function(h,d,m){return m=f(d,m),m&&(h[m[0]]=m[1]),h},{}))};var f}var sr=function(i){try{return i.only([[]]),sr=function(){return[[]]},[[]]}catch{return sr=function(){return en},en}};function Ii(i){return i==null?function(){}:typeof i=="string"?(a=i).split(".").length===1?function(u){return u[a]}:function(u){return ee(u,a)}:function(u){return ee(u,i)};var a}function ma(i){return[].slice.call(i)}var Bu=0;function ar(i){return i==null?":id":typeof i=="string"?i:"[".concat(i.join("+"),"]")}function Lu(i,a,b){function f(E){if(E.type===3)return null;if(E.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var k=E.lower,A=E.upper,O=E.lowerOpen,E=E.upperOpen;return k===void 0?A===void 0?null:a.upperBound(A,!!E):A===void 0?a.lowerBound(k,!!O):a.bound(k,A,!!O,!!E)}function h(P){var k,A=P.name;return{name:A,schema:P,mutate:function(O){var E=O.trans,T=O.type,N=O.keys,D=O.values,M=O.range;return new Promise(function(F,z){F=Pe(F);var q=E.objectStore(A),V=q.keyPath==null,Y=T==="put"||T==="add";if(!Y&&T!=="delete"&&T!=="deleteRange")throw new Error("Invalid operation type: "+T);var H,Z=(N||D||{length:1}).length;if(N&&D&&N.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(Z===0)return F({numFailures:0,failures:{},results:[],lastResult:void 0});function le(Ge){++tt,rr(Ge)}var de=[],pe=[],tt=0;if(T==="deleteRange"){if(M.type===4)return F({numFailures:tt,failures:pe,results:[],lastResult:void 0});M.type===3?de.push(H=q.clear()):de.push(H=q.delete(f(M)))}else{var V=Y?V?[D,N]:[D,null]:[N,null],oe=V[0],He=V[1];if(Y)for(var ze=0;ze<Z;++ze)de.push(H=He&&He[ze]!==void 0?q[T](oe[ze],He[ze]):q[T](oe[ze])),H.onerror=le;else for(ze=0;ze<Z;++ze)de.push(H=q[T](oe[ze])),H.onerror=le}function Qr(Ge){Ge=Ge.target.result,de.forEach(function(sn,ts){return sn.error!=null&&(pe[ts]=sn.error)}),F({numFailures:tt,failures:pe,results:T==="delete"?N:de.map(function(sn){return sn.result}),lastResult:Ge})}H.onerror=function(Ge){le(Ge),Qr(Ge)},H.onsuccess=Qr})},getMany:function(O){var E=O.trans,T=O.keys;return new Promise(function(N,D){N=Pe(N);for(var M,F=E.objectStore(A),z=T.length,q=new Array(z),V=0,Y=0,H=function(de){de=de.target,q[de._pos]=de.result,++Y===V&&N(q)},Z=_t(D),le=0;le<z;++le)T[le]!=null&&((M=F.get(T[le]))._pos=le,M.onsuccess=H,M.onerror=Z,++V);V===0&&N(q)})},get:function(O){var E=O.trans,T=O.key;return new Promise(function(N,D){N=Pe(N);var M=E.objectStore(A).get(T);M.onsuccess=function(F){return N(F.target.result)},M.onerror=_t(D)})},query:(k=x,function(O){return new Promise(function(E,T){E=Pe(E);var N,D,M,V=O.trans,F=O.values,z=O.limit,H=O.query,q=z===1/0?void 0:z,Y=H.index,H=H.range,V=V.objectStore(A),Y=Y.isPrimaryKey?V:V.index(Y.name),H=f(H);if(z===0)return E({result:[]});k?((q=F?Y.getAll(H,q):Y.getAllKeys(H,q)).onsuccess=function(Z){return E({result:Z.target.result})},q.onerror=_t(T)):(N=0,D=!F&&"openKeyCursor"in Y?Y.openKeyCursor(H):Y.openCursor(H),M=[],D.onsuccess=function(Z){var le=D.result;return le?(M.push(F?le.value:le.primaryKey),++N===z?E({result:M}):void le.continue()):E({result:M})},D.onerror=_t(T))})}),openCursor:function(O){var E=O.trans,T=O.values,N=O.query,D=O.reverse,M=O.unique;return new Promise(function(F,z){F=Pe(F);var Y=N.index,q=N.range,V=E.objectStore(A),V=Y.isPrimaryKey?V:V.index(Y.name),Y=D?M?"prevunique":"prev":M?"nextunique":"next",H=!T&&"openKeyCursor"in V?V.openKeyCursor(f(q),Y):V.openCursor(f(q),Y);H.onerror=_t(z),H.onsuccess=Pe(function(Z){var le,de,pe,tt,oe=H.result;oe?(oe.___id=++Bu,oe.done=!1,le=oe.continue.bind(oe),de=(de=oe.continuePrimaryKey)&&de.bind(oe),pe=oe.advance.bind(oe),tt=function(){throw new Error("Cursor not stopped")},oe.trans=E,oe.stop=oe.continue=oe.continuePrimaryKey=oe.advance=function(){throw new Error("Cursor not started")},oe.fail=Pe(z),oe.next=function(){var He=this,ze=1;return this.start(function(){return ze--?He.continue():He.stop()}).then(function(){return He})},oe.start=function(He){function ze(){if(H.result)try{He()}catch(Ge){oe.fail(Ge)}else oe.done=!0,oe.start=function(){throw new Error("Cursor behind last entry")},oe.stop()}var Qr=new Promise(function(Ge,sn){Ge=Pe(Ge),H.onerror=_t(sn),oe.fail=sn,oe.stop=function(ts){oe.stop=oe.continue=oe.continuePrimaryKey=oe.advance=tt,Ge(ts)}});return H.onsuccess=Pe(function(Ge){H.onsuccess=ze,ze()}),oe.continue=le,oe.continuePrimaryKey=de,oe.advance=pe,ze(),Qr},F(oe)):F(null)},z)})},count:function(O){var E=O.query,T=O.trans,N=E.index,D=E.range;return new Promise(function(M,F){var z=T.objectStore(A),q=N.isPrimaryKey?z:z.index(N.name),z=f(D),q=z?q.count(z):q.count();q.onsuccess=Pe(function(V){return M(V.target.result)}),q.onerror=_t(F)})}}}var d,m,w,S=(m=b,w=ma((d=i).objectStoreNames),{schema:{name:d.name,tables:w.map(function(P){return m.objectStore(P)}).map(function(P){var k=P.keyPath,E=P.autoIncrement,A=l(k),O={},E={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:k==null,compound:A,keyPath:k,autoIncrement:E,unique:!0,extractKey:Ii(k)},indexes:ma(P.indexNames).map(function(T){return P.index(T)}).map(function(M){var N=M.name,D=M.unique,F=M.multiEntry,M=M.keyPath,F={name:N,compound:l(M),keyPath:M,unique:D,multiEntry:F,extractKey:Ii(M)};return O[ar(M)]=F}),getIndexByKeyPath:function(T){return O[ar(T)]}};return O[":id"]=E.primaryKey,k!=null&&(O[ar(k)]=E.primaryKey),E})},hasGetAll:0<w.length&&"getAll"in m.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=S.schema,x=S.hasGetAll,S=b.tables.map(h),v={};return S.forEach(function(P){return v[P.name]=P}),{stack:"dbcore",transaction:i.transaction.bind(i),table:function(P){if(!v[P])throw new Error("Table '".concat(P,"' not found"));return v[P]},MIN_KEY:-1/0,MAX_KEY:sr(a),schema:b}}function Fu(i,a,u,f){var h=u.IDBKeyRange;return u.indexedDB,{dbcore:(f=Lu(a,h,f),i.dbcore.reduce(function(d,m){return m=m.create,r(r({},d),m(d))},f))}}function Ir(i,f){var u=f.db,f=Fu(i._middlewares,u,i._deps,f);i.core=f.dbcore,i.tables.forEach(function(h){var d=h.name;i.core.schema.tables.some(function(m){return m.name===d})&&(h.core=i.core.table(d),i[d]instanceof i.Table&&(i[d].core=h.core))})}function Kr(i,a,u,f){u.forEach(function(h){var d=f[h];a.forEach(function(m){var w=function b(x,S){return I(x,S)||(x=y(x))&&b(x,S)}(m,h);(!w||"value"in w&&w.value===void 0)&&(m===i.Transaction.prototype||m instanceof i.Transaction?L(m,h,{get:function(){return this.table(h)},set:function(b){$(this,h,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):m[h]=new i.Table(h,d))})})}function Ki(i,a){a.forEach(function(u){for(var f in u)u[f]instanceof i.Table&&delete u[f]})}function qu(i,a){return i._cfg.version-a._cfg.version}function Uu(i,a,u,f){var h=i._dbSchema;u.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=ji("$meta",wa("")[0],[]),i._storeNames.push("$meta"));var d=i._createTransaction("readwrite",i._storeNames,h);d.create(u),d._completion.catch(f);var m=d._reject.bind(d),w=re.transless||re;$t(function(){return re.trans=d,re.transless=w,a!==0?(Ir(i,u),x=a,((b=d).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(S){return S??x}):J.resolve(x)).then(function(S){return P=S,k=d,A=u,O=[],S=(v=i)._versions,E=v._dbSchema=Lr(0,v.idbdb,A),(S=S.filter(function(T){return T._cfg.version>=P})).length!==0?(S.forEach(function(T){O.push(function(){var N=E,D=T._cfg.dbschema;Fr(v,N,A),Fr(v,D,A),E=v._dbSchema=D;var M=Bi(N,D);M.add.forEach(function(Y){Li(A,Y[0],Y[1].primKey,Y[1].indexes)}),M.change.forEach(function(Y){if(Y.recreate)throw new ie.Upgrade("Not yet support for changing primary key");var H=A.objectStore(Y.name);Y.add.forEach(function(Z){return Br(H,Z)}),Y.change.forEach(function(Z){H.deleteIndex(Z.name),Br(H,Z)}),Y.del.forEach(function(Z){return H.deleteIndex(Z)})});var F=T._cfg.contentUpgrade;if(F&&T._cfg.version>P){Ir(v,A),k._memoizedTables={};var z=Ce(D);M.del.forEach(function(Y){z[Y]=N[Y]}),Ki(v,[v.Transaction.prototype]),Kr(v,[v.Transaction.prototype],c(z),z),k.schema=z;var q,V=xt(F);return V&&bn(),M=J.follow(function(){var Y;(q=F(k))&&V&&(Y=Mt.bind(null,null),q.then(Y,Y))}),q&&typeof q.then=="function"?J.resolve(q):M.then(function(){return q})}}),O.push(function(N){var D,M,F=T._cfg.dbschema;D=F,M=N,[].slice.call(M.db.objectStoreNames).forEach(function(z){return D[z]==null&&M.db.deleteObjectStore(z)}),Ki(v,[v.Transaction.prototype]),Kr(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),k.schema=v._dbSchema}),O.push(function(N){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===T._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(D){return D!=="$meta"})):N.objectStore("$meta").put(T._cfg.version,"version"))})}),function T(){return O.length?J.resolve(O.shift()(k.idbtrans)).then(T):J.resolve()}().then(function(){ga(E,A)})):J.resolve();var v,P,k,A,O,E}).catch(m)):(c(h).forEach(function(S){Li(u,S,h[S].primKey,h[S].indexes)}),Ir(i,u),void J.follow(function(){return i.on.populate.fire(d)}).catch(m));var b,x})}function Vu(i,a){ga(i._dbSchema,a),a.db.version%10!=0||a.objectStoreNames.contains("$meta")||a.db.createObjectStore("$meta").add(Math.ceil(a.db.version/10-1),"version");var u=Lr(0,i.idbdb,a);Fr(i,i._dbSchema,a);for(var f=0,h=Bi(u,i._dbSchema).change;f<h.length;f++){var d=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var w=a.objectStore(m.name);m.add.forEach(function(b){yt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(b.src)),Br(w,b)})}(h[f]);if(typeof d=="object")return d.value}}function Bi(i,a){var u,f={del:[],add:[],change:[]};for(u in i)a[u]||f.del.push(u);for(u in a){var h=i[u],d=a[u];if(h){var m={name:u,def:d,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(d.primKey.keyPath||"")||h.primKey.auto!==d.primKey.auto)m.recreate=!0,f.change.push(m);else{var w=h.idxByName,b=d.idxByName,x=void 0;for(x in w)b[x]||m.del.push(x);for(x in b){var S=w[x],v=b[x];S?S.src!==v.src&&m.change.push(v):m.add.push(v)}(0<m.del.length||0<m.add.length||0<m.change.length)&&f.change.push(m)}}else f.add.push([u,d])}return f}function Li(i,a,u,f){var h=i.db.createObjectStore(a,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return f.forEach(function(d){return Br(h,d)}),h}function ga(i,a){c(i).forEach(function(u){a.db.objectStoreNames.contains(u)||(yt&&console.debug("Dexie: Creating missing table",u),Li(a,u,i[u].primKey,i[u].indexes))})}function Br(i,a){i.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multi})}function Lr(i,a,u){var f={};return j(a.objectStoreNames,0).forEach(function(h){for(var d=u.objectStore(h),m=Mi(_a(x=d.keyPath),x||"",!0,!1,!!d.autoIncrement,x&&typeof x!="string",!0),w=[],b=0;b<d.indexNames.length;++b){var S=d.index(d.indexNames[b]),x=S.keyPath,S=Mi(S.name,x,!!S.unique,!!S.multiEntry,!1,x&&typeof x!="string",!1);w.push(S)}f[h]=ji(h,m,w)}),f}function Fr(i,a,u){for(var f=u.db.objectStoreNames,h=0;h<f.length;++h){var d=f[h],m=u.objectStore(d);i._hasGetAll="getAll"in m;for(var w=0;w<m.indexNames.length;++w){var b=m.indexNames[w],x=m.index(b).keyPath,S=typeof x=="string"?x:"["+j(x).join("+")+"]";!a[d]||(x=a[d].idxByName[S])&&(x.name=b,delete a[d].idxByName[S],a[d].idxByName[b]=x)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i._hasGetAll=!1)}function wa(i){return i.split(",").map(function(a,u){var f=(a=a.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(f)?f.match(/^\[(.*)\]$/)[1].split("+"):f;return Mi(f,h||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),l(h),u===0)})}var Hu=(qr.prototype._parseStoresSpec=function(i,a){c(i).forEach(function(u){if(i[u]!==null){var f=wa(i[u]),h=f.shift();if(h.unique=!0,h.multi)throw new ie.Schema("Primary key cannot be multi-valued");f.forEach(function(d){if(d.auto)throw new ie.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new ie.Schema("Index must have a name and cannot be an empty string")}),a[u]=ji(u,h,f)}})},qr.prototype.stores=function(u){var a=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,u):u;var u=a._versions,f={},h={};return u.forEach(function(d){p(f,d._cfg.storesSource),h=d._cfg.dbschema={},d._parseStoresSpec(f,h)}),a._dbSchema=h,Ki(a,[a._allTables,a,a.Transaction.prototype]),Kr(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],c(h),h),a._storeNames=c(h),this},qr.prototype.upgrade=function(i){return this._cfg.contentUpgrade=vi(this._cfg.contentUpgrade||Ae,i),this},qr);function qr(){}function Fi(i,a){var u=i._dbNamesDB;return u||(u=i._dbNamesDB=new St(Nr,{addons:[],indexedDB:i,IDBKeyRange:a})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function qi(i){return i&&typeof i.databases=="function"}function Ui(i){return $t(function(){return re.letThrough=!0,i()})}function Vi(i){return!("from"in i)}var Ve=function(i,a){if(!this){var u=new Ve;return i&&"d"in i&&p(u,i),u}p(this,arguments.length?{d:1,from:i,to:1<arguments.length?a:i}:{d:0})};function or(i,a,u){var f=ye(a,u);if(!isNaN(f)){if(0<f)throw RangeError();if(Vi(i))return p(i,{from:a,to:u,d:1});var h=i.l,f=i.r;if(ye(u,i.from)<0)return h?or(h,a,u):i.l={from:a,to:u,d:1,l:null,r:null},ba(i);if(0<ye(a,i.to))return f?or(f,a,u):i.r={from:a,to:u,d:1,l:null,r:null},ba(i);ye(a,i.from)<0&&(i.from=a,i.l=null,i.d=f?f.d+1:1),0<ye(u,i.to)&&(i.to=u,i.r=null,i.d=i.l?i.l.d+1:1),u=!i.r,h&&!i.l&&ur(i,h),f&&u&&ur(i,f)}}function ur(i,a){Vi(a)||function u(f,b){var d=b.from,m=b.to,w=b.l,b=b.r;or(f,d,m),w&&u(f,w),b&&u(f,b)}(i,a)}function va(i,a){var u=Ur(a),f=u.next();if(f.done)return!1;for(var h=f.value,d=Ur(i),m=d.next(h.from),w=m.value;!f.done&&!m.done;){if(ye(w.from,h.to)<=0&&0<=ye(w.to,h.from))return!0;ye(h.from,w.from)<0?h=(f=u.next(w.from)).value:w=(m=d.next(h.from)).value}return!1}function Ur(i){var a=Vi(i)?null:{s:0,n:i};return{next:function(u){for(var f=0<arguments.length;a;)switch(a.s){case 0:if(a.s=1,f)for(;a.n.l&&ye(u,a.n.from)<0;)a={up:a,n:a.n.l,s:1};else for(;a.n.l;)a={up:a,n:a.n.l,s:1};case 1:if(a.s=2,!f||ye(u,a.n.to)<=0)return{value:a.n,done:!1};case 2:if(a.n.r){a.s=3,a={up:a,n:a.n.r,s:0};continue}case 3:a=a.up}return{done:!0}}}}function ba(i){var a,u,f=(((a=i.r)===null||a===void 0?void 0:a.d)||0)-(((u=i.l)===null||u===void 0?void 0:u.d)||0),h=1<f?"r":f<-1?"l":"";h&&(a=h=="r"?"l":"r",u=r({},i),f=i[h],i.from=f.from,i.to=f.to,i[h]=f[h],u[h]=f[a],(i[a]=u).d=ka(u)),i.d=ka(i)}function ka(u){var a=u.r,u=u.l;return(a?u?Math.max(a.d,u.d):a.d:u?u.d:0)+1}function Vr(i,a){return c(a).forEach(function(u){i[u]?ur(i[u],a[u]):i[u]=function f(h){var d,m,w={};for(d in h)g(h,d)&&(m=h[d],w[d]=!m||typeof m!="object"||Se.has(m.constructor)?m:f(m));return w}(a[u])}),i}function Hi(i,a){return i.all||a.all||Object.keys(i).some(function(u){return a[u]&&va(a[u],i[u])})}C(Ve.prototype,((it={add:function(i){return ur(this,i),this},addKey:function(i){return or(this,i,i),this},addKeys:function(i){var a=this;return i.forEach(function(u){return or(a,u,u)}),this},hasKey:function(i){var a=Ur(this).next(i).value;return a&&ye(a.from,i)<=0&&0<=ye(a.to,i)}})[Le]=function(){return Ur(this)},it));var nn={},zi={},Gi=!1;function Hr(i){Vr(zi,i),Gi||(Gi=!0,setTimeout(function(){Gi=!1,Wi(zi,!(zi={}))},0))}function Wi(i,a){a===void 0&&(a=!1);var u=new Set;if(i.all)for(var f=0,h=Object.values(nn);f<h.length;f++)xa(m=h[f],i,u,a);else for(var d in i){var m,w=/^idb\:\/\/(.*)\/(.*)\//.exec(d);w&&(d=w[1],w=w[2],(m=nn["idb://".concat(d,"/").concat(w)])&&xa(m,i,u,a))}u.forEach(function(b){return b()})}function xa(i,a,u,f){for(var h=[],d=0,m=Object.entries(i.queries.query);d<m.length;d++){for(var w=m[d],b=w[0],x=[],S=0,v=w[1];S<v.length;S++){var P=v[S];Hi(a,P.obsSet)?P.subscribers.forEach(function(E){return u.add(E)}):f&&x.push(P)}f&&h.push([b,x])}if(f)for(var k=0,A=h;k<A.length;k++){var O=A[k],b=O[0],x=O[1];i.queries.query[b]=x}}function zu(i){var a=i._state,u=i._deps.indexedDB;if(a.isBeingOpened||i.idbdb)return a.dbReadyPromise.then(function(){return a.dbOpenError?Te(a.dbOpenError):i});a.isBeingOpened=!0,a.dbOpenError=null,a.openComplete=!1;var f=a.openCanceller,h=Math.round(10*i.verno),d=!1;function m(){if(a.openCanceller!==f)throw new ie.DatabaseClosed("db.open() was cancelled")}function w(){return new J(function(P,k){if(m(),!u)throw new ie.MissingAPI;var A=i.name,O=a.autoSchema||!h?u.open(A):u.open(A,h);if(!O)throw new ie.MissingAPI;O.onerror=_t(k),O.onblocked=Pe(i._fireOnBlocked),O.onupgradeneeded=Pe(function(E){var T;S=O.transaction,a.autoSchema&&!i._options.allowEmptyDB?(O.onerror=rr,S.abort(),O.result.close(),(T=u.deleteDatabase(A)).onsuccess=T.onerror=Pe(function(){k(new ie.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(S.onerror=_t(k),E=E.oldVersion>Math.pow(2,62)?0:E.oldVersion,v=E<1,i.idbdb=O.result,d&&Vu(i,S),Uu(i,E/10,S,k))},k),O.onsuccess=Pe(function(){S=null;var E,T,N,D,M,F=i.idbdb=O.result,z=j(F.objectStoreNames);if(0<z.length)try{var q=F.transaction((D=z).length===1?D[0]:D,"readonly");if(a.autoSchema)T=F,N=q,(E=i).verno=T.version/10,N=E._dbSchema=Lr(0,T,N),E._storeNames=j(T.objectStoreNames,0),Kr(E,[E._allTables],c(N),N);else if(Fr(i,i._dbSchema,q),((M=Bi(Lr(0,(M=i).idbdb,q),M._dbSchema)).add.length||M.change.some(function(V){return V.add.length||V.change.length}))&&!d)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),F.close(),h=F.version+1,d=!0,P(w());Ir(i,q)}catch{}kn.push(i),F.onversionchange=Pe(function(V){a.vcFired=!0,i.on("versionchange").fire(V)}),F.onclose=Pe(function(V){i.on("close").fire(V)}),v&&(M=i._deps,q=A,F=M.indexedDB,M=M.IDBKeyRange,qi(F)||q===Nr||Fi(F,M).put({name:q}).catch(Ae)),P()},k)}).catch(function(P){switch(P?.name){case"UnknownError":if(0<a.PR1398_maxLoop)return a.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),w();break;case"VersionError":if(0<h)return h=0,w()}return J.reject(P)})}var b,x=a.dbReadyResolve,S=null,v=!1;return J.race([f,(typeof navigator>"u"?J.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function k(){return indexedDB.databases().finally(P)}b=setInterval(k,100),k()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(w)]).then(function(){return m(),a.onReadyBeingFired=[],J.resolve(Ui(function(){return i.on.ready.fire(i.vip)})).then(function P(){if(0<a.onReadyBeingFired.length){var k=a.onReadyBeingFired.reduce(vi,Ae);return a.onReadyBeingFired=[],J.resolve(Ui(function(){return k(i.vip)})).then(P)}})}).finally(function(){a.openCanceller===f&&(a.onReadyBeingFired=null,a.isBeingOpened=!1)}).catch(function(P){a.dbOpenError=P;try{S&&S.abort()}catch{}return f===a.openCanceller&&i._close(),Te(P)}).finally(function(){a.openComplete=!0,x()}).then(function(){var P;return v&&(P={},i.tables.forEach(function(k){k.schema.indexes.forEach(function(A){A.name&&(P["idb://".concat(i.name,"/").concat(k.name,"/").concat(A.name)]=new Ve(-1/0,[[[]]]))}),P["idb://".concat(i.name,"/").concat(k.name,"/")]=P["idb://".concat(i.name,"/").concat(k.name,"/:dels")]=new Ve(-1/0,[[[]]])}),Kt(ir).fire(P),Wi(P,!0)),i})}function Qi(i){function a(d){return i.next(d)}var u=h(a),f=h(function(d){return i.throw(d)});function h(d){return function(b){var w=d(b),b=w.value;return w.done?b:b&&typeof b.then=="function"?b.then(u,f):l(b)?Promise.all(b).then(u,f):u(b)}}return h(a)()}function zr(i,a,u){for(var f=l(i)?i.slice():[i],h=0;h<u;++h)f.push(a);return f}var Gu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(i){return r(r({},i),{table:function(a){var u=i.table(a),f=u.schema,h={},d=[];function m(v,P,k){var A=ar(v),O=h[A]=h[A]||[],E=v==null?0:typeof v=="string"?1:v.length,T=0<P,T=r(r({},k),{name:T?"".concat(A,"(virtual-from:").concat(k.name,")"):k.name,lowLevelIndex:k,isVirtual:T,keyTail:P,keyLength:E,extractKey:Ii(v),unique:!T&&k.unique});return O.push(T),T.isPrimaryKey||d.push(T),1<E&&m(E===2?v[0]:v.slice(0,E-1),P+1,k),O.sort(function(N,D){return N.keyTail-D.keyTail}),T}a=m(f.primaryKey.keyPath,0,f.primaryKey),h[":id"]=[a];for(var w=0,b=f.indexes;w<b.length;w++){var x=b[w];m(x.keyPath,0,x)}function S(v){var P,k=v.query.index;return k.isVirtual?r(r({},v),{query:{index:k.lowLevelIndex,range:(P=v.query.range,k=k.keyTail,{type:P.type===1?2:P.type,lower:zr(P.lower,P.lowerOpen?i.MAX_KEY:i.MIN_KEY,k),lowerOpen:!0,upper:zr(P.upper,P.upperOpen?i.MIN_KEY:i.MAX_KEY,k),upperOpen:!0})}}):v}return r(r({},u),{schema:r(r({},f),{primaryKey:a,indexes:d,getIndexByKeyPath:function(v){return(v=h[ar(v)])&&v[0]}}),count:function(v){return u.count(S(v))},query:function(v){return u.query(S(v))},openCursor:function(v){var P=v.query.index,k=P.keyTail,A=P.isVirtual,O=P.keyLength;return A?u.openCursor(S(v)).then(function(T){return T&&E(T)}):u.openCursor(v);function E(T){return Object.create(T,{continue:{value:function(N){N!=null?T.continue(zr(N,v.reverse?i.MAX_KEY:i.MIN_KEY,k)):v.unique?T.continue(T.key.slice(0,O).concat(v.reverse?i.MIN_KEY:i.MAX_KEY,k)):T.continue()}},continuePrimaryKey:{value:function(N,D){T.continuePrimaryKey(zr(N,i.MAX_KEY,k),D)}},primaryKey:{get:function(){return T.primaryKey}},key:{get:function(){var N=T.key;return O===1?N[0]:N.slice(0,O)}},value:{get:function(){return T.value}}})}}})}})}};function Yi(i,a,u,f){return u=u||{},f=f||"",c(i).forEach(function(h){var d,m,w;g(a,h)?(d=i[h],m=a[h],typeof d=="object"&&typeof m=="object"&&d&&m?(w=ke(d))!==ke(m)?u[f+h]=a[h]:w==="Object"?Yi(d,m,u,f+h+"."):d!==m&&(u[f+h]=a[h]):d!==m&&(u[f+h]=a[h])):u[f+h]=void 0}),c(a).forEach(function(h){g(i,h)||(u[f+h]=a[h])}),u}function Xi(i,a){return a.type==="delete"?a.keys:a.keys||a.values.map(i.extractKey)}var Wu={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(i){return r(r({},i),{table:function(a){var u=i.table(a),f=u.schema.primaryKey;return r(r({},u),{mutate:function(h){var d=re.trans,m=d.table(a).hook,w=m.deleting,b=m.creating,x=m.updating;switch(h.type){case"add":if(b.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"put":if(b.fire===Ae&&x.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"delete":if(w.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"deleteRange":if(w.fire===Ae)break;return d._promise("readwrite",function(){return function v(P,k,A){return u.query({trans:P,values:!1,query:{index:f,range:k},limit:A}).then(function(O){var E=O.result;return S({type:"delete",keys:E,trans:P}).then(function(T){return 0<T.numFailures?Promise.reject(T.failures[0]):E.length<A?{failures:[],numFailures:0,lastResult:void 0}:v(P,r(r({},k),{lower:E[E.length-1],lowerOpen:!0}),A)})})}(h.trans,h.range,1e4)},!0)}return u.mutate(h);function S(v){var P,k,A,O=re.trans,E=v.keys||Xi(f,v);if(!E)throw new Error("Keys missing");return(v=v.type==="add"||v.type==="put"?r(r({},v),{keys:E}):r({},v)).type!=="delete"&&(v.values=s([],v.values)),v.keys&&(v.keys=s([],v.keys)),P=u,A=E,((k=v).type==="add"?Promise.resolve([]):P.getMany({trans:k.trans,keys:A,cache:"immutable"})).then(function(T){var N=E.map(function(D,M){var F,z,q,V=T[M],Y={onerror:null,onsuccess:null};return v.type==="delete"?w.fire.call(Y,D,V,O):v.type==="add"||V===void 0?(F=b.fire.call(Y,D,v.values[M],O),D==null&&F!=null&&(v.keys[M]=D=F,f.outbound||ce(v.values[M],f.keyPath,D))):(F=Yi(V,v.values[M]),(z=x.fire.call(Y,F,D,V,O))&&(q=v.values[M],Object.keys(z).forEach(function(H){g(q,H)?q[H]=z[H]:ce(q,H,z[H])}))),Y});return u.mutate(v).then(function(D){for(var M=D.failures,F=D.results,z=D.numFailures,D=D.lastResult,q=0;q<E.length;++q){var V=(F||E)[q],Y=N[q];V==null?Y.onerror&&Y.onerror(M[q]):Y.onsuccess&&Y.onsuccess(v.type==="put"&&T[q]?v.values[q]:V)}return{failures:M,results:F,numFailures:z,lastResult:D}}).catch(function(D){return N.forEach(function(M){return M.onerror&&M.onerror(D)}),Promise.reject(D)})})}}})}})}};function Ea(i,a,u){try{if(!a||a.keys.length<i.length)return null;for(var f=[],h=0,d=0;h<a.keys.length&&d<i.length;++h)ye(a.keys[h],i[d])===0&&(f.push(u?Ue(a.values[h]):a.values[h]),++d);return f.length===i.length?f:null}catch{return null}}var Qu={stack:"dbcore",level:-1,create:function(i){return{table:function(a){var u=i.table(a);return r(r({},u),{getMany:function(f){if(!f.cache)return u.getMany(f);var h=Ea(f.keys,f.trans._cache,f.cache==="clone");return h?J.resolve(h):u.getMany(f).then(function(d){return f.trans._cache={keys:f.keys,values:f.cache==="clone"?Ue(d):d},d})},mutate:function(f){return f.type!=="add"&&(f.trans._cache=null),u.mutate(f)}})}}}};function Aa(i,a){return i.trans.mode==="readonly"&&!!i.subscr&&!i.trans.explicit&&i.trans.db._options.cache!=="disabled"&&!a.schema.primaryKey.outbound}function Sa(i,a){switch(i){case"query":return a.values&&!a.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Yu={stack:"dbcore",level:0,name:"Observability",create:function(i){var a=i.schema.name,u=new Ve(i.MIN_KEY,i.MAX_KEY);return r(r({},i),{transaction:function(f,h,d){if(re.subscr&&h!=="readonly")throw new ie.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(re.querier));return i.transaction(f,h,d)},table:function(f){var h=i.table(f),d=h.schema,m=d.primaryKey,v=d.indexes,w=m.extractKey,b=m.outbound,x=m.autoIncrement&&v.filter(function(k){return k.compound&&k.keyPath.includes(m.keyPath)}),S=r(r({},h),{mutate:function(k){function A(H){return H="idb://".concat(a,"/").concat(f,"/").concat(H),D[H]||(D[H]=new Ve)}var O,E,T,N=k.trans,D=k.mutatedParts||(k.mutatedParts={}),M=A(""),F=A(":dels"),z=k.type,Y=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[Xi(m,k).filter(function(H){return H}),k.values]:[],q=Y[0],V=Y[1],Y=k.trans._cache;return l(q)?(M.addKeys(q),(Y=z==="delete"||q.length===V.length?Ea(q,Y):null)||F.addKeys(q),(Y||V)&&(O=A,E=Y,T=V,d.indexes.forEach(function(H){var Z=O(H.name||"");function le(pe){return pe!=null?H.extractKey(pe):null}function de(pe){return H.multiEntry&&l(pe)?pe.forEach(function(tt){return Z.addKey(tt)}):Z.addKey(pe)}(E||T).forEach(function(pe,He){var oe=E&&le(E[He]),He=T&&le(T[He]);ye(oe,He)!==0&&(oe!=null&&de(oe),He!=null&&de(He))})}))):q?(V={from:(V=q.lower)!==null&&V!==void 0?V:i.MIN_KEY,to:(V=q.upper)!==null&&V!==void 0?V:i.MAX_KEY},F.add(V),M.add(V)):(M.add(u),F.add(u),d.indexes.forEach(function(H){return A(H.name).add(u)})),h.mutate(k).then(function(H){return!q||k.type!=="add"&&k.type!=="put"||(M.addKeys(H.results),x&&x.forEach(function(Z){for(var le=k.values.map(function(oe){return Z.extractKey(oe)}),de=Z.keyPath.findIndex(function(oe){return oe===m.keyPath}),pe=0,tt=H.results.length;pe<tt;++pe)le[pe][de]=H.results[pe];A(Z.name).addKeys(le)})),N.mutatedParts=Vr(N.mutatedParts||{},D),H})}}),v=function(A){var O=A.query,A=O.index,O=O.range;return[A,new Ve((A=O.lower)!==null&&A!==void 0?A:i.MIN_KEY,(O=O.upper)!==null&&O!==void 0?O:i.MAX_KEY)]},P={get:function(k){return[m,new Ve(k.key)]},getMany:function(k){return[m,new Ve().addKeys(k.keys)]},count:v,query:v,openCursor:v};return c(P).forEach(function(k){S[k]=function(A){var O=re.subscr,E=!!O,T=Aa(re,h)&&Sa(k,A)?A.obsSet={}:O;if(E){var N=function(V){return V="idb://".concat(a,"/").concat(f,"/").concat(V),T[V]||(T[V]=new Ve)},D=N(""),M=N(":dels"),O=P[k](A),E=O[0],O=O[1];if((k==="query"&&E.isPrimaryKey&&!A.values?M:N(E.name||"")).add(O),!E.isPrimaryKey){if(k!=="count"){var F=k==="query"&&b&&A.values&&h.query(r(r({},A),{values:!1}));return h[k].apply(this,arguments).then(function(V){if(k==="query"){if(b&&A.values)return F.then(function(le){return le=le.result,D.addKeys(le),V});var Y=A.values?V.result.map(w):V.result;(A.values?D:M).addKeys(Y)}else if(k==="openCursor"){var H=V,Z=A.values;return H&&Object.create(H,{key:{get:function(){return M.addKey(H.primaryKey),H.key}},primaryKey:{get:function(){var le=H.primaryKey;return M.addKey(le),le}},value:{get:function(){return Z&&D.addKey(H.primaryKey),H.value}}})}return V})}M.add(u)}}return h[k].apply(this,arguments)}}),S}})}};function Oa(i,a,u){if(u.numFailures===0)return a;if(a.type==="deleteRange")return null;var f=a.keys?a.keys.length:"values"in a&&a.values?a.values.length:1;return u.numFailures===f?null:(a=r({},a),l(a.keys)&&(a.keys=a.keys.filter(function(h,d){return!(d in u.failures)})),"values"in a&&l(a.values)&&(a.values=a.values.filter(function(h,d){return!(d in u.failures)})),a)}function Ji(i,a){return u=i,((f=a).lower===void 0||(f.lowerOpen?0<ye(u,f.lower):0<=ye(u,f.lower)))&&(i=i,(a=a).upper===void 0||(a.upperOpen?ye(i,a.upper)<0:ye(i,a.upper)<=0));var u,f}function Pa(i,a,P,f,h,d){if(!P||P.length===0)return i;var m=a.query.index,w=m.multiEntry,b=a.query.range,x=f.schema.primaryKey.extractKey,S=m.extractKey,v=(m.lowLevelIndex||m).extractKey,P=P.reduce(function(k,A){var O=k,E=[];if(A.type==="add"||A.type==="put")for(var T=new Ve,N=A.values.length-1;0<=N;--N){var D,M=A.values[N],F=x(M);T.hasKey(F)||(D=S(M),(w&&l(D)?D.some(function(H){return Ji(H,b)}):Ji(D,b))&&(T.addKey(F),E.push(M)))}switch(A.type){case"add":var z=new Ve().addKeys(a.values?k.map(function(Z){return x(Z)}):k),O=k.concat(a.values?E.filter(function(Z){return Z=x(Z),!z.hasKey(Z)&&(z.addKey(Z),!0)}):E.map(function(Z){return x(Z)}).filter(function(Z){return!z.hasKey(Z)&&(z.addKey(Z),!0)}));break;case"put":var q=new Ve().addKeys(A.values.map(function(Z){return x(Z)}));O=k.filter(function(Z){return!q.hasKey(a.values?x(Z):Z)}).concat(a.values?E:E.map(function(Z){return x(Z)}));break;case"delete":var V=new Ve().addKeys(A.keys);O=k.filter(function(Z){return!V.hasKey(a.values?x(Z):Z)});break;case"deleteRange":var Y=A.range;O=k.filter(function(Z){return!Ji(x(Z),Y)})}return O},i);return P===i?i:(P.sort(function(k,A){return ye(v(k),v(A))||ye(x(k),x(A))}),a.limit&&a.limit<1/0&&(P.length>a.limit?P.length=a.limit:i.length===a.limit&&P.length<a.limit&&(h.dirty=!0)),d?Object.freeze(P):P)}function Ca(i,a){return ye(i.lower,a.lower)===0&&ye(i.upper,a.upper)===0&&!!i.lowerOpen==!!a.lowerOpen&&!!i.upperOpen==!!a.upperOpen}function Xu(i,a){return function(u,f,h,d){if(u===void 0)return f!==void 0?-1:0;if(f===void 0)return 1;if((f=ye(u,f))===0){if(h&&d)return 0;if(h)return 1;if(d)return-1}return f}(i.lower,a.lower,i.lowerOpen,a.lowerOpen)<=0&&0<=function(u,f,h,d){if(u===void 0)return f!==void 0?1:0;if(f===void 0)return-1;if((f=ye(u,f))===0){if(h&&d)return 0;if(h)return-1;if(d)return 1}return f}(i.upper,a.upper,i.upperOpen,a.upperOpen)}function Ju(i,a,u,f){i.subscribers.add(u),f.addEventListener("abort",function(){var h,d;i.subscribers.delete(u),i.subscribers.size===0&&(h=i,d=a,setTimeout(function(){h.subscribers.size===0&&ut(d,h)},3e3))})}var Zu={stack:"dbcore",level:0,name:"Cache",create:function(i){var a=i.schema.name;return r(r({},i),{transaction:function(u,f,h){var d,m,w=i.transaction(u,f,h);return f==="readwrite"&&(m=(d=new AbortController).signal,h=function(b){return function(){if(d.abort(),f==="readwrite"){for(var x=new Set,S=0,v=u;S<v.length;S++){var P=v[S],k=nn["idb://".concat(a,"/").concat(P)];if(k){var A=i.table(P),O=k.optimisticOps.filter(function(Z){return Z.trans===w});if(w._explicit&&b&&w.mutatedParts)for(var E=0,T=Object.values(k.queries.query);E<T.length;E++)for(var N=0,D=(z=T[E]).slice();N<D.length;N++)Hi((q=D[N]).obsSet,w.mutatedParts)&&(ut(z,q),q.subscribers.forEach(function(Z){return x.add(Z)}));else if(0<O.length){k.optimisticOps=k.optimisticOps.filter(function(Z){return Z.trans!==w});for(var M=0,F=Object.values(k.queries.query);M<F.length;M++)for(var z,q,V,Y=0,H=(z=F[M]).slice();Y<H.length;Y++)(q=H[Y]).res!=null&&w.mutatedParts&&(b&&!q.dirty?(V=Object.isFrozen(q.res),V=Pa(q.res,q.req,O,A,q,V),q.dirty?(ut(z,q),q.subscribers.forEach(function(Z){return x.add(Z)})):V!==q.res&&(q.res=V,q.promise=J.resolve({result:V}))):(q.dirty&&ut(z,q),q.subscribers.forEach(function(Z){return x.add(Z)})))}}}x.forEach(function(Z){return Z()})}}},w.addEventListener("abort",h(!1),{signal:m}),w.addEventListener("error",h(!1),{signal:m}),w.addEventListener("complete",h(!0),{signal:m})),w},table:function(u){var f=i.table(u),h=f.schema.primaryKey;return r(r({},f),{mutate:function(d){var m=re.trans;if(h.outbound||m.db._options.cache==="disabled"||m.explicit||m.idbtrans.mode!=="readwrite")return f.mutate(d);var w=nn["idb://".concat(a,"/").concat(u)];return w?(m=f.mutate(d),d.type!=="add"&&d.type!=="put"||!(50<=d.values.length||Xi(h,d).some(function(b){return b==null}))?(w.optimisticOps.push(d),d.mutatedParts&&Hr(d.mutatedParts),m.then(function(b){0<b.numFailures&&(ut(w.optimisticOps,d),(b=Oa(0,d,b))&&w.optimisticOps.push(b),d.mutatedParts&&Hr(d.mutatedParts))}),m.catch(function(){ut(w.optimisticOps,d),d.mutatedParts&&Hr(d.mutatedParts)})):m.then(function(b){var x=Oa(0,r(r({},d),{values:d.values.map(function(S,v){var P;return b.failures[v]?S:(S=(P=h.keyPath)!==null&&P!==void 0&&P.includes(".")?Ue(S):r({},S),ce(S,h.keyPath,b.results[v]),S)})}),b);w.optimisticOps.push(x),queueMicrotask(function(){return d.mutatedParts&&Hr(d.mutatedParts)})}),m):f.mutate(d)},query:function(d){if(!Aa(re,f)||!Sa("query",d))return f.query(d);var m=((x=re.trans)===null||x===void 0?void 0:x.db._options.cache)==="immutable",v=re,w=v.requery,b=v.signal,x=function(A,O,E,T){var N=nn["idb://".concat(A,"/").concat(O)];if(!N)return[];if(!(O=N.queries[E]))return[null,!1,N,null];var D=O[(T.query?T.query.index.name:null)||""];if(!D)return[null,!1,N,null];switch(E){case"query":var M=D.find(function(F){return F.req.limit===T.limit&&F.req.values===T.values&&Ca(F.req.query.range,T.query.range)});return M?[M,!0,N,D]:[D.find(function(F){return("limit"in F.req?F.req.limit:1/0)>=T.limit&&(!T.values||F.req.values)&&Xu(F.req.query.range,T.query.range)}),!1,N,D];case"count":return M=D.find(function(F){return Ca(F.req.query.range,T.query.range)}),[M,!!M,N,D]}}(a,u,"query",d),S=x[0],v=x[1],P=x[2],k=x[3];return S&&v?S.obsSet=d.obsSet:(v=f.query(d).then(function(A){var O=A.result;if(S&&(S.res=O),m){for(var E=0,T=O.length;E<T;++E)Object.freeze(O[E]);Object.freeze(O)}else A.result=Ue(O);return A}).catch(function(A){return k&&S&&ut(k,S),Promise.reject(A)}),S={obsSet:d.obsSet,promise:v,subscribers:new Set,type:"query",req:d,dirty:!1},k?k.push(S):(k=[S],(P=P||(nn["idb://".concat(a,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[d.query.index.name||""]=k)),Ju(S,k,w,b),S.promise.then(function(A){return{result:Pa(A.result,d,P?.optimisticOps,f,S,m)}})}})}})}};function Gr(i,a){return new Proxy(i,{get:function(u,f,h){return f==="db"?a:Reflect.get(u,f,h)}})}var St=(Ne.prototype.version=function(i){if(isNaN(i)||i<.1)throw new ie.Type("Given version is not a positive number");if(i=Math.round(10*i)/10,this.idbdb||this._state.isBeingOpened)throw new ie.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,i);var a=this._versions,u=a.filter(function(f){return f._cfg.version===i})[0];return u||(u=new this.Version(i),a.push(u),a.sort(qu),u.stores({}),this._state.autoSchema=!1,u)},Ne.prototype._whenReady=function(i){var a=this;return this.idbdb&&(this._state.openComplete||re.letThrough||this._vip)?i():new J(function(u,f){if(a._state.openComplete)return f(new ie.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return void f(new ie.DatabaseClosed);a.open().catch(Ae)}a._state.dbReadyPromise.then(u,f)}).then(i)},Ne.prototype.use=function(i){var a=i.stack,u=i.create,f=i.level,h=i.name;return h&&this.unuse({stack:a,name:h}),i=this._middlewares[a]||(this._middlewares[a]=[]),i.push({stack:a,create:u,level:f??10,name:h}),i.sort(function(d,m){return d.level-m.level}),this},Ne.prototype.unuse=function(i){var a=i.stack,u=i.name,f=i.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(h){return f?h.create!==f:!!u&&h.name!==u})),this},Ne.prototype.open=function(){var i=this;return Zt(Dt,function(){return zu(i)})},Ne.prototype._close=function(){var i=this._state,a=kn.indexOf(this);if(0<=a&&kn.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}i.isBeingOpened||(i.dbReadyPromise=new J(function(u){i.dbReadyResolve=u}),i.openCanceller=new J(function(u,f){i.cancelOpen=f}))},Ne.prototype.close=function(u){var a=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;a?(u.isBeingOpened&&u.cancelOpen(new ie.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new ie.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Ne.prototype.delete=function(i){var a=this;i===void 0&&(i={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",f=this._state;return new J(function(h,d){function m(){a.close(i);var w=a._deps.indexedDB.deleteDatabase(a.name);w.onsuccess=Pe(function(){var b,x,S;b=a._deps,x=a.name,S=b.indexedDB,b=b.IDBKeyRange,qi(S)||x===Nr||Fi(S,b).delete(x).catch(Ae),h()}),w.onerror=_t(d),w.onblocked=a._fireOnBlocked}if(u)throw new ie.InvalidArgument("Invalid closeOptions argument to db.delete()");f.isBeingOpened?f.dbReadyPromise.then(m):m()})},Ne.prototype.backendDB=function(){return this.idbdb},Ne.prototype.isOpen=function(){return this.idbdb!==null},Ne.prototype.hasBeenClosed=function(){var i=this._state.dbOpenError;return i&&i.name==="DatabaseClosed"},Ne.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ne.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ne.prototype,"tables",{get:function(){var i=this;return c(this._allTables).map(function(a){return i._allTables[a]})},enumerable:!1,configurable:!0}),Ne.prototype.transaction=function(){var i=function(a,u,f){var h=arguments.length;if(h<2)throw new ie.InvalidArgument("Too few arguments");for(var d=new Array(h-1);--h;)d[h-1]=arguments[h];return f=d.pop(),[a,we(d),f]}.apply(this,arguments);return this._transaction.apply(this,i)},Ne.prototype._transaction=function(i,a,u){var f=this,h=re.trans;h&&h.db===this&&i.indexOf("!")===-1||(h=null);var d,m,w=i.indexOf("?")!==-1;i=i.replace("!","").replace("?","");try{if(m=a.map(function(x){if(x=x instanceof f.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),i=="r"||i===Ci)d=Ci;else{if(i!="rw"&&i!=Ri)throw new ie.InvalidArgument("Invalid transaction mode: "+i);d=Ri}if(h){if(h.mode===Ci&&d===Ri){if(!w)throw new ie.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&m.forEach(function(x){if(h&&h.storeNames.indexOf(x)===-1){if(!w)throw new ie.SubTransaction("Table "+x+" not included in parent transaction.");h=null}}),w&&h&&!h.active&&(h=null)}}catch(x){return h?h._promise(null,function(S,v){v(x)}):Te(x)}var b=function x(S,v,P,k,A){return J.resolve().then(function(){var O=re.transless||re,E=S._createTransaction(v,P,S._dbSchema,k);if(E.explicit=!0,O={trans:E,transless:O},k)E.idbtrans=k.idbtrans;else try{E.create(),E.idbtrans._explicit=!0,S._state.PR1398_maxLoop=3}catch(D){return D.name===wi.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,v,P,null,A)})):Te(D)}var T,N=xt(A);return N&&bn(),O=J.follow(function(){var D;(T=A.call(E,E))&&(N?(D=Mt.bind(null,null),T.then(D,D)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=Qi(T)))},O),(T&&typeof T.then=="function"?J.resolve(T).then(function(D){return E.active?D:Te(new ie.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):O.then(function(){return T})).then(function(D){return k&&E._resolve(),E._completion.then(function(){return D})}).catch(function(D){return E._reject(D),Te(D)})})}.bind(null,this,d,m,h,u);return h?h._promise(d,b,"lock"):re.trans?Zt(re.transless,function(){return f._whenReady(b)}):this._whenReady(b)},Ne.prototype.table=function(i){if(!g(this._allTables,i))throw new ie.InvalidTable("Table ".concat(i," does not exist"));return this._allTables[i]},Ne);function Ne(i,a){var u=this;this._middlewares={},this.verno=0;var f=Ne.dependencies;this._options=a=r({addons:Ne.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},f=a.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,d,m,w,b,x={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ae,dbReadyPromise:null,cancelOpen:Ae,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen};x.dbReadyPromise=new J(function(v){x.dbReadyResolve=v}),x.openCanceller=new J(function(v,P){x.cancelOpen=P}),this._state=x,this.name=i,this.on=er(this,"populate","blocked","versionchange","close",{ready:[vi,Ae]}),this.on.ready.subscribe=B(this.on.ready.subscribe,function(v){return function(P,k){Ne.vip(function(){var A,O=u._state;O.openComplete?(O.dbOpenError||J.resolve().then(P),k&&v(P)):O.onReadyBeingFired?(O.onReadyBeingFired.push(P),k&&v(P)):(v(P),A=u,k||v(function E(){A.on.ready.unsubscribe(P),A.on.ready.unsubscribe(E)}))})}}),this.Collection=(h=this,tr(Mu.prototype,function(T,E){this.db=h;var k=aa,A=null;if(E)try{k=E()}catch(N){A=N}var O=T._ctx,E=O.table,T=E.hook.reading.fire;this._ctx={table:E,index:O.index,isPrimKey:!O.index||E.schema.primKey.keyPath&&O.index===E.schema.primKey.name,range:k,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:O.or,valueMapper:T!==Qn?T:null}})),this.Table=(d=this,tr(la.prototype,function(v,P,k){this.db=d,this._tx=k,this.name=v,this.schema=P,this.hook=d._allTables[v]?d._allTables[v].hook:er(null,{creating:[Su,Ae],reading:[Au,Qn],updating:[Pu,Ae],deleting:[Ou,Ae]})})),this.Transaction=(m=this,tr(Ku.prototype,function(v,P,k,A,O){var E=this;this.db=m,this.mode=v,this.storeNames=P,this.schema=k,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=er(this,"complete","error","abort"),this.parent=O||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new J(function(T,N){E._resolve=T,E._reject=N}),this._completion.then(function(){E.active=!1,E.on.complete.fire()},function(T){var N=E.active;return E.active=!1,E.on.error.fire(T),E.parent?E.parent._reject(T):N&&E.idbtrans&&E.idbtrans.abort(),Te(T)})})),this.Version=(w=this,tr(Hu.prototype,function(v){this.db=w,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,tr(ya.prototype,function(v,P,k){if(this.db=b,this._ctx={table:v,index:P===":id"?null:P,or:k},this._cmp=this._ascending=ye,this._descending=function(A,O){return ye(O,A)},this._max=function(A,O){return 0<ye(A,O)?A:O},this._min=function(A,O){return ye(A,O)<0?A:O},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new ie.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=sr(a.IDBKeyRange),this._createTransaction=function(v,P,k,A){return new u.Transaction(v,P,k,u._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(v){u.on("blocked").fire(v),kn.filter(function(P){return P.name===u.name&&P!==u&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(v)})},this.use(Qu),this.use(Zu),this.use(Yu),this.use(Gu),this.use(Wu);var S=new Proxy(this,{get:function(v,P,k){if(P==="_vip")return!0;if(P==="table")return function(O){return Gr(u.table(O),S)};var A=Reflect.get(v,P,k);return A instanceof la?Gr(A,S):P==="tables"?A.map(function(O){return Gr(O,S)}):P==="_createTransaction"?function(){return Gr(A.apply(this,arguments),S)}:A}});this.vip=S,f.forEach(function(v){return v(u)})}var Wr,it=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ec=(Zi.prototype.subscribe=function(i,a,u){return this._subscribe(i&&typeof i!="function"?i:{next:i,error:a,complete:u})},Zi.prototype[it]=function(){return this},Zi);function Zi(i){this._subscribe=i}try{Wr={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{Wr={indexedDB:null,IDBKeyRange:null}}function Ra(i){var a,u=!1,f=new ec(function(h){var d=xt(i),m,w=!1,b={},x={},S={get closed(){return w},unsubscribe:function(){w||(w=!0,m&&m.abort(),v&&Kt.storagemutated.unsubscribe(k))}};h.start&&h.start(S);var v=!1,P=function(){return Pi(A)},k=function(O){Vr(b,O),Hi(x,b)&&P()},A=function(){var O,E,T;!w&&Wr.indexedDB&&(b={},O={},m&&m.abort(),m=new AbortController,T=function(N){var D=wn();try{d&&bn();var M=$t(i,N);return M=d?M.finally(Mt):M}finally{D&&vn()}}(E={subscr:O,signal:m.signal,requery:P,querier:i,trans:null}),Promise.resolve(T).then(function(N){u=!0,a=N,w||E.signal.aborted||(b={},function(D){for(var M in D)if(g(D,M))return;return 1}(x=O)||v||(Kt(ir,k),v=!0),Pi(function(){return!w&&h.next&&h.next(N)}))},function(N){u=!1,["DatabaseClosedError","AbortError"].includes(N?.name)||w||Pi(function(){w||h.error&&h.error(N)})}))};return setTimeout(P,0),S});return f.hasValue=function(){return u},f.getValue=function(){return a},f}var rn=St;function es(i){var a=Bt;try{Bt=!0,Kt.storagemutated.fire(i),Wi(i,!0)}finally{Bt=a}}C(rn,r(r({},xr),{delete:function(i){return new rn(i,{addons:[]}).delete()},exists:function(i){return new rn(i,{addons:[]}).open().then(function(a){return a.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(i){try{return a=rn.dependencies,u=a.indexedDB,a=a.IDBKeyRange,(qi(u)?Promise.resolve(u.databases()).then(function(f){return f.map(function(h){return h.name}).filter(function(h){return h!==Nr})}):Fi(u,a).toCollection().primaryKeys()).then(i)}catch{return Te(new ie.MissingAPI)}var a,u},defineClass:function(){return function(i){p(this,i)}},ignoreTransaction:function(i){return re.trans?Zt(re.transless,i):i()},vip:Ui,async:function(i){return function(){try{var a=Qi(i.apply(this,arguments));return a&&typeof a.then=="function"?a:J.resolve(a)}catch(u){return Te(u)}}},spawn:function(i,a,u){try{var f=Qi(i.apply(u,a||[]));return f&&typeof f.then=="function"?f:J.resolve(f)}catch(h){return Te(h)}},currentTransaction:{get:function(){return re.trans||null}},waitFor:function(i,a){return a=J.resolve(typeof i=="function"?rn.ignoreTransaction(i):i).timeout(a||6e4),re.trans?re.trans.waitFor(a):a},Promise:J,debug:{get:function(){return yt},set:function(i){Zs(i)}},derive:R,extend:p,props:C,override:B,Events:er,on:Kt,liveQuery:Ra,extendObservabilitySet:Vr,getByKeyPath:ee,setByKeyPath:ce,delByKeyPath:function(i,a){typeof a=="string"?ce(i,a,void 0):"length"in a&&[].map.call(a,function(u){ce(i,u,void 0)})},shallowClone:Ce,deepClone:Ue,getObjectDiff:Yi,cmp:ye,asap:Q,minKey:-1/0,addons:[],connections:kn,errnames:wi,dependencies:Wr,cache:nn,semVer:"4.0.11",version:"4.0.11".split(".").map(function(i){return parseInt(i)}).reduce(function(i,a,u){return i+a/Math.pow(10,2*u)})})),rn.maxKey=sr(rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Kt(ir,function(i){Bt||(i=new CustomEvent($i,{detail:i}),Bt=!0,dispatchEvent(i),Bt=!1)}),addEventListener($i,function(i){i=i.detail,Bt||es(i)}));var An,Bt=!1,Ta=function(){};return typeof BroadcastChannel<"u"&&((Ta=function(){(An=new BroadcastChannel($i)).onmessage=function(i){return i.data&&es(i.data)}})(),typeof An.unref=="function"&&An.unref(),Kt(ir,function(i){Bt||An.postMessage(i)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(i){if(!St.disableBfCache&&i.persisted){yt&&console.debug("Dexie: handling persisted pagehide"),An?.close();for(var a=0,u=kn;a<u.length;a++)u[a].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(i){!St.disableBfCache&&i.persisted&&(yt&&console.debug("Dexie: handling persisted pageshow"),Ta(),es({all:new Ve(-1/0,[[]])}))})),J.rejectionMapper=function(i,a){return!i||i instanceof Et||i instanceof TypeError||i instanceof SyntaxError||!i.name||!Js[i.name]?i:(a=new Js[i.name](a||i.message,i),"stack"in i&&L(a,"stack",{get:function(){return this.inner.stack}}),a)},Zs(yt),r(St,Object.freeze({__proto__:null,Dexie:St,liveQuery:Ra,Entity:oa,cmp:ye,PropModification:nr,replacePrefix:function(i,a){return new nr({replacePrefix:[i,a]})},add:function(i){return new nr({add:i})},remove:function(i){return new nr({remove:i})},default:St,RangeSet:Ve,mergeRanges:ur,rangesOverlap:va}),{default:St}),St})}(Zr)),Zr.exports}var Tl=Rl();const xs=Pl(Tl),Wa=Symbol.for("Dexie"),si=globalThis[Wa]||(globalThis[Wa]=xs);if(xs.semVer!==si.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${xs.semVer} and ${si.semVer}`);const{liveQuery:Cd,mergeRanges:Rd,rangesOverlap:Td,RangeSet:Nd,cmp:Dd,Entity:Gt,PropModification:$d,replacePrefix:Md,add:jd,remove:Id}=si,ai=["a","b","c","d","e","f","g","h"],Ho=["1","2","3","4","5","6","7","8"],dn=["white","black"],ct=["pawn","knight","bishop","rook","queen","king"],Nl=["a","h"],yr=t=>"role"in t,ae=t=>t!==void 0,Be=t=>t==="white"?"black":"white",pn=t=>t>>3,Qe=t=>t&7,Es=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,fn=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function In(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Kn(t){if(t.length===2)return Es(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const Bn=t=>ai[Qe(t)]+Ho[pn(t)],Kd=t=>{if(t[1]==="@"&&t.length===4){const e=In(t[0]),n=Kn(t.slice(2));if(e&&ae(n))return{role:e,to:n}}else if(t.length===4||t.length===5){const e=Kn(t.slice(0,2)),n=Kn(t.slice(2,4));let r;if(t.length===5&&(r=In(t[4]),!r))return;if(ae(e)&&ae(n))return{from:e,to:n,promotion:r}}},Bs=t=>yr(t)?`${fn(t.role).toUpperCase()}@${Bn(t.to)}`:Bn(t.from)+Bn(t.to)+(t.promotion?fn(t.promotion):""),Ls=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,Fs=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Qa=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),As=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),Ya=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,As(t));class K{constructor(e,n){this.lo=e|0,this.hi=n|0}static fromSquare(e){return e>=32?new K(0,1<<e-32):new K(1<<e,0)}static fromRank(e){return new K(255,0).shl64(8*e)}static fromFile(e){return new K(16843009<<e,16843009<<e)}static empty(){return new K(0,0)}static full(){return new K(4294967295,4294967295)}static corners(){return new K(129,2164260864)}static center(){return new K(402653184,24)}static backranks(){return new K(255,4278190080)}static backrank(e){return e==="white"?new K(255,0):new K(0,4278190080)}static lightSquares(){return new K(1437226410,1437226410)}static darkSquares(){return new K(2857740885,2857740885)}complement(){return new K(~this.lo,~this.hi)}xor(e){return new K(this.lo^e.lo,this.hi^e.hi)}union(e){return new K(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new K(this.lo&e.lo,this.hi&e.hi)}diff(e){return new K(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?K.empty():e>=32?new K(this.hi>>>e-32,0):e>0?new K(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?K.empty():e>=32?new K(0,this.lo<<e-32):e>0?new K(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new K(As(this.hi),As(this.lo))}rbit64(){return new K(Ya(this.hi),Ya(this.lo))}minus64(e){const n=this.lo-e.lo,r=(n&e.lo&1)+(e.lo>>>1)+(n>>>1)>>>31;return new K(n,this.hi-(e.hi+r))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Qa(this.lo)+Qa(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,n){return n?this.with(e):this.without(e)}with(e){return e>=32?new K(this.lo,this.hi|1<<e-32):new K(this.lo|1<<e,this.hi)}without(e){return e>=32?new K(this.lo,this.hi&~(1<<e-32)):new K(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new K(this.lo,this.hi^1<<e-32):new K(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new K(this.lo&this.lo-1,this.hi):new K(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,n=this.hi;for(;e!==0;){const r=31-Math.clz32(e&-e);e^=1<<r,yield r}for(;n!==0;){const r=31-Math.clz32(n&-n);n^=1<<r,yield 32+r}}*reversed(){let e=this.lo,n=this.hi;for(;n!==0;){const r=31-Math.clz32(n);n^=1<<r,yield 32+r}for(;e!==0;){const r=31-Math.clz32(e);e^=1<<r,yield r}}}const oi=(t,e)=>{let n=K.empty();for(const r of e){const s=t+r;0<=s&&s<64&&Math.abs(Qe(t)-Qe(s))<=2&&(n=n.with(s))}return n},Ut=t=>{const e=[];for(let n=0;n<64;n++)e[n]=t(n);return e},Dl=Ut(t=>oi(t,[-9,-8,-7,-1,1,7,8,9])),$l=Ut(t=>oi(t,[-17,-15,-10,-6,6,10,15,17])),Ml={white:Ut(t=>oi(t,[7,9])),black:Ut(t=>oi(t,[-7,-9]))},pi=t=>Dl[t],yi=t=>$l[t],vr=(t,e)=>Ml[t][e],Ss=Ut(t=>K.fromFile(Qe(t)).without(t)),Os=Ut(t=>K.fromRank(pn(t)).without(t)),Ps=Ut(t=>{const e=new K(134480385,2151686160),n=8*(pn(t)-Qe(t));return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),Cs=Ut(t=>{const e=new K(270549120,16909320),n=8*(pn(t)+Qe(t)-7);return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),Rs=(t,e,n)=>{let r=n.intersect(e),s=r.bswap64();return r=r.minus64(t),s=s.minus64(t.bswap64()),r.xor(s.bswap64()).intersect(e)},jl=(t,e)=>Rs(K.fromSquare(t),Ss[t],e),Il=(t,e)=>{const n=Os[t];let r=e.intersect(n),s=r.rbit64();return r=r.minus64(K.fromSquare(t)),s=s.minus64(K.fromSquare(63-t)),r.xor(s.rbit64()).intersect(n)},Un=(t,e)=>{const n=K.fromSquare(t);return Rs(n,Ps[t],e).xor(Rs(n,Cs[t],e))},Vn=(t,e)=>jl(t,e).xor(Il(t,e)),qs=(t,e)=>Un(t,e).xor(Vn(t,e)),zo=(t,e,n)=>{switch(t.role){case"pawn":return vr(t.color,e);case"knight":return yi(e);case"bishop":return Un(e,n);case"rook":return Vn(e,n);case"queen":return qs(e,n);case"king":return pi(e)}},Go=(t,e)=>{const n=K.fromSquare(e);return Os[t].intersects(n)?Os[t].with(t):Cs[t].intersects(n)?Cs[t].with(t):Ps[t].intersects(n)?Ps[t].with(t):Ss[t].intersects(n)?Ss[t].with(t):K.empty()},_r=(t,e)=>Go(t,e).intersect(K.full().shl64(t).xor(K.full().shl64(e))).withoutFirst();class Ln{constructor(){}static default(){const e=new Ln;return e.reset(),e}reset(){this.occupied=new K(65535,4294901760),this.promoted=K.empty(),this.white=new K(65535,0),this.black=new K(0,4294901760),this.pawn=new K(65280,16711680),this.knight=new K(66,1107296256),this.bishop=new K(36,603979776),this.rook=new K(129,2164260864),this.queen=new K(8,134217728),this.king=new K(16,268435456)}static empty(){const e=new Ln;return e.clear(),e}clear(){this.occupied=K.empty(),this.promoted=K.empty();for(const e of dn)this[e]=K.empty();for(const e of ct)this[e]=K.empty()}clone(){const e=new Ln;e.occupied=this.occupied,e.promoted=this.promoted;for(const n of dn)e[n]=this[n];for(const n of ct)e[n]=this[n];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const n of ct)if(this[n].has(e))return n}get(e){const n=this.getColor(e);if(!n)return;const r=this.getRole(e),s=this.promoted.has(e);return{color:n,role:r,promoted:s}}take(e){const n=this.get(e);return n&&(this.occupied=this.occupied.without(e),this[n.color]=this[n.color].without(e),this[n.role]=this[n.role].without(e),n.promoted&&(this.promoted=this.promoted.without(e))),n}set(e,n){const r=this.take(e);return this.occupied=this.occupied.with(e),this[n.color]=this[n.color].with(e),this[n.role]=this[n.role].with(e),n.promoted&&(this.promoted=this.promoted.with(e)),r}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,n){return this[e].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class gt{constructor(){}static empty(){const e=new gt;for(const n of ct)e[n]=0;return e}static fromBoard(e,n){const r=new gt;for(const s of ct)r[s]=e.pieces(n,s).size();return r}clone(){const e=new gt;for(const n of ct)e[n]=this[n];return e}equals(e){return ct.every(n=>this[n]===e[n])}add(e){const n=new gt;for(const r of ct)n[r]=this[r]+e[r];return n}subtract(e){const n=new gt;for(const r of ct)n[r]=this[r]-e[r];return n}nonEmpty(){return ct.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class on{constructor(e,n){this.white=e,this.black=n}static empty(){return new on(gt.empty(),gt.empty())}static fromBoard(e){return new on(gt.fromBoard(e,"white"),gt.fromBoard(e,"black"))}clone(){return new on(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new on(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new on(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class mr{constructor(e,n){this.white=e,this.black=n}static default(){return new mr(3,3)}clone(){return new mr(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}class Wo{unwrap(e,n){const r=this._chain(s=>fe.ok(e?e(s):s),s=>n?fe.ok(n(s)):fe.err(s));if(r.isErr)throw r.error;return r.value}map(e,n){return this._chain(r=>fe.ok(e(r)),r=>fe.err(n?n(r):r))}chain(e,n){return this._chain(e,n||(r=>fe.err(r)))}}class Kl extends Wo{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,n){return e(this.value)}}class Bl extends Wo{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,n){return n(this.error)}}var fe;(function(t){t.ok=function(e){return new Kl(e)},t.err=function(e){return new Bl(e||new Error)},t.all=function(e){if(Array.isArray(e)){const s=[];for(let o=0;o<e.length;o++){const c=e[o];if(c.isErr)return c;s.push(c.value)}return t.ok(s)}const n={},r=Object.keys(e);for(let s=0;s<r.length;s++){const o=e[r[s]];if(o.isErr)return o;n[r[s]]=o.value}return t.ok(n)}})(fe||(fe={}));var Lt;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(Lt||(Lt={}));class On extends Error{}const Ll=(t,e,n,r)=>n[e].intersect(Vn(t,r).intersect(n.rooksAndQueens()).union(Un(t,r).intersect(n.bishopsAndQueens())).union(yi(t).intersect(n.knight)).union(pi(t).intersect(n.king)).union(vr(Be(e),t).intersect(n.pawn)));class un{constructor(){}static default(){const e=new un;return e.castlingRights=K.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new K(14,0),h:new K(96,0)},black:{a:new K(0,234881024),h:new K(0,1610612736)}},e}static empty(){const e=new un;return e.castlingRights=K.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:K.empty(),h:K.empty()},black:{a:K.empty(),h:K.empty()}},e}clone(){const e=new un;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,n,r,s){const o=Ls(e,n),c=Fs(e,n);this.castlingRights=this.castlingRights.with(s),this.rook[e][n]=s,this.path[e][n]=_r(s,c).with(c).union(_r(r,o).with(o)).without(r).without(s)}static fromSetup(e){const n=un.empty(),r=e.castlingRights.intersect(e.board.rook);for(const s of dn){const o=K.backrank(s),c=e.board.kingOf(s);if(!ae(c)||!o.has(c))continue;const l=r.intersect(e.board[s]).intersect(o),p=l.first();ae(p)&&p<c&&n.add(s,"a",c,p);const y=l.last();ae(y)&&c<y&&n.add(s,"h",c,y)}return n}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const n of dn)for(const r of Nl)this.rook[n][r]===e&&(this.rook[n][r]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(K.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class Fl{constructor(e){this.rules=e}reset(){this.board=Ln.default(),this.pockets=void 0,this.turn="white",this.castles=un.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=K.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=un.fromSetup(e),this.epSquare=ql(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,n,r){return Ll(e,n,this.board,r)}playCaptureAt(e,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[Be(n.color)][n.promoted?"pawn":n.role]++}ctx(){const e=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!ae(n))return{king:n,blockers:K.empty(),checkers:K.empty(),variantEnd:e,mustCapture:!1};const r=Vn(n,K.empty()).intersect(this.board.rooksAndQueens()).union(Un(n,K.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[Be(this.turn)]);let s=K.empty();for(const c of r){const l=_r(n,c).intersect(this.board.occupied);l.moreThanOne()||(s=s.union(l))}const o=this.kingAttackers(n,Be(this.turn),this.board.occupied);return{king:n,blockers:s,checkers:o,variantEnd:e,mustCapture:!1}}clone(){var e,n;const r=new this.constructor;return r.board=this.board.clone(),r.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),r.turn=this.turn,r.castles=this.castles.clone(),r.epSquare=this.epSquare,r.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),r.halfmoves=this.halfmoves,r.fullmoves=this.fullmoves,r}validate(){if(this.board.occupied.isEmpty())return fe.err(new On(Lt.Empty));if(this.board.king.size()!==2)return fe.err(new On(Lt.Kings));if(!ae(this.board.kingOf(this.turn)))return fe.err(new On(Lt.Kings));const e=this.board.kingOf(Be(this.turn));return ae(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?fe.err(new On(Lt.OppositeCheck)):K.backranks().intersects(this.board.pawn)?fe.err(new On(Lt.PawnsOnBackrank)):fe.ok(void 0):fe.err(new On(Lt.Kings))}dropDests(e){return K.empty()}dests(e,n){if(n=n||this.ctx(),n.variantEnd)return K.empty();const r=this.board.get(e);if(!r||r.color!==this.turn)return K.empty();let s,o;if(r.role==="pawn"){s=vr(this.turn,e).intersect(this.board[Be(this.turn)]);const c=this.turn==="white"?8:-8,l=e+c;if(0<=l&&l<64&&!this.board.occupied.has(l)){s=s.with(l);const p=this.turn==="white"?e<16:e>=48,y=l+c;p&&!this.board.occupied.has(y)&&(s=s.with(y))}ae(this.epSquare)&&Vl(this,e,n)&&(o=K.fromSquare(this.epSquare))}else r.role==="bishop"?s=Un(e,this.board.occupied):r.role==="knight"?s=yi(e):r.role==="rook"?s=Vn(e,this.board.occupied):r.role==="queen"?s=qs(e,this.board.occupied):s=pi(e);if(s=s.diff(this.board[this.turn]),ae(n.king)){if(r.role==="king"){const c=this.board.occupied.without(e);for(const l of s)this.kingAttackers(l,Be(this.turn),c).nonEmpty()&&(s=s.without(l));return s.union(ui(this,"a",n)).union(ui(this,"h",n))}if(n.checkers.nonEmpty()){const c=n.checkers.singleSquare();if(!ae(c))return K.empty();s=s.intersect(_r(c,n.king).with(c))}n.blockers.has(e)&&(s=s.intersect(Go(e,n.king)))}return o&&(s=s.union(o)),s}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[Be(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(K.darkSquares())||!this.board.bishop.intersects(K.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,n;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Ul(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return dn.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,n){if(yr(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&K.backranks().has(e.to)?!1:this.dropDests(n).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&K.backranks().has(e.to)))return!1;const r=this.dests(e.from,n);return r.has(e.to)||r.has(Hl(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return ae(e)&&this.kingAttackers(e,Be(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const n=this.variantOutcome(e);return n||(e=e||this.ctx(),this.isCheckmate(e)?{winner:Be(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const n=new Map;if(e.variantEnd)return n;for(const r of this.board[this.turn])n.set(r,this.dests(r,e));return n}play(e){const n=this.turn,r=this.epSquare,s=Yo(this,e);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=Be(n),yr(e))this.board.set(e.to,{role:e.role,color:n}),this.pockets&&this.pockets[n][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const o=this.board.take(e.from);if(!o)return;let c;if(o.role==="pawn"){this.halfmoves=0,e.to===r&&(c=this.board.take(e.to+(n==="white"?-8:8)));const l=e.from-e.to;Math.abs(l)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(o.role=e.promotion,o.promoted=!!this.pockets)}else if(o.role==="rook")this.castles.discardRook(e.from);else if(o.role==="king"){if(s){const l=this.castles.rook[n][s];if(ae(l)){const p=this.board.take(l);this.board.set(Ls(n,s),o),p&&this.board.set(Fs(n,s),p)}}this.castles.discardColor(n)}if(!s){const l=this.board.set(e.to,o)||c;l&&this.playCaptureAt(e.to,l)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Qo extends Fl{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const n=new this;return n.setupUnchecked(e),n.validate().map(r=>n)}clone(){return super.clone()}}const ql=(t,e)=>{if(!ae(e))return;const n=t.turn==="white"?5:2,r=t.turn==="white"?8:-8;if(pn(e)!==n||t.board.occupied.has(e+r))return;const s=e-r;if(!(!t.board.pawn.has(s)||!t.board[Be(t.turn)].has(s)))return e},Ul=t=>{if(!ae(t.epSquare))return;const e=t.ctx(),r=t.board.pieces(t.turn,"pawn").intersect(vr(Be(t.turn),t.epSquare));for(const s of r)if(t.dests(s,e).has(t.epSquare))return t.epSquare},Vl=(t,e,n)=>{if(!ae(t.epSquare)||!vr(t.turn,e).has(t.epSquare))return!1;if(!ae(n.king))return!0;const r=t.turn==="white"?8:-8,s=t.epSquare-r;return t.kingAttackers(n.king,Be(t.turn),t.board.occupied.toggle(e).toggle(s).with(t.epSquare)).without(s).isEmpty()},ui=(t,e,n)=>{if(!ae(n.king)||n.checkers.nonEmpty())return K.empty();const r=t.castles.rook[t.turn][e];if(!ae(r)||t.castles.path[t.turn][e].intersects(t.board.occupied))return K.empty();const s=Ls(t.turn,e),o=_r(n.king,s),c=t.board.occupied.without(n.king);for(const y of o)if(t.kingAttackers(y,Be(t.turn),c).nonEmpty())return K.empty();const l=Fs(t.turn,e),p=t.board.occupied.toggle(n.king).toggle(r).toggle(l);return t.kingAttackers(s,Be(t.turn),p).nonEmpty()?K.empty():K.fromSquare(r)},Bd=(t,e,n)=>{if(n.variantEnd)return K.empty();const r=t.board.get(e);if(!r||r.color!==t.turn)return K.empty();let s=zo(r,e,t.board.occupied);if(r.role==="pawn"){let o=t.board[Be(t.turn)];ae(t.epSquare)&&(o=o.with(t.epSquare)),s=s.intersect(o);const c=t.turn==="white"?8:-8,l=e+c;if(0<=l&&l<64&&!t.board.occupied.has(l)){s=s.with(l);const p=t.turn==="white"?e<16:e>=48,y=l+c;p&&!t.board.occupied.has(y)&&(s=s.with(y))}return s}else s=s.diff(t.board[t.turn]);return e===n.king?s.union(ui(t,"a",n)).union(ui(t,"h",n)):s},Yo=(t,e)=>{if(yr(e))return;const n=e.to-e.from;if(!(Math.abs(n)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return n>0?"h":"a"},Hl=(t,e)=>{const n=Yo(t,e);if(!n)return e;const r=t.castles.rook[t.turn][n];return{from:e.from,to:ae(r)?r:e.to}},zl="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Gl=zl+" w KQkq -",Us=Gl+" 0 1",Wl="8/8/8/8/8/8/8/8",Ql=Wl+" w - -",Ld=Ql+" 0 1";var Me;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(Me||(Me={}));class Fe extends Error{}const Yl=(t,e,n)=>{let r=t.indexOf(e);for(;n-- >0&&r!==-1;)r=t.indexOf(e,r+e.length);return r},$n=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Xo=t=>{const e=In(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},as=t=>{const e=Ln.empty();let n=7,r=0;for(let s=0;s<t.length;s++){const o=t[s];if(o==="/"&&r===8)r=0,n--;else{const c=parseInt(o,10);if(c>0)r+=c;else{if(r>=8||n<0)return fe.err(new Fe(Me.Board));const l=r+n*8,p=Xo(o);if(!p)return fe.err(new Fe(Me.Board));t[s+1]==="~"&&(p.promoted=!0,s++),e.set(l,p),r++}}}return n!==0||r!==8?fe.err(new Fe(Me.Board)):fe.ok(e)},Xa=t=>{if(t.length>64)return fe.err(new Fe(Me.Pockets));const e=on.empty();for(const n of t){const r=Xo(n);if(!r)return fe.err(new Fe(Me.Pockets));e[r.color][r.role]++}return fe.ok(e)},Xl=(t,e)=>{let n=K.empty();if(e==="-")return fe.ok(n);for(const r of e){const s=r.toLowerCase(),o=r===s?"black":"white",c=o==="white"?0:7;if("a"<=s&&s<="h")n=n.with(Es(s.charCodeAt(0)-97,c));else if(s==="k"||s==="q"){const l=t[o].intersect(K.backrank(o)).intersect(t.rook.union(t.king)),p=s==="k"?l.last():l.first();n=n.with(ae(p)&&t.rook.has(p)?p:Es(s==="k"?7:0,c))}else return fe.err(new Fe(Me.Castling))}return dn.some(r=>K.backrank(r).intersect(n).size()>2)?fe.err(new Fe(Me.Castling)):fe.ok(n)},Ja=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const n=$n(e[1]),r=$n(e[2]);return!ae(n)||n>3||!ae(r)||r>3?fe.err(new Fe(Me.RemainingChecks)):fe.ok(new mr(3-n,3-r))}else if(e.length===2){const n=$n(e[0]),r=$n(e[1]);return!ae(n)||n>3||!ae(r)||r>3?fe.err(new Fe(Me.RemainingChecks)):fe.ok(new mr(n,r))}else return fe.err(new Fe(Me.RemainingChecks))},Jo=t=>{const e=t.split(/[\s_]+/),n=e.shift();let r,s=fe.ok(void 0);if(n.endsWith("]")){const l=n.indexOf("[");if(l===-1)return fe.err(new Fe(Me.Fen));r=as(n.slice(0,l)),s=Xa(n.slice(l+1,-1))}else{const l=Yl(n,"/",7);l===-1?r=as(n):(r=as(n.slice(0,l)),s=Xa(n.slice(l+1)))}let o;const c=e.shift();if(!ae(c)||c==="w")o="white";else if(c==="b")o="black";else return fe.err(new Fe(Me.Turn));return r.chain(l=>{const p=e.shift(),y=ae(p)?Xl(l,p):fe.ok(K.empty()),_=e.shift();let g;if(ae(_)&&_!=="-"&&(g=Kn(_),!ae(g)))return fe.err(new Fe(Me.EpSquare));let C=e.shift(),$;ae(C)&&C.includes("+")&&($=Ja(C),C=e.shift());const L=ae(C)?$n(C):0;if(!ae(L))return fe.err(new Fe(Me.Halfmoves));const R=e.shift(),I=ae(R)?$n(R):1;if(!ae(I))return fe.err(new Fe(Me.Fullmoves));const W=e.shift();let j=fe.ok(void 0);if(ae(W)){if(ae($))return fe.err(new Fe(Me.RemainingChecks));j=Ja(W)}else ae($)&&(j=$);return e.length>0?fe.err(new Fe(Me.Fen)):s.chain(B=>y.chain(U=>j.map(Q=>({board:l,pockets:B,turn:o,castlingRights:U,remainingChecks:Q,epSquare:g,halfmoves:L,fullmoves:Math.max(1,I)}))))})},Jl=t=>{let e=fn(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},Zl=t=>{let e="",n=0;for(let r=7;r>=0;r--)for(let s=0;s<8;s++){const o=s+r*8,c=t.get(o);c?(n>0&&(e+=n,n=0),e+=Jl(c)):n++,s===7&&(n>0&&(e+=n,n=0),r!==0&&(e+="/"))}return e},Za=t=>ct.map(e=>fn(e).repeat(t[e])).join(""),ef=t=>Za(t.white).toUpperCase()+Za(t.black),tf=(t,e)=>{let n="";for(const r of dn){const s=K.backrank(r);let o=t.kingOf(r);ae(o)&&!s.has(o)&&(o=void 0);const c=t.pieces(r,"rook").intersect(s);for(const l of e.intersect(s).reversed())if(l===c.first()&&ae(o)&&l<o)n+=r==="white"?"Q":"q";else if(l===c.last()&&ae(o)&&o<l)n+=r==="white"?"K":"k";else{const p=ai[Qe(l)];n+=r==="white"?p.toUpperCase():p}}return n||"-"},nf=t=>`${t.white}+${t.black}`,Vs=(t,e)=>[Zl(t.board)+(t.pockets?`[${ef(t.pockets)}]`:""),t.turn[0],tf(t.board,t.castlingRights),ae(t.epSquare)?Bn(t.epSquare):"-",...t.remainingChecks?[nf(t.remainingChecks)]:[],Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))].join(" "),rf=(t,e)=>{let n="";if(yr(e))e.role!=="pawn"&&(n=fn(e.role).toUpperCase()),n+="@"+Bn(e.to);else{const r=t.board.getRole(e.from);if(!r)return"--";if(r==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))n=e.to>e.from?"O-O":"O-O-O";else{const s=t.board.occupied.has(e.to)||r==="pawn"&&Qe(e.from)!==Qe(e.to);if(r!=="pawn"){n=fn(r).toUpperCase();let o;if(r==="king"?o=pi(e.to).intersect(t.board.king):r==="queen"?o=qs(e.to,t.board.occupied).intersect(t.board.queen):r==="rook"?o=Vn(e.to,t.board.occupied).intersect(t.board.rook):r==="bishop"?o=Un(e.to,t.board.occupied).intersect(t.board.bishop):o=yi(e.to).intersect(t.board.knight),o=o.intersect(t.board[t.turn]).without(e.from),o.nonEmpty()){const c=t.ctx();for(const l of o)t.dests(l,c).has(e.to)||(o=o.without(l));if(o.nonEmpty()){let l=!1,p=o.intersects(K.fromRank(pn(e.from)));o.intersects(K.fromFile(Qe(e.from)))?l=!0:p=!0,p&&(n+=ai[Qe(e.from)]),l&&(n+=Ho[pn(e.from)])}}}else s&&(n=ai[Qe(e.from)]);s&&(n+="x"),n+=Bn(e.to),e.promotion&&(n+="="+fn(e.promotion).toUpperCase())}}return n},sf=(t,e)=>{var n;const r=rf(t,e);return t.play(e),!((n=t.outcome())===null||n===void 0)&&n.winner?r+"#":t.isCheck()?r+"+":r},Fd=(t,e)=>sf(t.clone(),e),Hs=(t,e)=>{const n=t.ctx(),r=e.match(/^([NBRQK])?([a-h])?([1-8])?[-x]?([a-h][1-8])(?:=?([nbrqkNBRQK]))?[+#]?$/);if(!r){let _;if(e==="O-O"||e==="O-O+"||e==="O-O#"?_="h":(e==="O-O-O"||e==="O-O-O+"||e==="O-O-O#")&&(_="a"),_){const $=t.castles.rook[t.turn][_];return!ae(n.king)||!ae($)||!t.dests(n.king,n).has($)?void 0:{from:n.king,to:$}}const g=e.match(/^([pnbrqkPNBRQK])?@([a-h][1-8])[+#]?$/);if(!g)return;const C={role:g[1]?In(g[1]):"pawn",to:Kn(g[2])};return t.isLegal(C,n)?C:void 0}const s=r[1]?In(r[1]):"pawn",o=Kn(r[4]),c=r[5]?In(r[5]):void 0;if(!!c!==(s==="pawn"&&K.backranks().has(o))||c==="king"&&t.rules!=="antichess")return;let l=t.board.pieces(t.turn,s);s==="pawn"&&!r[2]?l=l.intersect(K.fromFile(Qe(o))):r[2]&&(l=l.intersect(K.fromFile(r[2].charCodeAt(0)-97))),r[3]&&(l=l.intersect(K.fromRank(r[3].charCodeAt(0)-49)));const p=s==="pawn"?K.fromFile(Qe(o)):K.empty();l=l.intersect(p.union(zo({color:Be(t.turn),role:s},o,t.board.occupied)));let y;for(const _ of l)if(t.dests(_,n).has(o)){if(ae(y))return;y=_}if(ae(y))return{from:y,to:o,promotion:c}},af=(t=zs)=>({headers:t(),moves:new Zo});let Zo=class{constructor(){this.children=[]}*mainlineNodes(){let e=this;for(;e.children.length;){const n=e.children[0];yield n,e=n}}*mainline(){for(const e of this.mainlineNodes())yield e.data}end(){let e=this;for(;e.children.length;)e=e.children[0];return e}};class of extends Zo{constructor(e){super(),this.data=e}}const uf=t=>t?t.winner==="white"?"1-0":t.winner==="black"?"0-1":"1/2-1/2":"*",cf=t=>t==="1-0"||t==="10"||t==="10"?{winner:"white"}:t==="0-1"||t==="01"||t==="01"?{winner:"black"}:t==="1/2-1/2"||t==="1/21/2"||t==="1/21/2"?{winner:void 0}:void 0,zs=()=>new Map([["Event","?"],["Site","?"],["Date","????.??.??"],["Round","?"],["White","?"],["Black","?"],["Result","*"]]),eo="\uFEFF",os=t=>/^\s*$/.test(t),us=t=>t.startsWith("%");class lf extends Error{}class ff{constructor(e,n=zs,r=1e6){this.emitGame=e,this.initHeaders=n,this.maxBudget=r,this.lineBuf=[],this.resetGame(),this.state=0}resetGame(){this.budget=this.maxBudget,this.found=!1,this.state=1,this.game=af(this.initHeaders),this.stack=[{parent:this.game.moves,root:!0}],this.commentBuf=[]}consumeBudget(e){if(this.budget-=e,this.budget<0)throw new lf("ERR_PGN_BUDGET")}parse(e,n){if(!(this.budget<0))try{let r=0;for(;;){const s=e.indexOf(`
`,r);if(s===-1)break;const o=s>r&&e[s-1]==="\r"?s-1:s;this.consumeBudget(s-r),this.lineBuf.push(e.slice(r,o)),r=s+1,this.handleLine()}this.consumeBudget(e.length-r),this.lineBuf.push(e.slice(r)),n?.stream||(this.handleLine(),this.emit(void 0))}catch(r){this.emit(r)}}handleLine(){let e=!0,n=this.lineBuf.join("");this.lineBuf=[];e:for(;;)switch(this.state){case 0:n.startsWith(eo)&&(n=n.slice(eo.length)),this.state=1;case 1:if(os(n)||us(n))return;this.found=!0,this.state=2;case 2:{if(us(n))return;let r=!0;for(;r;)r=!1,n=n.replace(/^\s*\[([A-Za-z0-9][A-Za-z0-9_+#=:-]*)\s+"((?:[^"\\]|\\"|\\\\)*)"\]/,(s,o,c)=>(this.consumeBudget(200),this.handleHeader(o,c.replace(/\\"/g,'"').replace(/\\\\/g,"\\")),r=!0,e=!1,""));if(os(n))return;this.state=3}case 3:{if(e){if(us(n))return;if(os(n))return this.emit(void 0)}const r=/(?:[NBKRQ]?[a-h]?[1-8]?[-x]?[a-h][1-8](?:=?[nbrqkNBRQK])?|[pnbrqkPNBRQK]?@[a-h][1-8]|[O0o][-][O0o](?:[-][O0o])?)[+#]?|--|Z0|0000|@@@@|{|;|\$\d{1,4}|[?!]{1,2}|\(|\)|\*|1[-]0|0[-]1|1\/2[-]1\/2/g;let s;for(;s=r.exec(n);){const o=this.stack[this.stack.length-1];let c=s[0];if(c===";")return;if(c.startsWith("$"))this.handleNag(parseInt(c.slice(1),10));else if(c==="!")this.handleNag(1);else if(c==="?")this.handleNag(2);else if(c==="!!")this.handleNag(3);else if(c==="??")this.handleNag(4);else if(c==="!?")this.handleNag(5);else if(c==="?!")this.handleNag(6);else if(c==="1-0"||c==="10"||c==="10"||c==="0-1"||c==="01"||c==="01"||c==="1/2-1/2"||c==="1/21/2"||c==="1/21/2"||c==="*")this.stack.length===1&&c!=="*"&&this.handleHeader("Result",c);else if(c==="(")this.consumeBudget(100),this.stack.push({parent:o.parent,root:!1});else if(c===")")this.stack.length>1&&this.stack.pop();else if(c==="{"){const l=r.lastIndex,p=n[l]===" "?l+1:l;n=n.slice(p),this.state=4;continue e}else this.consumeBudget(100),c.startsWith("O")||c.startsWith("0")||c.startsWith("o")?c=c.replace(/[0o]/g,"O").replace(/[]/g,"-"):(c==="Z0"||c==="0000"||c==="@@@@")&&(c="--"),o.node&&(o.parent=o.node),o.node=new of({san:c,startingComments:o.startingComments}),o.startingComments=void 0,o.root=!1,o.parent.children.push(o.node)}return}case 4:{const r=n.indexOf("}");if(r===-1){this.commentBuf.push(n);return}else{const s=r>0&&n[r-1]===" "?r-1:r;this.commentBuf.push(n.slice(0,s)),this.handleComment(),n=n.slice(r),this.state=3,e=!1}}}}handleHeader(e,n){this.game.headers.set(e,e==="Result"?uf(cf(n)):n)}handleNag(e){var n;this.consumeBudget(50);const r=this.stack[this.stack.length-1];r.node&&((n=r.node.data).nags||(n.nags=[]),r.node.data.nags.push(e))}handleComment(){var e,n;this.consumeBudget(100);const r=this.stack[this.stack.length-1],s=this.commentBuf.join(`
`);this.commentBuf=[],r.node?((e=r.node.data).comments||(e.comments=[]),r.node.data.comments.push(s)):r.root?((n=this.game).comments||(n.comments=[]),this.game.comments.push(s)):(r.startingComments||(r.startingComments=[]),r.startingComments.push(s))}emit(e){if(this.state===4&&this.handleComment(),e)return this.emitGame(this.game,e);this.found&&this.emitGame(this.game,void 0),this.resetGame()}}const hf=(t,e=zs)=>{const n=[];return new ff(r=>n.push(r),e,NaN).parse(t),n},vt=t=>t.split(" ").slice(0,-1).join(" "),Gs=t=>Qo.fromSetup(Jo(t).unwrap()).unwrap(),df=t=>Gs(t).turn;function to(t,e=Us){let n=Gs(e),r=Hs(n,t),s=Bs(r);n.play(r);let o=Vs(n.toSetup());return{path:`${s}`,ply:1,before_fen:e,fen:o,before_uci:void 0,uci:s,san:t}}function no(t,e){let n=Gs(t.fen),r=Hs(n,e),s=Bs(r);n.play(r);let o=Vs(n.toSetup()),c=`${t.path} ${s}`,l=t.ply+1,p=t.fen,y=t.uci;return{path:c,ply:l,before_fen:p,fen:o,before_uci:y,uci:s,san:e}}const Ud=["!!","!","!?","?!","?","??"],Vd=["brilliant","good","interesting","inaccuracy","mistake","blunder"];function Hd(t){switch(t){case"!":return 1;case"?":return 2;case"!!":return 3;case"??":return 4;case"!?":return 5;case"?!":return 6}return 0}function zd(t){switch(t){case 1:return"!";case 2:return"?";case 3:return"!!";case 4:return"??";case 5:return"!?";case 6:return"?!"}return""}function kt(){return Math.random().toString(16).slice(2,12)}async function ro(t,e){await t.studies.add(e)}async function pf(t,e){t.transaction("rw",[t.studies,t.sections],async()=>{let n=await _i(t,e.study_id);return n.section_ids.push(e.id),await mi(t,n),await t.sections.add(e)})}async function yf(t,e){await t.transaction("rw",[t.sections,t.chapters],async()=>{let n=await Wn(t,e.section_id);return n.chapter_ids.push(e.id),await gi(t,n),await t.chapters.add(e)})}async function eu(t,e){await t.steps_trees.add(e)}async function tu(t,e){await t.play_uci_tree_replays.add(e)}async function Ws(t,e){let n=await t.chapters.get(e);if(!n)throw new ot("Chapter",e);return n}async function Wn(t,e){let n=await t.sections.get(e);if(!n)throw new ot("Section",e);return n}async function _i(t,e){let n=await t.studies.get(e);if(!n)throw new ot("Study",e);return n}async function mi(t,e){await t.studies.update(e.id,e)}async function gi(t,e){await t.sections.update(e.id,e)}async function nu(t,e){await t.chapters.update(e.id,e)}async function _f(t,e){t.transaction("rw",[t.studies,t.sections,t.chapters,t.play_uci_tree_replays],async()=>{let n=await t.studies.where("id").equals(e).first();if(!n)throw new ot("Study",e);await t.studies.delete(e);let s=(await t.sections.where("study_id").equals(n.id).toArray()).map(o=>o.id);t.sections.bulkDelete(s),s.forEach(o=>ru(t,o))})}async function mf(t,e){t.transaction("rw",[t.studies,t.sections,t.chapters,t.play_uci_tree_replays],async()=>{let n=await Wn(t,e),r=await _i(t,n.study_id);r.section_ids.splice(r.section_ids.indexOf(e),1),await mi(t,r),await t.sections.delete(e),await ru(t,e)})}async function ru(t,e){let n=await t.chapters.where("section_id").equals(e).toArray(),r=n.map(s=>s.id);t.chapters.bulkDelete(r),await n.map(s=>Qs(t,s))}async function gf(t,e){t.transaction("rw",[t.play_uci_tree_replays,t.sections,t.chapters],async()=>{let n=await Ws(t,e),r=await Wn(t,n.section_id);r.chapter_ids.splice(r.chapter_ids.indexOf(e),1),await gi(t,r),await t.chapters.delete(e),await Qs(t,n)})}async function Qs(t,e){let n=await t.play_uci_tree_replays.where("id").equals(e.tree_replay_id).first();if(!n)throw new ot("TreeReplay",e.tree_replay_id);t.play_uci_tree_replays.delete(n.id)}async function wf(t,e){await t.play_uci_tree_replays.update(e.id,e)}async function vf(t,e){await t.tree_step_nodes.update(e.id,e)}async function bf(t,e){let n=await Wn(t,e),r=(await t.chapters.where("section_id").equals(e).toArray()).map(s=>({...s}));return n.chapter_ids.map(s=>r.find(o=>o.id===s))}async function kf(t,e){let n=await t.chapters.where("id").equals(e).first();if(!n)throw new ot("Chapter",e);return n}async function xf(t,e){let n=await t.play_uci_tree_replays.where("steps_tree_id").equals(e).first();if(!n)throw new ot("Play Uci Tree Replay",e);let r=await t.steps_trees.where("id").equals(n.steps_tree_id).first();if(!r)throw new ot("Steps Tree",e);return su(t,n,r)}async function Ef(t,e){let n=await Ws(t,e);return iu(t,n.tree_replay_id)}async function iu(t,e){let n=await t.play_uci_tree_replays.where("id").equals(e).first();if(!n)throw new ot("Play Uci Tree Replay",e);let r=await t.steps_trees.where("id").equals(n.steps_tree_id).first();if(!r)throw new ot("Steps Tree",e);return su(t,n,r)}async function su(t,e,n){let r=await t.tree_step_nodes.where("tree_id").equals(n.id).toArray(),s={};r.forEach(c=>{let l=s[vt(c.step.path)];l===void 0&&(l=[],s[vt(c.step.path)]=l),l.push({...c})});for(let c of Object.keys(s)){let l=await t.tree_step_node_order_for_paths.where("tree_id").equals(n.id).and(p=>p.path===c).first();l!==void 0&&(s[c]=l.order.map(p=>{let y=s[c].find(_=>_.id===p);if(!y)throw new br("Ordered Tree Step Node Not Found ",p);return y}))}let o={...n,flat_nodes:s};return{...e,steps_tree:o}}async function io(t,e){let n=await(e?t.studies.where("predicate").equals(e).toArray():t.studies.toArray());return Promise.all(n.map(r=>au(t,r.id,5)))}async function Af(t,e,n){let r=[];for(let s of e){let o=await t.chapters.where("section_id").equals(s.id);n&&(o=o.limit(n));let c=(await o.toArray()).map(l=>({...l}));c=s.chapter_ids.flatMap(l=>{let p=c.find(y=>y.id===l);if(!p){if(n===void 0)throw new br("Chapter ids dont contain chapter",l);return[]}return p}),r.push({id:s.id,...s,chapters:c})}return r}async function au(t,e,n){let r=await t.studies.get(e);if(!r)throw new ot("Study",e);let s=await t.sections.where("study_id").equals(r.id).toArray(),o=await Af(t,s,n),c=r.section_ids.map(l=>{let p=o.find(y=>y.id===l);if(!p)throw new br("Section not found in section_ids",l);return p});return{...r,sections:c}}async function Sf(t,e,n,r){let s=await _i(t,e),o=s.section_ids.indexOf(n);if(o===-1)throw new br("Section not found in study.section_ids ",n);s.section_ids.splice(o,1),s.section_ids.splice(r,0,n),await mi(t,s)}async function Of(t,e,n,r){let s=await Wn(t,e),o=s.chapter_ids.indexOf(n);if(o===-1)throw new br("Chapter not found in section.chapter_ids ",n);s.chapter_ids.splice(o,1),s.chapter_ids.splice(r,0,n),await gi(t,s)}async function Pf(t,e,n,r,s,o){let c={id:kt(),step:n,tree_id:e,nags:r,comments:s};return o&&await t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes],async()=>{await ou(t,[c]),await t.tree_step_nodes.add(c)}),c}async function Cf(t,e,n,r,s){let o=[];for(let c of Object.keys(n)){let l=n[c],p=[];for(let y of l)p.push({id:kt(),step:y,tree_id:e,nags:r[y.path],comments:s[y.path]});await ou(t,p),o.push(...p)}await t.tree_step_nodes.bulkAdd(o)}async function ou(t,e){let n=vt(e[0].step.path);const r=e[0].tree_id;let s=await t.tree_step_node_order_for_paths.where("tree_id").equals(r).and(o=>o.path===n).first();if(!s)await t.tree_step_node_order_for_paths.add({id:kt(),tree_id:e[0].tree_id,path:n,order:e.map(o=>o.id)});else{let o=[...s.order,...e.map(c=>c.id)];await t.tree_step_node_order_for_paths.update(s.id,{order:o})}}async function Rf(t,e){await t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes],async()=>{let n=await t.tree_step_nodes.where("id").anyOf(e).toArray();for(let r of n){const s=await t.tree_step_node_order_for_paths.where("tree_id").equals(r.tree_id).and(o=>o.path===vt(r.step.path)).first();s!==void 0&&(s.order.splice(s.order.indexOf(r.id),1),s.order.length===0?await t.tree_step_node_order_for_paths.delete(s.id):await t.tree_step_node_order_for_paths.update(s.id,{order:s.order}))}await t.tree_step_nodes.bulkDelete(e)})}async function Tf(t,e,n){let r=await t.chapters.where("section_id").anyOf(n).toArray(),s=await t.play_uci_tree_replays.where("id").anyOf(r.map(y=>y.tree_replay_id)).toArray(),o=await t.steps_trees.where("id").anyOf(s.map(y=>y.steps_tree_id)).toArray(),c=await t.tree_step_nodes.where("tree_id").anyOf(o.map(y=>y.id)).toArray(),l=await t.repeat_due_moves.where("study_id").equals(e).toArray(),p=[];for(let y of c){let _=l.find(g=>g.tree_step_node_id===y.id);if(_){let g=await uu(t,_.id,5);p.push({id:_.id,study_id:e,tree_step_node_id:y.id,tree_step_node:{...y},attempts:g,is_saved:!0})}else p.push({id:kt(),study_id:e,tree_step_node_id:y.id,tree_step_node:{...y},attempts:[],is_saved:!1})}return p}async function Nf(t,e){await t.repeat_move_attempts.add(e)}async function uu(t,e,n){let r=t.repeat_move_attempts.where("repeat_due_move_id").equals(e);n!==void 0&&(r=r.limit(n));let s=await r.toArray();if(!s)throw new ot("RepeatMoveAttempt",e);return s.sort((o,c)=>c.created_at-o.created_at)}async function Df(t,e){await t.repeat_due_moves.add(e)}async function $f(t,e,n){t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes,t.steps_trees,t.play_uci_tree_replays,t.chapters],async()=>{let r=await Ws(t,e);Qs(t,r);let s=cu(n);await eu(t,s);let o=lu(s.id);await tu(t,o),await nu(t,{id:r.id,tree_replay_id:o.id})})}function Mf(t){return{id:t,name:"New Study",is_edits_disabled:!0,predicate:"featured",section_ids:[]}}function jf(){return{id:kt(),name:"New Study",is_edits_disabled:!1,predicate:"mine",section_ids:[]}}function If(t,e="New Section",n){return{id:kt(),study_id:t,name:e,chapter_ids:[],orientation:n}}function Kf(t,e,n="New Chapter",r){return{id:kt(),tree_replay_id:e,section_id:t,name:n,orientation:r}}function cu(t){return{id:kt(),initial_fen:t}}function lu(t){return{id:kt(),steps_tree_id:t,cursor_path:"",solved_paths:[],error_paths:[]}}function Bf(t,e,n){return{id:kt(),repeat_due_move_id:t,created_at:Date.now(),card:e,attempt_result:n}}class Lf extends si{studies;sections;chapters;play_uci_tree_replays;steps_trees;tree_step_nodes;tree_step_node_order_for_paths;repeat_due_moves;repeat_move_attempts;remove_database(){this.delete()}constructor(){super("StudiesDB"),this.version(1).stores({studies:"id, predicate",sections:"id, study_id",chapters:"id, section_id, tree_replay_id",play_uci_tree_replays:"id, steps_tree_id",steps_trees:"id",tree_step_nodes:"id, tree_id",repeat_due_moves:"id, study_id, tree_step_node_id",repeat_move_attempts:"id, repeat_due_move_id, created_at",tree_step_node_order_for_paths:"id, tree_id, path"}),this.studies.mapToClass(Ff),this.sections.mapToClass(qf),this.chapters.mapToClass(Uf),this.play_uci_tree_replays.mapToClass(Vf),this.steps_trees.mapToClass(Hf),this.tree_step_nodes.mapToClass(zf),this.tree_step_node_order_for_paths.mapToClass(Gf),this.repeat_due_moves.mapToClass(Wf)}}class Ff extends Gt{id;name;is_edits_disabled;predicate;selected_section_id;section_ids;orientation}class qf extends Gt{id;study_id;name;selected_chapter_id;chapter_ids;orientation}class Uf extends Gt{id;section_id;tree_replay_id;name;orientation}class Vf extends Gt{id;steps_tree_id;cursor_path;solved_paths;error_paths;success_path;failed_path;hide_after_path}class Hf extends Gt{id;initial_fen}class zf extends Gt{id;tree_id;step;nags;comments}class Gf extends Gt{id;tree_id;path;order}class Wf extends Gt{id;study_id;tree_step_node_id}const fu=Tt(),Qf=t=>{let e=new Lf,n={async new_featured_study_just_once_or_undefined(r){if(await e.studies.get(r))return;let o=Mf(r);return await ro(e,o),{id:o.id,...o,sections:[]}},async new_study(){let r=jf();return await ro(e,r),{id:r.id,...r,sections:[]}},async new_section(r,s){let o=If(r,s);return await pf(e,o),{id:o.id,...o,chapters:[]}},async new_chapter(r,s,o){return e.transaction("rw",[e.tree_step_node_order_for_paths,e.tree_step_nodes,e.steps_trees,e.play_uci_tree_replays,e.studies,e.sections,e.chapters],async()=>{let c=await Wn(e,r),l=await _i(e,c.study_id),p=o?.orientation??c.orientation??l.orientation,y=cu();await eu(e,y),o&&await Cf(e,y.id,o.flat_steps,o.flat_nags,o.flat_comments);let _=lu(y.id);await tu(e,_);let g=Kf(r,_.id,s,p);return await yf(e,g),{id:g.id,...g}})},get_chapter_by_id(r){return kf(e,r)},get_chapters_by_section_id(r){return bf(e,r)},get_studies_by_predicate(r){return io(e,r)},get_studies(){return io(e)},get_study_by_id(r,s){return au(e,r,s)},update_study(r){return mi(e,r)},update_section(r){return gi(e,r)},update_chapter(r){return nu(e,r)},delete_chapter(r){return gf(e,r)},delete_section(r){return mf(e,r)},delete_study(r){return _f(e,r)},order_sections(r,s,o){return Sf(e,r,s,o)},order_chapters(r,s,o){return Of(e,r,s,o)},get_replay_tree_by_id(r){return iu(e,r)},get_replay_tree_by_chapter_id(r){return Ef(e,r)},get_replay_tree_by_steps_tree_id(r){return xf(e,r)},update_play_uci_tree_replay(r){return wf(e,r)},async new_tree_step_node(r,s,o,c,l){return await Pf(e,r,s,o,c,l)},update_tree_step_node(r){return vf(e,r)},async delete_tree_nodes(r){await Rf(e,r)},load_repeat_due_moves(r,s){return Tf(e,r,s)},async add_repeat_move_attempt(r,s,o){let c=Bf(r,s,o);return await Nf(e,c),{...c}},load_repeat_move_attempts(r){return uu(e,r)},new_due_move(r){return Df(e,r)},change_root_fen(r,s){return $f(e,r,s)}};return te(fu.Provider,{value:n,get children(){return t.children}})};class ot extends Error{constructor(e,n){super(`DB ${e}${n?" by id "+n:""} not found.`),this.entity=e,this.id=n}}class br extends Error{constructor(e,n){super(`DB ${e}${n?" by id "+n:""} .`),this.msg=e,this.id=n}}const lt=(t,e)=>t;function Yf(t){const e=lt(()=>t.get_studies_by_predicate("mine")),n=lt(()=>t.get_studies_by_predicate("auto")),r=lt(()=>t.get_studies_by_predicate("featured")),s=lt(()=>t.get_studies()),o=lt(c=>t.get_study_by_id(c));return{mine:e,auto:n,featured:r,all:s,get:o,create_featured_once:async c=>await t.new_featured_study_just_once_or_undefined(c),create:async()=>await t.new_study(),delete:async c=>{await t.delete_study(c)},create_section:async(c,l)=>await t.new_section(c,l),update:async c=>{await t.update_study(c)},update_section:async c=>{await t.update_section(c)},delete_section:async(c,l)=>{await t.delete_section(l)},order_sections:async(c,l,p)=>{await t.order_sections(c,l,p)}}}function Xf(t){const e=lt(r=>t.get_chapters_by_section_id(r)),n=lt(r=>t.get_chapter_by_id(r));return{by_section_id:e,get:n,create:async(r,s,o)=>await t.new_chapter(r,s,o),delete:async r=>{await t.delete_chapter(r)},update_chapter:async r=>{await t.update_chapter(r)},order_chapters:async(r,s,o)=>{await t.order_chapters(r,s,o)}}}function Jf(t){const e=lt(s=>t.get_replay_tree_by_steps_tree_id(s)),n=lt(s=>t.get_replay_tree_by_chapter_id(s)),r=lt(s=>t.get_replay_tree_by_id(s));return{by_steps_tree_id:e,by_chapter_id:n,by_id:r,create_node:async(s,o,c,l,p)=>await t.new_tree_step_node(s,o,c,l,p),update:async s=>{await t.update_play_uci_tree_replay(s)},update_tree_node:async s=>{await t.update_tree_step_node(s)},delete_tree_nodes:async s=>{await t.delete_tree_nodes(s)},change_root_fen:async(s,o)=>{await t.change_root_fen(s,o)}}}function Zf(t){return{by_study_id:lt((n,r)=>t.load_repeat_due_moves(n,r)),async save_due_move(n){return t.new_due_move({id:n.id,study_id:n.study_id,tree_step_node_id:n.tree_step_node_id})},async new_attempt(n,r,s){return t.add_repeat_move_attempt(n,s,r)}}}function eh(t){let e=bt(fu),n=Yf(e),r=Xf(e),s=Jf(e),o=Zf(e);return{Studies:n,Chapters:r,ReplayTree:s,DueMoves:o}}function so(t){return Vs(t.toSetup())}function th(t){return hf(t).map(e=>{let n=e.headers.get("Event"),r=e.headers.get("Site"),s=e.headers.get("White"),o=e.headers.get("Black"),c=e.headers.get("Chapter"),l=e.headers.get("Orientation"),p=e.headers.get("FEN"),y=p??Us,_=Qo.fromSetup(Jo(y).unwrap()).unwrap(),g={},C={},$={};e.moves.children.forEach(R=>{L(R,_,0,"")});function L(R,I,W,j){let B=R.data.san,U=Hs(I,B),Q=I.clone();Q.play(U);let ee=Bs(U),ce=R.data.nags,Ce=g[j];Ce||(Ce=[],g[j]=Ce);let je=j.length===0?ee:`${j} ${ee}`;Ce.push({path:je,ply:W+1,before_fen:so(I),fen:so(Q),uci:ee,san:B}),ce&&($[je]=ce),R.children.forEach(we=>{L(we,Q,W+1,je)})}return{event:n,site:r,white:s,black:o,chapter:c,fen:p,orientation:l,flat_steps:g,flat_nags:$,flat_comments:C}})}function nh(t,e,n,r){const[s,o]=Re(),l=di(async y=>{let _=s();if(_===void 0)return{};if(_[0]==="studies")return(await p(_[1])).reduce((L,R)=>(L[R.id]=R,L),{});let g=_[1],C=y[g];return C?y:(C=await t.Studies.get(g),{...y,[g]:C})},{initialValue:{}});function p(y){return y==="mine"?t.Studies.mine():y==="auto"?t.Studies.auto():y==="featured"?t.Studies.featured():t.Studies.all()}return Object.assign(e,{load_studies(y){o(["studies",y])},load_study(y){o(["study",y])},async create_featured_once(y){let _=await t.Studies.create_featured_once(y);if(_)return r("studies",{[_.id]:_}),_},async create_study(){let y=await t.Studies.create();return r("studies",{[y.id]:y}),y},async delete_study(y){const _=n.studies[y];r("studies",{[y]:void 0});try{await t.Studies.delete(y)}catch(g){throw r("studies",{[y]:_}),g}},async update_study(y){await t.Studies.update(y),r("studies",y.id,y)},async update_section(y,_){await t.Studies.update_section(_),ht(()=>{r("studies",y,"sections",g=>g.id===_.id,_)})},async create_section(y,_){const g=await t.Studies.create_section(y,_);return ht(()=>{r("studies",y,C=>({sections:[...C.sections,g]})),r("studies",y,"section_ids",C=>[...C,g.id])}),g},async delete_section(y,_){await t.Studies.delete_section(y,_),ht(()=>{r("studies",y,"section_ids",g=>g.filter(C=>C!==_)),r("studies",y,g=>({sections:g.sections.filter(C=>C.id!==_)}))})},async order_sections(y,_,g){await t.Studies.order_sections(y,_,g),r("studies",y,"section_ids",C=>{let $=C.indexOf(_);return C.splice($,1),C.splice(g,0,_),[...C]})},async study_as_export_pgn(y){let _="",g=await t.Studies.get(y);for(let C of g.section_ids){let $=g.sections.find(L=>L.id===C);for(let L of $.chapter_ids){let R=$.chapters.find(I=>I.id===L);_+=await e.chapter_as_export_pgn(g.name,$.name,R),_+=`

`}_+=`


`}return _},async import_from_pgn(y,_,g,C){let $=y.name,L={};e.update_study({id:y.id,is_edits_disabled:!0});for(let j of g){let B=j.event,[U,Q,ee]=B.split(":");ee||(ee=Q,Q=_),L[Q]===void 0&&(L[Q]=[]),L[Q].push([ee,j]),$=U}await e.update_study({id:y.id,name:$});let R=Object.keys(L)[0];C&&await e.update_section(y.id,{id:C.id,name:R});let I,W=C;for(R of Object.keys(L)){C||(C=await e.create_section(y.id,R));let j=L[R];console.log(L,j);for(let[B,U]of j)I=await e.create_chapter(y.id,C.id,B,U);W=C,C=void 0}W&&I&&(e.update_study({id:y.id,selected_section_id:W.id}),e.update_section(y.id,{id:W.id,selected_chapter_id:I.id}))},async populate_featured_studies_once(){await rh(t,e),e.load_studies("featured")}}),l}async function rh(t,e){let n={e4e5white1heroku:"/featured_pgns/lichess_study_1e4-e5-black-repertoire-introduction_by_heroku_2025.03.26.pgn",e4e5black1heroku:"/featured_pgns/lichess_study_1e4-white-repertoire-introduction_by_heroku_2025.03.26.pgn"},r=await t.Studies.featured(),s=Object.keys(n);r.filter(o=>!s.includes(o.id)).forEach(o=>e.delete_study(o.id)),await Promise.all(s.filter(o=>!r.find(c=>c.id===o)).map(async o=>{let c=await e.create_featured_once(o);if(c===void 0)return;let l=await fetch(n[o]).then(p=>p.text()).then(th);await e.import_from_pgn(c,"New Section",l)}))}function ih(t,e,n,r){const[s,o]=Re(),c=di(async l=>{let p=s();if(p===void 0)return{list:[]};if(p[0]==="sections"){let g=(await Promise.all(p[1].map(L=>t.Chapters.by_section_id(L)))).flat(),$=l.list.filter(L=>!g.find(R=>R.id===L.id));return{list:[...g,...$]}}if(p[0]==="chapters"){let g=await t.Chapters.by_section_id(p[1]),$=l.list.filter(L=>!g.find(R=>R.id===L.id));return{list:[...g,...$]}}let y=p[1];if(l.list.findIndex(g=>g.id===y)===-1){let g=await t.Chapters.get(y);return{list:[...l.list,g]}}return l},{initialValue:{list:[]}});return Object.assign(e,{load_chapters_for_sections(l){o(["sections",l])},load_chapters(l){o(["chapters",l])},load_chapter(l){o(["chapter",l])},async create_chapter(l,p,y,_){let g=await t.Chapters.create(p,y,_);return ht(()=>{r("chapters","list",n.chapters.list.length,g),r("studies",l,"sections",C=>C.id===g.section_id,"chapter_ids",C=>[...C,g.id])}),g},async update_chapter(l,p,y){await t.Chapters.update_chapter(y),r("chapters","list",_=>_.id===y.id,y)},async order_chapters(l,p,y,_){await t.Chapters.order_chapters(p,y,_),r("studies",l,"sections",g=>g.id===p,"chapter_ids",g=>{let C=g.indexOf(y);return g.splice(C,1),g.splice(_,0,y),[...g]})},async delete_chapter(l,p,y){await t.Chapters.delete(y),ht(()=>{r("chapters","list",_=>_.filter(g=>g.id!==y)),r("studies",l,"sections",_=>_.id===p,"chapter_ids",_=>_.filter(g=>g!==y))})}}),c}var sh=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),ah=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),oh=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function uh(t){if(!t)return"";let e="";for(const n in t){if(!oh.includes(n))continue;const r=t[n];e+=r instanceof Date?`; ${n}=${r.toUTCString()}`:typeof r=="boolean"?`; ${n}`:`; ${n}=${r}`}return e}function ch(t,e){return t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`)?.pop()??null}var ao;try{ao=sh("solid-start/server").useRequest}catch{ao=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var Pn=ah({_read:()=>document.cookie,_write:(t,e,n)=>{document.cookie=`${t}=${e}${uh(n)}`},getItem:(t,e)=>ch(Pn._read(e),t),setItem:(t,e,n)=>{Pn._write(t,e,n);{const s=Object.assign(new Event("storage"),{key:t,oldValue:null,newValue:e,url:globalThis.document.URL,storageArea:Pn});window.dispatchEvent(s)}},removeItem:(t,e)=>{Pn._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let n=null,r=0;return Pn._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(s,o)=>(!n&&o&&r++===t&&(n=o),"")),n},getLength:t=>{let e=0;return Pn._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,n=>(e+=n?1:0,"")),e},get length(){return this.getLength()}});function hu(t,e={}){const n=e.storage||globalThis.localStorage;if(!n)return t;const r=e.storageOptions,s=e.name||`storage-${_c()}`,o=e.serialize||JSON.stringify.bind(JSON),c=e.deserialize||JSON.parse.bind(JSON),l=n.getItem(s,r),p=typeof t[0]=="function"?_=>t[1](()=>c(_)):_=>t[1](bl(c(_)));let y=!0;return l instanceof Promise?l.then(_=>y&&_&&p(_)):l&&p(l),[t[0],typeof t[0]=="function"?_=>{const g=t[1](_);return _?n.setItem(s,o(g),r):n.removeItem(s,r),y=!1,g}:(..._)=>{t[1](..._);const g=o(De(()=>t[0]));n.setItem(s,g,r),y=!1}]}function lh(t){let e,n;return function(...r){const s=this,o=()=>{n=void 0,e=t.apply(s,r).finally(()=>{e=void 0,n&&n()})};e?n=o:o()}}function fh(t,e){return lh(function(...n){return e.apply(this,n),new Promise(r=>setTimeout(r,t))})}function hh(t,e,n){return hu(Re(t),{name:`.aidchess.v1.${e}`})}class dh{ctx=yh();sounds=new Map;paths=new Map;theme="standard";volumeStorage=hh("1","sound.volume");enabled=()=>this.theme!=="silent";resolvePath(e){return this.enabled()?`/sound/${this.theme}/${e[0].toUpperCase()+e.slice(1)}`:void 0}getVolume=()=>{const e=parseFloat(this.volumeStorage[0]());return e>=0?e:.7};async play(e,n=1){if(!this.enabled())return;const r=await this.load(e);r&&await r.play(this.getVolume()*n)}async load(e,n){if(!this.ctx||(n?this.paths.set(e,n):n=this.paths.get(e)??this.resolvePath(e),!n))return;if(this.sounds.has(n))return this.sounds.get(n);const r=await fetch(`${n}.mp3`);if(!r.ok)throw new Error(`${n}.mp3 failed ${r.status}`);const s=await r.arrayBuffer(),o=await new Promise((l,p)=>{this.ctx?.decodeAudioData.length===1?this.ctx?.decodeAudioData(s).then(l).catch(p):this.ctx?.decodeAudioData(s,l,p)}),c=new ph(this.ctx,o);return this.sounds.set(n,c),c}preloadBoardSounds(){for(const e of["move","capture","check","genericNotify"])this.load(e)}throttled=fh(200,e=>this.play(e));setVolume=e=>this.volumeStorage[1](e.toString());async move(e){e?.name?this.throttled(e.name):(e?.san?.includes("x")?this.throttled("capture"):this.throttled("move"),(e?.san?.includes("#")||e?.san?.includes("+"))&&this.throttled("check"))}}class ph{constructor(e,n){this.buffer=n,this.rewire(e)}node;ctx;play(e=1){this.node.gain.setValueAtTime(e,this.ctx.currentTime);const n=this.ctx.createBufferSource();return n.buffer=this.buffer,n.connect(this.node),new Promise(r=>{n.onended=()=>{n.disconnect(),r()},n.start(0)})}rewire(e){this.node?.disconnect(),this.ctx=e,this.node=this.ctx.createGain(),this.node.connect(this.ctx.destination)}}function yh(){return new AudioContext}const _h=Tt(new dh);function mh(){return bt(_h)}var gh=Xe('<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=replay-jump><button class="fbt first"data-icon=></button><button class="fbt prev"data-icon=></button><button class="fbt next"data-icon=></button><button class="fbt last"data-icon=>'),wh=Xe('<div class=branch-sums><button class="fbt up"data-icon=></button><button class="fbt down"data-icon=>'),du=Xe("<span class=index>"),vh=Xe("<div class=fbt>"),bh=Xe("<div class=lines>"),kh=Xe("<div class=line>"),xh=Xe("<span class=collapsed>..<!> "),Eh=Xe("<div class=context-menu><div class=title></div><div class=list>"),Ah=Xe("<div class=move>"),Sh=Xe("<span class=nag>");function pu(t,e){let n=wt(t,e);if(!n)throw new Kh(e);let r=xe(t,e);return[n,...r.flatMap(s=>pu(t,s.step.path))]}function Oh(t){return yu(t.steps_tree,t.cursor_path)}function Ph(t,e){return xe(t,vt(e))}function yu(t,e){let n=[],r=Nn(t),s=r.length>1;if(e==="")return r;for(let o of e.split(" ")){let c=r.find(p=>p.step.uci===o);if(!c)return;s&&(n.push(c),s=!1);let l=xe(t,c.step.path);l.length>1&&(s=!0),r=l}return n}function Nn(t){return xe(t,"")}function Cn(t,e){let n=wt(t,e);return n?[wt(t,vt(e)),n]:void 0}function wt(t,e){if(e==="")return;let n=vt(e);return t.flat_nodes[n].find(o=>o.step.path===e)}function xe(t,e){return t.flat_nodes[e]??[]}function Ch(t,e){let n=xe(t,e.step.path);if(n.length>1)return 1;if(n.length===0)return 0;let r=1,s=n[0];for(;xe(t,s.step.path).length===1;)r++,s=xe(t,s.step.path)[0];return r}function Rh(t,e){return Th(t,e)?.length??0}const Th=(t,e)=>{let n=_u(t,e);return n?xe(t,n.step.path):void 0},_u=(t,e)=>{let n=xe(t,e.step.path);if(n.length!==0)return n.length===1?_u(t,n[0]):e};function Gd(t,e){return mu(t,xe(t,""),!0,e)}function Nh(t){return ei(t,xe(t,""),!0)}function Ts(t,e=!1){let n=t.step.ply,r=n%2===1||e?Math.ceil(n/2)+(n%2===1?".":"..."):"",s=n%2===1?"":" ";return`${r} ${t.step.san}${t.comments?" { "+t.comments+" }":""}${s}`}function ei(t,e,n=!1){let r="";return e.length===0||(e.length===1?(r+=Ts(e[0],n),r+=ei(t,xe(t,e[0].step.path),!1)):(r+=Ts(e[0],!1).trimEnd(),r+=" "+e.slice(1).map(s=>`(${ei(t,[s],!0).trimEnd()})`).join(" "),r+=" "+ei(t,xe(t,e[0].step.path),!0))),r}function mu(t,e,n=!1,r){let s="",o=e.find(c=>r.startsWith(c.step.path));return o&&(s+=Ts(o,n),s+=mu(t,xe(t,o.step.path),!1,r)),s}function Dh(t,e,n,r){let s="";return s+=`[Event] ${t}: ${e}: ${n.name}
`,s+=`[StudyName] ${t}
`,s+=`[ChapterName] ${n.name}
`,s+=`
`,s+=Nh(r),s}function $h(t){const e=ne(()=>t.replay_tree.cursor_path),n=ne(()=>t.replay_tree.hide_after_path),r=ne(()=>t.replay_tree.solved_paths),s=ne(()=>t.replay_tree.error_paths),o=ne(()=>t.replay_tree.success_path),c=ne(()=>t.replay_tree.failed_path),l=ne(()=>t.replay_tree.steps_tree),p=ne(()=>wt(l(),"")?.step.fen??l().initial_fen??Us),y=ne(()=>wt(l(),e())?.step.fen??p()),_=ne(()=>{let B=wt(l(),e())?.step;if(B)return[B.uci,B.san]});let g=[];fi(gr(e,B=>{yu(l(),B)?.map(U=>{if(!g.includes(U.step.path)){if(Ph(l(),U.step.path)?.forEach(Q=>{g=g.filter(ee=>ee!==Q.step.path)}),t.replay_tree.error_paths.includes(U.step.path)||t.replay_tree.failed_path===U.step.path)return;g.push(U.step.path)}})}));const C=ne(()=>{let B=e();if(B!=="")return B.split(" ").slice(0,-1).join(" ")}),$=ne(()=>{let B=e(),U=xe(l(),B);return U.length===1?U[0].step.path:U.find(Q=>g.includes(Q.step.path))?.step.path??U[0]?.step.path}),L=ne(()=>{let B=Cn(l(),e());if(!B)return;let U=B;if(!U[0])return"";if(xe(l(),U[0].step.path).length>1)return U[0].step.path;for(;!(!U[0]||xe(l(),U[0].step.path).length>1);){let Q=Cn(l(),U[0].step.path);if(!Q)break;U=Q}return U[1].step.path}),R=ne(()=>{let B=wt(l(),e());if(!B){let ee=Nn(l());return(ee.find(ce=>g.includes(ce.step.path))??ee[0])?.step.path}let U=B,Q=xe(l(),U.step.path);if(Q.length>1)return Q.find(ee=>g.includes(ee.step.path))?.step.path??Q[0]?.step.path;for(;Q.length===1;)U=Q[0],Q=xe(l(),U.step.path);return U.step.path}),I=ne(()=>{let B=Cn(l(),e());if(!B)return;let U=B[0]?xe(l(),B[0].step.path):[];if(!B[0])U=Nn(l());else if(xe(l(),B[0].step.path).length===1)for(;;){if(B=Cn(l(),B[0].step.path),!B)return;if(!B[0]){U=Nn(l());break}if(xe(l(),B[0].step.path).length>1){U=xe(l(),B[0].step.path);break}}let Q=U.indexOf(B[1]),ee=U[Q-1];if(ee)return ee.step.path}),W=ne(()=>{let B=Cn(l(),e());if(!B)return;let U=B[0]?xe(l(),B[0].step.path):[];if(!B[0])U=Nn(l());else if(xe(l(),B[0].step.path).length===1)for(;;){if(B=Cn(l(),B[0].step.path),!B)return;if(!B[0]){U=Nn(l());break}if(xe(l(),B[0].step.path).length>1){U=xe(l(),B[0].step.path);break}}let Q=U.indexOf(B[1]),ee=U[Q+1];if(ee)return ee.step.path}),j=ne(()=>wt(t.replay_tree.steps_tree,e()));return{get initial_fen(){return p()},get fen(){return y()},get turn(){return df(y())},get last_move(){return _()},get step_at_cursor_path(){return j()},get cursor_path(){return e()},get hide_after_path(){return n()},get solved_paths(){return r()},get error_paths(){return s()},get success_path(){return o()},get failed_path(){return c()},get get_prev_path(){return C()},get get_next_path(){return $()},get get_first_path(){return L()},get get_last_path(){return R()},get get_down_path(){return W()},get get_up_path(){return I()}}}const Wd=t=>{const e=mh();e.setVolume(.2),fi(gr(()=>t.step_at_cursor_path,(n,r)=>{n&&(!r||r.step.ply===n.step.ply-1)&&e.move(n.step)}))},Qd=t=>{let e=$h(t);const n=_=>{t.handle_goto_path(_)},r=_=>{t.handle_goto_path(_)},s=_=>{n(_)},o=(_,g)=>{t.on_context_menu?.(_,g)};let c;fi(()=>{let _=t.replay_tree.cursor_path,g=c.parentElement;if(!g)return;const C=c.querySelector(".on-path-end");if(!C){g.scrollTop=_.length>0?99999:0;return}let $=C.offsetTop-g.offsetHeight/2+C.offsetHeight;g.scrollTo({behavior:"smooth",top:$})});const l=_=>{if(t.lose_focus)return;let g=!1;_.key==="ArrowLeft"&&(r(e.get_prev_path),g=!0),_.key==="ArrowRight"&&(r(e.get_next_path),g=!0),_.key==="ArrowUp"&&(r(e.get_up_path),g=!0),_.key==="ArrowDown"&&(r(e.get_down_path),g=!0),g&&_.preventDefault()};rc(()=>{document.addEventListener("keydown",l),Vt(()=>{document.removeEventListener("keydown",l)})});const p=Fn(()=>t.features),y=Fn(()=>t.feature_content);return(()=>{var _=gh(),g=_.firstChild,C=g.firstChild,$=g.nextSibling,L=$.firstChild,R=L.nextSibling,I=R.nextSibling,W=I.nextSibling;return js(j=>c=j,C),ve(C,te(Ns,Ct({get replay_tree(){return t.replay_tree}},e,{on_set_cursor:s,on_context_menu:o,path:""}))),ve(_,te(dt,{get when(){return y()},get fallback(){return(()=>{var j=wh(),B=j.firstChild,U=B.nextSibling;return B.$$click=()=>r(e.get_up_path),U.$$click=()=>r(e.get_down_path),ve(j,te(Po,{get each(){return Oh(t.replay_tree)},children:Q=>(()=>{var ee=vh();return ee.$$click=()=>n(Q.step.path),ve(ee,te(dt,{get when(){return Q.step.ply&1},get children(){var ce=du();return ve(ce,()=>Ys(Q.step.ply)),ce}}),null),ve(ee,()=>Q.step.san,null),ee})()}),null),nt(Q=>{var ee=e.get_up_path===void 0,ce=e.get_up_path===void 0,Ce=e.get_down_path===void 0,je=e.get_down_path===void 0;return ee!==Q.e&&(B.disabled=Q.e=ee),ce!==Q.t&&B.classList.toggle("disabled",Q.t=ce),Ce!==Q.a&&(U.disabled=Q.a=Ce),je!==Q.o&&U.classList.toggle("disabled",Q.o=je),Q},{e:void 0,t:void 0,a:void 0,o:void 0}),j})()},children:j=>j()}),$),ve($,te(dt,{get when(){return p()},children:j=>j()}),L),L.$$click=()=>r(e.get_first_path),R.$$click=()=>r(e.get_prev_path),I.$$click=()=>r(e.get_next_path),W.$$click=()=>r(e.get_last_path),nt(j=>{var B=e.get_first_path===void 0,U=e.get_first_path===void 0,Q=e.get_prev_path===void 0,ee=e.get_prev_path===void 0,ce=e.get_next_path===void 0,Ce=e.get_next_path===void 0,je=e.get_last_path===void 0,we=e.get_last_path===void 0;return B!==j.e&&(L.disabled=j.e=B),U!==j.t&&L.classList.toggle("disabled",j.t=U),Q!==j.a&&(R.disabled=j.a=Q),ee!==j.o&&R.classList.toggle("disabled",j.o=ee),ce!==j.i&&(I.disabled=j.i=ce),Ce!==j.n&&I.classList.toggle("disabled",j.n=Ce),je!==j.s&&(W.disabled=j.s=je),we!==j.h&&W.classList.toggle("disabled",j.h=we),j},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),_})()};function Ns(t){const e=ne(()=>t.replay_tree.steps_tree.flat_nodes[t.path]??[]);return[te(dt,{get when(){return e().length===1},get children(){return[te(cs,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},get node(){return e()[0]}})),te(Ns,Ct(t,{get path(){return e()[0].step.path}}))]}}),te(dt,{get when(){return e().length>1},get children(){var n=bh();return ve(n,te(Po,{get each(){return e()},children:r=>(()=>{var s=kh();return ve(s,te(dt,{get when(){return t.replay_tree.cursor_path.startsWith(r.step.path)},get fallback(){return[te(cs,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},node:r,show_index:!0,collapsed:!0})),te(Mh,{node:r,get replay_tree(){return t.replay_tree}})]},get children(){return[te(cs,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},node:r,show_index:!0})),te(Ns,Ct(t,{get path(){return r.step.path}}))]}})),s})()})),n}})]}function Mh(t){return(()=>{var e=xh(),n=e.firstChild,r=n.nextSibling;return r.nextSibling,ve(e,()=>Ch(t.replay_tree.steps_tree,t.node),r),ve(e,()=>Rh(t.replay_tree.steps_tree,t.node),null),e})()}function Yd(t){return(()=>{var e=Eh(),n=e.firstChild,r=n.nextSibling,s=t.ref;return typeof s=="function"?js(s,e):t.ref=e,e.$$click=o=>{o.preventDefault(),o.stopImmediatePropagation()},ve(n,()=>Ys(t.step.ply),null),ve(n,()=>t.step.san,null),ve(r,()=>t.children),e})()}function cs(t){const e=ne(()=>t.node.step);let n=ne(()=>e().ply%2===1||t.show_index);const r=ne(()=>e().path),s=ne(()=>t.cursor_path.startsWith(r())),o=ne(()=>r()===t.cursor_path),c=ne(()=>t.hide_after_path!==void 0&&r()!==t.hide_after_path&&r().startsWith(t.hide_after_path)),l=ne(()=>t.failed_path===r()),p=ne(()=>t.success_path===r()),y=ne(()=>t.solved_paths.includes(r())),_=ne(()=>t.error_paths.includes(r())),g=ne(()=>({collapsed:t.collapsed,"on-path":s(),"on-path-end":o(),hidden:c(),failed:l(),success:p(),"in-solved":y(),"in-error":_(),[jh[t.node.nags?.[0]??0]]:t.node.nags!==void 0}));return(()=>{var C=Ah();return C.$$click=()=>{t.on_set_cursor(e().path)},C.$$contextmenu=$=>{$.preventDefault(),t.on_context_menu($,e().path)},ve(C,te(dt,{get when(){return n()},get children(){var $=du();return ve($,()=>Ys(e().ply)),$}}),null),ve(C,()=>e().san,null),ve(C,te(dt,{get when(){return t.node.nags},children:$=>te(Ih,{get nags(){return $()}})}),null),nt($=>Ro(C,g(),$)),C})()}let gu=["","!","?","!!","??","!?","?!"];gu[22]="";let jh=["","good","mistake","top","blunder","interesting","inaccuracy"];const Ih=t=>[" ",(()=>{var e=Sh();return ve(e,()=>gu[t.nags[0]]),e})()," "],Ys=t=>`${Math.ceil(t/2)}.`+(t%2===0?"..":"");class Kh extends Error{constructor(e){super(e)}}Ms(["click","contextmenu"]);function Bh(t,e,n,r){const[s,o]=Re(!0),[c,l]=Re(void 0,{equals:!1}),p=()=>({id:"",steps_tree_id:"",cursor_path:"",solved_paths:[],error_paths:[],success_path:void 0,failed_path:void 0,hide_after_path:void 0,steps_tree:{id:"",flat_nodes:{}}}),y=di(async()=>{let R=c();if(!R)return p();if(Array.isArray(R)){if(R[0]==="by_id")return R[1]===""?p():t.ReplayTree.by_id(R[1]).then(I=>(R[2]!==void 0&&(I.cursor_path=R[2]),I));if(R[0]==="by_steps_id")return t.ReplayTree.by_steps_tree_id(R[1]);{let I=R[1];return t.ReplayTree.by_steps_tree_id(I.tree_step_node.tree_id).then(W=>(W.cursor_path=vt(I.tree_step_node.step.path),W.hide_after_path="",W))}}return t.ReplayTree.by_chapter_id(R)},{initialValue:p()}),_=R=>{let I=n.replay_tree.hide_after_path;I!==void 0&&R!==I&&R.startsWith(I)||g(R)},g=R=>{s()&&t.ReplayTree.update({id:n.replay_tree.id,cursor_path:R}),r("replay_tree","cursor_path",R)};return Object.assign(e,{set_write_enabled_replay_tree(R){o(R)},reload_replay_tree_with_cursor_path(R){l(["by_id",n.replay_tree.id,R])},reset_replay_tree(){l(void 0)},load_replay_tree(R){l(R)},load_replay_tree_by_id(R,I){l(["by_id",R,I])},load_replay_tree_by_due_move(R){ht(()=>{l(["by_due_move",R]),o(!1)})},set_success_path:R=>{r("replay_tree","success_path",R)},set_failed_path:R=>{r("replay_tree","failed_path",R)},set_hide_after_path:R=>{r("replay_tree","hide_after_path",R)},goto_path_force:g,goto_path:_,goto_path_if_can(R){R!==void 0&&_(R)},delete_at_and_after_path(R){let I=vt(R),W=pu(n.replay_tree.steps_tree,R);s()&&t.ReplayTree.delete_tree_nodes(W.map(j=>j.id)),ht(()=>{r("replay_tree","steps_tree","flat_nodes",I,j=>j.filter(B=>B.step.path!==R)),W.forEach(j=>{r("replay_tree","steps_tree","flat_nodes",j.step.path,void 0)})}),_(I)},async tree_step_node_set_nags(R,I){let W=vt(R.step.path),j={id:R.id,nags:I};s()&&await t.ReplayTree.update_tree_node(j);let B=n.replay_tree.steps_tree.flat_nodes[W];r("replay_tree","steps_tree","flat_nodes",W,B.indexOf(R),"nags",I)},async add_child_san_to_current_path(R){let I=n.replay_tree.cursor_path,j=xe(n.replay_tree.steps_tree,I).find(Ce=>Ce.step.san===R);if(j)return j;let B=n.replay_tree.steps_tree.initial_fen,U=wt(n.replay_tree.steps_tree,I),Q=U?no(U.step,R):to(R,B),ee=await t.ReplayTree.create_node(n.replay_tree.steps_tree_id,Q,void 0,void 0,s());return n.replay_tree.steps_tree.flat_nodes[I]?r("replay_tree","steps_tree","flat_nodes",I,Ce=>[...Ce,ee]):r("replay_tree","steps_tree","flat_nodes",I,[ee]),ee},async add_child_san_to_success_or_error_path_no_save(R){let I=n.replay_tree.cursor_path,j=xe(n.replay_tree.steps_tree,I).find(ce=>ce.step.san===R);if(j)return n.replay_tree.error_paths.includes(j.step.path)?["error",j]:(r("replay_tree","solved_paths",ce=>[j.step.path,...ce]),["success",j]);let B=wt(n.replay_tree.steps_tree,I),U=B?no(B.step,R):to(R,n.replay_tree.steps_tree.initial_fen),Q=await t.ReplayTree.create_node(n.replay_tree.steps_tree_id,U,void 0,void 0,!1),ee=n.replay_tree.steps_tree.flat_nodes[I];return ht(()=>{ee?r("replay_tree","steps_tree","flat_nodes",I,ce=>[...ce,Q]):r("replay_tree","steps_tree","flat_nodes",I,[Q]),r("replay_tree","error_paths",ce=>[Q.step.path,...ce])}),["error",Q]},async chapter_as_export_pgn(R,I,W){let j=await t.ReplayTree.by_chapter_id(W.id);return Dh(R,I,W,j.steps_tree)},async change_root_fen(R,I){await t.ReplayTree.change_root_fen(R,I),console.log("here"),ht(()=>{l(void 0),l(R)})}}),y}var _e=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(_e||{}),X=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(X||{});class he{static card(e){return{...e,state:he.state(e.state),due:he.time(e.due),last_review:e.last_review?he.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),r=e.slice(1).toLowerCase(),s=X[`${n}${r}`];if(s===void 0)throw new Error(`Invalid rating:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),r=e.slice(1).toLowerCase(),s=_e[`${n}${r}`];if(s===void 0)throw new Error(`Invalid state:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){const n=Date.parse(e);if(isNaN(n))throw new Error(`Invalid date:[${e}]`);return new Date(n)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:he.time(e.due),rating:he.rating(e.rating),state:he.state(e.state),review:he.time(e.review)}}}Date.prototype.scheduler=function(t,e){return Lh(this,t,e)},Date.prototype.diff=function(t,e){return Fh(this,t,e)},Date.prototype.format=function(){return qh(this)},Date.prototype.dueFormat=function(t,e,n){return Uh(this,t,e,n)};function Lh(t,e,n){return new Date(n?yn(t).getTime()+e*24*60*60*1e3:yn(t).getTime()+e*60*1e3)}function Fh(t,e,n){if(!t||!e)throw new Error("Invalid date");const r=yn(t).getTime()-yn(e).getTime();let s=0;switch(n){case"days":s=Math.floor(r/(24*60*60*1e3));break;case"minutes":s=Math.floor(r/(60*1e3));break}return s}function qh(t){const e=yn(t),n=e.getFullYear(),r=e.getMonth()+1,s=e.getDate(),o=e.getHours(),c=e.getMinutes(),l=e.getSeconds();return`${n}-${cr(r)}-${cr(s)} ${cr(o)}:${cr(c)}:${cr(l)}`}function cr(t){return t<10?`0${t}`:`${t}`}const ls=[60,60,24,31,12],fs=["second","min","hour","day","month","year"];function Uh(t,e,n,r=fs){t=yn(t),e=yn(e),r.length!==fs.length&&(r=fs);let s=t.getTime()-e.getTime(),o;for(s/=1e3,o=0;o<ls.length&&!(s<ls[o]);o++)s/=ls[o];return`${Math.floor(s)}${n?r[o]:""}`}function yn(t){return he.time(t)}const Vh=[X.Again,X.Hard,X.Good,X.Easy],Hh=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function zh(t,e,n){let r=1;for(const c of Hh)r+=c.factor*Math.max(Math.min(t,c.end)-c.start,0);t=Math.min(t,n);let s=Math.max(2,Math.round(t-r));const o=Math.min(Math.round(t+r),n);return t>e&&(s=Math.max(s,e+1)),s=Math.min(s,o),{min_ivl:s,max_ivl:o}}function cn(t,e,n){return Math.min(Math.max(t,e),n)}function Gh(t,e){const n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),r=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((r-n)/864e5)}const Wh=.9,Qh=36500,Yh=[.40255,1.18385,3.173,15.69105,7.1949,.5345,1.4604,.0046,1.54575,.1192,1.01925,1.9395,.11,.29605,2.2698,.2315,2.9898,.51655,.6621],Xh=!1,Jh=!0,ft=.01,Xr=100,oo=[[ft,Xr],[ft,Xr],[ft,Xr],[ft,Xr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,2],[0,2]],uo=t=>{let e=Yh;return t?.w&&(t.w.length===19?e=t?.w:t.w.length===17&&(e=t?.w.concat([0,0]),e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS V5]auto fill w to 19 length"))),e=e.map((n,r)=>cn(n,oo[r][0],oo[r][1])),{request_retention:t?.request_retention||Wh,maximum_interval:t?.maximum_interval||Qh,w:e,enable_fuzz:t?.enable_fuzz??Xh,enable_short_term:t?.enable_short_term??Jh}};function ci(t,e){return{due:t?he.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:_e.New,last_review:void 0}}class Zh{c;s0;s1;s2;constructor(e){const n=ed();this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),e==null&&(e=+new Date),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function ed(){let t=4022871197;return function(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=r*4294967296}return(t>>>0)*23283064365386963e-26}}function td(t){const e=new Zh(t),n=()=>e.next();return n.int32=()=>e.next()*4294967296|0,n.double=()=>n()+(n()*2097152|0)*11102230246251565e-32,n.state=()=>e.state,n.importState=r=>(e.state=r,n),n}const co=-.5,lo=19/81;class nd{param;intervalModifier;_seed;constructor(e){this.param=new Proxy(uo(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(e,1/co)-1)/lo).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){const e=this;return{set:function(n,r,s){return r==="request_retention"&&Number.isFinite(s)&&(e.intervalModifier=e.calculate_interval_modifier(Number(s))),Reflect.set(n,r,s),!0}}}update_parameters(e){const n=uo(e);for(const r in n)if(r in this.param){const s=r;this.param[s]=n[s]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return this.constrain_difficulty(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1)}apply_fuzz(e,n){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);const r=td(this._seed)(),{min_ivl:s,max_ivl:o}=zh(e,n,this.param.maximum_interval);return Math.floor(r*(o-s+1)+s)}next_interval(e,n){const r=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(r,n)}linear_damping(e,n){return+(e*(10-n)/9).toFixed(8)}next_difficulty(e,n){const r=-this.param.w[6]*(n-3),s=e+this.linear_damping(r,e);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(X.Easy),s))}constrain_difficulty(e){return Math.min(Math.max(+e.toFixed(8),1),10)}mean_reversion(e,n){return+(this.param.w[7]*e+(1-this.param.w[7])*n).toFixed(8)}next_recall_stability(e,n,r,s){const o=X.Hard===s?this.param.w[15]:1,c=X.Easy===s?this.param.w[16]:1;return+cn(n*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(n,-this.param.w[9])*(Math.exp((1-r)*this.param.w[10])-1)*o*c),ft,36500).toFixed(8)}next_forget_stability(e,n,r){return+cn(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(n+1,this.param.w[13])-1)*Math.exp((1-r)*this.param.w[14]),ft,36500).toFixed(8)}next_short_term_stability(e,n){return+cn(e*Math.exp(this.param.w[17]*(n-3+this.param.w[18])),ft,36500).toFixed(8)}forgetting_curve(e,n){return+Math.pow(1+lo*e/n,co).toFixed(8)}next_state(e,n,r){const{difficulty:s,stability:o}=e??{difficulty:0,stability:0};if(n<0)throw new Error(`Invalid delta_t "${n}"`);if(r<0||r>4)throw new Error(`Invalid grade "${r}"`);if(s===0&&o===0)return{difficulty:this.init_difficulty(r),stability:this.init_stability(r)};if(r===0)return{difficulty:s,stability:o};if(s<1||o<ft)throw new Error(`Invalid memory state { difficulty: ${s}, stability: ${o} }`);const c=this.forgetting_curve(n,o),l=this.next_recall_stability(s,o,c,r),p=this.next_forget_stability(s,o,c),y=this.next_short_term_stability(o,r);let _=l;if(r===1){let[g,C]=[0,0];this.param.enable_short_term&&(g=this.param.w[17],C=this.param.w[18]);const $=o/Math.exp(g*C);_=cn(+$.toFixed(8),ft,p)}return n===0&&this.param.enable_short_term&&(_=y),{difficulty:this.next_difficulty(s,r),stability:_}}}function wu(){const t=this.review_time.getTime(),e=this.current.reps,n=this.current.difficulty*this.current.stability;return`${t}_${e}_${n}`}var Ds=(t=>(t.SCHEDULER="Scheduler",t.SEED="Seed",t))(Ds||{});class vu{last;current;review_time;next=new Map;algorithm;initSeedStrategy;constructor(e,n,r,s={seed:wu}){this.algorithm=r,this.initSeedStrategy=s.seed.bind(this),this.last=he.card(e),this.current=he.card(e),this.review_time=he.time(n),this.init()}init(){const{state:e,last_review:n}=this.current;let r=0;e!==_e.New&&n&&(r=Gh(n,this.review_time)),this.current.last_review=this.review_time,this.current.elapsed_days=r,this.current.reps+=1,this.algorithm.seed=this.initSeedStrategy()}preview(){return{[X.Again]:this.review(X.Again),[X.Hard]:this.review(X.Hard),[X.Good]:this.review(X.Good),[X.Easy]:this.review(X.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const e of Vh)yield this.review(e)}review(e){const{state:n}=this.last;let r;switch(n){case _e.New:r=this.newState(e);break;case _e.Learning:case _e.Relearning:r=this.learningState(e);break;case _e.Review:r=this.reviewState(e);break}if(r)return r;throw new Error("Invalid grade")}buildLog(e){const{last_review:n,due:r,elapsed_days:s}=this.last;return{rating:e,state:this.current.state,due:n||r,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:s,scheduled_days:this.current.scheduled_days,review:this.review_time}}}class fo extends vu{newState(e){const n=this.next.get(e);if(n)return n;const r=he.card(this.current);switch(r.difficulty=this.algorithm.init_difficulty(e),r.stability=this.algorithm.init_stability(e),e){case X.Again:r.scheduled_days=0,r.due=this.review_time.scheduler(1),r.state=_e.Learning;break;case X.Hard:r.scheduled_days=0,r.due=this.review_time.scheduler(5),r.state=_e.Learning;break;case X.Good:r.scheduled_days=0,r.due=this.review_time.scheduler(10),r.state=_e.Learning;break;case X.Easy:{const o=this.algorithm.next_interval(r.stability,this.current.elapsed_days);r.scheduled_days=o,r.due=this.review_time.scheduler(o,!0),r.state=_e.Review;break}default:throw new Error("Invalid grade")}const s={card:r,log:this.buildLog(e)};return this.next.set(e,s),s}learningState(e){const n=this.next.get(e);if(n)return n;const{state:r,difficulty:s,stability:o}=this.last,c=he.card(this.current),l=this.current.elapsed_days;switch(c.difficulty=this.algorithm.next_difficulty(s,e),c.stability=this.algorithm.next_short_term_stability(o,e),e){case X.Again:{c.scheduled_days=0,c.due=this.review_time.scheduler(5,!1),c.state=r;break}case X.Hard:{c.scheduled_days=0,c.due=this.review_time.scheduler(10),c.state=r;break}case X.Good:{const y=this.algorithm.next_interval(c.stability,l);c.scheduled_days=y,c.due=this.review_time.scheduler(y,!0),c.state=_e.Review;break}case X.Easy:{const y=this.algorithm.next_short_term_stability(o,X.Good),_=this.algorithm.next_interval(y,l),g=Math.max(this.algorithm.next_interval(c.stability,l),_+1);c.scheduled_days=g,c.due=this.review_time.scheduler(g,!0),c.state=_e.Review;break}default:throw new Error("Invalid grade")}const p={card:c,log:this.buildLog(e)};return this.next.set(e,p),p}reviewState(e){const n=this.next.get(e);if(n)return n;const r=this.current.elapsed_days,{difficulty:s,stability:o}=this.last,c=this.algorithm.forgetting_curve(r,o),l=he.card(this.current),p=he.card(this.current),y=he.card(this.current),_=he.card(this.current);this.next_ds(l,p,y,_,s,o,c),this.next_interval(l,p,y,_,r),this.next_state(l,p,y,_),l.lapses+=1;const g={card:l,log:this.buildLog(X.Again)},C={card:p,log:super.buildLog(X.Hard)},$={card:y,log:super.buildLog(X.Good)},L={card:_,log:super.buildLog(X.Easy)};return this.next.set(X.Again,g),this.next.set(X.Hard,C),this.next.set(X.Good,$),this.next.set(X.Easy,L),this.next.get(e)}next_ds(e,n,r,s,o,c,l){e.difficulty=this.algorithm.next_difficulty(o,X.Again);const p=c/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),y=this.algorithm.next_forget_stability(o,c,l);e.stability=cn(+p.toFixed(8),ft,y),n.difficulty=this.algorithm.next_difficulty(o,X.Hard),n.stability=this.algorithm.next_recall_stability(o,c,l,X.Hard),r.difficulty=this.algorithm.next_difficulty(o,X.Good),r.stability=this.algorithm.next_recall_stability(o,c,l,X.Good),s.difficulty=this.algorithm.next_difficulty(o,X.Easy),s.stability=this.algorithm.next_recall_stability(o,c,l,X.Easy)}next_interval(e,n,r,s,o){let c,l;c=this.algorithm.next_interval(n.stability,o),l=this.algorithm.next_interval(r.stability,o),c=Math.min(c,l),l=Math.max(l,c+1);const p=Math.max(this.algorithm.next_interval(s.stability,o),l+1);e.scheduled_days=0,e.due=this.review_time.scheduler(5),n.scheduled_days=c,n.due=this.review_time.scheduler(c,!0),r.scheduled_days=l,r.due=this.review_time.scheduler(l,!0),s.scheduled_days=p,s.due=this.review_time.scheduler(p,!0)}next_state(e,n,r,s){e.state=_e.Relearning,n.state=_e.Review,r.state=_e.Review,s.state=_e.Review}}class ho extends vu{newState(e){const n=this.next.get(e);if(n)return n;this.current.scheduled_days=0,this.current.elapsed_days=0;const r=he.card(this.current),s=he.card(this.current),o=he.card(this.current),c=he.card(this.current);return this.init_ds(r,s,o,c),this.next_interval(r,s,o,c,0),this.next_state(r,s,o,c),this.update_next(r,s,o,c),this.next.get(e)}init_ds(e,n,r,s){e.difficulty=this.algorithm.init_difficulty(X.Again),e.stability=this.algorithm.init_stability(X.Again),n.difficulty=this.algorithm.init_difficulty(X.Hard),n.stability=this.algorithm.init_stability(X.Hard),r.difficulty=this.algorithm.init_difficulty(X.Good),r.stability=this.algorithm.init_stability(X.Good),s.difficulty=this.algorithm.init_difficulty(X.Easy),s.stability=this.algorithm.init_stability(X.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){const n=this.next.get(e);if(n)return n;const r=this.current.elapsed_days,{difficulty:s,stability:o}=this.last,c=this.algorithm.forgetting_curve(r,o),l=he.card(this.current),p=he.card(this.current),y=he.card(this.current),_=he.card(this.current);return this.next_ds(l,p,y,_,s,o,c),this.next_interval(l,p,y,_,r),this.next_state(l,p,y,_),l.lapses+=1,this.update_next(l,p,y,_),this.next.get(e)}next_ds(e,n,r,s,o,c,l){e.difficulty=this.algorithm.next_difficulty(o,X.Again);const p=this.algorithm.next_forget_stability(o,c,l);e.stability=cn(c,ft,p),n.difficulty=this.algorithm.next_difficulty(o,X.Hard),n.stability=this.algorithm.next_recall_stability(o,c,l,X.Hard),r.difficulty=this.algorithm.next_difficulty(o,X.Good),r.stability=this.algorithm.next_recall_stability(o,c,l,X.Good),s.difficulty=this.algorithm.next_difficulty(o,X.Easy),s.stability=this.algorithm.next_recall_stability(o,c,l,X.Easy)}next_interval(e,n,r,s,o){let c,l,p,y;c=this.algorithm.next_interval(e.stability,o),l=this.algorithm.next_interval(n.stability,o),p=this.algorithm.next_interval(r.stability,o),y=this.algorithm.next_interval(s.stability,o),c=Math.min(c,l),l=Math.max(l,c+1),p=Math.max(p,l+1),y=Math.max(y,p+1),e.scheduled_days=c,e.due=this.review_time.scheduler(c,!0),n.scheduled_days=l,n.due=this.review_time.scheduler(l,!0),r.scheduled_days=p,r.due=this.review_time.scheduler(p,!0),s.scheduled_days=y,s.due=this.review_time.scheduler(y,!0)}next_state(e,n,r,s){e.state=_e.Review,n.state=_e.Review,r.state=_e.Review,s.state=_e.Review}update_next(e,n,r,s){const o={card:e,log:this.buildLog(X.Again)},c={card:n,log:super.buildLog(X.Hard)},l={card:r,log:super.buildLog(X.Good)},p={card:s,log:super.buildLog(X.Easy)};this.next.set(X.Again,o),this.next.set(X.Hard,c),this.next.set(X.Good,l),this.next.set(X.Easy,p)}}class rd{fsrs;constructor(e){this.fsrs=e}replay(e,n,r){return this.fsrs.next(e,n,r)}handleManualRating(e,n,r,s,o,c,l){if(typeof n>"u")throw new Error("reschedule: state is required for manual rating");let p,y;if(n===_e.New)p={rating:X.Manual,state:n,due:l??r,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:r},y=ci(r),y.last_review=r;else{if(typeof l>"u")throw new Error("reschedule: due is required for manual rating");const _=l.diff(r,"days");p={rating:X.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:r},y={...e,state:n,due:l,last_review:r,stability:o||e.stability,difficulty:c||e.difficulty,elapsed_days:s,scheduled_days:_,reps:e.reps+1}}return{card:y,log:p}}reschedule(e,n){const r=[];let s=ci(e.due);for(const o of n){let c;if(o.review=he.time(o.review),o.rating===X.Manual){let l=0;s.state!==_e.New&&s.last_review&&(l=o.review.diff(s.last_review,"days")),c=this.handleManualRating(s,o.state,o.review,l,o.stability,o.difficulty,o.due?he.time(o.due):void 0)}else c=this.replay(s,o.review,o.rating);r.push(c),s=c.card}return r}calculateManualRecord(e,n,r,s){if(!r)return null;const{card:o,log:c}=r,l=he.card(e);return l.due.getTime()===o.due.getTime()?null:(l.scheduled_days=o.due.diff(l.due,"days"),this.handleManualRating(l,o.state,he.time(n),c.elapsed_days,s?o.stability:void 0,s?o.difficulty:void 0,o.due))}}class Xd extends nd{strategyHandler=new Map;Scheduler;constructor(e){super(e);const{enable_short_term:n}=this.parameters;this.Scheduler=n?fo:ho}params_handler_proxy(){const e=this;return{set:function(n,r,s){return r==="request_retention"&&Number.isFinite(s)?e.intervalModifier=e.calculate_interval_modifier(Number(s)):r==="enable_short_term"&&(e.Scheduler=s===!0?fo:ho),Reflect.set(n,r,s),!0}}}useStrategy(e,n){return this.strategyHandler.set(e,n),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,n){const r=this.strategyHandler.get(Ds.SEED),s=this.strategyHandler.get(Ds.SCHEDULER)||this.Scheduler,o=r||wu;return new s(e,n,this,{seed:o})}repeat(e,n,r){const s=this.getScheduler(e,n).preview();return r&&typeof r=="function"?r(s):s}next(e,n,r,s){const o=this.getScheduler(e,n),c=he.rating(r);if(c===X.Manual)throw new Error("Cannot review a manual rating");const l=o.review(c);return s&&typeof s=="function"?s(l):l}get_retrievability(e,n,r=!0){const s=he.card(e);n=n?he.time(n):new Date;const o=s.state!==_e.New?Math.max(n.diff(s.last_review,"days"),0):0,c=s.state!==_e.New?this.forgetting_curve(o,+s.stability.toFixed(8)):0;return r?`${(c*100).toFixed(2)}%`:c}rollback(e,n,r){const s=he.card(e),o=he.review_log(n);if(o.rating===X.Manual)throw new Error("Cannot rollback a manual rating");let c,l,p;switch(o.state){case _e.New:c=o.due,l=void 0,p=0;break;case _e.Learning:case _e.Relearning:case _e.Review:c=o.review,l=o.due,p=s.lapses-(o.rating===X.Again&&o.state===_e.Review?1:0);break}const y={...s,due:c,stability:o.stability,difficulty:o.difficulty,elapsed_days:o.last_elapsed_days,scheduled_days:o.scheduled_days,reps:Math.max(0,s.reps-1),lapses:Math.max(0,p),state:o.state,last_review:l};return r&&typeof r=="function"?r(y):y}forget(e,n,r=!1,s){const o=he.card(e);n=he.time(n);const c=o.state===_e.New?0:n.diff(o.last_review,"days"),l={rating:X.Manual,state:o.state,due:o.due,stability:o.stability,difficulty:o.difficulty,elapsed_days:0,last_elapsed_days:o.elapsed_days,scheduled_days:c,review:n},p={card:{...o,due:n,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:r?0:o.reps,lapses:r?0:o.lapses,state:_e.New,last_review:o.last_review},log:l};return s&&typeof s=="function"?s(p):p}reschedule(e,n=[],r={}){const{recordLogHandler:s,reviewsOrderBy:o,skipManual:c=!0,now:l=new Date,update_memory_state:p=!1}=r;o&&typeof o=="function"&&n.sort(o),c&&(n=n.filter(L=>L.rating!==X.Manual));const y=new rd(this),_=y.reschedule(r.first_card||ci(),n),g=_.length,C=he.card(e),$=y.calculateManualRecord(C,l,g?_[g-1]:void 0,p);return s&&typeof s=="function"?{collections:_.map(s),reschedule_item:$?s($):null}:{collections:_,reschedule_item:$}}}function id(t,e,n,r){const[s,o]=Re(),c=di(async()=>{let l=s();return l===void 0?{list:[]}:{list:await t.DueMoves.by_study_id(...l)}},{initialValue:{list:[]}});return Object.assign(e,{load_due_moves(l,p){o([l,p])},async save_due_move_if_not(l){l.is_saved||(await t.DueMoves.save_due_move(l),r("due_moves","list",p=>p.id===l.id,"is_saved",!0))},async add_attempt_with_spaced_repetition(l,p,y){let _=ci(),g=p.attempts[0]?.card;if(g){let $;switch(y){case"failed":$=X.Hard;break;case"failed-with-hint":$=X.Again;break;case"failed-with-skip":$=X.Again;break;case"solved":$=X.Easy;break;case"solved-with-hint":$=X.Good;break}_=l.repeat(g,new Date)[$].card}let C=await t.DueMoves.new_attempt(p.id,y,_);r("due_moves","list",$=>$.id===p.id,"attempts",$=>[C,...$])}}),c}const bu=Tt();function sd(t){let e,n,r,s,[o,c]=Vo({get studies(){return e()},get chapters(){return n()},get replay_tree(){return r()},get due_moves(){return s()}}),l={},p=[o,l],y=eh();return e=nh(y,l,o,c),n=ih(y,l,o,c),r=Bh(y,l,o,c),s=id(y,l,o,c),te(bu.Provider,{value:p,get children(){return t.children}})}function Jd(){return bt(bu)}const ad=1,ku=Tt();function od(t){let[e,n]=hu(Vo({repeat_selected_study_id:void 0,selected_section_ids:{}}),{name:".aidchess.pstore?v"+ad}),s=[e,{set_repeat_selected_study(o){n("repeat_selected_study_id",o)},toggle_repeat_study_section(o){let c=e.repeat_selected_study_id;if(!c)return;let l=e.selected_section_ids[c];l?l.includes(o)?n("selected_section_ids",c,p=>p.filter(y=>y!==o)):n("selected_section_ids",c,p=>[...p,o]):n("selected_section_ids",c,[o])}}];return te(ku.Provider,{value:s,get children(){return t.children}})}const Zd=()=>bt(ku);var ud=Xe("<main class=not-found><h3>404 Not Found"),cd=Xe('<header id=top><div class=site-title-nav><input type=checkbox id=tn-tg class="topnav-toggle fullscreen-toggle"><label for=tn-tg class=fullscreen-mask></label><label for=tn-tg class=hbg><span class=hbg__in></span></label><h1 class=site-title> <small></small> </h1><nav id=topnav><section></section><section></section><section></section><section></section><section></section></nav></div><div class=site-buttons><div class=dasher>'),ld=Xe("<div>");const fd=Ht(()=>zt(()=>import("./Home-C8JKiqaP.js"),__vite__mapDeps([0,1]))),Rn=Ht(()=>zt(()=>import("./Contact-Cde5BfpP.js"),__vite__mapDeps([2,3]))),hd=Ht(()=>zt(()=>import("./Placeholder-5FhVQYjw.js"),[])),xu=Ht(()=>zt(()=>import("./Beta-BNxFdZXP.js"),__vite__mapDeps([4,5]))),dd=Ht(()=>zt(()=>import("./List-D8px1dBx.js"),__vite__mapDeps([6,7]))),pd=Ht(()=>zt(()=>import("./Show-BwOoJoCl.js"),__vite__mapDeps([8,9,10,11]))),yd=Ht(()=>zt(()=>import("./List-C90-GFvH.js"),__vite__mapDeps([12,13]))),_d=Ht(()=>zt(()=>import("./Show-CdPWXhLp.js"),__vite__mapDeps([14,12,13,9,10,15]))),md=()=>te(Sl,{get children(){return te(yl,{root:wd,get children(){return[te(We,{path:"/",component:fd}),te(We,{path:"/builder",component:hd}),te(We,{path:"/beta",component:xu}),te(We,{path:"/openings",component:dd}),te(We,{path:"/openings/:id",component:pd}),te(We,{path:"/repetition",component:yd}),te(We,{path:"/repetition/:id",component:_d}),te(We,{path:"/contact",component:Rn}),te(We,{path:"/terms",component:Rn}),te(We,{path:"/privacy",component:Rn}),te(We,{path:"/about",component:Rn}),te(We,{path:"/donate",component:Rn}),te(We,{path:"/thanks",component:Rn}),te(We,{path:"*",component:gd})]}})}}),gd=()=>(()=>{var t=ud();return t.firstChild,ve(t,te(Ot,{href:"/",children:"Go back home."}),null),t})(),wd=t=>te(Qf,{get children(){return te(od,{get children(){return te(sd,{get children(){return te(vd,t)}})}})}}),vd=t=>{let e=hi(),n=ne(()=>e.pathname.split("/")[1]);const r=()=>{let l=n();return l===""?"home":l},s=()=>`on-${r()}`,[o,c]=Re(!1,{equals:!1});return Zc(()=>{c(!1)}),[(()=>{var l=cd(),p=l.firstChild,y=p.firstChild,_=y.nextSibling,g=_.nextSibling,C=g.nextSibling,$=C.firstChild,L=$.nextSibling,R=C.nextSibling,I=R.firstChild,W=I.nextSibling,j=W.nextSibling,B=j.nextSibling,U=B.nextSibling,Q=p.nextSibling,ee=Q.firstChild;return ve(C,te(Ot,{href:"/",children:"aidchess.com"}),$),ve(L,te(Ot,{class:"beta",href:"/beta",children:"beta"})),ve(I,te(Ot,{class:"home",href:"/",children:"aidchess.com"})),ve(W,te(Ot,{href:"/builder",target:"_self",children:"Builder"})),ve(j,te(Ot,{href:"/openings",children:"Openings"})),ve(B,te(Ot,{href:"/repetition",children:"Repetition"})),ve(U,te(Ot,{class:"donate",href:"/donate",target:"_self",children:"Donate"})),ve(ee,te(Ot,{href:"/dashboard",children:"Dashboard"})),nt(()=>y.checked=o()),l})(),(()=>{var l=ld();return ve(l,te(dt,{get when(){return!1},get fallback(){return te(gc,{fallback:p=>xu(),get children(){return t.children}})},get children(){return t.children}})),nt(()=>Co(l,"main-wrap "+s())),l})()]},bd=document.getElementById("root");Cc(()=>te(md,{}),bd);export{Ro as $,Ot as A,Be as B,Qo as C,gt as D,Bd as E,Po as F,vr as G,Ln as H,Lt as I,Re as J,Us as K,Vo as L,Ad as M,Jo as N,Xl as O,Fl as P,Kn as Q,mr as R,Ed as S,Vs as T,Nc as U,Dc as V,ht as W,ct as X,rc as Y,Vt as Z,js as _,hi as a,Ld as a0,th as a1,wo as a2,Od as a3,Da as a4,Ct as a5,gr as a6,$h as a7,Wd as a8,wt as a9,df as aa,Qd as ab,Yd as ac,Ud as ad,Vd as ae,xe as af,Gs as ag,Kd as ah,Fd as ai,zd as aj,Gd as ak,xd as al,Hd as am,hc as an,vt as ao,bt as ap,Tt as aq,Xd as ar,Qe as as,pn as at,Zd as au,ne as b,te as c,Ms as d,nt as e,Co as f,Jd as g,Pd as h,ve as i,fi as j,kd as k,dt as l,Sd as m,Bn as n,on as o,fe as p,On as q,K as r,ms as s,Xe as t,Io as u,ae as v,_r as w,dn as x,un as y,pi as z};
