import{k as je,l as Ne,a as T,u as Ye,i as u,c as f,S as Q,f as m,m as y,b as We,h as G,s as pe,F as te,j as P,n as Fe,o as D,p as F,q as Ee,r as fe,v as ne,M as J,w as S,g as Ue,d as Ge,t as i}from"./index-CWKCI5O_.js";/* empty css                   */import{S as He,R as ve}from"./studyrepo-DX28pDGv.js";import{S as Ke,C as Be}from"./Chessboard-BQS-6QEq.js";import{T as Ve,a as ge,C as Je}from"./Chesstree2-kwsty6mQ.js";import{p as Xe,s as Ze,m as et,M as tt,I as st}from"./chess_pgn_logic-m9U_HTP8.js";import{O as rt,S as at,D as it,a as Le}from"./SessionStore-CatqcBDw.js";import{s as lt}from"./scroll-DnAhRpRC.js";function nt(c,t,l){const d=Xe(c),_=t.startsWith("O-O")?Ze(d.to)===0?t.startsWith("O-O-O")?"c1":"g1":t.startsWith("O-O-O")?"c8":"g8":et(d.to),v=l,b=_t[v];return[{orig:_,brush:b?"":void 0,customSvg:b?{html:b}:void 0,label:b?void 0:{text:v,fill:"purple"}}]}const U=c=>`<defs><filter id="shadow"><feDropShadow dx="4" dy="7" stdDeviation="5" flood-opacity="0.5" /></filter></defs>
<g transform="translate(71 -12) scale(0.4)">${c}</g>`,_t={"?!":U(`
  <circle style="fill:#56b4e9;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M37.734 21.947c-3.714 0-7.128.464-10.242 1.393-3.113.928-6.009 2.13-8.685 3.605l4.343 8.766c2.35-1.202 4.644-2.157 6.883-2.867a22.366 22.366 0 0 1 6.799-1.065c2.294 0 4.07.464 5.326 1.393 1.311.874 1.967 2.186 1.967 3.933 0 1.748-.546 3.277-1.639 4.588-1.038 1.257-2.786 2.758-5.244 4.506-2.786 2.021-4.751 3.961-5.898 5.819-1.147 1.857-1.721 4.15-1.721 6.88v2.952h10.568v-2.377c0-1.147.137-2.103.41-2.868.328-.764.93-1.557 1.803-2.376.874-.82 2.104-1.803 3.688-2.95 2.13-1.584 3.906-3.058 5.326-4.424 1.42-1.42 2.485-2.95 3.195-4.59.71-1.638 1.065-3.576 1.065-5.816 0-4.206-1.584-7.675-4.752-10.406-3.114-2.731-7.51-4.096-13.192-4.096zm24.745.819l2.048 39.084h9.75l2.047-39.084zM35.357 68.73c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.047 2.732-2.047 5.244 0 2.404.682 4.152 2.047 5.244 1.366 1.038 3.032 1.557 4.998 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.05-2.84 2.05-5.244 0-2.512-.684-4.26-2.05-5.244-1.365-1.038-3.004-1.557-4.916-1.557zm34.004 0c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.049 2.732-2.049 5.244 0 2.404.684 4.152 2.05 5.244 1.365 1.038 3.03 1.557 4.997 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.047-2.84 2.047-5.244 0-2.512-.681-4.26-2.047-5.244-1.365-1.038-3.004-1.557-4.916-1.557z"/>
`),"?":U(`
  <circle style="fill:#e69f00;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M40.436 60.851q0-4.66 1.957-7.83 1.958-3.17 6.712-6.619 4.195-2.983 5.967-5.127 1.864-2.237 1.864-5.22 0-2.983-2.237-4.475-2.144-1.585-6.06-1.585-3.915 0-7.737 1.212t-7.83 3.263l-4.941-9.975q4.568-2.517 9.881-4.101 5.314-1.585 11.653-1.585 9.695 0 15.008 4.661 5.407 4.661 5.407 11.839 0 3.822-1.212 6.619-1.212 2.796-3.635 5.22-2.424 2.33-6.06 5.034-2.703 1.958-4.195 3.356-1.491 1.398-2.05 2.703-.467 1.305-.467 3.263v2.703H40.436zm-1.492 18.924q0-4.288 2.33-5.966 2.331-1.771 5.687-1.771 3.263 0 5.594 1.771 2.33 1.678 2.33 5.966 0 4.102-2.33 5.966-2.331 1.772-5.594 1.772-3.356 0-5.686-1.772-2.33-1.864-2.33-5.966z"/>
`),"??":U(`
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M31.8 22.22c-3.675 0-7.052.46-10.132 1.38-3.08.918-5.945 2.106-8.593 3.565l4.298 8.674c2.323-1.189 4.592-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.025.46 5.268 1.378 1.297.865 1.946 2.16 1.946 3.89s-.541 3.242-1.622 4.539c-1.027 1.243-2.756 2.73-5.188 4.458-2.756 2-4.7 3.918-5.836 5.755-1.134 1.837-1.702 4.107-1.702 6.808v2.92h10.457v-2.35c0-1.135.135-2.082.406-2.839.324-.756.918-1.54 1.783-2.35.864-.81 2.079-1.784 3.646-2.918 2.107-1.568 3.863-3.026 5.268-4.376 1.405-1.405 2.46-2.92 3.162-4.541.703-1.621 1.054-3.54 1.054-5.755 0-4.161-1.568-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zm38.664 0c-3.675 0-7.053.46-10.133 1.38-3.08.918-5.944 2.106-8.591 3.565l4.295 8.674c2.324-1.189 4.593-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.026.46 5.269 1.378 1.297.865 1.946 2.16 1.946 3.89s-.54 3.242-1.62 4.539c-1.027 1.243-2.757 2.73-5.189 4.458-2.756 2-4.7 3.918-5.835 5.755-1.135 1.837-1.703 4.107-1.703 6.808v2.92h10.457v-2.35c0-1.135.134-2.082.404-2.839.324-.756.918-1.54 1.783-2.35.865-.81 2.081-1.784 3.648-2.918 2.108-1.568 3.864-3.026 5.269-4.376 1.405-1.405 2.46-2.92 3.162-4.541.702-1.621 1.053-3.54 1.053-5.755 0-4.161-1.567-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zM29.449 68.504c-1.945 0-3.593.513-4.944 1.54-1.351.973-2.027 2.703-2.027 5.188 0 2.378.676 4.108 2.027 5.188 1.35 1.027 3 1.54 4.944 1.54 1.892 0 3.512-.513 4.863-1.54 1.35-1.08 2.026-2.81 2.026-5.188 0-2.485-.675-4.215-2.026-5.188-1.351-1.027-2.971-1.54-4.863-1.54zm38.663 0c-1.945 0-3.592.513-4.943 1.54-1.35.973-2.026 2.703-2.026 5.188 0 2.378.675 4.108 2.026 5.188 1.351 1.027 2.998 1.54 4.943 1.54 1.891 0 3.513-.513 4.864-1.54 1.351-1.08 2.027-2.81 2.027-5.188 0-2.485-.676-4.215-2.027-5.188-1.35-1.027-2.973-1.54-4.864-1.54z"/>
`),"!?":U(`
  <circle style="fill:#ea45d8;filter:url(#shadow)" cx="50" cy="50" r="50"/>
    <path fill="#fff" d="M60.823 58.9q0-4.098 1.72-6.883 1.721-2.786 5.9-5.818 3.687-2.622 5.243-4.506 1.64-1.966 1.64-4.588t-1.967-3.933q-1.885-1.393-5.326-1.393t-6.8 1.065q-3.36 1.065-6.883 2.868l-4.343-8.767q4.015-2.212 8.685-3.605 4.67-1.393 10.242-1.393 8.521 0 13.192 4.097 4.752 4.096 4.752 10.405 0 3.36-1.065 5.818-1.066 2.458-3.196 4.588-2.13 2.048-5.326 4.424-2.376 1.72-3.687 2.95-1.31 1.229-1.802 2.376-.41 1.147-.41 2.868v2.376h-10.57zm-1.311 16.632q0-3.77 2.048-5.244 2.049-1.557 4.998-1.557 2.868 0 4.916 1.557 2.049 1.475 2.049 5.244 0 3.605-2.049 5.244-2.048 1.556-4.916 1.556-2.95 0-4.998-1.556-2.048-1.64-2.048-5.244zM36.967 61.849h-9.75l-2.049-39.083h13.847zM25.004 75.532q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
`),"!":U(`
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M54.967 62.349h-9.75l-2.049-39.083h13.847zM43.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
`),"!!":U(`
  <circle style="fill:#168226;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M71.967 62.349h-9.75l-2.049-39.083h13.847zM60.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244zM37.967 62.349h-9.75l-2.049-39.083h13.847zM26.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
`),"✓":U(`
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M87 32.8q0 2-1.4 3.2L51 70.6 44.6 77q-1.7 1.3-3.4 1.3-1.8 0-3.1-1.3L14.3 53.3Q13 52 13 50q0-2 1.3-3.2l6.4-6.5Q22.4 39 24 39q1.9 0 3.2 1.3l14 14L72.7 23q1.3-1.3 3.2-1.3 1.6 0 3.3 1.3l6.4 6.5q1.3 1.4 1.3 3.4z"/>
`),"✗":U(`
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M79.4 68q0 1.8-1.4 3.2l-6.7 6.7q-1.4 1.4-3.5 1.4-1.9 0-3.3-1.4L50 63.4 35.5 78q-1.4 1.4-3.3 1.4-2 0-3.5-1.4L22 71.2q-1.4-1.4-1.4-3.3 0-1.7 1.4-3.5L36.5 50 22 35.4Q20.6 34 20.6 32q0-1.7 1.4-3.5l6.7-6.5q1.2-1.4 3.5-1.4 2 0 3.3 1.4L50 36.6 64.5 22q1.2-1.4 3.3-1.4 2.3 0 3.5 1.4l6.7 6.5q1.4 1.8 1.4 3.5 0 2-1.4 3.3L63.5 49.9 78 64.4q1.4 1.8 1.4 3.5z"/>
`)};var ot=i("<div class=progress-wrap><div class=progress><div class=bar></div></div><h5>%"),ct=i("<div class=repertoire>"),ht=i("<div class=sections-wrap><h2 class=title> <span>%</span></h2><div class=info></div><div class=sections-scroll><div class=sections>"),dt=i("<a class=update>Update Study"),ut=i("<a class=delete> Delete Study "),mt=i("<div class=tools><a class=delete> Clear Progress "),pt=i("<a target=_blank>lichess"),ft=i("<div class=section><input type=radio name=accordion><label> <span class=progress>%</span></label><div class=chapters>"),vt=i("<div><div class=title><span class=no>.</span> <!> "),gt=i("<div class=board-wrap>"),$t=i("<div class=eval-gauge>"),Pe=i("<small> Click on variations to expand. "),qt=i("<small> Your goal is to guess every move correctly to pass the quiz. "),zt=i("<div class=in_mode><button><span> Take Quiz </span></button><button><span> Play Deathmatch "),bt=i("<h2>Deathmatch Mode"),De=i("<span class=passed>passed"),yt=i("<small> Deathmatch "),wt=i("<small> Your score: "),Te=i("<small> Progress +<!>% "),kt=i("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),xt=i("<small> Quiz "),St=i("<small> Your score: <!> out of 15 correct"),Ct=i("<div class=past>"),Mt=i("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),Et=i("<small> Your goal is to guess every move correctly to fill up the progress bar. "),Lt=i("<div class=in_mode><button><span> Play all Moves </span></button><button><span> Play as Match "),Pt=i("<h2>Play as Match"),Re=i("<small> End of practice. "),Oe=i("<small> Congratulations. "),Dt=i("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Tt=i("<h2>Play all moves"),Rt=i("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Ot=i("<div class=replay-wrap><div class=replay-header><div class=title><h4></h4><h5></h5></div></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content>"),Qt=i('<div class=line><span class="fill white"></span><span class="fill black">'),At=i("<span class=index>"),It=i("<div class=fbt>"),jt=i("<small>You will play the moves from the opening."),Nt=i("<small>If you go out of book, game ends."),Yt=i("<div class=in_mode><button class=end2><span> End Deathmatch "),Qe=i("<span class=failed>failed"),Wt=i("<h3>Quiz Mode"),Ft=i("<small>You are given 15 random positions from the opening."),Ut=i("<small>Guess the correct move."),Gt=i("<h2> of 15"),Ht=i("<div class=in_mode><button class=end2><span> End Quiz "),Kt=i("<span>"),Bt=i("<small> Try to guess the moves for <!>."),Vt=i("<small> AI will play the next move, picking a random variation. "),Jt=i("<small> Moves will be hidden once the game is started. "),Xt=i("<small>Try to guess the moves for both sides."),Zt=i("<small>Moves will be hidden once you start.");const es=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],ts=c=>es[Math.floor((1-c/10)*6)],ss=c=>`${Math.floor(c/2)+1}.`+(c%2===0?"..":"");class rs{_mode;get mode(){return this._mode[0]()}set mode(t){this._mode[1](t)}_match_color;get match_color(){return this._match_color[0]()}set match_color(t){this._match_color[1](t)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}_practice_end_result;get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(t){this._practice_end_result[1](t)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){S(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){S(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){S(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){S(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz-quiz"})}end_quiz(){S(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz"})}quiz_pass_one(t){S(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(t)})}_quiz_quiz_ls_paths=[];quiz_fail_one(t){S(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(t)})}get quiz_pass(){return this.quiz_quiz_ls.filter(t=>t>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(t){this._quiz_quiz_ls[1](t)}_quiz_quiz_ls;_quiz_deathmatch_fail;set quiz_deathmatch_fail_result(t){this._quiz_deathmatch_fail[1](t)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}_quiz_deathmatch_result_path;get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(t){this._quiz_deathmatch_result_path[1](t)}restart_deathmatch(){S(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){S(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}constructor(){this._mode=T(void 0,{equals:!1}),this._match_color=T("white"),this._quiz_quiz_ls=T([],{equals:!1}),this._quiz_deathmatch_fail=T(0),this._quiz_deathmatch_result_path=T([]),this._practice_end_result=T(!1)}}const as=c=>(()=>{var t=ot(),l=t.firstChild,d=l.firstChild,_=l.nextSibling,v=_.firstChild;return u(_,()=>c.width,v),G(b=>ne(d,`width: ${c.width}%`,b)),t})();class is{constructor(t){this.sections=t}get progress(){let t=this.sections.length;return this.sections.map(l=>Math.round(l.progress/t)).reduce((l,d)=>l+d)}section_by_name(t){return this.sections.find(l=>l.name===t)}}class ls{constructor(t){this.chapters=t,this.m_progress=m(()=>{let l=this.chapters.length;return this.chapters.map(d=>Math.round(d.progress/l)).reduce((d,_)=>d+_)})}m_progress;get name(){return this.chapters[0].section}get progress(){return this.m_progress()}chapter_by_name(t){return this.chapters.find(l=>l.chapter===t)}}class K{constructor(t,l,d,_,v){this.study_id=t,this.section=l,this.chapter=d,this.score_tree=_,this.solved_paths=v}static load_from_store(t,l,d){let _=new Le(t.id,l,d),v=t.sections.find(b=>b.name===l)?.chapters.find(b=>b.name===d)?.pgn.tree;if(v)return K.make(t.id,l,d,v,ge.set_for_saving(_.solved_paths))}static save_paths_to_store(t){let l=new Le(t.study_id,t.section,t.chapter);l.solved_paths=t.solved_paths.get_for_saving(),l.practice_progress=t.progress}static make(t,l,d,_,v=new ge){return new K(t,l,d,tt.make(_),v)}get clone(){return new K(this.study_id,this.section,this.chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(t=>D(()=>this.score_tree.get_at(t)?.score)??0).reduce((t,l)=>t+l,0)*100)}get progress_map(){let t=D(()=>this.score_tree.progress_paths);const l=D(()=>t.map(d=>[d.filter(_=>_.length%2===1).map(_=>this.score_tree.get_at(_).score).reduce((_,v)=>_+v,0),d.filter(_=>_.length%2===0).map(_=>this.score_tree.get_at(_).score).reduce((_,v)=>_+v,0)]));return t.map((d,_)=>{let v=d[0],b=d[d.length-1],R=l[_][0],j=l[_][1],N=m(()=>this.solved_paths.paths),s=m(()=>N().filter(g=>d.some(L=>L.join("")===g.join("")))),k=m(()=>s().filter(g=>g.length%2===1).map(g=>this.score_tree.get_at(g).score).reduce((g,L)=>g+L,0)),a=m(()=>s().filter(g=>g.length%2===0).map(g=>this.score_tree.get_at(g).score).reduce((g,L)=>g+L,0));return{color:ts(v.length/20+b.length/10),total:R+j,black:m(()=>a()/j),white:m(()=>k()/R),path:b}}).reverse()}clone_merge_stats(t){let l=D(()=>this.clone);return l.solved_paths.merge_dup(t.solved_paths),l}merge_and_save_stats(t){this.solved_paths.merge_dup(t.solved_paths),this.save_stats()}save_stats(){K.save_paths_to_store(this)}}const vs=()=>{const c=je(),[t]=Ne(c.id,He.read_section_study);let[l,d]=T();return(()=>{var _=ct();return Ye(v=>d(v),_),u(_,f(Q,{get when(){return t()},fallback:"Loading...",get children(){return f(ns,{get el_rep(){return l()},get section_study(){return t()}})}})),_})()},ns=c=>{let t=m(()=>c.section_study.sections),l=new rt(c.section_study.id),d=0,_=t().findIndex(q=>q.name===at.i_section);_===-1&&(_=t().findIndex(q=>q.name===l.i_section_name),_===-1?_=0:d=l.i_chapter_index);const[v,b]=T(_),R=m(()=>t()[v()]),j=m(()=>R().chapters),[N,s]=T(d),k=q=>{S(()=>{s(0),b(q)})};y(()=>{l.i_section_name=R().name}),y(()=>{l.i_chapter_index=N()});const a=m(()=>j()[N()]);let g=m(()=>{const q=c.section_study;return new is(q.sections.map(z=>new ls(z.chapters.map(w=>K.load_from_store(q,z.name,w.name)))))});const L=new it(c.section_study.id);y(()=>{L.progress=g().progress}),y(()=>{L.sections_progress=g().sections.map(q=>[q.name,q.progress])});const _e=We(),se=async()=>{await ve.update_imported_study(c.section_study.id),location.reload()},X=()=>{ve.delete_imported_study(c.section_study.id),_e("/repertoires")},re=()=>{ve.clear_progress(c.section_study.id),console.log("done"),location.reload()};return[(()=>{var q=ht(),z=q.firstChild,w=z.firstChild,Z=w.nextSibling,oe=Z.firstChild,ae=z.nextSibling,ce=ae.nextSibling,ie=ce.firstChild;return u(z,()=>c.section_study.name,w),u(Z,()=>g().progress,oe),u(ae,f(Q,{get when(){return c.section_study.import_lichess_link},children:O=>[(()=>{var C=pt();return G(()=>pe(C,"href",O())),C})()," "]})),u(ie,f(te,{get each(){return t()},children:(O,C)=>(()=>{var A=ft(),B=A.firstChild,I=B.nextSibling,ee=I.firstChild,le=ee.nextSibling,r=le.firstChild,o=I.nextSibling;return I.$$click=()=>k(C()),u(I,()=>O.name,ee),u(le,()=>g().section_by_name(O.name).progress,r),u(o,f(te,{get each(){return O.chapters},children:(p,$)=>(()=>{var M=vt(),x=M.firstChild,Y=x.firstChild,H=Y.firstChild,W=Y.nextSibling,V=W.nextSibling;return V.nextSibling,M.$$click=()=>s($()),u(Y,()=>$()+1,H),u(x,()=>p.name,V),u(M,f(as,{get width(){return g().section_by_name(O.name).chapter_by_name(p.name).progress}}),null),G(()=>P(M,"chapter"+($()===N()?" active":""))),M})()})),G(p=>{var $=`accordion-${C()}`,M=v()===C()?"active":"",x=`accordion-${C()}`;return $!==p.e&&pe(B,"id",p.e=$),M!==p.t&&P(I,p.t=M),x!==p.a&&pe(I,"for",p.a=x),p},{e:void 0,t:void 0,a:void 0}),G(()=>B.checked=v()===C()),A})()})),q})(),f(_s,{get el_rep(){return c.el_rep},get stats(){return g().section_by_name(R().name).chapter_by_name(a().name)},get study(){return c.section_study},get section(){return R()},get chapter(){return a()}}),(()=>{var q=mt(),z=q.firstChild;return u(q,f(Q,{get when(){return c.section_study.import_lichess_link||c.section_study.import_pgn},get children(){return[(()=>{var w=dt();return w.$$click=()=>se(),w})(),(()=>{var w=ut();return w.$$click=()=>X(),w})()]}}),z),z.$$click=()=>re(),q})()]},_s=c=>{const t=Fe();t.setVolume(.2);const l=m(()=>c.study),d=m(()=>c.section),_=m(()=>c.chapter),v=m(()=>l().name),b=m(()=>d().name),R=m(()=>_().name),j=m(()=>_().pgn),N=m(()=>j().tree.initial_color);let s=new rs,k=new Ke;const a=m(()=>(s.mode,Ve.make(j().tree.clone))),g=m(()=>{let r=a().tree;return D(()=>K.make(v(),b(),R(),r,new ge))});let L=m(()=>c.stats);const[_e,se]=T(!1),X=m(()=>{if(s.mode==="quiz-quiz")return s.i_quiz_quiz===16});let re=m(()=>{let r=L(),o=g(),p=D(()=>r.progress);return r.clone_merge_stats(o).progress-p});const q=m(()=>g().progress_map);let[z,w]=T(!1);const Z=r=>{let o=s.mode;if(r==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},oe=m(()=>s.mode!==void 0&&!X()&&!s.practice_end_result&&!s.quiz_deathmatch_fail_result),ae=m(()=>a().collect_branch_sums(a().cursor_path)),ce=m(F(()=>s.quiz_deathmatch_result_path,r=>{let o=r.length,p=a().tree?.all_leaves.map($=>$.path).filter($=>!a().failed_paths.find(M=>M.join("")===$.join(""))).filter($=>$.join("").startsWith(r.join("")))[0]?.length;return`${o} out of ${p}`}));y(()=>{if(s.mode==="quiz-quiz"){let r=X();s.quiz_quiz_ls[s.quiz_quiz_ls.length-1]<0&&(se(!0),setTimeout(()=>{se(!1)},500)),r?(t.play("victory"),D(()=>{a().clear_failed_paths(),a()._hidden_paths.clear()})):(w(!0),setTimeout(()=>{S(()=>D(()=>{a().set_random_cursor_hide_rest(),s.match_color=a().cursor_after_color;let p=a().cursor_path;A(p.slice(0,-1)),setTimeout(()=>{a().cursor_path=p,w(!1)},200)}))},100))}}),y(()=>{let{mode:r,match_color:o}=s;r==="quiz-deathmatch"&&o!==N()&&setTimeout(()=>{D(()=>{a().reveal_one_random()})},400)}),y(()=>{a().solved_paths.replace_all(L().solved_paths)}),y(()=>{D(()=>g()).solved_paths.replace_all(a().solved_paths)}),y(F(()=>[L(),g()],(r,o)=>{if(o){let[p,$]=o;p.merge_and_save_stats($)}})),y(F(()=>k.add_uci,r=>{if(z()||!r)return;a().try_next_uci_fail(r)?(ie(),s.mode==="quiz-quiz"&&s.quiz_pass_one(a().cursor_path)):((s.mode==="match"||s.mode==="moves")&&(w(!0),setTimeout(()=>{a().on_wheel(-1),w(!1)},100)),s.mode==="quiz-quiz"&&(s.quiz_fail_one(a().cursor_path.slice(0,-1)),t.play("error")),s.mode==="quiz-deathmatch"&&(s.quiz_deathmatch_fail_result=-1,s.quiz_deathmatch_result_path=a().cursor_path.slice(0,-1),a()._hidden_paths.clear()))})),y(F(()=>s.quiz_deathmatch_fail_result,r=>{(r>0||r<0)&&t.play("victory")})),y(F(()=>s.practice_end_result,r=>{r&&t.play("victory")})),y(()=>{let{mode:r,match_color:o}=s;r==="match"&&o!==N()&&D(()=>{ie()})}),y(F(()=>a().fen_last_move,r=>{if(r){let[o,p]=r;k.on_set_fen_uci(o,p)}else k.on_set_fen_uci(j().fen??st)}));const ie=()=>{let r=()=>a().is_cursor_path_at_a_leaf;r()?s.mode==="quiz-deathmatch"?(s.quiz_deathmatch_fail_result=1,s.quiz_deathmatch_result_path=a().cursor_path):(s.mode==="match"||s.mode==="moves")&&(s.practice_end_result=!0):(s.mode==="match"||s.mode==="quiz-deathmatch")&&(w(!0),setTimeout(()=>{a().reveal_one_random(),r()&&(s.mode==="quiz-deathmatch"?(s.quiz_deathmatch_fail_result=1,s.quiz_deathmatch_result_path=a().cursor_path):(s.mode==="match"||s.mode==="moves")&&(s.practice_end_result=!0)),w(!1)},400))};y(()=>{s.match_color=l().orientation??"white"});let O=!1;y(F(()=>a().tree?.get_at(a().cursor_path),r=>{if(r){if(O){O=!1;return}t.move(r)}}));const C=r=>{z()||(s.mode=r)},A=r=>{O=!0,a().cursor_path=r};y(F(()=>k.on_wheel,r=>{r&&a().on_wheel(r)}));const B=r=>{r.key==="f"&&s.flip_match_color()};Ee(()=>{document.addEventListener("keypress",B)}),fe(()=>{document.removeEventListener("keypress",B)});const I=r=>{r.key==="ArrowLeft"&&k.set_on_wheel(-1),r.key==="ArrowRight"&&k.set_on_wheel(1),r.key==="ArrowUp"&&a().can_navigate_up&&a().navigate_up(),r.key==="ArrowDown"&&a().can_navigate_down&&a().navigate_down()};Ee(()=>{document.addEventListener("keydown",I)}),fe(()=>{document.removeEventListener("keydown",I)});const ee=lt(r=>{const o=r.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(r.preventDefault(),k.set_on_wheel(Math.sign(r.deltaY)))});y(()=>{const r=c.el_rep;r&&(r.addEventListener("wheel",ee,{passive:!1}),fe(()=>{r.removeEventListener("wheel",ee)}))});const le=m(()=>{let r=a().tree?._traverse_path(a().cursor_path);if(!r||!r.data.nags)return[];let o=["","!","?","!!","??","!?","?!"];return nt(r.data.uci,r.data.san,o[r.data.nags[0]])});return[(()=>{var r=gt();return u(r,f(Be,{get shapes(){return le()},get orientation(){return s.match_color},get movable(){return oe()},get doPromotion(){return k.promotion},get onMoveAfter(){return k.on_move_after},get fen_uci(){return k.fen_uci},get color(){return k.turnColor},get dests(){return k.dests}})),r})(),(()=>{var r=$t();return u(r,f(te,{get each(){return q()},children:o=>(()=>{var p=Qt(),$=p.firstChild,M=$.nextSibling;return p.$$click=x=>a().try_set_cursor_path(o.path),G(x=>{var Y=`background: ${o.color}; height: ${o.total*100}%`,H=`height: ${o.white()*100}%`,W=`height: ${o.black()*100}%`;return x.e=ne(p,Y,x.e),x.t=ne($,H,x.t),x.a=ne(M,W,x.a),x},{e:void 0,t:void 0,a:void 0}),p})()})),r})(),(()=>{var r=Ot(),o=r.firstChild,p=o.firstChild,$=p.firstChild,M=$.nextSibling,x=o.nextSibling,Y=x.firstChild,H=Y.nextSibling,W=H.firstChild,V=W.nextSibling,$e=H.nextSibling,he=$e.firstChild,de=he.nextSibling,ue=de.nextSibling,qe=ue.nextSibling,Ae=$e.nextSibling,ze=Ae.firstChild,me=ze.firstChild,be=me.nextSibling,Ie=ze.nextSibling;return u($,b),u(M,R),u(Y,f(Je,{get lala(){return a()}})),W.$$click=()=>a().navigate_up(),V.$$click=()=>a().navigate_down(),u(H,f(te,{get each(){return ae()},children:e=>(()=>{var n=It();return n.$$click=()=>a().try_set_cursor_path(e.path),u(n,f(Q,{get when(){return e.ply&1},get children(){var h=At();return u(h,()=>ss(e.ply)),h}}),null),u(n,()=>e.san,null),n})()}),null),he.$$click=()=>a().navigate_first(),de.$$click=()=>a().navigate_prev(),ue.$$click=()=>a().navigate_next(),qe.$$click=()=>a().navigate_last(),me.$$click=()=>s.end_match_or_moves(),be.$$click=()=>C("quiz"),u(Ie,f(Ue,{get children(){return[f(J,{get when(){return s.mode==="quiz"},get children(){return[Pe(),qt(),(()=>{var e=zt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>C("quiz-quiz"),h.$$click=()=>C("quiz-deathmatch"),e})()]}}),f(J,{get when(){return s.mode==="quiz-deathmatch"},get children(){return[bt(),f(Q,{get when(){return s.quiz_deathmatch_fail_result!==0},get fallback(){return[jt(),Nt(),(()=>{var e=Yt(),n=e.firstChild;return n.$$click=()=>{S(()=>{let h=a().cursor_path.slice(0,-1);s.end_deathmatch(),a()._hidden_paths.clear(),A(h)})},e})()]},get children(){return[(()=>{var e=yt();return e.firstChild,u(e,f(Q,{get when(){return s.quiz_deathmatch_fail_result>0},get fallback(){return Qe()},get children(){return[" ",De()]}}),null),e})(),(()=>{var e=wt();return e.firstChild,u(e,ce,null),e})(),(()=>{var e=Te(),n=e.firstChild,h=n.nextSibling;return h.nextSibling,u(e,re,h),e})(),(()=>{var e=kt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>s.restart_deathmatch(),h.$$click=()=>{S(()=>{let E=a().cursor_path.slice(0,-1);s.end_deathmatch(),a()._hidden_paths.clear(),A(E)})},e})()]}})]}}),f(J,{get when(){return s.mode==="quiz-quiz"},get children(){return f(Q,{get when(){return X()},get fallback(){return[Wt(),Ft(),Ut(),(()=>{var e=Gt(),n=e.firstChild;return u(e,()=>s.i_quiz_quiz,n),G(()=>P(e,_e()?"error":"")),e})(),(()=>{var e=Ht(),n=e.firstChild;return n.$$click=()=>{S(()=>{let h=a().cursor_path;s.end_quiz(),a()._hidden_paths.clear(),A(h)})},e})()]},get children(){return[(()=>{var e=xt();return e.firstChild,u(e,f(Q,{get when(){return s.quiz_pass>10},get fallback(){return Qe()},get children(){return[" ",De()]}}),null),e})(),(()=>{var e=St(),n=e.firstChild,h=n.nextSibling;return h.nextSibling,u(e,()=>s.quiz_pass,h),e})(),(()=>{var e=Te(),n=e.firstChild,h=n.nextSibling;return h.nextSibling,u(e,re,h),e})(),(()=>{var e=Ct();return u(e,f(te,{get each(){return s.quiz_quiz_ls},children:(n,h)=>(()=>{var E=Kt();return E.$$click=()=>a().cursor_path=s._quiz_quiz_ls_paths[h()],P(E,"move "+(n>0?"success":"error")),u(E,()=>h()+1),E})()})),e})(),(()=>{var e=Mt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>s.restart_quiz(),h.$$click=()=>{S(()=>{let E=a().cursor_path;s.end_quiz(),a()._hidden_paths.clear(),A(E)})},e})()]}})}}),f(J,{get when(){return s.mode===void 0},get children(){return[Pe(),Et(),(()=>{var e=Lt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>C("moves"),h.$$click=()=>C("match"),e})()]}}),f(J,{get when(){return s.mode==="match"},get children(){return[Pt(),f(Q,{get when(){return s.practice_end_result},get fallback(){return[(()=>{var e=Bt(),n=e.firstChild,h=n.nextSibling;return h.nextSibling,u(e,()=>s.match_color,h),e})(),Vt(),Jt()]},get children(){return[Re(),Oe()]}}),(()=>{var e=Dt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>s.restart_match(),h.$$click=()=>{let E=a().cursor_path;s.end_match_or_moves(),a()._hidden_paths.clear(),A(E)},e})()]}}),f(J,{get when(){return s.mode==="moves"},get children(){return[Tt(),f(Q,{get when(){return s.practice_end_result},get fallback(){return[Xt(),Zt()]},get children(){return[Re(),Oe()]}}),(()=>{var e=Rt(),n=e.firstChild,h=n.nextSibling;return n.$$click=()=>{s.restart_moves()},h.$$click=()=>s.end_match_or_moves(),e})()]}})]}})),G(e=>{var n=z()||!a().can_navigate_up,h="fbt prev"+(!z()&&a().can_navigate_up?"":" disabled"),E=z()||!a().can_navigate_down,ye="fbt prev"+(!z()&&a().can_navigate_down?"":" disabled"),we="fbt first"+(!z()&&a().can_navigate_prev?"":" disabled"),ke="fbt prev"+(!z()&&a().can_navigate_prev?"":" disabled"),xe="fbt next"+(!z()&&a().can_navigate_next?"":" disabled"),Se="fbt last"+(!z()&&a().can_navigate_next?"":" disabled"),Ce="tab"+Z("practice"),Me="tab"+Z("quiz");return n!==e.e&&(W.disabled=e.e=n),h!==e.t&&P(W,e.t=h),E!==e.a&&(V.disabled=e.a=E),ye!==e.o&&P(V,e.o=ye),we!==e.i&&P(he,e.i=we),ke!==e.n&&P(de,e.n=ke),xe!==e.s&&P(ue,e.s=xe),Se!==e.h&&P(qe,e.h=Se),Ce!==e.r&&P(me,e.r=Ce),Me!==e.d&&P(be,e.d=Me),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),r})()]};Ge(["click"]);export{vs as default};
