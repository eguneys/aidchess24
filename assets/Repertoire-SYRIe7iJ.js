var Be=Object.defineProperty;var He=(m,r,l)=>r in m?Be(m,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[r]=l;var D=(m,r,l)=>(He(m,typeof r!="symbol"?r+"":r,l),l);import{h as Ke,j as Ue,i as u,c as d,S as C,k as Je,l as y,b as p,m as q,n as k,o as S,p as ke,q as ye,r as Ve,f as Y,g as w,F as re,s as W,M as L,v as f,e as Xe,w as Ze,d as et,t as i}from"./index-D4oj29dd.js";/* empty css                   */import{S as tt}from"./studyrepo-B5jCVy9P.js";import{S as rt,C as st}from"./Shalala-CFB8ngC4.js";import{T as at,a as se,C as lt}from"./Chesstree2-ChjLcKWB.js";import{M as it,I as _t}from"./chess_pgn_logic-CW9nH3VL.js";import{S as nt,O as Se}from"./SessionStore-CwafTgIw.js";import{s as ot}from"./scroll-DnAhRpRC.js";var ct=i("<div class=progress><div class=bar></div><h3>"),ht=i("<div class=repertoire-wrap>"),Ce=i("<small> Click on variations to expand. "),ut=i("<small> Your goal is to guess every move correctly to pass the quiz. "),dt=i("<h2>Select a Quiz Option"),mt=i("<button><span> Take Quiz "),pt=i("<button><span> Play Deathmatch "),vt=i("<h2>Deathmatch Mode"),xe=i("<span class=passed>passed"),gt=i("<small> Deathmatch "),ft=i("<small> Your score: "),Me=i("<small> Progress +<!>% "),$t=i("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),zt=i("<h2>Quiz Mode"),qt=i("<small> Quiz "),bt=i("<small> Your score: <!> out of 15 correct"),wt=i("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),kt=i("<small> Your goal is to guess every move correctly to fill up the progress bar. "),yt=i("<h2>Select a Practice Option"),St=i("<button><span> Play all Moves "),Ct=i("<button><span> Play as Match "),xt=i("<h2>Play as Match"),Pe=i("<small> End of practice. "),Ee=i("<small> Congratulations. "),Mt=i("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Pt=i("<h2>Play all moves"),Et=i("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Tt=i("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=progress>%</h3><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Rt=i("<li><div><h3></h3> "),Dt=i('<div class=line><span class="fill white"></span><span class="fill black">'),Qt=i("<span class=index>"),jt=i("<div class=fbt>"),Lt=i("<small>You will play the moves from the opening."),It=i("<small>If you go out of book, game ends."),Ot=i("<div class=in_mode><button class=end2><span> End Deathmatch "),Te=i("<span class=failed>failed"),Yt=i("<small>You are given 15 random positions from the opening."),At=i("<small>Guess the correct move."),Nt=i("<h2> of 15"),Ft=i("<div class=in_mode><button class=end2><span> End Quiz "),Gt=i("<small> Try to guess the moves for <!>."),Wt=i("<small> AI will play the next move, picking a random variation. "),Bt=i("<small> Moves will be hidden once the game is started. "),Ht=i("<small>Try to guess the moves for both sides."),Kt=i("<small>Moves will be hidden once you start.");const Ut=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Jt=m=>Ut[Math.floor((1-m/10)*6)],Vt=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Xt{constructor(){D(this,"_mode");D(this,"_match_color");D(this,"_practice_end_result");D(this,"_quiz_quiz_ls");D(this,"_quiz_deathmatch_fail");D(this,"_quiz_deathmatch_result_path");this._mode=y(void 0,{equals:!1}),this._match_color=y("white"),this._quiz_quiz_ls=y([],{equals:!1}),this._quiz_deathmatch_fail=y(0),this._quiz_deathmatch_result_path=y([]),this._practice_end_result=y(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){f(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){f(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){f(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){f(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){f(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){f(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){f(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){f(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){f(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const Re=m=>(()=>{var r=ct(),l=r.firstChild,c=l.nextSibling;return u(c,()=>`%${m.width}`),Y(h=>W(l,`width: ${m.width}%`,h)),r})();class Zt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(l=>Math.round(l.progress/r)).reduce((l,c)=>l+c)}}class Q{constructor(r,l,c,h){this.study_id=r,this.i_chapter=l,this.score_tree=c,this.solved_paths=h}static load_from_store(r,l){let c=new Se(r.id,l);return Q.make(r.id,l,r.chapters[l].pgn.tree,se.set_for_saving(c.solved_paths))}static save_paths_to_store(r){let l=new Se(r.study_id,r.i_chapter);l.solved_paths=r.solved_paths.get_for_saving(),l.practice_progress=r.progress}static make(r,l,c,h=new se){return new Q(r,l,it.make(c),h)}get clone(){return new Q(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(r=>k(()=>{var l;return(l=this.score_tree.get_at(r))==null?void 0:l.score})??0).reduce((r,l)=>r+l,0)*100)}get progress_map(){let r=k(()=>this.score_tree.progress_paths);const l=k(()=>r.map(c=>[c.filter(h=>h.length%2===1).map(h=>this.score_tree.get_at(h).score).reduce((h,t)=>h+t,0),c.filter(h=>h.length%2===0).map(h=>this.score_tree.get_at(h).score).reduce((h,t)=>h+t,0)]));return r.map((c,h)=>{let t=c[0],$=c[c.length-1],x=l[h][0],B=l[h][1],I=p(()=>this.solved_paths.paths),M=p(()=>I().filter(v=>c.some(P=>P.join("")===v.join("")))),O=p(()=>M().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0)),a=p(()=>M().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0));return{color:Jt(t.length/20+$.length/10),total:x*2,black:p(()=>a()/B),white:p(()=>O()/x),path:$}}).reverse()}clone_merge_stats(r){let l=k(()=>this.clone);return l.solved_paths.merge_dup(r.solved_paths),l}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),this.save_stats()}save_stats(){Q.save_paths_to_store(this)}}const cr=()=>{const m=Ke(),[r]=Ue(m.id,tt.read_study);return(()=>{var l=ht();return u(l,d(C,{get when(){return!r.loading},fallback:"Loading...",get children(){return d(er,{get study(){return r()}})}})),l})()},er=m=>{const r=Je(),l=()=>m.study;let[c,h]=y(!1),t=new Xt,$=new rt;const[x,B]=y(nt.i_chapter??0);let I=p(()=>{const s=l();return new Zt(s.chapters.map((o,b)=>Q.load_from_store(s,b)))}),M=p(()=>I().chapters[x()]);const O=p(()=>l().chapters[x()]),a=p(()=>{t.mode;let s=O();return at.make(s.pgn.tree.clone)}),v=p(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===15}),[P,ae]=y(!1);q(()=>{if(t.mode==="quiz-quiz"){let s=t.i_quiz_quiz;t.quiz_quiz_ls[t.quiz_quiz_ls.length-1]<0&&(ae(!0),setTimeout(()=>{ae(!1)},500)),s===15||(h(!0),setTimeout(()=>{f(()=>k(()=>{a().set_random_cursor_hide_rest(),t.match_color=a().cursor_after_color,h(!1)}))},100))}}),q(()=>{let{mode:s,match_color:o}=t;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{k(()=>{a().reveal_one_random()})},400)}),q(()=>{a().solved_paths.replace_all(M().solved_paths)});const A=p(()=>{let s=a().tree;return k(()=>Q.make(l().name,x(),s,new se))});q(()=>{k(()=>A()).solved_paths.replace_all(a().solved_paths)});let le=p(()=>{let s=M(),o=A(),b=k(()=>s.progress);return s.clone_merge_stats(o).progress-b});q(S(()=>[M(),A()],(s,o)=>{if(o){let[b,E]=o;b.merge_and_save_stats(E)}})),q(S(()=>$.add_uci,s=>{if(c()||!s)return;a().try_next_uci_fail(s)?(ie(),t.mode==="quiz-quiz"&&t.quiz_pass_one()):((t.mode==="match"||t.mode==="moves")&&(h(!0),setTimeout(()=>{a().on_wheel(-1),h(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(),r.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=a().cursor_path.slice(0,-1)))})),q(S(()=>t.quiz_deathmatch_fail_result,s=>{(s>0||s<0)&&r.play("victory")})),q(S(()=>t.practice_end_result,s=>{s&&r.play("victory")})),q(()=>{let{mode:s,match_color:o}=t;s==="match"&&o==="black"&&k(()=>{ie()})}),q(S(()=>a().fen_last_move,s=>{if(s){let[o,b]=s;$.on_set_fen_uci(o,b)}else $.on_set_fen_uci(_t)}));const ie=()=>{let s=()=>a().is_cursor_path_at_a_leaf;s()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=a().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(h(!0),setTimeout(()=>{a().reveal_one_random(),s()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=a().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),h(!1)},400))};q(S(()=>$.on_wheel,s=>{s&&a().on_wheel(s)}));const _e=s=>{s.key==="f"&&t.flip_match_color()};q(S(()=>{var s;return(s=a().tree)==null?void 0:s.get_at(a().cursor_path)},s=>{s&&r.move(s)})),ke(()=>{document.addEventListener("keypress",_e)}),ye(()=>{document.removeEventListener("keypress",_e)});const ne=ot(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),$.set_on_wheel(Math.sign(s.deltaY)))});q(()=>{t.match_color=l().orientation??"white"});const De=p(()=>A().progress_map);let H;ke(()=>{H.addEventListener("wheel",ne,{passive:!1})}),ye(()=>{H.removeEventListener("wheel",ne)});const oe=s=>{let o=t.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},Qe=p(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),je=p(S(()=>t.quiz_deathmatch_result_path,s=>{var E,j;let o=s.length,b=(j=(E=a().tree)==null?void 0:E.all_leaves.map(T=>T.path).filter(T=>!a().failed_paths.find(K=>K.join("")===T.join(""))).filter(T=>T.join("").startsWith(s.join("")))[0])==null?void 0:j.length;return`${o} out of ${b}`})),Le=p(()=>{var s;return(s=a().tree)==null?void 0:s.collect_branch_sums(a().cursor_path)});return(()=>{var s=Tt(),o=s.firstChild,b=o.firstChild,E=b.nextSibling,j=E.firstChild,T=j.firstChild,K=j.nextSibling,ce=o.nextSibling,he=ce.nextSibling,Ie=he.nextSibling,ue=Ie.firstChild,de=ue.firstChild,me=de.firstChild,Oe=me.nextSibling,U=de.nextSibling,Ye=U.firstChild,Ae=U.nextSibling,Ne=Ae.firstChild,Fe=ue.nextSibling,pe=Fe.firstChild,J=pe.nextSibling,N=J.firstChild,V=N.nextSibling,ve=J.nextSibling,X=ve.firstChild,Z=X.nextSibling,ee=Z.nextSibling,ge=ee.nextSibling,Ge=ve.nextSibling,fe=Ge.firstChild,te=fe.firstChild,$e=te.nextSibling,We=fe.nextSibling;return Ve(e=>H=e,s),u(T,()=>l().name),u(j,d(Re,{get width(){return I().progress}}),null),u(K,d(re,{get each(){return l().chapters},children:(e,_)=>(()=>{var n=Rt(),z=n.firstChild,g=z.firstChild;return g.nextSibling,n.$$click=()=>B(_()),u(g,()=>e.name),u(z,d(Re,{get width(){var R;return((R=I())==null?void 0:R.chapters[_()].progress)??0}}),null),Y(()=>w(n,_()===x()?"active":"")),n})()})),u(ce,d(st,{get orientation(){return t.match_color},get movable(){return Qe()},get doPromotion(){return $.promotion},get onMoveAfter(){return $.on_move_after},get fen_uci(){return $.fen_uci},get color(){return $.turnColor},get dests(){return $.dests}})),u(he,d(re,{get each(){return De()},children:e=>(()=>{var _=Dt(),n=_.firstChild,z=n.nextSibling;return _.$$click=g=>a().try_set_cursor_path(e.path),Y(g=>{var R=`background: ${e.color}; height: ${Math.round(e.total*100)}%`,F=`height: ${Math.round(e.white()*100)}%`,G=`height: ${Math.round(e.black()*100)}%`;return g.e=W(_,R,g.e),g.t=W(n,F,g.t),g.a=W(z,G,g.a),g},{e:void 0,t:void 0,a:void 0}),_})()})),u(me,()=>l().name),u(Oe,()=>O().name),u(U,()=>M().progress,Ye),u(pe,d(lt,{get lala(){return a()}})),N.$$click=()=>a().navigate_up(),V.$$click=()=>a().navigate_down(),u(J,d(re,{get each(){return Le()},children:e=>(()=>{var _=jt();return _.$$click=()=>a().try_set_cursor_path(e.path),u(_,d(C,{get when(){return e.ply&1},get children(){var n=Qt();return u(n,()=>Vt(e.ply)),n}}),null),u(_,()=>e.san,null),_})()}),null),X.$$click=()=>a().navigate_first(),Z.$$click=()=>a().navigate_prev(),ee.$$click=()=>a().navigate_next(),ge.$$click=()=>a().navigate_last(),te.$$click=()=>t.end_match_or_moves(),$e.$$click=()=>t.mode="quiz",u(We,d(Xe,{get children(){return[d(L,{get when(){return t.mode==="quiz"},get children(){return[Ce(),ut(),dt(),(()=>{var e=mt();return e.$$click=()=>t.mode="quiz-quiz",e})(),(()=>{var e=pt();return e.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(L,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[vt(),d(C,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Lt(),It(),(()=>{var e=Ot(),_=e.firstChild;return _.$$click=()=>{f(()=>{let n=a().cursor_path;t.end_deathmatch(),a().cursor_path=n})},e})()]},get children(){return[(()=>{var e=gt();return e.firstChild,u(e,d(C,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return Te()},get children(){return[" ",xe()]}}),null),e})(),(()=>{var e=ft();return e.firstChild,u(e,je,null),e})(),(()=>{var e=Me(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,le,n),e})(),(()=>{var e=$t(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_deathmatch(),n.$$click=()=>{f(()=>{let z=a().cursor_path;t.end_deathmatch(),a().cursor_path=z})},e})()]}})]}}),d(L,{get when(){return t.mode==="quiz-quiz"},get children(){return[zt(),d(C,{get when(){return v()},get fallback(){return[Yt(),At(),(()=>{var e=Nt(),_=e.firstChild;return u(e,()=>t.i_quiz_quiz,_),Y(()=>w(e,P()?"error":"")),e})(),(()=>{var e=Ft(),_=e.firstChild;return _.$$click=()=>{f(()=>{let n=a().cursor_path;t.end_quiz(),a().cursor_path=n})},e})()]},get children(){return[(()=>{var e=qt();return e.firstChild,u(e,d(C,{get when(){return t.quiz_pass>10},get fallback(){return Te()},get children(){return[" ",xe()]}}),null),e})(),(()=>{var e=bt(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,()=>t.quiz_pass,n),e})(),(()=>{var e=Me(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,le,n),e})(),(()=>{var e=wt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_quiz(),n.$$click=()=>{f(()=>{let z=a().cursor_path;t.end_quiz(),a().cursor_path=z})},e})()]}})]}}),d(L,{get when(){return t.mode===void 0},get children(){return[Ce(),kt(),yt(),(()=>{var e=St();return e.$$click=()=>t.mode="moves",e})(),(()=>{var e=Ct();return e.$$click=()=>t.mode="match",e})()]}}),d(L,{get when(){return t.mode==="match"},get children(){return[xt(),d(C,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Gt(),_=e.firstChild,n=_.nextSibling;return n.nextSibling,u(e,()=>t.match_color,n),e})(),Wt(),Bt()]},get children(){return[Pe(),Ee()]}}),(()=>{var e=Mt(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>t.restart_match(),n.$$click=()=>{let z=a().cursor_path;t.end_match_or_moves(),a().cursor_path=z},e})()]}}),d(L,{get when(){return t.mode==="moves"},get children(){return[Pt(),d(C,{get when(){return t.practice_end_result},get fallback(){return[Ht(),Kt()]},get children(){return[Pe(),Ee()]}}),(()=>{var e=Et(),_=e.firstChild,n=_.nextSibling;return _.$$click=()=>{t.restart_moves()},n.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),Y(e=>{var _=O().site,n=c()||!a().can_navigate_up,z="fbt prev"+(!c()&&a().can_navigate_up?"":" disabled"),g=c()||!a().can_navigate_down,R="fbt prev"+(!c()&&a().can_navigate_down?"":" disabled"),F="fbt first"+(!c()&&a().can_navigate_prev?"":" disabled"),G="fbt prev"+(!c()&&a().can_navigate_prev?"":" disabled"),ze="fbt next"+(!c()&&a().can_navigate_next?"":" disabled"),qe="fbt last"+(!c()&&a().can_navigate_next?"":" disabled"),be="tab"+oe("practice"),we="tab"+oe("quiz");return _!==e.e&&Ze(Ne,"href",e.e=_),n!==e.t&&(N.disabled=e.t=n),z!==e.a&&w(N,e.a=z),g!==e.o&&(V.disabled=e.o=g),R!==e.i&&w(V,e.i=R),F!==e.n&&w(X,e.n=F),G!==e.s&&w(Z,e.s=G),ze!==e.h&&w(ee,e.h=ze),qe!==e.r&&w(ge,e.r=qe),be!==e.d&&w(te,e.d=be),we!==e.l&&w($e,e.l=we),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),s})()};et(["click"]);export{cr as default};
