var Ee=Object.defineProperty;var Pe=(u,r,a)=>r in u?Ee(u,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[r]=a;var S=(u,r,a)=>(Pe(u,typeof r!="symbol"?r+"":r,a),a);import{h as Te,j as Re,i as d,c as h,S as x,k as De,l as M,b as p,m as g,n as E,o as b,p as oe,q as ce,r as Qe,f as F,g as C,F as he,s as G,M as D,e as je,v as Le,d as Ye,t as i,w as z}from"./index-BjjQPSku.js";/* empty css                   */import{S as Ie}from"./studyrepo-zkLe54hg.js";import{S as Oe,C as Ae}from"./Shalala-CGc1kbVn.js";import{T as Ne,a as V,C as Fe}from"./Chesstree2-Dpu8S-zl.js";import{I as Ge,M as We}from"./chess_pgn_logic-C5UwJ1ts.js";import{S as Be,O as ue}from"./SessionStore-Dr5jhwoV.js";function He(u){let r=0;return a=>{r+=a.deltaY*(a.deltaMode?40:1),Math.abs(r)>=4?(u(a,!0),r=0):u(a,!1)}}var Ke=i("<div class=progress><div class=bar></div><h3>"),Ue=i("<div class=repertoire-wrap>"),de=i("<small> Click on variations to expand. "),Je=i("<small> Your goal is to guess every move correctly to pass the quiz. "),Ve=i("<h2>Select a Quiz Option"),Xe=i("<button><span> Take Quiz "),Ze=i("<button><span> Play Deathmatch "),et=i("<h2>Deathmatch Mode"),me=i("<span class=passed>passed"),tt=i("<small> Deathmatch "),rt=i("<small> Your score: "),at=i("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),st=i("<h2>Quiz Mode"),it=i("<small> Quiz "),lt=i("<small> Your score: <!> out of 15 correct"),_t=i("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),nt=i("<small> Your goal is to guess every move correctly to fill up the progress bar. "),ot=i("<h2>Select a Practice Option"),ct=i("<button><span> Play all Moves "),ht=i("<button><span> Play as Match "),ut=i("<h2>Play as Match"),pe=i("<small> End of practice. "),ve=i("<small> Congratulations. "),dt=i("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),mt=i("<h2>Play all moves"),pt=i("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),vt=i("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),gt=i("<li><div><h3></h3> "),ft=i('<div class=line><span class="fill white"></span><span class="fill black">'),$t=i("<small>You will play the moves from the opening."),zt=i("<small>If you go out of book, game ends."),qt=i("<div class=in_mode><button class=end2><span> End Deathmatch "),ge=i("<span class=failed>failed"),bt=i("<small>You are given 15 random positions from the opening."),kt=i("<small>Guess the correct move."),wt=i("<h2> of 15"),yt=i("<div class=in_mode><button class=end2><span> End Quiz "),St=i("<small> Try to guess the moves for <!>."),Ct=i("<small> AI will play the next move, picking a random variation. "),xt=i("<small> Moves will be hidden once the game is started. "),Mt=i("<small>Try to guess the moves for both sides."),Et=i("<small>Moves will be hidden once you start.");const Pt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Tt=u=>Pt[Math.floor((1-u/10)*6)];class Rt{constructor(){S(this,"_mode");S(this,"_match_color");S(this,"_practice_end_result");S(this,"_quiz_quiz_ls");S(this,"_quiz_deathmatch_fail");S(this,"_quiz_deathmatch_result_path");this._mode=M(void 0,{equals:!1}),this._match_color=M("white"),this._quiz_quiz_ls=M([],{equals:!1}),this._quiz_deathmatch_fail=M(0),this._quiz_deathmatch_result_path=M([]),this._practice_end_result=M(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){z(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){z(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){z(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){z(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){z(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){z(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){z(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const fe=u=>(()=>{var r=Ke(),a=r.firstChild,e=a.nextSibling;return d(e,()=>`%${u.width}`),F(n=>G(a,`width: ${u.width}%`,n)),r})();class Dt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(a=>Math.round(a.progress/r)).reduce((a,e)=>a+e)}}class Q{constructor(r,a,e,n){this.study_id=r,this.i_chapter=a,this.score_tree=e,this.solved_paths=n}static load_from_store(r,a){let e=new ue(r.id,a);return Q.make(r.id,a,r.chapters[a].pgn.tree,V.set_for_saving(e.solved_paths))}static save_paths_to_store(r){let a=new ue(r.study_id,r.i_chapter);a.solved_paths=r.solved_paths.get_for_saving(),a.practice_progress=r.progress}static make(r,a,e,n=new V){return new Q(r,a,We.make(e),n)}get progress(){return Math.round(this.solved_paths.expand_paths.map(r=>{var a;return((a=this.score_tree.get_at(r))==null?void 0:a.score)??0}).reduce((r,a)=>r+a,0)*100)}get progress_map(){let r=E(()=>this.score_tree.progress_paths);const a=E(()=>r.map(e=>[e.filter(n=>n.length%2===1).map(n=>this.score_tree.get_at(n).score).reduce((n,f)=>n+f,0),e.filter(n=>n.length%2===0).map(n=>this.score_tree.get_at(n).score).reduce((n,f)=>n+f,0)]));return r.map((e,n)=>{let f=e[0],Y=e[e.length-1],P=a[n][0],I=a[n][1],j=p(()=>this.solved_paths.expand_paths),_=p(()=>j().filter(m=>e.some(q=>q.join("")===m.join("")))),O=p(()=>_().filter(m=>m.length%2===1).map(m=>this.score_tree.get_at(m).score).reduce((m,q)=>m+q,0)),L=p(()=>_().filter(m=>m.length%2===0).map(m=>this.score_tree.get_at(m).score).reduce((m,q)=>m+q,0));return{color:Tt(f.length/20+Y.length/10),total:P*2,black:p(()=>L()/I),white:p(()=>O()/P),path:Y}}).reverse()}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),Q.save_paths_to_store(this)}}const Gt=()=>{const u=Te(),[r]=Re(u.id,Ie.read_study);return(()=>{var a=Ue();return d(a,h(x,{get when(){return!r.loading},fallback:"Loading...",get children(){return h(Qt,{get study(){return r()}})}})),a})()},Qt=u=>{const r=De(),a=()=>u.study;let e=new Rt,n=new Oe;const[f,Y]=M(Be.i_chapter??0);let P=p(()=>{const s=a();return new Dt(s.chapters.map((o,$)=>Q.load_from_store(s,$)))}),I=p(()=>P().chapters[f()]);const j=p(()=>a().chapters[f()]),_=p(()=>{e.mode;let s=j();return Ne.make(s.pgn.tree.clone)}),O=p(()=>{if(e.mode==="quiz-quiz")return e.i_quiz_quiz===15});g(()=>{e.mode==="quiz-quiz"&&(e.i_quiz_quiz===15||E(()=>{_().set_random_cursor_hide_rest(),e.match_color=_().cursor_after_color}))}),g(()=>{let{mode:s,match_color:o}=e;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{E(()=>{_().reveal_one_random()})},400)}),g(()=>{_().solved_paths.replace_all(I().solved_paths)});const L=p(()=>{let s=_().tree;return E(()=>Q.make(a().name,f(),s,new V))});g(()=>{if(e.mode!==void 0&&e.mode!=="match"&&e.mode!=="moves")return;E(()=>L()).solved_paths.replace_all(_().solved_paths)}),g(b(()=>[L(),I()],(s,o)=>{if(o){let[$,T]=o;T.merge_and_save_stats($)}})),g(b(()=>n.add_uci,s=>{if(!s)return;_().try_next_uci_fail(s)?(m(),e.mode==="quiz-quiz"&&e.quiz_pass_one()):((e.mode==="match"||e.mode==="moves")&&setTimeout(()=>{_().on_wheel(-1)},100),e.mode==="quiz-quiz"&&(e.quiz_fail_one(),r.play("error")),e.mode==="quiz-deathmatch"&&(e.quiz_deathmatch_fail_result=-1,e.quiz_deathmatch_result_path=_().cursor_path.slice(0,-1)))})),g(b(()=>e.quiz_deathmatch_fail_result,()=>{r.play("victory")})),g(b(()=>e.practice_end_result,()=>{r.play("victory")})),g(()=>{let{mode:s,match_color:o}=e;s==="match"&&o==="black"&&E(()=>{m()})}),g(b(()=>_().fen_last_move,s=>{if(s){let[o,$]=s;n.on_set_fen_uci(o,$)}else n.on_set_fen_uci(Ge)}));const m=()=>{let s=()=>_().is_cursor_path_at_a_leaf;s()?e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=_().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0):(e.mode==="match"||e.mode==="quiz-deathmatch")&&setTimeout(()=>{_().reveal_one_random(),s()&&(e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=_().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0))},400)};g(b(()=>n.on_wheel,s=>{s&&_().on_wheel(s)}));const q=s=>{s.key==="f"&&e.flip_match_color()};g(b(()=>{var s;return(s=_().tree)==null?void 0:s.get_at(_().cursor_path)},s=>{s&&r.move(s)})),oe(()=>{document.addEventListener("keypress",q)}),ce(()=>{document.removeEventListener("keypress",q)});const X=He(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),n.set_on_wheel(Math.sign(s.deltaY)))});g(()=>{e.match_color=a().orientation??"white"});const $e=p(()=>L().progress_map);let W;oe(()=>{W.addEventListener("wheel",X,{passive:!1})}),ce(()=>{W.removeEventListener("wheel",X)});const Z=s=>{let o=e.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},ze=p(()=>e.mode!==void 0&&!O()&&!e.practice_end_result),qe=p(b(()=>e.quiz_deathmatch_result_path,s=>{var T,R;let o=s.length,$=(R=(T=_().tree)==null?void 0:T.all_leaves.map(k=>k.path).filter(k=>!_().failed_paths.find(B=>B.join("")===k.join(""))).filter(k=>k.join("").startsWith(s.join("")))[0])==null?void 0:R.length;return`${o} out of ${$}`}));return(()=>{var s=vt(),o=s.firstChild,$=o.firstChild,T=$.nextSibling,R=T.firstChild,k=R.firstChild,B=R.nextSibling,ee=o.nextSibling,te=ee.nextSibling,be=te.nextSibling,re=be.firstChild,ae=re.firstChild,ke=ae.firstChild,we=ke.nextSibling,ye=ae.nextSibling,Se=ye.firstChild,Ce=re.nextSibling,se=Ce.firstChild,ie=se.nextSibling,H=ie.firstChild,K=H.nextSibling,U=K.nextSibling,le=U.nextSibling,xe=ie.nextSibling,_e=xe.firstChild,J=_e.firstChild,ne=J.nextSibling,Me=_e.nextSibling;return Qe(t=>W=t,s),d(k,()=>a().name),d(R,h(fe,{get width(){return P().progress}}),null),d(B,h(he,{get each(){return a().chapters},children:(t,l)=>(()=>{var c=gt(),w=c.firstChild,v=w.firstChild;return v.nextSibling,c.$$click=()=>Y(l()),d(v,()=>t.name),d(w,h(fe,{get width(){var y;return((y=P())==null?void 0:y.chapters[l()].progress)??0}}),null),F(()=>C(c,l()===f()?"active":"")),c})()})),d(ee,h(Ae,{get orientation(){return e.match_color},get movable(){return ze()},get doPromotion(){return n.promotion},get onMoveAfter(){return n.on_move_after},get fen_uci(){return n.fen_uci},get color(){return n.turnColor},get dests(){return n.dests}})),d(te,h(he,{get each(){return $e()},children:t=>(()=>{var l=ft(),c=l.firstChild,w=c.nextSibling;return l.$$click=v=>_().try_set_cursor_path(t.path),F(v=>{var y=`background: ${t.color}; height: ${Math.round(t.total*100)}%`,A=`height: ${Math.round(t.white()*100)}%`,N=`height: ${Math.round(t.black()*100)}%`;return v.e=G(l,y,v.e),v.t=G(c,A,v.t),v.a=G(w,N,v.a),v},{e:void 0,t:void 0,a:void 0}),l})()})),d(we,()=>j().name),d(se,h(Fe,{get lala(){return _()}})),H.$$click=()=>_().navigate_first(),K.$$click=()=>_().navigate_prev(),U.$$click=()=>_().navigate_next(),le.$$click=()=>_().navigate_last(),J.$$click=()=>e.end_match_or_moves(),ne.$$click=()=>e.mode="quiz",d(Me,h(je,{get children(){return[h(D,{get when(){return e.mode==="quiz"},get children(){return[de(),Je(),Ve(),(()=>{var t=Xe();return t.$$click=()=>e.mode="quiz-quiz",t})(),(()=>{var t=Ze();return t.$$click=()=>e.mode="quiz-deathmatch",t})()]}}),h(D,{get when(){return e.mode==="quiz-deathmatch"},get children(){return[et(),h(x,{get when(){return e.quiz_deathmatch_fail_result!==0},get fallback(){return[$t(),zt(),(()=>{var t=qt(),l=t.firstChild;return l.$$click=()=>e.end_deathmatch(),t})()]},get children(){return[(()=>{var t=tt();return t.firstChild,d(t,h(x,{get when(){return e.quiz_deathmatch_fail_result>0},get fallback(){return ge()},get children(){return[" ",me()]}}),null),t})(),(()=>{var t=rt();return t.firstChild,d(t,qe,null),t})(),(()=>{var t=at(),l=t.firstChild,c=l.nextSibling;return l.$$click=()=>e.restart_deathmatch(),c.$$click=()=>e.end_deathmatch(),t})()]}})]}}),h(D,{get when(){return e.mode==="quiz-quiz"},get children(){return[st(),h(x,{get when(){return O()},get fallback(){return[bt(),kt(),(()=>{var t=wt(),l=t.firstChild;return d(t,()=>e.i_quiz_quiz,l),t})(),(()=>{var t=yt(),l=t.firstChild;return l.$$click=()=>e.end_quiz(),t})()]},get children(){return[(()=>{var t=it();return t.firstChild,d(t,h(x,{get when(){return e.quiz_pass>10},get fallback(){return ge()},get children(){return[" ",me()]}}),null),t})(),(()=>{var t=lt(),l=t.firstChild,c=l.nextSibling;return c.nextSibling,d(t,()=>e.quiz_pass,c),t})(),(()=>{var t=_t(),l=t.firstChild,c=l.nextSibling;return l.$$click=()=>e.restart_quiz(),c.$$click=()=>e.end_quiz(),t})()]}})]}}),h(D,{get when(){return e.mode===void 0},get children(){return[de(),nt(),ot(),(()=>{var t=ct();return t.$$click=()=>e.mode="moves",t})(),(()=>{var t=ht();return t.$$click=()=>e.mode="match",t})()]}}),h(D,{get when(){return e.mode==="match"},get children(){return[ut(),h(x,{get when(){return e.practice_end_result},get fallback(){return[(()=>{var t=St(),l=t.firstChild,c=l.nextSibling;return c.nextSibling,d(t,()=>e.match_color,c),t})(),Ct(),xt()]},get children(){return[pe(),ve()]}}),(()=>{var t=dt(),l=t.firstChild,c=l.nextSibling;return l.$$click=()=>e.restart_match(),c.$$click=()=>e.end_match_or_moves(),t})()]}}),h(D,{get when(){return e.mode==="moves"},get children(){return[mt(),h(x,{get when(){return e.practice_end_result},get fallback(){return[Mt(),Et()]},get children(){return[pe(),ve()]}}),(()=>{var t=pt(),l=t.firstChild,c=l.nextSibling;return l.$$click=()=>{e.restart_moves()},c.$$click=()=>e.end_match_or_moves(),t})()]}})]}})),F(t=>{var l=j().site,c="fbt first"+(_().can_navigate_prev?"":" disabled"),w="fbt prev"+(_().can_navigate_prev?"":" disabled"),v="fbt next"+(_().can_navigate_next?"":" disabled"),y="fbt last"+(_().can_navigate_next?"":" disabled"),A="tab"+Z("practice"),N="tab"+Z("quiz");return l!==t.e&&Le(Se,"href",t.e=l),c!==t.t&&C(H,t.t=c),w!==t.a&&C(K,t.a=w),v!==t.o&&C(U,t.o=v),y!==t.i&&C(le,t.i=y),A!==t.n&&C(J,t.n=A),N!==t.s&&C(ne,t.s=N),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),s})()};Ye(["click"]);export{Gt as default};
