var N=Object.defineProperty;var b=(a,t,e)=>t in a?N(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>(b(a,typeof t!="symbol"?t+"":t,e),e);const w=(a=p)=>({headers:a(),moves:new k});class k{constructor(){this.children=[]}*mainline(){let t=this;for(;t.children.length;){const e=t.children[0];yield e.data,t=e}}}class _ extends k{constructor(t){super(),this.data=t}}const p=()=>new Map([["Event","?"],["Site","?"],["Date","????.??.??"],["Round","?"],["White","?"],["Black","?"],["Result","*"]]),B="\uFEFF",o=a=>/^\s*$/.test(a),u=a=>a.startsWith("%");class v extends Error{}class C{constructor(t,e=p,s=1e6){this.emitGame=t,this.initHeaders=e,this.maxBudget=s,this.lineBuf=[],this.resetGame(),this.state=0}resetGame(){this.budget=this.maxBudget,this.found=!1,this.state=1,this.game=w(this.initHeaders),this.stack=[{parent:this.game.moves,root:!0}],this.commentBuf=[]}consumeBudget(t){if(this.budget-=t,this.budget<0)throw new v("ERR_PGN_BUDGET")}parse(t,e){if(!(this.budget<0))try{let s=0;for(;;){const i=t.indexOf(`
`,s);if(i===-1)break;const h=i>s&&t[i-1]==="\r"?i-1:i;this.consumeBudget(i-s),this.lineBuf.push(t.slice(s,h)),s=i+1,this.handleLine()}this.consumeBudget(t.length-s),this.lineBuf.push(t.slice(s)),e!=null&&e.stream||(this.handleLine(),this.emit(void 0))}catch(s){this.emit(s)}}handleLine(){let t=!0,e=this.lineBuf.join("");this.lineBuf=[];e:for(;;)switch(this.state){case 0:e.startsWith(B)&&(e=e.slice(B.length)),this.state=1;case 1:if(o(e)||u(e))return;this.found=!0,this.state=2;case 2:{if(u(e))return;let s=!0;for(;s;)s=!1,e=e.replace(/^\s*\[([A-Za-z0-9][A-Za-z0-9_+#=:-]*)\s+"((?:[^"\\]|\\"|\\\\)*)"\]/,(i,h,n)=>(this.consumeBudget(200),this.game.headers.set(h,n.replace(/\\"/g,'"').replace(/\\\\/g,"\\")),s=!0,t=!1,""));if(o(e))return;this.state=3}case 3:{if(t){if(u(e))return;if(o(e))return this.emit(void 0)}const s=/(?:[NBKRQ]?[a-h]?[1-8]?[-x]?[a-h][1-8](?:=?[nbrqkNBRQK])?|[pnbrqkPNBRQK]?@[a-h][1-8]|O-O-O|0-0-0|O-O|0-0)[+#]?|--|Z0|0000|@@@@|{|;|\$\d{1,4}|[?!]{1,2}|\(|\)|\*|1-0|0-1|1\/2-1\/2/g;let i;for(;i=s.exec(e);){const h=this.stack[this.stack.length-1];let n=i[0];if(n===";")return;if(n.startsWith("$"))this.handleNag(parseInt(n.slice(1),10));else if(n==="!")this.handleNag(1);else if(n==="?")this.handleNag(2);else if(n==="!!")this.handleNag(3);else if(n==="??")this.handleNag(4);else if(n==="!?")this.handleNag(5);else if(n==="?!")this.handleNag(6);else if(n==="1-0"||n==="0-1"||n==="1/2-1/2"||n==="*")this.stack.length===1&&n!=="*"&&this.game.headers.set("Result",n);else if(n==="(")this.consumeBudget(100),this.stack.push({parent:h.parent,root:!1});else if(n===")")this.stack.length>1&&this.stack.pop();else if(n==="{"){const l=s.lastIndex,m=e[l]===" "?l+1:l;e=e.slice(m),this.state=4;continue e}else this.consumeBudget(100),n==="Z0"||n==="0000"||n==="@@@@"?n="--":n.startsWith("0")&&(n=n.replace(/0/g,"O")),h.node&&(h.parent=h.node),h.node=new _({san:n,startingComments:h.startingComments}),h.startingComments=void 0,h.root=!1,h.parent.children.push(h.node)}return}case 4:{const s=e.indexOf("}");if(s===-1){this.commentBuf.push(e);return}else{const i=s>0&&e[s-1]===" "?s-1:s;this.commentBuf.push(e.slice(0,i)),this.handleComment(),e=e.slice(s),this.state=3,t=!1}}}}handleNag(t){var e;this.consumeBudget(50);const s=this.stack[this.stack.length-1];s.node&&((e=s.node.data).nags||(e.nags=[]),s.node.data.nags.push(t))}handleComment(){var t,e;this.consumeBudget(100);const s=this.stack[this.stack.length-1],i=this.commentBuf.join(`
`);this.commentBuf=[],s.node?((t=s.node.data).comments||(t.comments=[]),s.node.data.comments.push(i)):s.root?((e=this.game).comments||(e.comments=[]),this.game.comments.push(i)):(s.startingComments||(s.startingComments=[]),s.startingComments.push(i))}emit(t){if(this.state===4&&this.handleComment(),t)return this.emitGame(this.game,t);this.found&&this.emitGame(this.game,void 0),this.resetGame()}}const O=(a,t=p)=>{const e=[];return new C(s=>e.push(s),t,NaN).parse(a),e},y=(a,t)=>{let e=a.map(s=>{let i=s.moves,h=s.headers.get("Site"),n=s.headers.get("Event"),l;if(n.includes(": "))[t,l]=n.split(": ");else{let m=s.headers.get("White"),x=s.headers.get("Black");l=`${m} vs ${x} at ${n}`}return{name:l,site:h,moves:i}});return{name:t,chapters:e}},E=(a,t)=>fetch(`pgns/${a}.pgn`).then(e=>e.text()).then(e=>y(O(e),t)),c=class c{read_study(t){let e=P.study_name_by_id(t);return E(t,e)}};r(c,"init",()=>new c);let f=c;const M=f.init(),G={Openings:[["Slav Defense","TCnt4Tx7"],["Sicilian Defense","dgldIBYr"],["French Defense","bLcOj6sO"],["e4 vs Minor Defenses","F8wyMEli"],["Spanish Opening",""]],Masters:[["Bobby Fischer 60 Memorable Games","nk2t0m1n"],["Magnus Carlsen 2023",""],["Tata Steel 2023",""]],Tactics:[["50 Puzzles 1600","u1600"],["50 Puzzles 2000","u2000"],["50 Puzzles 2200","u2200"]],Endgames:[["100 Endgames You Must Know",""],["King and Pawn Endgames",""]]},d=class d{constructor(){r(this,"all");r(this,"openings");r(this,"masters");r(this,"tactics");r(this,"endgames");r(this,"recent");r(this,"completed")}study_name_by_id(t){return this.all.find(s=>s.study_link===t).study_name}};r(d,"init",()=>{function t(s){return G[s].map(i=>({category:s,study_name:i[0],study_link:i[1]}))}let e=new d;return e.openings=t("Openings"),e.masters=t("Masters"),e.tactics=t("Tactics"),e.endgames=t("Endgames"),e.all=[...e.openings,...e.masters,...e.tactics,...e.endgames],e.recent=[],e.completed=[],e});let g=d;const P=g.init();export{P as R,M as S};
