var ae=Object.defineProperty;var le=(i,e,t)=>e in i?ae(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var P=(i,e,t)=>(le(i,typeof e!="symbol"?e+"":e,t),t);import{h as L,j as oe,k as ie,i as d,c as p,S as ne,b as u,l as g,m as A,o as E,n as ce,f as R,g as _e,F as H,s as T,M as O,p as he,e as de,q as me,d as pe,t as o}from"./index-DPH8FDkZ.js";/* empty css                   */import{S as ue}from"./studyrepo-DyPKlVR-.js";import{S as ve,C as ge}from"./Shalala-BDueUcDD.js";import{T as $e,a as j,C as fe}from"./Chesstree2-D_p2KVAz.js";import{I as be,M as we}from"./chess_pgn_logic-CBf0qoYW.js";import{m as ke}from"./index-CT_n0A0s.js";class K{constructor(e,t){P(this,"_solved_paths");this.study_name=e,this._solved_paths=ke(L([[],[]]),{name:`.repertoire_stat.name.${e}.chapter.${t}`})}set solved_paths(e){this._solved_paths[1](e)}get solved_paths(){return this._solved_paths[0]()}}var ye=o("<div class=progress><div class=bar></div><h3>"),Se=o("<div class=repertoire-wrap>"),Ce=o("<small> Click on variations to expand. "),xe=o("<small> Your goal is to guess every move correctly to fill up the progress bar. "),Me=o("<h2>Select a Practice Option"),Pe=o("<button><span> Play all Moves "),Ee=o("<button><span> Play as Match "),Re=o("<h2>Play as Match"),Te=o("<small> Try to guess the moves for <!>."),Le=o("<small> AI will play the next move, picking a random variation. "),Ae=o("<small> Moves will be hidden once the game is started. "),Ie=o("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Ne=o("<h2>Play all moves"),De=o("<small>Try to guess the moves for both sides."),Oe=o("<small>Moves will be hidden once you start."),je=o("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Fe=o("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools></div></div></div><div class=under><br><br><br>"),qe=o("<li><div><h3></h3> "),Ye=o('<div class=line><span class="fill white"></span><span class="fill black">');const Be=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Ge=i=>Be[Math.floor((1-i/10)*6)];class He{constructor(){P(this,"_mode");P(this,"_match_color");this._mode=L(void 0,{equals:!1}),this._match_color=L("white")}get mode(){return this._mode[0]()}set mode(e){this._mode[1](e)}get match_color(){return this._match_color[0]()}set match_color(e){this._match_color[1](e)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}}const Q=i=>(()=>{var e=ye(),t=e.firstChild,s=t.nextSibling;return d(s,()=>`%${i.width}`),R(a=>T(t,`width: ${i.width}%`,a)),e})();class Ke{constructor(e){this.chapters=e}get progress(){let e=this.chapters.length;return this.chapters.map(t=>Math.round(t.progress/e)).reduce((t,s)=>t+s)}}class k{constructor(e,t,s,a){this.study_name=e,this.i_chapter=t,this.score_tree=s,this.solved_paths=a}static load_from_store(e,t){let s=new K(e.name,t);return k.make(e.name,t,e.chapters[t].pgn.tree,j.set_for_saving(s.solved_paths))}static save_paths_to_store(e){let t=new K(e.study_name,e.i_chapter);t.solved_paths=e.solved_paths.get_for_saving()}static make(e,t,s,a=new j){return new k(e,t,we.make(s),a)}get progress(){return Math.floor(this.solved_paths.expand_paths.map(e=>{var t;return((t=this.score_tree.get_at(e))==null?void 0:t.score)??0}).reduce((e,t)=>e+t,0)*100)}get progress_map(){let e=A(()=>this.score_tree.progress_paths);const t=A(()=>e.map(s=>[s.filter(a=>a.length%2===1).map(a=>this.score_tree.get_at(a).score).reduce((a,$)=>a+$,0),s.filter(a=>a.length%2===0).map(a=>this.score_tree.get_at(a).score).reduce((a,$)=>a+$,0)]));return e.map((s,a)=>{let $=s[0],b=s[s.length-1],y=t[a][0],S=t[a][1],m=u(()=>this.solved_paths.expand_paths),w=u(()=>m().filter(_=>s.some(r=>r.join("")===_.join("")))),C=u(()=>w().filter(_=>_.length%2===1).map(_=>this.score_tree.get_at(_).score).reduce((_,r)=>_+r,0)),I=u(()=>w().filter(_=>_.length%2===0).map(_=>this.score_tree.get_at(_).score).reduce((_,r)=>_+r,0));return{color:Ge($.length/20+b.length/10),total:y*2,black:u(()=>I()/S),white:u(()=>C()/y),path:b}}).reverse()}merge_and_save_stats(e){this.solved_paths.merge_dup(e.solved_paths),k.save_paths_to_store(this)}}const tt=()=>{const i=oe(),[e]=ie(i.id,ue.read_study);return(()=>{var t=Se();return d(t,p(ne,{get when(){return!e.loading},fallback:"Loading...",get children(){return p(Qe,{get study(){return e()}})}})),t})()},Qe=i=>{const e=()=>i.study;let t=new He,s=new ve;const[a,$]=L(0);let b=u(()=>{const r=e();return new Ke(r.chapters.map((n,f)=>k.load_from_store(r,f)))}),y=u(()=>b().chapters[a()]);const S=u(()=>e().chapters[a()]),m=u(()=>{t.mode;let r=S();return $e.make(r.pgn.tree.clone)});g(()=>{m().solved_paths.replace_all(y().solved_paths)});const w=u(()=>{let r=m().tree;return A(()=>k.make(e().name,a(),r,new j))});g(()=>{A(()=>w()).solved_paths.replace_all(m().solved_paths)}),g(E(()=>[w(),y()],(r,n)=>{if(n){let[f,N]=n;N.merge_and_save_stats(f)}})),g(()=>{let{mode:r,match_color:n}=t;r==="match"&&n==="black"&&setTimeout(()=>{m().reveal_one_random()},400)}),g(E(()=>s.add_uci,r=>{if(!r)return;m().try_next_uci_fail(r)&&t.mode==="match"&&setTimeout(()=>{m().reveal_one_random()},400)})),g(E(()=>m().fen_last_move,r=>{if(r){let[n,f]=r;s.on_set_fen_uci(n,f)}else s.on_set_fen_uci(be)})),g(E(()=>s.on_wheel,r=>{r&&m().on_wheel(r)}));const C=r=>{r.key==="f"&&t.flip_match_color()};document.addEventListener("keypress",C),ce(()=>{document.removeEventListener("keypress",C)});const I=r=>{const n=r.target;n.tagName!=="PIECE"&&n.tagName!=="SQUARE"&&n.tagName!=="CG-BOARD"||(r.preventDefault(),s.set_on_wheel(Math.sign(r.deltaY)))};g(()=>{t.match_color=e().orientation??"white"});const _=u(()=>w().progress_map);return(()=>{var r=Fe(),n=r.firstChild,f=n.firstChild,N=f.nextSibling,D=N.firstChild,U=D.firstChild,W=D.nextSibling,F=n.nextSibling,q=F.nextSibling,z=q.nextSibling,Y=z.firstChild,B=Y.firstChild,J=B.firstChild,V=J.nextSibling,X=B.nextSibling,Z=X.firstChild,ee=Y.nextSibling,G=ee.firstChild,te=G.nextSibling;return r.addEventListener("wheel",I),d(U,()=>e().name),d(D,p(Q,{get width(){return b().progress}}),null),d(W,p(H,{get each(){return e().chapters},children:(l,c)=>(()=>{var h=qe(),x=h.firstChild,v=x.firstChild;return v.nextSibling,h.$$click=()=>$(c()),d(v,()=>l.name),d(x,p(Q,{get width(){var M;return((M=b())==null?void 0:M.chapters[c()].progress)??0}}),null),R(()=>_e(h,c()===a()?"active":"")),h})()})),d(F,p(ge,{get orientation(){return t.match_color},get movable(){return t.mode!==void 0},get doPromotion(){return s.promotion},get onMoveAfter(){return s.on_move_after},get fen_uci(){return s.fen_uci},get color(){return s.turnColor},get dests(){return s.dests}})),d(q,p(H,{get each(){return _()},children:l=>(()=>{var c=Ye(),h=c.firstChild,x=h.nextSibling;return c.$$click=v=>m().try_set_cursor_path(l.path),R(v=>{var M=`background: ${l.color}; height: ${Math.round(l.total*100)}%`,re=`height: ${Math.round(l.white()*100)}%`,se=`height: ${Math.round(l.black()*100)}%`;return v.e=T(c,M,v.e),v.t=T(h,re,v.t),v.a=T(x,se,v.a),v},{e:void 0,t:void 0,a:void 0}),c})()})),d(V,()=>S().name),d(G,p(fe,{get lala(){return m()}})),d(te,p(de,{get children(){return[p(O,{get when(){return t.mode===void 0},get children(){return[Ce(),xe(),Me(),(()=>{var l=Pe();return l.$$click=()=>t.mode="moves",l})(),(()=>{var l=Ee();return l.$$click=()=>t.mode="match",l})()]}}),p(O,{get when(){return t.mode==="match"},get children(){return[Re(),(()=>{var l=Te(),c=l.firstChild,h=c.nextSibling;return h.nextSibling,d(l,()=>t.match_color,h),l})(),Le(),Ae(),(()=>{var l=Ie(),c=l.firstChild,h=c.nextSibling;return c.$$click=()=>{he(()=>{t.mode="match",t.flip_match_color()})},h.$$click=()=>t.mode=void 0,l})()]}}),p(O,{get when(){return t.mode==="moves"},get children(){return[Ne(),De(),Oe(),(()=>{var l=je(),c=l.firstChild,h=c.nextSibling;return c.$$click=()=>{t.mode="moves"},h.$$click=()=>t.mode=void 0,l})()]}})]}})),R(()=>me(Z,"href",S().site)),r})()};pe(["click"]);export{tt as default};
