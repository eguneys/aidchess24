var te=Object.defineProperty;var re=(e,t,r)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var F=(e,t,r)=>(re(e,typeof t!="symbol"?t+"":t,r),r);import{$ as se,h as A,j as le,k as ne,l as oe,m as ie,b as V,n as S,o as x,p as ae,i as g,c as b,F as ce,f as U,g as he,S as W,s as ee,e as de,M as Y,q as ue,r as _e,d as fe,t as p}from"./index-BJhK7sSu.js";/* empty css                   */import{S as me}from"./studyrepo-CYHmw0L0.js";import{S as pe,C as ve}from"./Shalala-BAHuyHly.js";import{C as $e,T as ge}from"./Chesstree2-DFzYCcsN.js";import{I as we,M as be}from"./chess_pgn_logic-DwF2uhPO.js";const ye=Symbol("store-raw"),Se=Symbol("store-node"),R=Symbol("store-has"),Ce=Symbol("store-self");function J(e){let t;return e!=null&&typeof e=="object"&&(e[se]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function B(e,t=new Set){let r,i,l,o;if(r=e!=null&&e[ye])return r;if(!J(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let _=0,c=e.length;_<c;_++)l=e[_],(i=B(l,t))!==l&&(e[_]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const _=Object.keys(e),c=Object.getOwnPropertyDescriptors(e);for(let f=0,h=_.length;f<h;f++)o=_[f],!c[o].get&&(l=e[o],(i=B(l,t))!==l&&(e[o]=i))}return e}function Oe(e,t){let r=e[t];return r||Object.defineProperty(e,t,{value:r=Object.create(null)}),r}function H(e,t,r){if(e[t])return e[t];const[i,l]=A(r,{equals:!1,internal:!0});return i.$=l,e[t]=i}function k(e,t,r,i=!1){if(!i&&e[t]===r)return;const l=e[t],o=e.length;r===void 0?(delete e[t],e[R]&&e[R][t]&&l!==void 0&&e[R][t].$()):(e[t]=r,e[R]&&e[R][t]&&l===void 0&&e[R][t].$());let _=Oe(e,Se),c;if((c=H(_,t,l))&&c.$(()=>r),Array.isArray(e)&&e.length!==o){for(let f=e.length;f<o;f++)(c=_[f])&&c.$();(c=H(_,"length",o))&&c.$(e.length)}(c=_[Ce])&&c.$()}const G=Symbol("store-root");function j(e,t,r,i,l){const o=t[r];if(e===o)return;const _=Array.isArray(e);if(r!==G&&(!J(e)||!J(o)||_!==Array.isArray(o)||l&&e[l]!==o[l])){k(t,r,e);return}if(_){if(e.length&&o.length&&(!i||l&&e[0]&&e[0][l]!=null)){let h,n,u,w,$,y,m,s;for(u=0,w=Math.min(o.length,e.length);u<w&&(o[u]===e[u]||l&&o[u]&&e[u]&&o[u][l]===e[u][l]);u++)j(e[u],o,u,i,l);const a=new Array(e.length),d=new Map;for(w=o.length-1,$=e.length-1;w>=u&&$>=u&&(o[w]===e[$]||l&&o[u]&&e[u]&&o[w][l]===e[$][l]);w--,$--)a[$]=o[w];if(u>$||u>w){for(n=u;n<=$;n++)k(o,n,e[n]);for(;n<e.length;n++)k(o,n,a[n]),j(e[n],o,n,i,l);o.length>e.length&&k(o,"length",e.length);return}for(m=new Array($+1),n=$;n>=u;n--)y=e[n],s=l&&y?y[l]:y,h=d.get(s),m[n]=h===void 0?-1:h,d.set(s,n);for(h=u;h<=w;h++)y=o[h],s=l&&y?y[l]:y,n=d.get(s),n!==void 0&&n!==-1&&(a[n]=o[h],n=m[n],d.set(s,n));for(n=u;n<e.length;n++)n in a?(k(o,n,a[n]),j(e[n],o,n,i,l)):k(o,n,e[n])}else for(let h=0,n=e.length;h<n;h++)j(e[h],o,h,i,l);o.length>e.length&&k(o,"length",e.length);return}const c=Object.keys(e);for(let h=0,n=c.length;h<n;h++)j(e[c[h]],o,c[h],i,l);const f=Object.keys(o);for(let h=0,n=f.length;h<n;h++)e[f[h]]===void 0&&k(o,f[h],void 0)}function ke(e,t={}){const{merge:r,key:i="id"}=t,l=B(e);return o=>{if(!J(o)||!J(l))return l;const _=j(l,{[G]:o},G,r,i);return _===void 0?o:_}}var Ae=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Pe=e=>(typeof e.clear=="function"||(e.clear=()=>{let t;for(;t=e.key(0);)e.removeItem(t)}),e),xe=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function Ee(e){if(!e)return"";let t="";for(const r in e){if(!xe.includes(r))continue;const i=e[r];t+=i instanceof Date?`; ${r}=${i.toUTCString()}`:typeof i=="boolean"?`; ${r}`:`; ${r}=${i}`}return t}function Ie(e,t){var r;return((r=e.match(`(^|;)\\s*${t}\\s*=\\s*([^;]+)`))==null?void 0:r.pop())??null}var Q;try{Q=Ae("solid-start/server").useRequest}catch{Q=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var N=Pe({_read:()=>document.cookie,_write:(e,t,r)=>{document.cookie=`${e}=${t}${Ee(r)}`},getItem:(e,t)=>Ie(N._read(t),e),setItem:(e,t,r)=>{N._write(e,t,r);{const l=Object.assign(new Event("storage"),{key:e,oldValue:null,newValue:t,url:globalThis.document.URL,storageArea:N});window.dispatchEvent(l)}},removeItem:(e,t)=>{N._write(e,"deleted",{...t,expires:new Date(0)})},key:(e,t)=>{let r=null,i=0;return N._read(t).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(l,o)=>(!r&&o&&i++===e&&(r=o),"")),r},getLength:e=>{let t=0;return N._read(e).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,r=>(t+=r?1:0,"")),t},get length(){return this.getLength()}});function Me(e,t={}){const r=t.storage||globalThis.localStorage;if(!r)return e;const i=t.storageOptions,l=t.name||`storage-${le()}`,o=t.serialize||JSON.stringify.bind(JSON),_=t.deserialize||JSON.parse.bind(JSON),c=r.getItem(l,i),f=typeof e[0]=="function"?n=>e[1](()=>_(n)):n=>e[1](ke(_(n)));let h=!0;return c instanceof Promise?c.then(n=>h&&n&&f(n)):c&&f(c),[e[0],typeof e[0]=="function"?n=>{const u=e[1](n);return n?r.setItem(l,o(u),i):r.removeItem(l,i),h=!1,u}:(...n)=>{e[1](...n);const u=o(ne(()=>e[0]));r.setItem(l,u,i),h=!1}]}class X{constructor(t,r){F(this,"_solved_paths");this.study_name=t,this._solved_paths=Me(A([]),{name:`.repertoire_stat.name.${t}.chapter.${r}`})}set solved_paths(t){this._solved_paths[1](t)}get solved_paths(){return this._solved_paths[0]()}}var qe=p("<div class=progress><div class=bar></div><h3>"),Re=p("<div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul>"),Ne=p("<div class=repertoire>"),je=p("<li><div><h3></h3> "),Te=p("<div class=board-wrap>"),Le=p("<div class=eval-gauge><div class=white style=height:100%> </div><div class=score>"),ze=p("<small> Click on variations to expand. "),De=p("<small> Your goal is to guess every move correctly to fill up the progress bar. "),Fe=p("<h2>Select a Practice Option"),Je=p("<button><span> Play all Moves "),Ke=p("<button><span> Play as Match "),Ue=p("<h2>Play as Match"),Ve=p("<small> Try to guess the moves for <!>."),We=p("<small> AI will play the next move, picking a random variation. "),Ye=p("<small> Moves will be hidden once the game is started. "),Be=p("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),Ge=p("<h2>Play all moves"),He=p("<small>Try to guess the moves for both sides."),Qe=p("<small>Moves will be hidden once you start."),Xe=p("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Ze=p("<div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>");class et{constructor(){F(this,"_mode");F(this,"_match_color");this._mode=A(void 0,{equals:!1}),this._match_color=A("white")}get mode(){return this._mode[0]()}set mode(t){this._mode[1](t)}get match_color(){return this._match_color[0]()}set match_color(t){this._match_color[1](t)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}}const Z=e=>(()=>{var t=qe(),r=t.firstChild,i=r.nextSibling;return g(i,()=>`%${e.width}`),U(l=>ee(r,`width: ${e.width}%`,l)),t})();class tt{constructor(t){this.chapters=t}get progress(){let t=this.chapters.length;return this.chapters.map(r=>Math.round(r.progress/t)).reduce((r,i)=>r+i)}}class T{constructor(t,r){F(this,"_solved_paths");this.score_tree=t,this._solved_paths=A(r,{equals:!1})}static load_from_store(t,r){let i=new X(t.name,r);return T.make(t.chapters[r].pgn.tree,i.solved_paths)}static save_paths_to_store(t,r,i){let l=new X(t.name,r);l.solved_paths=i.solved_paths}static make(t,r=[]){return new T(be.make(t),r)}get solved_paths(){return this._solved_paths[0]()}set solved_paths(t){this._solved_paths[1](t)}get progress(){return Math.floor(this.solved_paths.map(t=>{var r;return((r=this.score_tree.get_at(t))==null?void 0:r.score)??0}).reduce((t,r)=>t+r,0)*100)}merge_stats(t){this.solved_paths=rt(this.solved_paths,t.solved_paths)}}const ht=()=>{const e=oe(),[t]=ie(e.id,me.read_study);let r=V(()=>{const s=t();if(s)return new tt(s.chapters.map((a,d)=>T.load_from_store(s,d)))}),i=V(()=>{var s;return(s=r())==null?void 0:s.chapters[l()]});const[l,o]=A(0),_=V(()=>{var s;return(s=t())==null?void 0:s.chapters[l()]});let c=new pe,[f,h]=A(void 0);S(()=>{m.mode;let s=_();if(s){let a=ge.make(s.pgn.tree.clone);a.solved_paths=i().solved_paths.slice(0),h(a)}});let[n,u]=A(void 0);S(x(()=>m.mode,s=>{if(s!==void 0){let a=f().tree;u(T.make(a))}})),S(x(()=>{var s;return(s=f())==null?void 0:s.solved_paths},s=>{if(s){let a=n();a&&(a.solved_paths=s)}}));const w=()=>{let s=t(),a=l(),d=i();!s||!d||(d.merge_stats(n()),T.save_paths_to_store(s,a,d))};S(x(()=>m.mode,s=>{s||w()})),S(()=>{let{mode:s,match_color:a}=m;s==="match"&&a==="black"&&setTimeout(()=>{var d;(d=f())==null||d.reveal_one_random()},400)}),S(x(()=>c.add_uci,s=>{var d;if(!s)return;((d=f())==null?void 0:d.try_next_uci_fail(s))&&m.mode==="match"&&setTimeout(()=>{var C;(C=f())==null||C.reveal_one_random()},400)})),S(x(()=>{var s;return(s=f())==null?void 0:s.solved_paths},s=>{})),S(x(()=>{var s;return(s=f())==null?void 0:s.fen_last_move},s=>{if(s){let[a,d]=s;c.on_set_fen_uci(a,d)}else c.on_set_fen_uci(we)})),S(x(()=>c.on_wheel,s=>{var a;s&&((a=f())==null||a.on_wheel(s))}));const $=s=>{s.key==="f"&&m.flip_match_color()};document.addEventListener("keypress",$),ae(()=>{document.removeEventListener("keypress",$)});const y=s=>{const a=s.target;a.tagName!=="PIECE"&&a.tagName!=="SQUARE"&&a.tagName!=="CG-BOARD"||(s.preventDefault(),c.set_on_wheel(Math.sign(s.deltaY)))};let m=new et;return S(()=>{var s;m.match_color=((s=t())==null?void 0:s.orientation)??"white"}),(()=>{var s=Ne();return s.addEventListener("wheel",y),g(s,b(W,{get when(){return!t.loading},fallback:"Loading...",get children(){var a=Re(),d=a.firstChild,C=d.nextSibling,O=C.firstChild,L=O.firstChild,E=O.nextSibling;return g(L,()=>t().name),g(O,b(Z,{get width(){var I;return((I=r())==null?void 0:I.progress)??0}}),null),g(E,b(ce,{get each(){return t().chapters},children:(I,z)=>(()=>{var M=je(),D=M.firstChild,K=D.firstChild;return K.nextSibling,M.$$click=()=>o(z()),g(K,()=>I.name),g(D,b(Z,{get width(){var v;return((v=r())==null?void 0:v.chapters[z()].progress)??0}}),null),U(()=>he(M,z()===l()?"active":"")),M})()})),a}}),null),g(s,b(W,{get when(){return _()},children:a=>[(()=>{var d=Te();return g(d,b(ve,{get orientation(){return m.match_color},get movable(){return m.mode!==void 0},get doPromotion(){return c.promotion},get onMoveAfter(){return c.on_move_after},get fen_uci(){return c.fen_uci},get color(){return c.turnColor},get dests(){return c.dests}})),d})(),(()=>{var d=Le(),C=d.firstChild,O=C.nextSibling;return U(L=>{var E;return ee(O,`height: ${((E=n())==null?void 0:E.progress)??0}%`,L)}),d})(),(()=>{var d=Ze(),C=d.firstChild,O=C.firstChild,L=O.firstChild,E=L.nextSibling,I=O.nextSibling,z=I.firstChild,M=C.nextSibling,D=M.firstChild,K=D.nextSibling;return g(E,()=>a().name),g(D,b(W,{get when(){return f()},children:v=>b($e,{get lala(){return v()}})})),g(K,b(de,{get children(){return[b(Y,{get when(){return m.mode===void 0},get children(){return[ze(),De(),Fe(),(()=>{var v=Je();return v.$$click=()=>m.mode="moves",v})(),(()=>{var v=Ke();return v.$$click=()=>m.mode="match",v})()]}}),b(Y,{get when(){return m.mode==="match"},get children(){return[Ue(),(()=>{var v=Ve(),P=v.firstChild,q=P.nextSibling;return q.nextSibling,g(v,()=>m.match_color,q),v})(),We(),Ye(),(()=>{var v=Be(),P=v.firstChild,q=P.nextSibling;return P.$$click=()=>{ue(()=>{m.mode="match",m.flip_match_color()})},q.$$click=()=>m.mode=void 0,v})()]}}),b(Y,{get when(){return m.mode==="moves"},get children(){return[Ge(),He(),Qe(),(()=>{var v=Xe(),P=v.firstChild,q=P.nextSibling;return P.$$click=()=>{m.mode="moves"},q.$$click=()=>m.mode=void 0,v})()]}})]}})),U(()=>_e(z,"href",a().site)),d})()]}),null),s})()};function rt(e,t){let r=e.slice(0);return t.forEach(i=>{r.every(l=>l.join("")!==i.join(""))&&r.push(i)}),r}fe(["click"]);export{ht as default};
