var Sn=Object.defineProperty;var Mn=(e,n,o)=>n in e?Sn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;var _=(e,n,o)=>(Mn(e,typeof n!="symbol"?n+"":n,o),o);import{x as xn,n as z,v as Ve,t as B,d as $n,h as H,k as se,o as qn,q as he,i as K,c as P,S as Ze,e as An,M as De,F as Ee,f as Dn,g as En,b as ae}from"./index-BQ70uqJh.js";import{m as Te,s as Tn,I as we,a as On,C as Oe,p as Ne,b as Nn,c as Kn,d as Wn}from"./chess_pgn_logic-B22neYOF.js";const Ln=(e,n)=>{const o=new Map,t=e.ctx();for(const[r,i]of e.allDests(t))if(i.nonEmpty()){const c=Array.from(i,Te);!(n!=null&&n.chess960)&&r===t.king&&Tn(r)===4&&(i.has(0)?c.push("c1"):i.has(56)&&c.push("c8"),i.has(7)?c.push("g1"):i.has(63)&&c.push("g8")),o.set(Te(r),c)}return o},Rn=["white","black"],_e=["a","b","c","d","e","f","g","h"],ye=["1","2","3","4","5","6","7","8"],Hn=[...ye].reverse(),ke=Array.prototype.concat(..._e.map(e=>ye.map(n=>e+n))),S=e=>ke[8*e[0]+e[1]],m=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Ge=ke.map(m);function zn(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const jn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},Ce=e=>e==="white"?"black":"white",Y=(e,n)=>{const o=e[0]-n[0],t=e[1]-n[1];return o*o+t*t},pe=(e,n)=>e.role===n.role&&e.color===n.color,X=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],E=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},Ue=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},Pe=(e,n)=>{e.style.visibility=n?"visible":"hidden"},I=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ye=e=>{var n;return(((n=e.buttons)!==null&&n!==void 0?n:0)&2)===2},O=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Xe(e,n,o){const t=m(e);return n||(t[0]=7-t[0],t[1]=7-t[1]),[o.left+o.width*t[0]/8+o.width/16,o.top+o.height*(7-t[1])/8+o.height/16]}const j=(e,n)=>Math.abs(e-n),Bn=e=>(n,o,t,r)=>j(n,t)<2&&(e==="white"?r===o+1||o<=1&&r===o+2&&n===t:r===o-1||o>=6&&r===o-2&&n===t),Qe=(e,n,o,t)=>{const r=j(e,o),i=j(n,t);return r===1&&i===2||r===2&&i===1},Je=(e,n,o,t)=>j(e,o)===j(n,t),en=(e,n,o,t)=>e===o||n===t,nn=(e,n,o,t)=>Je(e,n,o,t)||en(e,n,o,t),In=(e,n,o)=>(t,r,i,c)=>j(t,i)<2&&j(r,c)<2||o&&r===c&&r===(e==="white"?0:7)&&(t===4&&(i===2&&n.includes(0)||i===6&&n.includes(7))||n.includes(i));function Fn(e,n){const o=n==="white"?"1":"8",t=[];for(const[r,i]of e)r[1]===o&&i.color===n&&i.role==="rook"&&t.push(m(r)[0]);return t}function on(e,n,o){const t=e.get(n);if(!t)return[];const r=m(n),i=t.role,c=i==="pawn"?Bn(t.color):i==="knight"?Qe:i==="bishop"?Je:i==="rook"?en:i==="queen"?nn:In(t.color,Fn(e,t.color),o);return Ge.filter(s=>(r[0]!==s[0]||r[1]!==s[1])&&c(r[0],r[1],s[0],s[1])).map(S)}function y(e,...n){e&&setTimeout(()=>e(...n),1)}function Vn(e){e.orientation=Ce(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Zn(e,n){for(const[o,t]of n)t?e.pieces.set(o,t):e.pieces.delete(o)}function Gn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,t]of e.pieces)t.role==="king"&&t.color===n&&(e.check=o)}function Un(e,n,o,t){L(e),e.premovable.current=[n,o],y(e.premovable.events.set,n,o,t)}function W(e){e.premovable.current&&(e.premovable.current=void 0,y(e.premovable.events.unset))}function Yn(e,n,o){W(e),e.predroppable.current={role:n,key:o},y(e.predroppable.events.set,n,o)}function L(e){const n=e.predroppable;n.current&&(n.current=void 0,y(n.events.unset))}function Xn(e,n,o){if(!e.autoCastle)return!1;const t=e.pieces.get(n);if(!t||t.role!=="king")return!1;const r=m(n),i=m(o);if(r[1]!==0&&r[1]!==7||r[1]!==i[1])return!1;r[0]===4&&!e.pieces.has(o)&&(i[0]===6?o=S([7,i[1]]):i[0]===2&&(o=S([0,i[1]])));const c=e.pieces.get(o);return!c||c.color!==t.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),r[0]<i[0]?(e.pieces.set(S([6,i[1]]),t),e.pieces.set(S([5,i[1]]),c)):(e.pieces.set(S([2,i[1]]),t),e.pieces.set(S([3,i[1]]),c)),!0)}function tn(e,n,o){const t=e.pieces.get(n),r=e.pieces.get(o);if(n===o||!t)return!1;const i=r&&r.color!==t.color?r:void 0;return o===e.selected&&M(e),y(e.events.move,n,o,i),Xn(e,n,o)||(e.pieces.set(o,t),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,y(e.events.change),i||!0}function Se(e,n,o,t){if(e.pieces.has(o))if(t)e.pieces.delete(o);else return!1;return y(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,y(e.events.change),e.movable.dests=void 0,e.turnColor=Ce(e.turnColor),!0}function rn(e,n,o){const t=tn(e,n,o);return t&&(e.movable.dests=void 0,e.turnColor=Ce(e.turnColor),e.animation.current=void 0),t}function ln(e,n,o){if(Me(e,n,o)){const t=rn(e,n,o);if(t){const r=e.hold.stop();M(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return t!==!0&&(i.captured=t),y(e.movable.events.after,n,o,i),!0}}else if(Jn(e,n,o))return Un(e,n,o,{ctrlKey:e.stats.ctrlKey}),M(e),!0;return M(e),!1}function cn(e,n,o,t){const r=e.pieces.get(n);r&&(Qn(e,n,o)||t)?(e.pieces.delete(n),Se(e,r,o,t),y(e.movable.events.afterNewPiece,r.role,o,{premove:!1,predrop:!1})):r&&eo(e,n,o)?Yn(e,r.role,o):(W(e),L(e)),e.pieces.delete(n),M(e)}function ge(e,n,o){if(y(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){M(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&ln(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(an(e,n)||xe(e,n))&&(sn(e,n),e.hold.start())}function sn(e,n){e.selected=n,xe(e,n)?e.premovable.customDests||(e.premovable.dests=on(e.pieces,n,e.premovable.castle)):e.premovable.dests=void 0}function M(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function an(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const Me=(e,n,o)=>{var t,r;return n!==o&&an(e,n)&&(e.movable.free||!!(!((r=(t=e.movable.dests)===null||t===void 0?void 0:t.get(n))===null||r===void 0)&&r.includes(o)))};function Qn(e,n,o){const t=e.pieces.get(n);return!!t&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function xe(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function Jn(e,n,o){var t,r;const i=(r=(t=e.premovable.customDests)===null||t===void 0?void 0:t.get(n))!==null&&r!==void 0?r:on(e.pieces,n,e.premovable.castle);return n!==o&&xe(e,n)&&i.includes(o)}function eo(e,n,o){const t=e.pieces.get(n),r=e.pieces.get(o);return!!t&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function no(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function oo(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],t=n[1];let r=!1;if(Me(e,o,t)){const i=rn(e,o,t);if(i){const c={premove:!0};i!==!0&&(c.captured=i),y(e.movable.events.after,o,t,c),r=!0}}return W(e),r}function to(e,n){const o=e.predroppable.current;let t=!1;if(!o)return!1;if(n(o)){const r={role:o.role,color:e.movable.color};Se(e,r,o.key)&&(y(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),t=!0)}return L(e),t}function $e(e){W(e),L(e),M(e)}function Ke(e){e.movable.color=e.movable.dests=e.animation.current=void 0,$e(e)}function F(e,n,o){let t=Math.floor(8*(e[0]-o.left)/o.width);n||(t=7-t);let r=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(r=7-r),t>=0&&t<8&&r>=0&&r<8?S([t,r]):void 0}function ro(e,n,o,t){const r=m(e),i=Ge.filter(l=>nn(r[0],r[1],l[0],l[1])||Qe(r[0],r[1],l[0],l[1])),s=i.map(l=>Xe(S(l),o,t)).map(l=>Y(n,l)),[,d]=s.reduce((l,u,a)=>l[0]<u?l:[u,a],[s[0],0]);return S(i[d])}const k=e=>e.orientation==="white",dn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",io={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},lo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function un(e){e==="start"&&(e=dn);const n=new Map;let o=7,t=0;for(const r of e)switch(r){case" ":case"[":return n;case"/":if(--o,o<0)return n;t=0;break;case"~":{const i=n.get(S([t-1,o]));i&&(i.promoted=!0);break}default:{const i=r.charCodeAt(0);if(i<57)t+=i-48;else{const c=r.toLowerCase();n.set(S([t,o]),{role:io[c],color:r===c?"black":"white"}),++t}}}return n}function co(e){return Hn.map(n=>_e.map(o=>{const t=e.get(o+n);if(t){let r=lo[t.role];return t.color==="white"&&(r=r.toUpperCase()),t.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function fn(e,n){n.animation&&(qe(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function hn(e,n){var o,t,r;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((t=n.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),qe(e,n),n.fen&&(e.pieces=un(n.fen),e.drawable.shapes=((r=n.drawable)===null||r===void 0?void 0:r.shapes)||[]),"check"in n&&Gn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&sn(e,e.selected),fn(e,n),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",c="e"+i,s=e.movable.dests.get(c),d=e.pieces.get(c);if(!s||!d||d.role!=="king")return;e.movable.dests.set(c,s.filter(l=>!(l==="a"+i&&s.includes("c"+i))&&!(l==="h"+i&&s.includes("g"+i))))}}function qe(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&We(e[o])&&We(n[o])?qe(e[o],n[o]):e[o]=n[o])}function We(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const R=(e,n)=>n.animation.enabled?uo(e,n):N(e,n);function N(e,n){const o=e(n);return n.dom.redraw(),o}const de=(e,n)=>({key:e,pos:m(e),piece:n}),so=(e,n)=>n.sort((o,t)=>Y(e.pos,o.pos)-Y(e.pos,t.pos))[0];function ao(e,n){const o=new Map,t=[],r=new Map,i=[],c=[],s=new Map;let d,l,u;for(const[a,g]of e)s.set(a,de(a,g));for(const a of ke)d=n.pieces.get(a),l=s.get(a),d?l?pe(d,l.piece)||(i.push(l),c.push(de(a,d))):c.push(de(a,d)):l&&i.push(l);for(const a of c)l=so(a,i.filter(g=>pe(a.piece,g.piece))),l&&(u=[l.pos[0]-a.pos[0],l.pos[1]-a.pos[1]],o.set(a.key,u.concat(u)),t.push(l.key));for(const a of i)t.includes(a.key)||r.set(a.key,a.piece);return{anims:o,fadings:r}}function pn(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(n-o.start)*o.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const r=fo(t);for(const i of o.plan.anims.values())i[2]=i[0]*r,i[3]=i[1]*r;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>pn(e,i))}}function uo(e,n){const o=new Map(n.pieces),t=e(n),r=ao(o,n);if(r.anims.size||r.fadings.size){const i=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:r},i||pn(n,performance.now())}else n.dom.redraw();return t}const fo=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ho=["green","red","blue","yellow"];function po(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?M(e):$e(e);const o=I(n),t=F(o,k(e),e.dom.bounds());t&&(e.drawable.current={orig:t,pos:o,brush:bo(n),snapToValidMove:e.drawable.defaultSnapToValidMove},gn(e))}function gn(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=F(n.pos,k(e),e.dom.bounds());o||(n.snapToValidMove=!1);const t=n.snapToValidMove?ro(n.orig,n.pos,k(e),e.dom.bounds()):o;t!==n.mouseSq&&(n.mouseSq=t,n.dest=t!==n.orig?t:void 0,e.dom.redrawNow()),gn(e)}})}function go(e,n){e.drawable.current&&(e.drawable.current.pos=I(n))}function mo(e){const n=e.drawable.current;n&&(n.mouseSq&&wo(e.drawable,n),mn(e))}function mn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function vo(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),vn(e.drawable))}function bo(e){var n;const o=(e.shiftKey||e.ctrlKey)&&Ye(e),t=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return ho[(o?1:0)+(t?2:0)]}function wo(e,n){const o=r=>r.orig===n.orig&&r.dest===n.dest,t=e.shapes.find(o);t&&(e.shapes=e.shapes.filter(r=>!o(r))),(!t||t.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),vn(e)}function vn(e){e.onChange&&e.onChange(e.shapes)}function _o(e,n){if(!(e.trustAllEvents||n.isTrusted)||n.buttons!==void 0&&n.buttons>1||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),t=I(n),r=F(t,k(e),o);if(!r)return;const i=e.pieces.get(r),c=e.selected;if(!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!i||i.color!==e.turnColor)&&vo(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||i||c||yo(e,t)))n.preventDefault();else if(n.touches)return;const s=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&Me(e,e.selected,r)?R(a=>ge(a,r),e):ge(e,r);const l=e.selected===r,u=wn(e,r);if(i&&u&&l&&no(e,r)){e.draggable.current={orig:r,piece:i,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const a=e.dom.elements.ghost;a&&(a.className=`ghost ${i.color} ${i.role}`,E(a,X(o)(m(r),k(e))),Pe(a,!0)),Ae(e)}else s&&W(e),d&&L(e);e.dom.redraw()}function yo(e,n){const o=k(e),t=e.dom.bounds(),r=Math.pow(t.width/8,2);for(const i of e.pieces.keys()){const c=Xe(i,o,t);if(Y(c,n)<=r)return!0}return!1}function ko(e,n,o,t){const r="a0";e.pieces.set(r,n),e.dom.redraw();const i=I(o);e.draggable.current={orig:r,piece:n,origPos:i,pos:i,started:!0,element:()=>wn(e,r),originTarget:o.target,newPiece:!0,force:!!t,keyHasChanged:!1},Ae(e)}function Ae(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const t=e.pieces.get(o.orig);if(!t||!pe(t,o.piece))ee(e);else if(!o.started&&Y(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const i=o.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),o.element=i}const r=e.dom.bounds();E(o.element,[o.pos[0]-r.left-r.width/16,o.pos[1]-r.top-r.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==F(o.pos,k(e),r))}Ae(e)})}function Co(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=I(n))}function Po(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}W(e),L(e);const t=I(n)||o.pos,r=F(t,k(e),e.dom.bounds());r&&o.started&&o.orig!==r?o.newPiece?cn(e,o.orig,r,o.force):(e.stats.ctrlKey=n.ctrlKey,ln(e,o.orig,r)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(o.orig),y(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===r||!r)?M(e):e.selectable.enabled||M(e),bn(e),e.draggable.current=void 0,e.dom.redraw()}function ee(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,M(e),bn(e),e.dom.redraw())}function bn(e){const n=e.dom.elements;n.ghost&&Pe(n.ghost,!1)}function wn(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function So(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{Le(e,2),setTimeout(()=>Le(e,void 0),120)},120)}function Le(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function Mo(e,n){function o(){Vn(e),n()}return{set(t){t.orientation&&t.orientation!==e.orientation&&o(),fn(e,t),(t.fen?R:N)(r=>hn(r,t),e)},state:e,getFen:()=>co(e.pieces),toggleOrientation:o,setPieces(t){R(r=>Zn(r,t),e)},selectSquare(t,r){t?R(i=>ge(i,t,r),e):e.selected&&(M(e),e.dom.redraw())},move(t,r){R(i=>tn(i,t,r),e)},newPiece(t,r){R(i=>Se(i,t,r),e)},playPremove(){if(e.premovable.current){if(R(oo,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const r=to(e,t);return e.dom.redraw(),r}return!1},cancelPremove(){N(W,e)},cancelPredrop(){N(L,e)},cancelMove(){N(t=>{$e(t),ee(t)},e)},stop(){N(t=>{Ke(t),ee(t)},e)},explode(t){So(e,t)},setAutoShapes(t){N(r=>r.drawable.autoShapes=t,e)},setShapes(t){N(r=>r.drawable.shapes=t,e)},getKeyAtDomPos(t){return F(t,k(e),e.dom.bounds())},redrawAll:n,dragNewPiece(t,r,i){ko(e,t,r,i)},destroy(){Ke(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function xo(){return{pieces:un(dn),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:jn()}}const Re={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function $o(){const e=b("defs"),n=w(b("filter"),{id:"cg-filter-blur"});return n.appendChild(w(b("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(n),e}function qo(e,n,o){var t;const r=e.drawable,i=r.current,c=i&&i.mouseSq?i:void 0,s=new Map,d=e.dom.bounds(),l=r.autoShapes.filter(h=>!h.piece);for(const h of r.shapes.concat(l).concat(c?[c]:[])){if(!h.dest)continue;const p=(t=s.get(h.dest))!==null&&t!==void 0?t:new Set,f=te(oe(m(h.orig),e.orientation),d),$=te(oe(m(h.dest),e.orientation),d);p.add(ve(f,$)),s.set(h.dest,p)}const u=r.shapes.concat(l).map(h=>({shape:h,current:!1,hash:He(h,me(h.dest,s),!1,d)}));c&&u.push({shape:c,current:!0,hash:He(c,me(c.dest,s),!0,d)});const a=u.map(h=>h.hash).join(";");if(a===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=a;const g=n.querySelector("defs");Ao(r,u,g),Do(u,n.querySelector("g"),o.querySelector("g"),h=>Oo(e,h,r.brushes,s,d))}function Ao(e,n,o){var t;const r=new Map;let i;for(const d of n.filter(l=>l.shape.dest&&l.shape.brush))i=_n(e.brushes[d.shape.brush],d.shape.modifiers),!((t=d.shape.modifiers)===null||t===void 0)&&t.hilite&&r.set(ne(i).key,ne(i)),r.set(i.key,i);const c=new Set;let s=o.firstElementChild;for(;s;)c.add(s.getAttribute("cgKey")),s=s.nextElementSibling;for(const[d,l]of r.entries())c.has(d)||o.appendChild(Wo(l))}function Do(e,n,o,t){const r=new Map;for(const i of e)r.set(i.hash,!1);for(const i of[n,o]){const c=[];let s=i.firstElementChild,d;for(;s;)d=s.getAttribute("cgHash"),r.has(d)?r.set(d,!0):c.push(s),s=s.nextElementSibling;for(const l of c)i.removeChild(l)}for(const i of e.filter(c=>!r.get(c.hash)))for(const c of t(i))c.isCustom?o.appendChild(c.el):n.appendChild(c.el)}function He({orig:e,dest:n,brush:o,piece:t,modifiers:r,customSvg:i,label:c},s,d,l){var u,a;return[l.width,l.height,d,e,n,o,s&&"-",t&&Eo(t),r&&To(r),i&&`custom-${ze(i.html)},${(a=(u=i.center)===null||u===void 0?void 0:u[0])!==null&&a!==void 0?a:"o"}`,c&&`label-${ze(c.text)}`].filter(g=>g).join(",")}function Eo(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function To(e){return[e.lineWidth,e.hilite&&"*"].filter(n=>n).join(",")}function ze(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return n.toString()}function Oo(e,{shape:n,current:o,hash:t},r,i,c){var s,d;const l=te(oe(m(n.orig),e.orientation),c),u=n.dest?te(oe(m(n.dest),e.orientation),c):l,a=n.brush&&_n(r[n.brush],n.modifiers),g=i.get(n.dest),h=[];if(a){const p=w(b("g"),{cgHash:t});h.push({el:p}),l[0]!==u[0]||l[1]!==u[1]?p.appendChild(Ko(n,a,l,u,o,me(n.dest,i))):p.appendChild(No(r[n.brush],l,o,c))}if(n.label){const p=n.label;(s=p.fill)!==null&&s!==void 0||(p.fill=n.brush&&r[n.brush].color);const f=n.brush?void 0:"tr";h.push({el:Lo(p,t,l,u,g,f),isCustom:!0})}if(n.customSvg){const p=(d=n.customSvg.center)!==null&&d!==void 0?d:"orig",[f,$]=p==="label"?kn(l,u,g).map(C=>C-.5):p==="dest"?u:l,x=w(b("g"),{transform:`translate(${f},${$})`,cgHash:t});x.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${n.customSvg.html}</svg>`,h.push({el:x,isCustom:!0})}return h}function No(e,n,o,t){const r=Ro(),i=(t.width+t.height)/(4*Math.max(t.width,t.height));return w(b("circle"),{stroke:e.color,"stroke-width":r[o?0:1],fill:"none",opacity:yn(e,o),cx:n[0],cy:n[1],r:i-r[1]/2})}function ne(e){return["#ffffff","#fff","white"].includes(e.color)?Re.hilitePrimary:Re.hiliteWhite}function Ko(e,n,o,t,r,i){var c;function s(u){var a;const g=zo(i&&!r),h=t[0]-o[0],p=t[1]-o[1],f=Math.atan2(p,h),$=Math.cos(f)*g,x=Math.sin(f)*g;return w(b("line"),{stroke:u?ne(n).color:n.color,"stroke-width":Ho(n,r)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?ne(n).key:n.key})`,opacity:!((a=e.modifiers)===null||a===void 0)&&a.hilite?1:yn(n,r),x1:o[0],y1:o[1],x2:t[0]-$,y2:t[1]-x})}if(!(!((c=e.modifiers)===null||c===void 0)&&c.hilite))return s(!1);const d=b("g"),l=w(b("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(jo(o,t)),l.appendChild(s(!0)),d.appendChild(l),d.appendChild(s(!1)),d}function Wo(e){const n=w(b("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return n.appendChild(w(b("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function Lo(e,n,o,t,r,i){var c;const d=.4*.75**e.text.length,l=kn(o,t,r),u=i==="tr"?.4:0,a=w(b("g"),{transform:`translate(${l[0]+u},${l[1]-u})`,cgHash:n});a.appendChild(w(b("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:(c=e.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const g=w(b("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return g.innerHTML=e.text,a.appendChild(g),a}function oe(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function me(e,n){return(e&&n.has(e)&&n.get(e).size>1)===!0}function b(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function w(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function _n(e,n){return n?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}:e}function Ro(){return[3/64,4/64]}function Ho(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function yn(e,n){return(e.opacity||1)*(n?.9:1)}function zo(e){return(e?20:10)/64}function te(e,n){const o=Math.min(1,n.width/n.height),t=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*t]}function jo(e,n){const o={from:[Math.floor(Math.min(e[0],n[0])),Math.floor(Math.min(e[1],n[1]))],to:[Math.ceil(Math.max(e[0],n[0])),Math.ceil(Math.max(e[1],n[1]))]};return w(b("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function ve(e,n,o=!0){const t=Math.atan2(n[1]-e[1],n[0]-e[0])+Math.PI;return o?(Math.round(t*8/Math.PI)+16)%16:t}function Bo(e,n){return Math.sqrt([e[0]-n[0],e[1]-n[1]].reduce((o,t)=>o+t*t,0))}function kn(e,n,o){let t=Bo(e,n);const r=ve(e,n,!1);if(o&&(t-=33/64,o.size>1)){t-=10/64;const i=ve(e,n);(o.has((i+1)%16)||o.has((i+15)%16))&&i&1&&(t-=.4)}return[e[0]-Math.cos(r)*t,e[1]-Math.sin(r)*t].map(i=>i+.5)}function Io(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const d of Rn)e.classList.toggle("orientation-"+d,n.orientation===d);e.classList.toggle("manipulable",!n.viewOnly);const o=O("cg-container");e.appendChild(o);const t=O("cg-board");o.appendChild(t);let r,i,c;if(n.drawable.visible&&(r=w(b("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild($o()),r.appendChild(b("g")),i=w(b("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(b("g")),c=O("cg-auto-pieces"),o.appendChild(r),o.appendChild(i),o.appendChild(c)),n.coordinates){const d=n.orientation==="black"?" black":"",l=n.ranksPosition==="left"?" left":"";o.appendChild(je(ye,"ranks"+d+l)),o.appendChild(je(_e,"files"+d))}let s;return n.draggable.enabled&&n.draggable.showGhost&&(s=O("piece","ghost"),Pe(s,!1),o.appendChild(s)),{board:t,container:o,wrap:e,ghost:s,svg:r,customSvg:i,autoPieces:c}}function je(e,n){const o=O("coords",n);let t;for(const r of e)t=O("coord"),t.textContent=r,o.appendChild(t);return o}function Fo(e,n){if(!e.dropmode.active)return;W(e),L(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const t=I(n),r=t&&F(t,k(e),e.dom.bounds());r&&cn(e,"a0",r)}e.dom.redraw()}function Vo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",r=>r.preventDefault()),e.viewOnly)return;const t=Go(e);o.addEventListener("touchstart",t,{passive:!1}),o.addEventListener("mousedown",t,{passive:!1})}function Zo(e,n){const o=[];if("ResizeObserver"in window||o.push(G(document.body,"chessground.resize",n)),!e.viewOnly){const t=Be(e,Co,go),r=Be(e,Po,mo);for(const c of["touchmove","mousemove"])o.push(G(document,c,t));for(const c of["touchend","mouseup"])o.push(G(document,c,r));const i=()=>e.dom.bounds.clear();o.push(G(document,"scroll",i,{capture:!0,passive:!0})),o.push(G(window,"resize",i,{passive:!0}))}return()=>o.forEach(t=>t())}function G(e,n,o,t){return e.addEventListener(n,o,t),()=>e.removeEventListener(n,o,t)}const Go=e=>n=>{e.draggable.current?ee(e):e.drawable.current?mn(e):n.shiftKey||Ye(n)?e.drawable.enabled&&po(e,n):e.viewOnly||(e.dropmode.active?Fo(e,n):_o(e,n))},Be=(e,n,o)=>t=>{e.drawable.current?e.drawable.enabled&&o(e,t):e.viewOnly||n(e,t)};function Uo(e){const n=k(e),o=X(e.dom.bounds()),t=e.dom.elements.board,r=e.pieces,i=e.animation.current,c=i?i.plan.anims:new Map,s=i?i.plan.fadings:new Map,d=e.draggable.current,l=Xo(e),u=new Set,a=new Set,g=new Map,h=new Map;let p,f,$,x,C,V,le,q,ce,Q;for(f=t.firstChild;f;){if(p=f.cgKey,Cn(f))if($=r.get(p),C=c.get(p),V=s.get(p),x=f.cgPiece,f.cgDragging&&(!d||d.orig!==p)&&(f.classList.remove("dragging"),E(f,o(m(p),n)),f.cgDragging=!1),!V&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),$){if(C&&f.cgAnimating&&x===U($)){const v=m(p);v[0]+=C[2],v[1]+=C[3],f.classList.add("anim"),E(f,o(v,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),E(f,o(m(p),n)),e.addPieceZIndex&&(f.style.zIndex=ue(m(p),n)));x===U($)&&(!V||!f.cgFading)?u.add(p):V&&x===U(V)?(f.classList.add("fading"),f.cgFading=!0):fe(g,x,f)}else fe(g,x,f);else if(Pn(f)){const v=f.className;l.get(p)===v?a.add(p):fe(h,v,f)}f=f.nextSibling}for(const[v,Z]of l)if(!a.has(v)){ce=h.get(Z),Q=ce&&ce.pop();const A=o(m(v),n);if(Q)Q.cgKey=v,E(Q,A);else{const D=O("square",Z);D.cgKey=v,E(D,A),t.insertBefore(D,t.firstChild)}}for(const[v,Z]of r)if(C=c.get(v),!u.has(v))if(le=g.get(U(Z)),q=le&&le.pop(),q){q.cgKey=v,q.cgFading&&(q.classList.remove("fading"),q.cgFading=!1);const A=m(v);e.addPieceZIndex&&(q.style.zIndex=ue(A,n)),C&&(q.cgAnimating=!0,q.classList.add("anim"),A[0]+=C[2],A[1]+=C[3]),E(q,o(A,n))}else{const A=U(Z),D=O("piece",A),J=m(v);D.cgPiece=A,D.cgKey=v,C&&(D.cgAnimating=!0,J[0]+=C[2],J[1]+=C[3]),E(D,o(J,n)),e.addPieceZIndex&&(D.style.zIndex=ue(J,n)),t.appendChild(D)}for(const v of g.values())Fe(e,v);for(const v of h.values())Fe(e,v)}function Yo(e){const n=k(e),o=X(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(Cn(t)&&!t.cgAnimating||Pn(t))&&E(t,o(m(t.cgKey),n)),t=t.nextSibling}function Ie(e){var n,o;const t=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,i=t.height/t.width,c=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=c*i;r.style.width=c+"px",r.style.height=s+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-width",c+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",s+"px")}const Cn=e=>e.tagName==="PIECE",Pn=e=>e.tagName==="SQUARE";function Fe(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function ue(e,n){const t=e[1];return`${n?10-t:3+t}`}const U=e=>`${e.color} ${e.role}`;function Xo(e){var n,o,t;const r=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)T(r,s,"last-move");if(e.check&&e.highlight.check&&T(r,e.check,"check"),e.selected&&(T(r,e.selected,"selected"),e.movable.showDests)){const s=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(s)for(const l of s)T(r,l,"move-dest"+(e.pieces.has(l)?" oc":""));const d=(t=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(e.selected))!==null&&t!==void 0?t:e.premovable.dests;if(d)for(const l of d)T(r,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const i=e.premovable.current;if(i)for(const s of i)T(r,s,"current-premove");else e.predroppable.current&&T(r,e.predroppable.current.key,"current-premove");const c=e.exploding;if(c)for(const s of c.keys)T(r,s,"exploding"+c.stage);return e.highlight.custom&&e.highlight.custom.forEach((s,d)=>{T(r,d,s)}),r}function T(e,n,o){const t=e.get(n);t?e.set(n,`${t} ${o}`):e.set(n,o)}function fe(e,n,o){const t=e.get(n);t?t.push(o):e.set(n,[o])}function Qo(e,n,o){const t=new Map,r=[];for(const s of e)t.set(s.hash,!1);let i=n.firstElementChild,c;for(;i;)c=i.getAttribute("cgHash"),t.has(c)?t.set(c,!0):r.push(i),i=i.nextElementSibling;for(const s of r)n.removeChild(s);for(const s of e)t.get(s.hash)||n.appendChild(o(s))}function Jo(e,n){const t=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:ot(r),current:!1}));Qo(t,n,r=>nt(e,r,e.dom.bounds()))}function et(e){var n;const o=k(e),t=X(e.dom.bounds());let r=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;r;)Ue(r,t(m(r.cgKey),o),r.cgScale),r=r.nextSibling}function nt(e,{shape:n,hash:o},t){var r,i,c;const s=n.orig,d=(r=n.piece)===null||r===void 0?void 0:r.role,l=(i=n.piece)===null||i===void 0?void 0:i.color,u=(c=n.piece)===null||c===void 0?void 0:c.scale,a=O("piece",`${d} ${l}`);return a.setAttribute("cgHash",o),a.cgKey=s,a.cgScale=u,Ue(a,X(t)(m(s),k(e)),u),a}const ot=e=>{var n,o,t;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")};function tt(e,n){const o=xo();hn(o,n||{});function t(){const r="dom"in o?o.dom.unbind:void 0,i=Io(e,o),c=zn(()=>i.board.getBoundingClientRect()),s=u=>{Uo(l),i.autoPieces&&Jo(l,i.autoPieces),!u&&i.svg&&qo(l,i.svg,i.customSvg)},d=()=>{Ie(l),Yo(l),i.autoPieces&&et(l)},l=o;return l.dom={elements:i,bounds:c,redraw:rt(s),redrawNow:s,unbind:r},l.drawable.prevSvgHash="",Ie(l),s(!1),Vo(l,d),r||(l.dom.unbind=Zo(l,d)),l.events.insert&&l.events.insert(i),l}return Mo(t(),t)}function rt(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}var it=B('<div class="is2d chessboard">');const lt=e=>{let n,o;return xn(()=>{let t=e.color,r=e.dests,i={premovable:{enabled:!1},movable:{color:t,free:!1,dests:r,events:{after:e.onMoveAfter}}};o=tt(n,i)}),z(()=>{let t,r;e.fen_uci?[t,r]=e.fen_uci:t=we;let i=[];r&&(i.push(r.slice(0,2)),i.push(r.slice(2,4)));let c=e.movable?e.color:void 0;o.set({fen:t,lastMove:i,turnColor:e.color,movable:{color:c,dests:e.dests}})}),z(()=>{let t=e.orientation??"white";o.set({orientation:t})}),z(()=>{let t=e.doPromotion;if(t){let r=o.state.pieces.get(t);o.setPieces(new Map([[t,{color:r.color,role:"queen",promoted:!0}]]))}}),(()=>{var t=it();return Ve(r=>n=r,t),t})()};var ct=B("<div class=chesstree>"),st=B("<div class=lines>"),at=B("<div class=line>"),dt=B("<span class=index>"),ut=B("<div>");const ft=e=>{let n=e.before_fen??we,[o,t]=H([],{equals:!1}),[r,i]=H(void 0,{equals:!1});z(()=>{let l=e.pgn;l&&(i(l),s([]))});const c=()=>{var l;return(l=r())==null?void 0:l.root},s=l=>{let u=se(()=>r());if(u){let a=u.get_at(l);if(a){let g=a.after_fen,h=a.uci;e.on_set_fen_uci(g,h),t(a.path)}}};z(qn(()=>e.on_wheel,l=>{var u;if(l){let a=o();if(l<0)a.length>1&&s(a.slice(0,-1));else{let g=r();if(g){let h=g._traverse_path(a),p=(u=h==null?void 0:h.children[0])==null?void 0:u.data.path;p&&s(p)}}}})),z(()=>{let l=e.add_uci;if(!l)return;let u=se(()=>r()),a=se(()=>o());u?u.append_uci(l,a):u=On.make(n,[l]),a=[...a,l],he(()=>{i(u),t(a)})});let d;return z(()=>{let l=o(),u=d.parentElement;if(!u)return;const a=d.querySelector(".on_path_end");if(!a){u.scrollTop=l.length>0?99999:0;return}let g=a.offsetTop-u.offsetHeight/2+a.offsetHeight;u.scrollTo({behavior:"smooth",top:g})}),(()=>{var l=ct();return Ve(u=>d=u,l),K(l,P(Ze,{get when(){return c()},get fallback(){return[]},children:u=>P(be,{on_set_path:s,get cursor_path(){return o()},get lines(){return[u()]}})})),l})()},be=e=>P(Ee,{get each(){return e.lines},children:n=>[P(ht,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},get data(){return n.data},get show_index(){return e.show_index}}),P(An,{get children(){return[P(De,{get when(){return n.children.length===1},get children(){return P(be,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},get lines(){return n.children}})}}),P(De,{get when(){return n.children.length>1},get children(){var o=st();return K(o,P(Ee,{get each(){return n.children},children:t=>(()=>{var r=at();return K(r,P(be,{get on_set_path(){return e.on_set_path},get cursor_path(){return e.cursor_path},lines:[t],show_index:!0})),r})()})),o}})]}})]}),ht=e=>{let n=`${Math.ceil(e.data.ply/2)}.`;e.data.ply%2===0&&(n+="..");let o=()=>e.cursor_path.join("").startsWith(e.data.path.join("")),t=()=>e.cursor_path.join("")===e.data.path.join(""),r=()=>["move",t()?"on_path_end":o()?"on_path":""].join(" ");return(()=>{var i=ut();return i.$$click=()=>e.on_set_path(e.data.path),K(i,P(Ze,{get when(){return e.show_index||e.data.ply&1},get children(){var c=dt();return K(c,n),c}}),null),K(i,()=>e.data.san,null),Dn(()=>En(i,r())),i})()};$n(["click"]);var pt=B("<div class=shalala><div class=chessboard-wrap></div><div class=chesstree-wrap><div class=chesstree-v>");const ie=class ie{constructor(){_(this,"_add_uci");_(this,"_promotion");_(this,"_position");_(this,"m_fen");_(this,"m_dests");_(this,"m_color");_(this,"_last_move");_(this,"_on_wheel");_(this,"set_on_wheel",n=>{this._on_wheel[1](n)});_(this,"on_set_fen_uci",(n,o)=>{he(()=>{this.add_uci=void 0,this.last_move=o,this.position=Oe.fromSetup(Ne(n).unwrap()).unwrap()})});_(this,"reset_move_after",()=>{this.position=this.position});_(this,"on_move_after",(n,o)=>{let t=this.position.board.get(Kn(n)),r=n+o;t.role==="pawn"&&(o[1]==="8"&&this.turnColor==="white"||o[1]==="1"&&this.turnColor==="black")&&(r+="q"),this.position.play(Wn(r)),he(()=>{this.last_move=r,this.position=this.position,r.length===5&&(this.promotion=o),this.add_uci=r})});this._on_wheel=H(void 0,{equals:!1}),this._last_move=H(void 0,{equals:!1}),this._add_uci=H(void 0,{equals:!1}),this._promotion=H(void 0,{equals:!1}),this._position=H(Oe.fromSetup(Ne(we).unwrap()).unwrap(),{equals:!1}),this.m_dests=ae(()=>Ln(this.position)),this.m_fen=ae(()=>Nn(this.position.toSetup())),this.m_color=ae(()=>this.position.turn)}get position(){return this._position[0]()}set position(n){this._position[1](n)}get turnColor(){return this.m_color()}get promotion(){return this._promotion[0]()}set promotion(n){this._promotion[1](n)}get add_uci(){return this._add_uci[0]()}set add_uci(n){this._add_uci[1](n)}get last_move(){return this._last_move[0]()}set last_move(n){this._last_move[1](n)}get on_wheel(){return this._on_wheel[0]()}get fen_uci(){let n=this.fen,o=this.last_move;return[n,o]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}};_(ie,"init",()=>new ie);let re=ie;const gt=()=>{let e=re.init();const n=o=>{const t=o.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(o.preventDefault(),e.set_on_wheel(Math.sign(o.deltaY)))};return(()=>{var o=pt(),t=o.firstChild,r=t.nextSibling,i=r.firstChild;return o.addEventListener("wheel",n),K(t,P(lt,{movable:!0,get doPromotion(){return e.promotion},get onMoveAfter(){return e.on_move_after},get fen_uci(){return e.fen_uci},get color(){return e.turnColor},get dests(){return e.dests}})),K(i,P(ft,{get on_wheel(){return e.on_wheel},get add_uci(){return e.add_uci},get on_set_fen_uci(){return e.on_set_fen_uci}})),o})()},wt=Object.freeze(Object.defineProperty({__proto__:null,Shala:re,default:gt},Symbol.toStringTag,{value:"Module"}));export{lt as C,re as S,wt as a,Ce as o};
