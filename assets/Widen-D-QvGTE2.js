import{y as me,a as C,f as d,m as J,i as n,c,F as j,S as b,h as se,j as ie,d as be,t as g,p as K,w as L}from"./index-CNzW0Pk-.js";import{S as xe,C as Se}from"./Chessboard-DoH7AcsF.js";import{f as we,a as Ce,b as ne}from"./chess_pgn_logic-BSOd-XJi.js";const ke=_=>_.trim().split(`
`).map(t=>{let[o,f,x,A]=t.split(","),I=parseInt(f),O=A.split("/").map(h=>{let[k,p]=h.split(" ");return k}).slice(0,I);return{fen:x,candidates:O}}),ye=()=>fetch("puzzles/puzzles.csv").then(_=>_.text()).then(_=>ke(_));class ze{i_next;all;constructor(){this.i_next=me(0,"candidates_i_next")}async fetch_candidates(){this.all=await ye()}get_current_8(){let t=this.i_next[0]();return this.all.slice(t,t+8)}get_next_8(){let t=this.i_next[0]()+8;return t+8>this.all.length&&(t=0),this.i_next[1](t),this.get_current_8()}}let U=new ze;await U.fetch_candidates();var Pe=g("<div class=results><h3>Total Score: <!> </h3><ul class=cc-list></ul><div class=cc-compare><a class=analyse> Analyse on lichess </a><div class=compare><div><h4>You</h4><ul></ul></div><div><h4>Answer</h4><ul></ul></div></div><div class=q-score><span>Score: </span></div></div><div class=next-cc><a>New Puzzles"),Te=g("<div class=widen><div class=board-wrap></div><div class=replay-wrap><div class=header>Widen Your Search</div><div class=replay>"),Me=g("<a class=link>See Results"),Ne=g("<div class=questions><h3>There are <!> Candidate Moves</h3><small>Positions taken from masters games</small><p>that doesn't worsen the position too much.</p><p>Try to guess what they are.</p><p>Order is considered for extra score.</p><small>Some positions are not winning, try to find the best resistance.</small><h3> of 8</h3><ul class=candidates>"),Ae=g("<div><span>--"),Q=g("<li>"),Ee=g("<div><span></span><a>Takeback"),Re=g("<a class=link>Next Position"),qe=g("<li> <span>");class N{constructor(t,o,f="none",x){this.pvs=t,this.fen=o,this.solution_uci=x,this._state=C(f),this._uci=C()}get score(){let{uci:t,solution_uci:o}=this;return t?t===o?5:this.pvs.includes(t)?2:0:0}takeback(){this.uci=void 0,this.state="guess"}get applied_fen(){let t=this.uci;return t?Ce(this.fen,t):this.fen}get solution_san(){let t=this.solution_uci;if(t)return ne(this.fen,t)}get san(){let t=this.uci;if(t)return ne(this.fen,t)}get uci(){return this._uci[0]()}set uci(t){this._uci[1](t)}get state(){return this._state[0]()}set state(t){this._state[1](t)}_uci;_state}const je=()=>{let[_,t]=C(U.get_current_8()),[o,f]=C(0),x=d(()=>_()[o()]);const A=d(()=>x().fen);let I=d(()=>x().candidates);const O=d(()=>I().length);let h=new xe;const[k,p]=C(1),le=e=>{if(k()===e)return"active"},re=e=>{if(o()===e)return"active"},ae=d(()=>we(A())),V=d(()=>_().map(e=>{let s=e.fen,i=e.candidates.length,l=e.candidates;return[new N(l,s,i>=2?"guess":void 0,l[0]),new N(l,s,i>=2?"guess":void 0,l[1]),new N(l,s,i>=3?"guess":void 0,l[2]),new N(l,s,i>=4?"guess":void 0,l[3]),new N(l,s,i>=5?"guess":void 0,l[4])]})),$=d(()=>V()[o()]),ce=d(()=>V().map(e=>e.map(s=>s.score).reduce((s,i)=>s+i,0)).reduce((e,s)=>e+s,0));J(K(A,e=>{h.on_set_fen_uci(e)}));const y=d(()=>$()[k()-1]);J(K(()=>y().applied_fen,e=>{let s=y().uci;ee()||h.on_set_fen_uci(e,s)})),J(K(()=>h.add_uci,e=>{if(!e)return;let s=y();s.state==="guess"&&(s.state="filled",s.uci=e,X=setTimeout(()=>{_e()},1e3))}));let X;const _e=()=>{let e=$(),s=k();for(let i=s+1;i<=5;i++)if(e[i-1].state==="guess"){p(i);return}for(let i=1;i<s;i++)if(e[i-1].state==="guess"){p(i);return}},oe=()=>y().state==="guess",ue=d(()=>$().filter(e=>e.state==="guess").length===0),de=d(()=>o()===7),he=()=>{Z(o()+1)},Z=e=>{L(()=>{clearTimeout(X),f(e),p(1)})},[ee,te]=C(!1),ge=()=>{L(()=>{te(!0),f(0)})},fe=()=>{L(()=>{t(U.get_next_8()),f(0),p(1),te(!1)})},pe=()=>{let e=y().fen.replace(" ","%20");window.open(`https://lichess.org/analysis?fen=${e}`,"_blank")};return(()=>{var e=Te(),s=e.firstChild,i=s.nextSibling,l=i.firstChild,$e=l.nextSibling;return n(s,c(Se,{get orientation(){return ae()},get movable(){return oe()},get doPromotion(){return h.promotion},get onMoveAfter(){return h.on_move_after},get fen_uci(){return h.fen_uci},get color(){return h.turnColor},get dests(){return h.dests}})),n($e,c(b,{get when(){return ee()},get fallback(){return(()=>{var S=Ne(),v=S.firstChild,B=v.firstChild,z=B.nextSibling;z.nextSibling;var E=v.nextSibling,R=E.nextSibling,q=R.nextSibling,F=q.nextSibling,W=F.nextSibling,P=W.nextSibling,D=P.firstChild,G=P.nextSibling;return n(v,O,z),n(P,()=>o()+1,D),n(G,c(j,{get each(){return $()},children:(r,T)=>c(b,{get when(){return r.state!=="none"},get children(){var w=Q();return w.$$click=()=>p(T()+1),n(w,c(b,{get when(){return r.state==="guess"},get fallback(){return(()=>{var M=Ee(),Y=M.firstChild,H=Y.nextSibling;return n(Y,()=>r.san),H.$$click=()=>{r.takeback(),p(T()+1)},M})()},get children(){return Ae()}})),se(()=>ie(w,le(T()+1))),w}})})),n(S,c(b,{get when(){return ue()},get children(){return c(b,{get when(){return de()},get fallback(){return(()=>{var r=Re();return r.$$click=()=>{he()},r})()},get children(){var r=Me();return r.$$click=()=>{ge()},r}})}}),null),S})()},get children(){var S=Pe(),v=S.firstChild,B=v.firstChild,z=B.nextSibling;z.nextSibling;var E=v.nextSibling,R=E.nextSibling,q=R.firstChild,F=q.nextSibling,W=F.firstChild,P=W.firstChild,D=P.nextSibling,G=W.nextSibling,r=G.firstChild,T=r.nextSibling,w=F.nextSibling,M=w.firstChild;M.firstChild;var Y=R.nextSibling,H=Y.firstChild;return n(v,ce,z),n(E,c(j,{get each(){return _()},children:(u,a)=>(()=>{var m=Q();return m.$$click=()=>Z(a()),n(m,()=>a()+1),se(()=>ie(m,re(a()))),m})()})),q.$$click=()=>pe(),n(D,c(j,{get each(){return $()},children:u=>c(b,{get when(){return u.state!=="none"},get children(){var a=qe(),m=a.firstChild,ve=m.nextSibling;return n(a,()=>u.san,m),n(ve,()=>u.score),a}})})),n(T,c(j,{get each(){return $()},children:u=>c(b,{get when(){return u.state!=="none"},get children(){var a=Q();return n(a,()=>u.solution_san),a}})})),n(M,()=>$().map(u=>u.score).reduce((u,a)=>u+a,0),null),H.$$click=()=>{fe()},S}})),e})()};be(["click"]);export{je as default};
