var P=Object.defineProperty;var Q=(i,r,s)=>r in i?P(i,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[r]=s;var m=(i,r,s)=>(Q(i,typeof r!="symbol"?r+"":r,s),s);import{j as U,k as V,b as q,o as v,l as w,i as l,c as u,S,f as F,q as W,d as Y,t as c,h as M,s as J}from"./index-B_QKkqnW.js";/* empty css                   */import{S as K}from"./studyrepo-DLuXUKtW.js";import{S as X,C as Z,o as ee}from"./Shalala-DpwkvLOr.js";import{b as te,T as re}from"./Chesstree2-BZ2kIyaZ.js";import{m as N}from"./index-DVgBeDVX.js";import"./chess_pgn_logic-BK7Cxuej.js";var se=c("<div class=progress><div class=bar></div><h3>"),ne=c("<div class=list-wrap><h1 class=header>Tactics</h1><div class=list><div><h3 class=title></h3><span>Total Runs</span><p>Highscore: <!> </p></div><div><p>Current Run</p><p>Score: "),ae=c("<div class=repertoire>"),le=c("<div class=board-wrap>"),ie=c("<h3>Puzzle solved. <span> Score +"),ce=c("<h3> Current Run Finished "),_e=c("<button><span>New Run"),he=c("<div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>"),oe=c("<h3>Find the best line!"),ue=c("<button><span>View Solution"),de=c("<button><span>Next Puzzle");const C=class C{constructor(r){m(this,"_scores");m(this,"_current_run");this.id=r,this._scores=N(M([],{equals:!1}),{name:`.puzzle_run.${r}.scores.`}),this._current_run=[N(M(0),{name:`.puzzle_run.${r}.current_run.0.`}),N(M(0),{name:`.puzzle_run.${r}.current_run.1.`})]}get current_score(){return this._current_run[0][0]()??0}get i_selected_chapter(){return this._current_run[1][0]()??0}set current_score(r){this._current_run[0][1](r)}set i_selected_chapter(r){this._current_run[1][1](r)}get scores(){return this._scores[0]()}new_current_run(){this.current_score=0,this.i_selected_chapter=0}add_current_run(){let r=this._scores[0]();r.push(this.current_score),r=r.slice(-10),this._scores[1](r)}get highscore(){return Math.max(0,...this._scores[0]())}};m(C,"make",r=>new C(r));let A=C;const x=class x{constructor(r,s){m(this,"attempt");this.puzzle=r,this.solution=s,this.attempt=re.make(s)}};m(x,"make",(r,s)=>new x(r,s));let T=x;const D=i=>(()=>{var r=se(),s=r.firstChild,_=s.nextSibling;return l(_,()=>`${i.width}/${i.nb}`),F(k=>J(s,`width: ${i.width/i.nb*100}%`,k)),r})(),Se=()=>{let r=U().id,s=A.make(r);const[_]=V(r,K.read_study),k=q(()=>{var e;return(e=_())==null?void 0:e.chapters[s.i_selected_chapter]});let h=new X,o=q(v(k,e=>{if(e){let t=T.make(e.pgn.puzzle,e.pgn.tree);return t.attempt.cursor_path=t.attempt.tree.root.data.path,t.attempt.tree.root.children.map(n=>n.data.path).forEach(n=>t.attempt._hidden_paths.add_path(n)),t}}));w(v(()=>h.add_uci,e=>{var t;e&&((t=o())==null||t.attempt.try_next_uci_fail(e))})),w(v(()=>{var e;return(e=o())==null?void 0:e.attempt.fen_last_move},e=>{if(e){let[t,n]=e;h.on_set_fen_uci(t,n)}})),w(v(()=>h.on_wheel,e=>{var t;e&&((t=o())==null||t.attempt.on_wheel(e))}));const L=()=>{let e=_();return e?`${s.i_selected_chapter+1} / ${e.chapters.length}  Score: ${s.current_score}`:"--"},y=()=>{var n,d;let e=((n=o())==null?void 0:n.attempt.solved_paths_expanded.length)??0,t=((d=o())==null?void 0:d.attempt.failed_paths.length)??0;return e%2===1?e=e+1+(e-1)/2:e=e+e/2,t%2===1?t=t+1+(t-1)/2:t=t+e/2,e-t},j=()=>{s.new_current_run()},B=()=>{s.current_score=Math.max(0,s.current_score+y()),s.i_selected_chapter=s.i_selected_chapter+1};w(v(()=>{var e;return(e=o())==null?void 0:e.attempt.is_revealed},(e,t)=>{e&&!t&&s.i_selected_chapter===_().chapters.length-1&&(s.current_score=Math.max(0,s.current_score+y()),s.add_current_run())}));const G=()=>{var e;(e=o())==null||e.attempt.reveal_hidden_paths()},H=e=>{const t=e.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(e.preventDefault(),h.set_on_wheel(Math.sign(e.deltaY)))};return(()=>{var e=ae();return e.addEventListener("wheel",H),l(e,u(S,{get when(){return!_.loading},fallback:"Loading...",get children(){var t=ne(),n=t.firstChild,d=n.nextSibling,p=d.firstChild,g=p.firstChild,E=g.nextSibling,$=E.nextSibling,R=$.firstChild,b=R.nextSibling;b.nextSibling;var f=p.nextSibling,z=f.firstChild,a=z.nextSibling;return a.firstChild,l(g,()=>_().name),l(p,u(D,{get width(){return s.scores.length},nb:10}),$),l($,()=>s.highscore,b),l(f,u(D,{get width(){return s.i_selected_chapter+1},get nb(){return _().chapters.length}}),a),l(a,()=>s.current_score,null),t}}),null),l(e,u(S,{get when(){return o()},children:t=>[(()=>{var n=le();return l(n,u(Z,{get orientation(){return ee(t().attempt.initial_color??"white")},get movable(){return!t().attempt.is_revealed},get doPromotion(){return h.promotion},get onMoveAfter(){return h.on_move_after},get fen_uci(){return h.fen_uci},get color(){return h.turnColor},get dests(){return h.dests}})),n})(),(()=>{var n=he(),d=n.firstChild,p=d.firstChild,g=p.firstChild,E=g.nextSibling,$=p.nextSibling,R=$.firstChild,b=d.nextSibling,f=b.firstChild,z=f.nextSibling;return l(g,()=>_().name),l(E,L),l(f,u(te,{get lala(){return t().attempt}})),l(z,u(S,{get when(){return t().attempt.is_revealed},get fallback(){return[oe(),(()=>{var a=ue();return a.$$click=G,a})()]},get children(){return[(()=>{var a=ie(),I=a.firstChild,O=I.nextSibling;return O.firstChild,l(O,y,null),a})(),u(S,{get when(){return s.i_selected_chapter===_().chapters.length-1},get fallback(){return(()=>{var a=de();return a.$$click=B,a})()},get children(){return[ce(),(()=>{var a=_e();return a.$$click=j,a})()]}})]}})),F(()=>W(R,"href",`https://lichess.org/training/${t().puzzle}`)),n})()]}),null),e})()};Y(["click"]);export{Se as default};
