import{O as F,_ as be,$ as ke,t as i,i as c,c as r,ap as Se,h as Ce,g as xe,a8 as Me,a4 as Te,a5 as A,b as o,aa as Ae,J as Pe,l as N,W as Fe,k as b,ab as Le,A as Re,F as O,af as Ie,U as Ne,ag as Be,ah as Ee,ai as qe,ao as De,e as Ge,f as Ue,s as We,aq as He,ar as Je,d as Oe}from"./index-DEITIkSU.js";import{createRepeatProps as je}from"./List-CVcmfuNo.js";import{b as ze,a as P,P as Ke,n as Qe}from"./random-B7C0-ROH.js";var Ve=i("<span class=time-ago>");function Xe(_){const[k,d]=F(""),p=()=>{const h=new Date().getTime(),s=Math.round((h-_.timestamp)/1e3);if(s<60)d(`${s} seconds ago`);else if(s<3600){const n=Math.round(s/60);d(`${n} minutes ago`)}else if(s<86400){const n=Math.round(s/3600);d(`${n} hours ago`)}else if(s<604800){const n=Math.round(s/86400);d(`${n} days ago`)}else if(s<2592e3){const n=Math.round(s/604800);d(`${n} weeks ago`)}else if(s<31536e3){const n=Math.round(s/2592e3);d(`${n} months ago`)}else{const n=Math.round(s/31536e3);d(`${n} years ago`)}};return be(()=>{p();const h=setInterval(p,6e4);ke(()=>clearInterval(h))}),(()=>{var h=Ve();return c(h,k),h})()}var Ye=i("<span class=value>"),Ze=i("<div class=header><div class=title></div><div class=filter><span class=label>Filter:</span><span class=value></span> moves</div><div class=due-moves><span class=label>Due:</span>"),et=i("<div class=board-wrap>"),tt=i("<button>Hint: Show Previous Moves"),st=i("<button>Goto Next Due Move"),at=i("<div class=controls>"),nt=i("<div class=replay-wrap>"),rt=i("<div class=underboard><div class=move-history><h4>Latest Attempts for this Move</h4><div class=attempts></div></div><div class=session-history><h4>Latest Attempts for Today </h4><div class=attempts>"),lt=i("<main class=repeat-show>"),ot=i('<div class="Loading ...">'),it=i("<div class=no-dues><span>Great; No due moves at this time."),_t=i("<span class=idle>..."),ct=i("<button>Show Answer"),ut=i("<span class=ply>"),dt=i("<div><i>");const wt=()=>r(ht,{}),pt=He(new Je({}));function ht(){let _=Se(pt),[k]=Ce(),d=k.filter??"white";const p=()=>{switch(d){case"first-ten":return"First Ten";case"ten-twenty":return"First Ten to Twenty";case"twenty-plus":return"Twenty Plus";case"white":return"White";case"black":return"Black"}};let[h,{goto_path:s,goto_path_if_can:n,set_failed_path:S,set_success_path:T,set_hide_after_path:g,add_child_san_to_current_path:z,save_due_move_if_not:K,add_attempt_with_spaced_repetition:Q,load_study:V,load_chapters_for_sections:X,load_due_moves:Y,load_replay_tree_by_due_move:Z}]=xe(),C=Me(h);const ee=()=>h.replay_tree,B=()=>C.fen,te=()=>C.last_move;let u=je();const se=()=>{X(u.selected_section_ids)},ae=()=>{let e=u.selected_study_id,t=u.selected_section_ids;e&&t.length>0&&Y(e,t)};let ne=Te();A(()=>V(ne.id)),A(se),A(ae);const E=o(()=>{switch(d){case"first-ten":return u.due_first_ten;case"ten-twenty":return u.due_ten_twenty;case"twenty-plus":return u.due_twenty_plus;case"white":return u.due_white;case"black":return u.due_black}}),q=o(()=>{switch(d){case"first-ten":return u.all_first_ten;case"ten-twenty":return u.all_ten_twenty;case"twenty-plus":return u.all_twenty_plus;case"white":return u.all_white;case"black":return u.all_black}}),[L,D]=F(),re=o(e=>{let t=E();if(L()!==void 0)return e;if(t.length>0)return ze(t)}),[G,U]=F(),m=o(()=>G()??re());A(()=>{let e=m();e&&Z(e)});const le=o(()=>m()===void 0),R=o(()=>L()!==void 0),oe=o(()=>m()?.tree_step_node.step.uci),W=o(()=>Ae(m()?.tree_step_node.step.before_fen??Pe)),ie=o(()=>!R()),[I,_e]=F(),ce=e=>{{let t=m();g(De(t.tree_step_node.step.path))}_e(e)},ue=e=>{n(e)};async function w(e){D(e),g(void 0);let t=m();await Q(_,t,e),await K(t),e.includes("solved")&&await new Promise(a=>{setTimeout(()=>{H(),a(void 0)},800)})}const H=()=>{D(void 0),U(void 0)},de=e=>{let t=q()?.find(a=>a.id===e.repeat_due_move_id);t&&U(t)},pe=async(e,t)=>{let l=Ie(B()),$=l.turn,x=l.board.get(Ne(e)),v=e+t;x.role==="pawn"&&(t[1]==="8"&&$==="white"||t[1]==="1"&&$==="black")&&(v+="q");let y=Be(v),f=Ee(l,y),M=await z(f);g(void 0),s(M.step.path);const ye=G()!==void 0;v===oe()?(I()?w("solved-with-hint"):w(ye?"solved-with-hint":"solved"),T(M.step.path)):(I()?w("failed-with-hint"):w("failed"),S(M.step.path))},he=()=>{w("failed-with-skip");let e=m().tree_step_node.step.path;S(e),s(e)},J=o(()=>m()?.attempts),me=o(()=>{let e=q()?.map(t=>t.attempts[0]).filter(Boolean)??[];return e.sort((t,a)=>t.created_at-a.created_at),e}),ve=o(()=>{let e=J();if(e)return e[0]}),fe=e=>{de(e)},ge=e=>{e>0?n(C.get_next_path):n(C.get_prev_path)};let we=o(()=>{let e=C.step_at_cursor_path;if(!e)return[];let t=L();if(!t)return[];if(h.replay_tree.failed_path===e.step.path)return P(e.step.uci,e.step.san,"✗");if(h.replay_tree.success_path===e.step.path)return t.includes("hint")?P(e.step.uci,e.step.san,"✓"):P(e.step.uci,e.step.san,"!");let a=e.nags?.[0];return a?P(e.step.uci,e.step.san,qe(a)):[]});const $e=o(()=>!0);return(()=>{var e=lt();return c(e,r(N,{get fallback(){return ot()},get children(){return[(()=>{var t=Ze(),a=t.firstChild,l=a.nextSibling,$=l.firstChild,x=$.nextSibling,v=l.nextSibling;return v.firstChild,c(a,()=>u.study?.name),c(x,p),c(v,r(N,{get children(){return[(()=>{var y=Ye();return c(y,()=>E().length),y})()," moves left"]}}),null),t})(),(()=>{var t=et();return Fe(t,"wheel",Qe(ge)),c(t,r(Ke,{get shapes(){return we()},get orientation(){return W()},get color(){return W()},get movable(){return ie()},get fen(){return B()},get last_move(){return te()},play_orig_key:pe})),t})(),(()=>{var t=nt();return c(t,r(N,{get children(){return r(b,{get when(){return!le()},get fallback(){return(()=>{var a=it();return a.firstChild,c(a,r(Re,{href:"/repetition",children:"Go Back to Repetitions"}),null),a})()},get children(){return[r(Le,{handle_goto_path:ue,get replay_tree(){return ee()},lose_focus:!1}),(()=>{var a=at();return c(a,r(b,{get when(){return $e()},get fallback(){return _t()},get children(){return[r(b,{get when(){return o(()=>!R())()&&!I()},get children(){var l=tt();return l.$$click=()=>ce(!0),l}}),r(b,{get when(){return R()},get fallback(){return(()=>{var l=ct();return l.$$click=he,l})()},get children(){var l=st();return l.$$click=H,l}})]}})),a})()]}})}})),t})(),(()=>{var t=rt(),a=t.firstChild,l=a.firstChild,$=l.nextSibling,x=a.nextSibling,v=x.firstChild,y=v.nextSibling;return c($,r(O,{get each(){return J()},children:(f,M)=>r(j,{get latest(){return M()===0},attempt:f,time:!0})})),c(y,r(O,{get each(){return me()},children:f=>r(j,{get latest(){return f===ve()},attempt:f,time:!1,on_click:()=>fe(f)})})),t})()]}})),e})()}function j(_){const k=o(()=>" "+_.attempt.attempt_result),d=()=>_.attempt.attempt_result.includes("skip")?"":_.attempt.attempt_result.includes("solved")?_.attempt.attempt_result.includes("hint")?"":"":"";return(()=>{var p=dt(),h=p.firstChild;return p.$$click=()=>_.on_click?.(),c(p,r(b,{get when(){return _.ply},get children(){var s=ut();return c(s,()=>_.ply),s}}),null),c(p,r(b,{get when(){return _.time},get children(){return r(Xe,{get timestamp(){return _.attempt.created_at}})}}),null),Ge(s=>{var n="attempt"+k(),S=!!_.latest,T=!_.time,g=d();return n!==s.e&&Ue(p,s.e=n),S!==s.t&&p.classList.toggle("latest",s.t=S),T!==s.a&&p.classList.toggle("selectable",s.a=T),g!==s.o&&We(h,"data-icon",s.o=g),s},{e:void 0,t:void 0,a:void 0,o:void 0}),p})()}Oe(["click"]);export{wt as default};
