var Ke=Object.defineProperty;var Ue=(m,s,i)=>s in m?Ke(m,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[s]=i;var S=(m,s,i)=>(Ue(m,typeof s!="symbol"?s+"":s,i),i);import{h as Ve,j as Je,i as c,c as d,S as x,k as Xe,l as y,b as g,m as b,n as k,o as C,p as Se,q as Ce,r as Ze,f as N,g as w,F as H,s as K,M as I,v as z,e as et,w as tt,d as st,t as n}from"./index-Bc3TZFCc.js";/* empty css                   */import{S as rt}from"./studyrepo-DhQ8y6VO.js";import{S as at,C as lt}from"./Shalala-3uGAPdAg.js";import{T as it,a as le,C as _t}from"./Chesstree2-Q6WJ9Mju.js";import{M as nt,I as ot}from"./chess_pgn_logic-CRDi3fUE.js";import{S as ct,O as xe}from"./SessionStore-hcqu0Tn-.js";import{s as ht}from"./scroll-DnAhRpRC.js";var ut=n("<div class=progress><div class=bar></div><h3>"),dt=n("<div class=repertoire-wrap>"),Ee=n("<small> Click on variations to expand. "),mt=n("<small> Your goal is to guess every move correctly to pass the quiz. "),pt=n("<div class=in_mode><button><span> Take Quiz </span></button><button><span> Play Deathmatch "),vt=n("<h2>Deathmatch Mode"),Me=n("<span class=passed>passed"),gt=n("<small> Deathmatch "),ft=n("<small> Your score: "),Pe=n("<small> Progress +<!>% "),$t=n("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),zt=n("<small> Quiz "),qt=n("<small> Your score: <!> out of 15 correct"),bt=n("<div class=past>"),wt=n("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),kt=n("<small> Your goal is to guess every move correctly to fill up the progress bar. "),yt=n("<div class=in_mode><button><span> Play all Moves </span></button><button><span> Play as Match "),St=n("<h2>Play as Match"),Te=n("<small> End of practice. "),Re=n("<small> Congratulations. "),Ct=n("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),xt=n("<h2>Play all moves"),Et=n("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),Mt=n("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=progress>%</h3><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Pt=n("<li><div><h3></h3> "),Tt=n('<div class=line><span class="fill white"></span><span class="fill black">'),Rt=n("<span class=index>"),Dt=n("<div class=fbt>"),jt=n("<small>You will play the moves from the opening."),Lt=n("<small>If you go out of book, game ends."),Qt=n("<div class=in_mode><button class=end2><span> End Deathmatch "),De=n("<span class=failed>failed"),It=n("<h3>Quiz Mode"),Yt=n("<small>You are given 15 random positions from the opening."),At=n("<small>Guess the correct move."),Nt=n("<h2> of 15"),Ot=n("<div class=in_mode><button class=end2><span> End Quiz "),Ft=n("<span>"),Gt=n("<small> Try to guess the moves for <!>."),Wt=n("<small> AI will play the next move, picking a random variation. "),Bt=n("<small> Moves will be hidden once the game is started. "),Ht=n("<small>Try to guess the moves for both sides."),Kt=n("<small>Moves will be hidden once you start.");const Ut=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Vt=m=>Ut[Math.floor((1-m/10)*6)],Jt=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Xt{constructor(){S(this,"_mode");S(this,"_match_color");S(this,"_practice_end_result");S(this,"_quiz_quiz_ls_paths",[]);S(this,"_quiz_quiz_ls");S(this,"_quiz_deathmatch_fail");S(this,"_quiz_deathmatch_result_path");this._mode=y(void 0,{equals:!1}),this._match_color=y("white"),this._quiz_quiz_ls=y([],{equals:!1}),this._quiz_deathmatch_fail=y(0),this._quiz_deathmatch_result_path=y([]),this._practice_end_result=y(!1)}get mode(){return this._mode[0]()}set mode(s){this._mode[1](s)}get match_color(){return this._match_color[0]()}set match_color(s){this._match_color[1](s)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(s){this._practice_end_result[1](s)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){z(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){z(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){z(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){z(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz-quiz"})}end_quiz(){z(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz"})}quiz_pass_one(s){z(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(s)})}quiz_fail_one(s){z(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(s)})}get quiz_pass(){return this.quiz_quiz_ls.filter(s=>s>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(s){this._quiz_quiz_ls[1](s)}set quiz_deathmatch_fail_result(s){this._quiz_deathmatch_fail[1](s)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(s){this._quiz_deathmatch_result_path[1](s)}restart_deathmatch(){z(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){z(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const je=m=>(()=>{var s=ut(),i=s.firstChild,h=i.nextSibling;return c(h,()=>`%${m.width}`),N(u=>K(i,`width: ${m.width}%`,u)),s})();class Zt{constructor(s){this.chapters=s}get progress(){let s=this.chapters.length;return this.chapters.map(i=>Math.round(i.progress/s)).reduce((i,h)=>i+h)}}class j{constructor(s,i,h,u){this.study_id=s,this.i_chapter=i,this.score_tree=h,this.solved_paths=u}static load_from_store(s,i){let h=new xe(s.id,i);return j.make(s.id,i,s.chapters[i].pgn.tree,le.set_for_saving(h.solved_paths))}static save_paths_to_store(s){let i=new xe(s.study_id,s.i_chapter);i.solved_paths=s.solved_paths.get_for_saving(),i.practice_progress=s.progress}static make(s,i,h,u=new le){return new j(s,i,nt.make(h),u)}get clone(){return new j(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(s=>k(()=>{var i;return(i=this.score_tree.get_at(s))==null?void 0:i.score})??0).reduce((s,i)=>s+i,0)*100)}get progress_map(){let s=k(()=>this.score_tree.progress_paths);const i=k(()=>s.map(h=>[h.filter(u=>u.length%2===1).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0),h.filter(u=>u.length%2===0).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0)]));return s.map((h,u)=>{let t=h[0],q=h[h.length-1],E=i[u][0],O=i[u][1],Y=g(()=>this.solved_paths.paths),M=g(()=>Y().filter(v=>h.some(P=>P.join("")===v.join("")))),A=g(()=>M().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0)),r=g(()=>M().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0));return{color:Vt(t.length/20+q.length/10),total:E+O,black:g(()=>r()/O),white:g(()=>A()/E),path:q}}).reverse()}clone_merge_stats(s){let i=k(()=>this.clone);return i.solved_paths.merge_dup(s.solved_paths),i}merge_and_save_stats(s){this.solved_paths.merge_dup(s.solved_paths),this.save_stats()}save_stats(){j.save_paths_to_store(this)}}const cs=()=>{const m=Ve(),[s]=Je(m.id,rt.read_study);return(()=>{var i=dt();return c(i,d(x,{get when(){return!s.loading},fallback:"Loading...",get children(){return d(es,{get study(){return s()}})}})),i})()},es=m=>{const s=Xe(),i=()=>m.study;s.setVolume(.2);let[h,u]=y(!1),t=new Xt,q=new at;const[E,O]=y(ct.i_chapter??0);let Y=g(()=>{const a=i();return new Zt(a.chapters.map((o,f)=>j.load_from_store(a,f)))}),M=g(()=>Y().chapters[E()]);const A=g(()=>i().chapters[E()]),r=g(()=>{t.mode;let a=A();return it.make(a.pgn.tree.clone)}),v=g(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===16}),[P,ie]=y(!1);b(()=>{if(t.mode==="quiz-quiz"){let a=v();t.quiz_quiz_ls[t.quiz_quiz_ls.length-1]<0&&(ie(!0),setTimeout(()=>{ie(!1)},500)),a?(s.play("victory"),k(()=>{r().clear_failed_paths(),r()._hidden_paths.clear()})):(u(!0),setTimeout(()=>{z(()=>k(()=>{r().set_random_cursor_hide_rest(),t.match_color=r().cursor_after_color;let f=r().cursor_path;L(f.slice(0,-1)),setTimeout(()=>{r().cursor_path=f,u(!1)},200)}))},100))}}),b(()=>{let{mode:a,match_color:o}=t;a==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{k(()=>{r().reveal_one_random()})},400)}),b(()=>{r().solved_paths.replace_all(M().solved_paths)});const F=g(()=>{let a=r().tree;return k(()=>j.make(i().name,E(),a,new le))});b(()=>{k(()=>F()).solved_paths.replace_all(r().solved_paths)});let _e=g(()=>{let a=M(),o=F(),f=k(()=>a.progress);return a.clone_merge_stats(o).progress-f});b(C(()=>[M(),F()],(a,o)=>{if(o){let[f,T]=o;f.merge_and_save_stats(T)}})),b(C(()=>q.add_uci,a=>{if(h()||!a)return;r().try_next_uci_fail(a)?(ne(),t.mode==="quiz-quiz"&&t.quiz_pass_one(r().cursor_path)):((t.mode==="match"||t.mode==="moves")&&(u(!0),setTimeout(()=>{r().on_wheel(-1),u(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(r().cursor_path.slice(0,-1)),s.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=r().cursor_path.slice(0,-1)))})),b(C(()=>t.quiz_deathmatch_fail_result,a=>{(a>0||a<0)&&s.play("victory")})),b(C(()=>t.practice_end_result,a=>{a&&s.play("victory")})),b(()=>{let{mode:a,match_color:o}=t;a==="match"&&o==="black"&&k(()=>{ne()})}),b(C(()=>r().fen_last_move,a=>{if(a){let[o,f]=a;q.on_set_fen_uci(o,f)}else q.on_set_fen_uci(ot)}));const ne=()=>{let a=()=>r().is_cursor_path_at_a_leaf;a()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=r().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(u(!0),setTimeout(()=>{r().reveal_one_random(),a()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=r().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),u(!1)},400))};b(C(()=>q.on_wheel,a=>{a&&r().on_wheel(a)}));const oe=a=>{a.key==="f"&&t.flip_match_color()};let U=!1;b(C(()=>{var a;return(a=r().tree)==null?void 0:a.get_at(r().cursor_path)},a=>{if(a){if(U){U=!1;return}s.move(a)}})),Se(()=>{document.addEventListener("keypress",oe)}),Ce(()=>{document.removeEventListener("keypress",oe)});const ce=ht(a=>{const o=a.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(a.preventDefault(),q.set_on_wheel(Math.sign(a.deltaY)))});b(()=>{t.match_color=i().orientation??"white"});const Le=g(()=>F().progress_map);let V;Se(()=>{V.addEventListener("wheel",ce,{passive:!1})}),Ce(()=>{V.removeEventListener("wheel",ce)});const he=a=>{let o=t.mode;if(a==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},Qe=g(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),Ie=g(C(()=>t.quiz_deathmatch_result_path,a=>{var T,Q;let o=a.length,f=(Q=(T=r().tree)==null?void 0:T.all_leaves.map(R=>R.path).filter(R=>!r().failed_paths.find(J=>J.join("")===R.join(""))).filter(R=>R.join("").startsWith(a.join("")))[0])==null?void 0:Q.length;return`${o} out of ${f}`})),Ye=g(()=>r().collect_branch_sums(r().cursor_path)),L=a=>{U=!0,r().cursor_path=a};return(()=>{var a=Mt(),o=a.firstChild,f=o.firstChild,T=f.nextSibling,Q=T.firstChild,R=Q.firstChild,J=Q.nextSibling,ue=o.nextSibling,de=ue.nextSibling,Ae=de.nextSibling,me=Ae.firstChild,pe=me.firstChild,ve=pe.firstChild,Ne=ve.nextSibling,X=pe.nextSibling,Oe=X.firstChild,Fe=X.nextSibling,Ge=Fe.firstChild,We=me.nextSibling,ge=We.firstChild,Z=ge.nextSibling,G=Z.firstChild,ee=G.nextSibling,fe=Z.nextSibling,te=fe.firstChild,se=te.nextSibling,re=se.nextSibling,$e=re.nextSibling,Be=fe.nextSibling,ze=Be.firstChild,ae=ze.firstChild,qe=ae.nextSibling,He=ze.nextSibling;return Ze(e=>V=e,a),c(R,()=>i().name),c(Q,d(je,{get width(){return Y().progress}}),null),c(J,d(H,{get each(){return i().chapters},children:(e,l)=>(()=>{var _=Pt(),p=_.firstChild,$=p.firstChild;return $.nextSibling,_.$$click=()=>O(l()),c($,()=>e.name),c(p,d(je,{get width(){var D;return((D=Y())==null?void 0:D.chapters[l()].progress)??0}}),null),N(()=>w(_,l()===E()?"active":"")),_})()})),c(ue,d(lt,{get orientation(){return t.match_color},get movable(){return Qe()},get doPromotion(){return q.promotion},get onMoveAfter(){return q.on_move_after},get fen_uci(){return q.fen_uci},get color(){return q.turnColor},get dests(){return q.dests}})),c(de,d(H,{get each(){return Le()},children:e=>(()=>{var l=Tt(),_=l.firstChild,p=_.nextSibling;return l.$$click=$=>r().try_set_cursor_path(e.path),N($=>{var D=`background: ${e.color}; height: ${e.total*100}%`,W=`height: ${e.white()*100}%`,B=`height: ${e.black()*100}%`;return $.e=K(l,D,$.e),$.t=K(_,W,$.t),$.a=K(p,B,$.a),$},{e:void 0,t:void 0,a:void 0}),l})()})),c(ve,()=>i().name),c(Ne,()=>A().name),c(X,()=>M().progress,Oe),c(ge,d(_t,{get lala(){return r()}})),G.$$click=()=>r().navigate_up(),ee.$$click=()=>r().navigate_down(),c(Z,d(H,{get each(){return Ye()},children:e=>(()=>{var l=Dt();return l.$$click=()=>r().try_set_cursor_path(e.path),c(l,d(x,{get when(){return e.ply&1},get children(){var _=Rt();return c(_,()=>Jt(e.ply)),_}}),null),c(l,()=>e.san,null),l})()}),null),te.$$click=()=>r().navigate_first(),se.$$click=()=>r().navigate_prev(),re.$$click=()=>r().navigate_next(),$e.$$click=()=>r().navigate_last(),ae.$$click=()=>t.end_match_or_moves(),qe.$$click=()=>t.mode="quiz",c(He,d(et,{get children(){return[d(I,{get when(){return t.mode==="quiz"},get children(){return[Ee(),mt(),(()=>{var e=pt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="quiz-quiz",_.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(I,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[vt(),d(x,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[jt(),Lt(),(()=>{var e=Qt(),l=e.firstChild;return l.$$click=()=>{z(()=>{let _=r().cursor_path;t.end_deathmatch(),r()._hidden_paths.clear(),L(_)})},e})()]},get children(){return[(()=>{var e=gt();return e.firstChild,c(e,d(x,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return De()},get children(){return[" ",Me()]}}),null),e})(),(()=>{var e=ft();return e.firstChild,c(e,Ie,null),e})(),(()=>{var e=Pe(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,_e,_),e})(),(()=>{var e=$t(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_deathmatch(),_.$$click=()=>{z(()=>{let p=r().cursor_path;t.end_deathmatch(),r()._hidden_paths.clear(),L(p)})},e})()]}})]}}),d(I,{get when(){return t.mode==="quiz-quiz"},get children(){return d(x,{get when(){return v()},get fallback(){return[It(),Yt(),At(),(()=>{var e=Nt(),l=e.firstChild;return c(e,()=>t.i_quiz_quiz,l),N(()=>w(e,P()?"error":"")),e})(),(()=>{var e=Ot(),l=e.firstChild;return l.$$click=()=>{z(()=>{let _=r().cursor_path;t.end_quiz(),r()._hidden_paths.clear(),L(_)})},e})()]},get children(){return[(()=>{var e=zt();return e.firstChild,c(e,d(x,{get when(){return t.quiz_pass>10},get fallback(){return De()},get children(){return[" ",Me()]}}),null),e})(),(()=>{var e=qt(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,()=>t.quiz_pass,_),e})(),(()=>{var e=Pe(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,_e,_),e})(),(()=>{var e=bt();return c(e,d(H,{get each(){return t.quiz_quiz_ls},children:(l,_)=>(()=>{var p=Ft();return p.$$click=()=>r().cursor_path=t._quiz_quiz_ls_paths[_()],w(p,"move "+(l>0?"success":"error")),c(p,()=>_()+1),p})()})),e})(),(()=>{var e=wt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_quiz(),_.$$click=()=>{z(()=>{let p=r().cursor_path;t.end_quiz(),r()._hidden_paths.clear(),L(p)})},e})()]}})}}),d(I,{get when(){return t.mode===void 0},get children(){return[Ee(),kt(),(()=>{var e=yt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="moves",_.$$click=()=>t.mode="match",e})()]}}),d(I,{get when(){return t.mode==="match"},get children(){return[St(),d(x,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Gt(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,()=>t.match_color,_),e})(),Wt(),Bt()]},get children(){return[Te(),Re()]}}),(()=>{var e=Ct(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_match(),_.$$click=()=>{let p=r().cursor_path;t.end_match_or_moves(),r()._hidden_paths.clear(),L(p)},e})()]}}),d(I,{get when(){return t.mode==="moves"},get children(){return[xt(),d(x,{get when(){return t.practice_end_result},get fallback(){return[Ht(),Kt()]},get children(){return[Te(),Re()]}}),(()=>{var e=Et(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>{t.restart_moves()},_.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),N(e=>{var l=A().site,_=h()||!r().can_navigate_up,p="fbt prev"+(!h()&&r().can_navigate_up?"":" disabled"),$=h()||!r().can_navigate_down,D="fbt prev"+(!h()&&r().can_navigate_down?"":" disabled"),W="fbt first"+(!h()&&r().can_navigate_prev?"":" disabled"),B="fbt prev"+(!h()&&r().can_navigate_prev?"":" disabled"),be="fbt next"+(!h()&&r().can_navigate_next?"":" disabled"),we="fbt last"+(!h()&&r().can_navigate_next?"":" disabled"),ke="tab"+he("practice"),ye="tab"+he("quiz");return l!==e.e&&tt(Ge,"href",e.e=l),_!==e.t&&(G.disabled=e.t=_),p!==e.a&&w(G,e.a=p),$!==e.o&&(ee.disabled=e.o=$),D!==e.i&&w(ee,e.i=D),W!==e.n&&w(te,e.n=W),B!==e.s&&w(se,e.s=B),be!==e.h&&w(re,e.h=be),we!==e.r&&w($e,e.r=we),ke!==e.d&&w(ae,e.d=ke),ye!==e.l&&w(qe,e.l=ye),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a})()};st(["click"]);export{cs as default};
