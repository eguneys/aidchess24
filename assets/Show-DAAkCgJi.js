import{O as A,_ as ke,$ as Se,t as n,i as c,c as o,ap as Ce,h as Me,g as Te,a8 as xe,a4 as Ae,a5 as T,b as i,aa as Pe,J as Le,l as E,W as Fe,k as $,ab as Re,A as Ie,F as Y,af as Ne,U as Be,ag as Ee,ah as qe,ai as De,ao as Ge,Y as j,e as Ue,f as We,s as He,aq as Je,ar as Oe,d as Ye}from"./index-Kg10kyHr.js";import{createRepeatProps as je}from"./List-CS0sCL02.js";import{b as ze,a as x,P as Ke,n as Qe}from"./random-CAuo1AIA.js";var Ve=n("<span class=time-ago>");function Xe(_){const[y,d]=A(""),p=()=>{const h=new Date().getTime(),s=Math.round((h-_.timestamp)/1e3);if(s<60)d(`${s} seconds ago`);else if(s<3600){const r=Math.round(s/60);d(`${r} minutes ago`)}else if(s<86400){const r=Math.round(s/3600);d(`${r} hours ago`)}else if(s<604800){const r=Math.round(s/86400);d(`${r} days ago`)}else if(s<2592e3){const r=Math.round(s/604800);d(`${r} weeks ago`)}else if(s<31536e3){const r=Math.round(s/2592e3);d(`${r} months ago`)}else{const r=Math.round(s/31536e3);d(`${r} years ago`)}};return ke(()=>{p();const h=setInterval(p,6e4);Se(()=>clearInterval(h))}),(()=>{var h=Ve();return c(h,y),h})()}var Ze=n("<div class=title>"),et=n("<div class=filter><span class=label>Filter:</span><span class=value></span> moves"),tt=n("<div class=due-moves><span class=label>Due:</span><span class=value></span> moves left"),st=n("<div class=header>"),at=n("<div class=board-wrap>"),nt=n("<button>Hint: Show Previous Moves"),rt=n("<button>Goto Next Due Move"),lt=n("<div class=controls>"),ot=n("<div class=replay-wrap>"),it=n("<div class=underboard><div class=move-history><h4>Latest Attempts for this Move</h4><div class=attempts></div></div><div class=session-history><h4>Latest Attempts for Today </h4><div class=attempts>"),_t=n("<main class=repeat-show>"),ct=n('<div class="Loading ...">'),ut=n("<div class=loading>Loading.."),dt=n("<div class=no-dues><span>Great; No due moves at this time."),pt=n("<span class=idle>..."),ht=n("<button>Show Answer"),mt=n("<span class=ply>"),vt=n("<div><i>");const kt=()=>o(gt,{}),ft=Je(new Oe({}));function gt(){let _=Ce(ft),[y]=Me(),d=y.filter??"white";const p=()=>{switch(d){case"first-ten":return"First Ten";case"ten-twenty":return"First Ten to Twenty";case"twenty-plus":return"Twenty Plus";case"white":return"White";case"black":return"Black"}};let[h,{goto_path:s,goto_path_if_can:r,set_failed_path:b,set_success_path:M,set_hide_after_path:f,add_child_san_to_current_path:K,save_due_move_if_not:Q,add_attempt_with_spaced_repetition:V,load_study:X,load_chapters_for_sections:Z,load_due_moves:ee,load_replay_tree_by_due_move:te}]=Te(),k=xe(h);const se=()=>h.replay_tree,q=()=>k.fen,ae=()=>k.last_move;let u=je();const ne=()=>{Z(u.selected_section_ids)},re=()=>{let e=u.selected_study_id,t=u.selected_section_ids;e&&t.length>0&&ee(e,t)};let le=Ae();T(()=>X(le.id)),T(ne),T(re);const D=i(()=>{switch(d){case"first-ten":return u.due_first_ten;case"ten-twenty":return u.due_ten_twenty;case"twenty-plus":return u.due_twenty_plus;case"white":return u.due_white;case"black":return u.due_black}}),G=i(()=>{switch(d){case"first-ten":return u.all_first_ten;case"ten-twenty":return u.all_ten_twenty;case"twenty-plus":return u.all_twenty_plus;case"white":return u.all_white;case"black":return u.all_black}}),[P,L]=A(),oe=i(e=>{let t=D();if(P()!==void 0)return e;if(t.length>0)return ze(t)}),[U,W]=A(),m=i(()=>U()??oe());T(()=>{let e=m();e&&te(e)});const ie=i(()=>m()===void 0),F=i(()=>P()!==void 0),_e=i(()=>m()?.tree_step_node.step.uci),H=i(()=>Pe(m()?.tree_step_node.step.before_fen??Le)),ce=i(()=>!F()),[R,ue]=A(),I=e=>{if(e){let t=m();f(Ge(t.tree_step_node.step.path))}else f("");ue(e)},de=e=>{r(e)};async function w(e){L(e),f(void 0);let t=m();await V(_,t,e),await Q(t),e.includes("solved")&&await new Promise(a=>{setTimeout(()=>{J(),a(void 0)},800)})}const J=()=>{j(()=>{L(void 0),I(!1),W(void 0)})},pe=e=>{let t=G()?.find(a=>a.id===e.repeat_due_move_id);t&&j(()=>{L(void 0),I(!1),W(t)})},he=async(e,t)=>{let l=Ne(q()),v=l.turn,N=l.board.get(Be(e)),S=e+t;N.role==="pawn"&&(t[1]==="8"&&v==="white"||t[1]==="1"&&v==="black")&&(S+="q");let B=Ee(S),g=qe(l,B),C=await K(g);f(void 0),s(C.step.path);const be=U()!==void 0;S===_e()?(R()?w("solved-with-hint"):w(be?"solved-with-hint":"solved"),M(C.step.path)):(R()?w("failed-with-hint"):w("failed"),b(C.step.path))},me=()=>{w("failed-with-skip");let e=m().tree_step_node.step.path;b(e),s(e)},O=i(()=>m()?.attempts),ve=i(()=>{let e=G()?.map(t=>t.attempts[0]).filter(Boolean)??[];return e.sort((t,a)=>t.created_at-a.created_at),e}),fe=i(()=>{let e=O();if(e)return e[0]}),ge=e=>{pe(e)},we=e=>{e>0?r(k.get_next_path):r(k.get_prev_path)};let $e=i(()=>{let e=k.step_at_cursor_path;if(!e)return[];let t=P();if(!t)return[];if(h.replay_tree.failed_path===e.step.path)return x(e.step.uci,e.step.san,"✗");if(h.replay_tree.success_path===e.step.path)return t.includes("hint")?x(e.step.uci,e.step.san,"✓"):x(e.step.uci,e.step.san,"!");let a=e.nags?.[0];return a?x(e.step.uci,e.step.san,De(a)):[]});const ye=i(()=>!0);return(()=>{var e=_t();return c(e,o(E,{get fallback(){return ct()},get children(){return[(()=>{var t=st();return c(t,o(E,{get children(){return[(()=>{var a=Ze();return c(a,()=>u.study?.name),a})(),(()=>{var a=et(),l=a.firstChild,v=l.nextSibling;return c(v,p),a})(),(()=>{var a=tt(),l=a.firstChild,v=l.nextSibling;return c(v,()=>D().length),a})()]}})),t})(),(()=>{var t=at();return Fe(t,"wheel",Qe(we)),c(t,o(Ke,{get shapes(){return $e()},get orientation(){return H()},get color(){return H()},get movable(){return ce()},get fen(){return q()},get last_move(){return ae()},play_orig_key:he})),t})(),(()=>{var t=ot();return c(t,o(E,{get fallback(){return ut()},get children(){return o($,{get when(){return!ie()},get fallback(){return(()=>{var a=dt();return a.firstChild,c(a,o(Ie,{href:"/repetition",children:"Go Back to Repetitions"}),null),a})()},get children(){return[o(Re,{handle_goto_path:de,get replay_tree(){return se()},lose_focus:!1}),(()=>{var a=lt();return c(a,o($,{get when(){return ye()},get fallback(){return pt()},get children(){return[o($,{get when(){return i(()=>!F())()&&!R()},get children(){var l=nt();return l.$$click=()=>I(!0),l}}),o($,{get when(){return F()},get fallback(){return(()=>{var l=ht();return l.$$click=me,l})()},get children(){var l=rt();return l.$$click=J,l}})]}})),a})()]}})}})),t})(),(()=>{var t=it(),a=t.firstChild,l=a.firstChild,v=l.nextSibling,N=a.nextSibling,S=N.firstChild,B=S.nextSibling;return c(v,o(Y,{get each(){return O()},children:(g,C)=>o(z,{get latest(){return C()===0},attempt:g,time:!0})})),c(B,o(Y,{get each(){return ve()},children:g=>o(z,{get latest(){return g===fe()},attempt:g,time:!1,on_click:()=>ge(g)})})),t})()]}})),e})()}function z(_){const y=i(()=>" "+_.attempt.attempt_result),d=()=>_.attempt.attempt_result.includes("skip")?"":_.attempt.attempt_result.includes("solved")?_.attempt.attempt_result.includes("hint")?"":"":"";return(()=>{var p=vt(),h=p.firstChild;return p.$$click=()=>_.on_click?.(),c(p,o($,{get when(){return _.ply},get children(){var s=mt();return c(s,()=>_.ply),s}}),null),c(p,o($,{get when(){return _.time},get children(){return o(Xe,{get timestamp(){return _.attempt.created_at}})}}),null),Ue(s=>{var r="attempt"+y(),b=!!_.latest,M=!_.time,f=d();return r!==s.e&&We(p,s.e=r),b!==s.t&&p.classList.toggle("latest",s.t=b),M!==s.a&&p.classList.toggle("selectable",s.a=M),f!==s.o&&He(h,"data-icon",s.o=f),s},{e:void 0,t:void 0,a:void 0,o:void 0}),p})()}Ye(["click"]);export{kt as default};
