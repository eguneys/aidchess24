import{g as $,Y as U,Z as A,_ as X,n as ee,q as R,$ as te,v as se,u as y,a as ie,i as l,c as f,A as ne,j as O,k as j,F as q,S as B,t as b,D as P,B as le,e as re,d as ae,R as w}from"./index-B1vCCvLd.js";function ge(s){const i=$(()=>U(A(s)));return()=>i()()}function C(s){const[i,a]=X([]);return ee(R(s,()=>{ce(A(s),i,a)})),i}function ce(s,i,a,e={key:"id"}){const t=s.subscribe(c=>a(te(c,e)));return se(()=>"unsubscribe"in t?t.unsubscribe():t()),i}var de=b("<div class=repeat-show><div class=studies><h3>Repertoires</h3><div class=list-wrap><div class=list>"),E=b("<div>"),oe=b("<p>Selected <!> sections"),ue=b("<div class=buttons><button>First 10 moves <span></span></button><div class=small><button>10-20 moves <span></span></button><button>20+ moves <span></span></button></div><div class=small><button>White moves <span></span></button><button>Black moves <span>"),_e=b("<div class=study-side><div class=sections><h3>Sections</h3><div class=list-wrap><div class=list></div></div></div><div class=dues>"),he=b("<p> Please Select Some Sections ");const $e=()=>{const s=y(w),i=C(()=>s.studies.toArray()),[a,e]=ie(0),t=$(()=>i[a()]);return(()=>{var c=de(),h=c.firstChild,g=h.firstChild,d=g.nextSibling,p=d.firstChild;return l(p,f(q,{each:i,get fallback(){return f(ne,{href:"/repertoires",children:"Import some studies first"})},children:(_,n)=>(()=>{var r=E();return r.$$click=()=>e(n()),l(r,()=>_.name),O(()=>j(r,"study"+(a()===n()?" active":""))),r})()})),l(c,f(B,{get when(){return t()},children:_=>f(fe,{get study(){return _()}})}),null),c})()},F=s=>{const i=y(w);let a=C(async()=>{let e=await i.due_cards.where("section_id").anyOf(s).toArray();return await Promise.all(e.map(async t=>{let c=await i.moves.where("id").anyOf(t.move_ids).toArray(),h=await i.sections.where("id").equals(t.section_id).first(),g=await Promise.all(c.map(async d=>({data:d.data,chapter:await i.chapters.where("id").equals(d.chapter_id).first()})));return{id:t.id,before_fen:t.before_fen,due:t.card.due.getTime(),section:h,moves:g}}))});return{get due(){return a.filter(e=>e.due<=new Date().getTime())},get due_white(){return this.due.filter(e=>P(e.before_fen)==="white")},get due_black(){return this.due.filter(e=>P(e.before_fen)==="black")},get due_10(){return this.due.filter(e=>e.moves[0]?.data.path.length<=20)},get due_10_20(){return this.due.filter(e=>e.moves[0]?.data.path.length>=20&&e.moves[0].data.path.length<=40)},get due_20plus(){return this.due.filter(e=>e.moves[0]?.data.path.length>=40)}}},N=s=>le([],"repeat.selected_sections."+s),fe=s=>{const i=y(w),a=C(()=>i.sections.where("study_id").equals(s.study.id).toArray()),e=$(()=>N(s.study.id)),t=$(()=>e()[0]()),c=n=>e()[1](n),h=$(()=>t().length),g=n=>{t().includes(n)?c(t().filter(r=>r!==n)):c([...t(),n])};let d=$(R(t,n=>F(n)));const p=re(),_=n=>{let r=s.study.id;p("/repeat/"+r+(n?`?filter=${n}`:""))};return(()=>{var n=_e(),r=n.firstChild,Q=r.firstChild,T=Q.nextSibling,M=T.firstChild,z=r.nextSibling;return l(M,f(q,{each:a,children:o=>(()=>{var u=E();return u.$$click=()=>g(o.id),l(u,()=>o.name),O(()=>j(u,"section"+(t().includes(o.id)?" selected":""))),u})()})),l(z,f(B,{get when(){return h()>0},get fallback(){return he()},get children(){return[(()=>{var o=oe(),u=o.firstChild,m=u.nextSibling;return m.nextSibling,l(o,h,m),o})(),(()=>{var o=ue(),u=o.firstChild,m=u.firstChild,I=m.nextSibling,x=u.nextSibling,v=x.firstChild,V=v.firstChild,W=V.nextSibling,k=v.nextSibling,Y=k.firstChild,Z=Y.nextSibling,G=x.nextSibling,S=G.firstChild,H=S.firstChild,J=H.nextSibling,D=S.nextSibling,K=D.firstChild,L=K.nextSibling;return u.$$click=()=>_("first-ten"),l(I,()=>d().due_10.length),v.$$click=()=>_("ten-twenty"),l(W,()=>d().due_10_20.length),k.$$click=()=>_("twenty-plus"),l(Z,()=>d().due_20plus.length),S.$$click=()=>_("white"),l(J,()=>d().due_white.length),D.$$click=()=>_("black"),l(L,()=>d().due_black.length),o})()]}})),n})()};ae(["click"]);const me=Object.freeze(Object.defineProperty({__proto__:null,Due_Component:F,PersistedSelectionComponent:N,default:$e},Symbol.toStringTag,{value:"Module"}));export{F as D,N as P,me as S,ge as c};
