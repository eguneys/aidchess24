var ye=Object.defineProperty;var Ce=(u,r,a)=>r in u?ye(u,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[r]=a;var y=(u,r,a)=>(Ce(u,typeof r!="symbol"?r+"":r,a),a);import{h as Se,j as xe,i as d,c as h,S as C,k as Me,l as S,b as p,m as v,n as x,o as b,p as re,q as ae,r as Ee,f as O,g as W,F as se,s as A,M as T,e as Pe,v as Te,d as Re,t as l,w as z}from"./index-Be4LgMea.js";/* empty css                   */import{S as De}from"./studyrepo-Dk4x-YPq.js";import{S as Qe,C as Le}from"./Shalala-mANot_sf.js";import{T as Ye,a as B,C as je}from"./Chesstree2-PUoZcEi6.js";import{I as Ie,M as Oe}from"./chess_pgn_logic-8egVLlrH.js";import{S as Ae,O as le}from"./SessionStore-yjN-z7dI.js";function Ne(u){let r=0;return a=>{r+=a.deltaY*(a.deltaMode?40:1),Math.abs(r)>=4?(u(a,!0),r=0):u(a,!1)}}var Fe=l("<div class=progress><div class=bar></div><h3>"),Ge=l("<div class=repertoire-wrap>"),ie=l("<small> Click on variations to expand. "),We=l("<small> Your goal is to guess every move correctly to pass the quiz. "),Be=l("<h2>Select a Quiz Option"),He=l("<button><span> Take Quiz "),Ke=l("<button><span> Play Deathmatch "),Ue=l("<h2>Deathmatch Mode"),_e=l("<span class=passed>passed"),Je=l("<small> Deathmatch "),Ve=l("<small> Your score: "),Xe=l("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),Ze=l("<h2>Quiz Mode"),et=l("<small> Quiz "),tt=l("<small> Your score: <!> out of 15 correct"),rt=l("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),at=l("<small> Your goal is to guess every move correctly to fill up the progress bar. "),st=l("<h2>Select a Practice Option"),lt=l("<button><span> Play all Moves "),it=l("<button><span> Play as Match "),_t=l("<h2>Play as Match"),oe=l("<small> End of practice. "),ne=l("<small> Congratulations. "),ot=l("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),nt=l("<h2>Play all moves"),ct=l("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),ht=l("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),ut=l("<li><div><h3></h3> "),dt=l('<div class=line><span class="fill white"></span><span class="fill black">'),mt=l("<small>You will play the moves from the opening."),pt=l("<small>If you go out of book, game ends."),vt=l("<div class=in_mode><button class=end2><span> End Deathmatch "),ce=l("<span class=failed>failed"),ft=l("<small>You are given 15 random positions from the opening."),gt=l("<small>Guess the correct move."),$t=l("<h2> of 15"),zt=l("<div class=in_mode><button class=end2><span> End Quiz "),qt=l("<small> Try to guess the moves for <!>."),bt=l("<small> AI will play the next move, picking a random variation. "),wt=l("<small> Moves will be hidden once the game is started. "),kt=l("<small>Try to guess the moves for both sides."),yt=l("<small>Moves will be hidden once you start.");const Ct=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],St=u=>Ct[Math.floor((1-u/10)*6)];class xt{constructor(){y(this,"_mode");y(this,"_match_color");y(this,"_practice_end_result");y(this,"_quiz_quiz_ls");y(this,"_quiz_deathmatch_fail");y(this,"_quiz_deathmatch_result_path");this._mode=S(void 0,{equals:!1}),this._match_color=S("white"),this._quiz_quiz_ls=S([],{equals:!1}),this._quiz_deathmatch_fail=S(0),this._quiz_deathmatch_result_path=S([]),this._practice_end_result=S(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){z(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){z(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){z(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){z(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){z(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){z(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){z(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){z(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const he=u=>(()=>{var r=Fe(),a=r.firstChild,e=a.nextSibling;return d(e,()=>`%${u.width}`),O(_=>A(a,`width: ${u.width}%`,_)),r})();class Mt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(a=>Math.round(a.progress/r)).reduce((a,e)=>a+e)}}class R{constructor(r,a,e,_){this.study_id=r,this.i_chapter=a,this.score_tree=e,this.solved_paths=_}static load_from_store(r,a){let e=new le(r.id,a);return R.make(r.id,a,r.chapters[a].pgn.tree,B.set_for_saving(e.solved_paths))}static save_paths_to_store(r){let a=new le(r.study_id,r.i_chapter);a.solved_paths=r.solved_paths.get_for_saving(),a.practice_progress=r.progress}static make(r,a,e,_=new B){return new R(r,a,Oe.make(e),_)}get progress(){return Math.floor(this.solved_paths.expand_paths.map(r=>{var a;return((a=this.score_tree.get_at(r))==null?void 0:a.score)??0}).reduce((r,a)=>r+a,0)*100)}get progress_map(){let r=x(()=>this.score_tree.progress_paths);const a=x(()=>r.map(e=>[e.filter(_=>_.length%2===1).map(_=>this.score_tree.get_at(_).score).reduce((_,g)=>_+g,0),e.filter(_=>_.length%2===0).map(_=>this.score_tree.get_at(_).score).reduce((_,g)=>_+g,0)]));return r.map((e,_)=>{let g=e[0],L=e[e.length-1],M=a[_][0],Y=a[_][1],D=p(()=>this.solved_paths.expand_paths),n=p(()=>D().filter(m=>e.some(q=>q.join("")===m.join("")))),j=p(()=>n().filter(m=>m.length%2===1).map(m=>this.score_tree.get_at(m).score).reduce((m,q)=>m+q,0)),Q=p(()=>n().filter(m=>m.length%2===0).map(m=>this.score_tree.get_at(m).score).reduce((m,q)=>m+q,0));return{color:St(g.length/20+L.length/10),total:M*2,black:p(()=>Q()/Y),white:p(()=>j()/M),path:L}}).reverse()}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),R.save_paths_to_store(this)}}const It=()=>{const u=Se(),[r]=xe(u.id,De.read_study);return(()=>{var a=Ge();return d(a,h(C,{get when(){return!r.loading},fallback:"Loading...",get children(){return h(Et,{get study(){return r()}})}})),a})()},Et=u=>{const r=Me(),a=()=>u.study;let e=new xt,_=new Qe;const[g,L]=S(Ae.i_chapter??0);let M=p(()=>{const s=a();return new Mt(s.chapters.map((o,$)=>R.load_from_store(s,$)))}),Y=p(()=>M().chapters[g()]);const D=p(()=>a().chapters[g()]),n=p(()=>{e.mode;let s=D();return Ye.make(s.pgn.tree.clone)}),j=p(()=>{if(e.mode==="quiz-quiz")return e.i_quiz_quiz===15});v(()=>{e.mode==="quiz-quiz"&&(e.i_quiz_quiz===15||x(()=>{n().set_random_cursor_hide_rest(),e.match_color=n().cursor_after_color}))}),v(()=>{let{mode:s,match_color:o}=e;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{x(()=>{n().reveal_one_random()})},400)}),v(()=>{n().solved_paths.replace_all(Y().solved_paths)});const Q=p(()=>{let s=n().tree;return x(()=>R.make(a().name,g(),s,new B))});v(()=>{if(e.mode!==void 0&&e.mode!=="match"&&e.mode!=="moves")return;x(()=>Q()).solved_paths.replace_all(n().solved_paths)}),v(b(()=>[Q(),Y()],(s,o)=>{if(o){let[$,E]=o;E.merge_and_save_stats($)}})),v(b(()=>_.add_uci,s=>{if(!s)return;n().try_next_uci_fail(s)?(m(),e.mode==="quiz-quiz"&&e.quiz_pass_one()):((e.mode==="match"||e.mode==="moves")&&setTimeout(()=>{n().on_wheel(-1)},100),e.mode==="quiz-quiz"&&(e.quiz_fail_one(),r.play("error")),e.mode==="quiz-deathmatch"&&(e.quiz_deathmatch_fail_result=-1,e.quiz_deathmatch_result_path=n().cursor_path.slice(0,-1)))})),v(b(()=>e.quiz_deathmatch_fail_result,()=>{r.play("victory")})),v(b(()=>e.practice_end_result,()=>{r.play("victory")})),v(()=>{let{mode:s,match_color:o}=e;s==="match"&&o==="black"&&x(()=>{m()})}),v(b(()=>n().fen_last_move,s=>{if(s){let[o,$]=s;_.on_set_fen_uci(o,$)}else _.on_set_fen_uci(Ie)}));const m=()=>{let s=()=>n().is_cursor_path_at_a_leaf;s()?e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=n().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0):(e.mode==="match"||e.mode==="quiz-deathmatch")&&setTimeout(()=>{n().reveal_one_random(),s()&&(e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=n().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0))},400)};v(b(()=>_.on_wheel,s=>{s&&n().on_wheel(s)}));const q=s=>{s.key==="f"&&e.flip_match_color()};v(b(()=>{var s;return(s=n().tree)==null?void 0:s.get_at(n().cursor_path)},s=>{s&&r.move(s)})),re(()=>{document.addEventListener("keypress",q)}),ae(()=>{document.removeEventListener("keypress",q)});const H=Ne(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),_.set_on_wheel(Math.sign(s.deltaY)))});v(()=>{e.match_color=a().orientation??"white"});const ue=p(()=>Q().progress_map);let N;re(()=>{N.addEventListener("wheel",H,{passive:!1})}),ae(()=>{N.removeEventListener("wheel",H)});const K=s=>{let o=e.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},de=p(()=>e.mode!==void 0&&!j()&&!e.practice_end_result),me=p(b(()=>e.quiz_deathmatch_result_path,s=>{var E,P;let o=s.length,$=(P=(E=n().tree)==null?void 0:E.all_leaves.map(w=>w.path).filter(w=>!n().failed_paths.find(F=>F.join("")===w.join(""))).filter(w=>w.join("").startsWith(s.join("")))[0])==null?void 0:P.length;return`${o} out of ${$}`}));return(()=>{var s=ht(),o=s.firstChild,$=o.firstChild,E=$.nextSibling,P=E.firstChild,w=P.firstChild,F=P.nextSibling,U=o.nextSibling,J=U.nextSibling,pe=J.nextSibling,V=pe.firstChild,X=V.firstChild,ve=X.firstChild,fe=ve.nextSibling,ge=X.nextSibling,$e=ge.firstChild,ze=V.nextSibling,Z=ze.firstChild,qe=Z.nextSibling,ee=qe.firstChild,G=ee.firstChild,te=G.nextSibling,be=ee.nextSibling;return Ee(t=>N=t,s),d(w,()=>a().name),d(P,h(he,{get width(){return M().progress}}),null),d(F,h(se,{get each(){return a().chapters},children:(t,i)=>(()=>{var c=ut(),k=c.firstChild,f=k.firstChild;return f.nextSibling,c.$$click=()=>L(i()),d(f,()=>t.name),d(k,h(he,{get width(){var I;return((I=M())==null?void 0:I.chapters[i()].progress)??0}}),null),O(()=>W(c,i()===g()?"active":"")),c})()})),d(U,h(Le,{get orientation(){return e.match_color},get movable(){return de()},get doPromotion(){return _.promotion},get onMoveAfter(){return _.on_move_after},get fen_uci(){return _.fen_uci},get color(){return _.turnColor},get dests(){return _.dests}})),d(J,h(se,{get each(){return ue()},children:t=>(()=>{var i=dt(),c=i.firstChild,k=c.nextSibling;return i.$$click=f=>n().try_set_cursor_path(t.path),O(f=>{var I=`background: ${t.color}; height: ${Math.round(t.total*100)}%`,we=`height: ${Math.round(t.white()*100)}%`,ke=`height: ${Math.round(t.black()*100)}%`;return f.e=A(i,I,f.e),f.t=A(c,we,f.t),f.a=A(k,ke,f.a),f},{e:void 0,t:void 0,a:void 0}),i})()})),d(fe,()=>D().name),d(Z,h(je,{get lala(){return n()}})),G.$$click=()=>e.end_match_or_moves(),te.$$click=()=>e.mode="quiz",d(be,h(Pe,{get children(){return[h(T,{get when(){return e.mode==="quiz"},get children(){return[ie(),We(),Be(),(()=>{var t=He();return t.$$click=()=>e.mode="quiz-quiz",t})(),(()=>{var t=Ke();return t.$$click=()=>e.mode="quiz-deathmatch",t})()]}}),h(T,{get when(){return e.mode==="quiz-deathmatch"},get children(){return[Ue(),h(C,{get when(){return e.quiz_deathmatch_fail_result!==0},get fallback(){return[mt(),pt(),(()=>{var t=vt(),i=t.firstChild;return i.$$click=()=>e.end_deathmatch(),t})()]},get children(){return[(()=>{var t=Je();return t.firstChild,d(t,h(C,{get when(){return e.quiz_deathmatch_fail_result>0},get fallback(){return ce()},get children(){return[" ",_e()]}}),null),t})(),(()=>{var t=Ve();return t.firstChild,d(t,me,null),t})(),(()=>{var t=Xe(),i=t.firstChild,c=i.nextSibling;return i.$$click=()=>e.restart_deathmatch(),c.$$click=()=>e.end_deathmatch(),t})()]}})]}}),h(T,{get when(){return e.mode==="quiz-quiz"},get children(){return[Ze(),h(C,{get when(){return j()},get fallback(){return[ft(),gt(),(()=>{var t=$t(),i=t.firstChild;return d(t,()=>e.i_quiz_quiz,i),t})(),(()=>{var t=zt(),i=t.firstChild;return i.$$click=()=>e.end_quiz(),t})()]},get children(){return[(()=>{var t=et();return t.firstChild,d(t,h(C,{get when(){return e.quiz_pass>10},get fallback(){return ce()},get children(){return[" ",_e()]}}),null),t})(),(()=>{var t=tt(),i=t.firstChild,c=i.nextSibling;return c.nextSibling,d(t,()=>e.quiz_pass,c),t})(),(()=>{var t=rt(),i=t.firstChild,c=i.nextSibling;return i.$$click=()=>e.restart_quiz(),c.$$click=()=>e.end_quiz(),t})()]}})]}}),h(T,{get when(){return e.mode===void 0},get children(){return[ie(),at(),st(),(()=>{var t=lt();return t.$$click=()=>e.mode="moves",t})(),(()=>{var t=it();return t.$$click=()=>e.mode="match",t})()]}}),h(T,{get when(){return e.mode==="match"},get children(){return[_t(),h(C,{get when(){return e.practice_end_result},get fallback(){return[(()=>{var t=qt(),i=t.firstChild,c=i.nextSibling;return c.nextSibling,d(t,()=>e.match_color,c),t})(),bt(),wt()]},get children(){return[oe(),ne()]}}),(()=>{var t=ot(),i=t.firstChild,c=i.nextSibling;return i.$$click=()=>e.restart_match(),c.$$click=()=>e.end_match_or_moves(),t})()]}}),h(T,{get when(){return e.mode==="moves"},get children(){return[nt(),h(C,{get when(){return e.practice_end_result},get fallback(){return[kt(),yt()]},get children(){return[oe(),ne()]}}),(()=>{var t=ct(),i=t.firstChild,c=i.nextSibling;return i.$$click=()=>{e.restart_moves()},c.$$click=()=>e.end_match_or_moves(),t})()]}})]}})),O(t=>{var i=D().site,c="tab"+K("practice"),k="tab"+K("quiz");return i!==t.e&&Te($e,"href",t.e=i),c!==t.t&&W(G,t.t=c),k!==t.a&&W(te,t.a=k),t},{e:void 0,t:void 0,a:void 0}),s})()};Re(["click"]);export{It as default};
