import{k as G,l as H,f as N,p as $,m as b,i as a,c as u,S as w,h as T,s as I,d as Q,t as i,x as R,a as y,v as U}from"./index-oDkSJERN.js";/* empty css                   */import{S as V}from"./studyrepo-gwUpw6xA.js";import{S as W,C as Y,o as j}from"./Shalala-B-YofOr1.js";import{b as J,T as K}from"./Chesstree2-DV-1IZTL.js";import"./chess_pgn_logic-BNcdKDJk.js";var X=i("<div class=progress><div class=bar></div><h3>"),Z=i("<div class=list-wrap><h1 class=header>Tactics</h1><div class=list><div><h3 class=title></h3><span>Total Runs</span><p>Highscore: <!> </p></div><div><p>Current Run</p><p>Score: "),ee=i("<div class=repertoire>"),te=i("<div class=board-wrap>"),re=i("<h3>Puzzle solved. <span> Score +"),se=i("<h3> Current Run Finished "),ne=i("<button><span>New Run"),ae=i("<div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>"),le=i("<h3>Find the best line!"),ie=i("<button><span>View Solution"),ce=i("<button><span>Next Puzzle");class E{constructor(r){this.id=r,this._scores=R(y([],{equals:!1}),{name:`.puzzle_run.${r}.scores.`}),this._current_run=[R(y(0),{name:`.puzzle_run.${r}.current_run.0.`}),R(y(0),{name:`.puzzle_run.${r}.current_run.1.`})]}static make=r=>new E(r);_scores;_current_run;get current_score(){return this._current_run[0][0]()??0}get i_selected_chapter(){return this._current_run[1][0]()??0}set current_score(r){this._current_run[0][1](r)}set i_selected_chapter(r){this._current_run[1][1](r)}get scores(){return this._scores[0]()}new_current_run(){this.current_score=0,this.i_selected_chapter=0}add_current_run(){let r=this._scores[0]();r.push(this.current_score),r=r.slice(-10),this._scores[1](r)}get highscore(){return Math.max(0,...this._scores[0]())}}class P{constructor(r,s){this.puzzle=r,this.solution=s,this.attempt=K.make(s)}static make=(r,s)=>new P(r,s);attempt}const A=d=>(()=>{var r=X(),s=r.firstChild,c=s.nextSibling;return a(c,()=>`${d.width}/${d.nb}`),T(S=>U(s,`width: ${d.width/d.nb*100}%`,S)),r})(),me=()=>{let r=G().id,s=E.make(r);const[c]=H(r,V.read_study),S=N(()=>c()?.chapters[s.i_selected_chapter]);let _=new W,h=N($(S,e=>{if(e){let t=P.make(e.pgn.puzzle,e.pgn.tree);return t.attempt.cursor_path=t.attempt.tree.root.data.path,t.attempt.tree.root.children.map(l=>l.data.path).forEach(l=>t.attempt._hidden_paths.add_path(l)),t}}));b($(()=>_.add_uci,e=>{e&&h()?.attempt.try_next_uci_fail(e)})),b($(()=>h()?.attempt.fen_last_move,e=>{if(e){let[t,l]=e;_.on_set_fen_uci(t,l)}})),b($(()=>_.on_wheel,e=>{e&&h()?.attempt.on_wheel(e)}));const O=()=>{let e=c();return e?`${s.i_selected_chapter+1} / ${e.chapters.length}  Score: ${s.current_score}`:"--"},C=()=>{let e=h()?.attempt.solved_paths_expanded.length??0,t=h()?.attempt.failed_paths.length??0;return e%2===1?e=e+1+(e-1)/2:e=e+e/2,t%2===1?t=t+1+(t-1)/2:t=t+e/2,e-t},D=()=>{s.new_current_run()},F=()=>{s.current_score=Math.max(0,s.current_score+C()),s.i_selected_chapter=s.i_selected_chapter+1};b($(()=>h()?.attempt.is_revealed,(e,t)=>{e&&!t&&s.i_selected_chapter===c().chapters.length-1&&(s.current_score=Math.max(0,s.current_score+C()),s.add_current_run())}));const L=()=>{h()?.attempt.reveal_hidden_paths()},q=e=>{const t=e.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(e.preventDefault(),_.set_on_wheel(Math.sign(e.deltaY)))};return(()=>{var e=ee();return e.addEventListener("wheel",q),a(e,u(w,{get when(){return!c.loading},fallback:"Loading...",get children(){var t=Z(),l=t.firstChild,f=l.nextSibling,o=f.firstChild,p=o.firstChild,x=p.nextSibling,m=x.nextSibling,k=m.firstChild,v=k.nextSibling;v.nextSibling;var g=o.nextSibling,z=g.firstChild,n=z.nextSibling;return n.firstChild,a(p,()=>c().name),a(o,u(A,{get width(){return s.scores.length},nb:10}),m),a(m,()=>s.highscore,v),a(g,u(A,{get width(){return s.i_selected_chapter+1},get nb(){return c().chapters.length}}),n),a(n,()=>s.current_score,null),t}}),null),a(e,u(w,{get when(){return h()},children:t=>[(()=>{var l=te();return a(l,u(Y,{get orientation(){return j(t().attempt.initial_color??"white")},get movable(){return!t().attempt.is_revealed},get doPromotion(){return _.promotion},get onMoveAfter(){return _.on_move_after},get fen_uci(){return _.fen_uci},get color(){return _.turnColor},get dests(){return _.dests}})),l})(),(()=>{var l=ae(),f=l.firstChild,o=f.firstChild,p=o.firstChild,x=p.nextSibling,m=o.nextSibling,k=m.firstChild,v=f.nextSibling,g=v.firstChild,z=g.nextSibling;return a(p,()=>c().name),a(x,O),a(g,u(J,{get lala(){return t().attempt}})),a(z,u(w,{get when(){return t().attempt.is_revealed},get fallback(){return[le(),(()=>{var n=ie();return n.$$click=L,n})()]},get children(){return[(()=>{var n=re(),B=n.firstChild,M=B.nextSibling;return M.firstChild,a(M,C,null),n})(),u(w,{get when(){return s.i_selected_chapter===c().chapters.length-1},get fallback(){return(()=>{var n=ce();return n.$$click=F,n})()},get children(){return[se(),(()=>{var n=ne();return n.$$click=D,n})()]}})]}})),T(()=>I(k,"href",`https://lichess.org/training/${t().puzzle}`)),l})()]}),null),e})()};Q(["click"]);export{me as default};
