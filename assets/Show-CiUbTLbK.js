import{c as o,a as w,K as O,f as p,i,S as P,R as X,l as Y,u as Z,F as R,A as ee,h as k,j as Q,s as K,N as te,O as A,b as se,d as ne,t as u,L as W,m as le}from"./index-D0kh0AZe.js";import{c as ie}from"./solid-dexie-B1gXUA1y.js";var ae=u("<div class=repeat-show>"),re=u("<div class=show>"),ce=u('<div class=new-repeat><h3>Create a New Repeat</h3><input type=text placeholder="Repeat Name"value="My Repeat"><div class=study-list><h3>Studies</h3><div class=list></div></div><div class=section-list><h3>Sections</h3><div class=controls><button>Select All</button></div><div class=list></div></div><button class=save> Save '),oe=u("<div class=none>"),z=u("<div>"),de=u("<p>Select a Study"),_e=u("<div class=section><input type=checkbox><label>"),ue=u("<div class=dialog><div class=overlay></div><div class=content>"),he=u("<div class=list-wrap><h3>Repeats</h3><div class=list></div><button>Create a New Repeat"),ve=u("<div class=show><h2></h2><h4>Sections</h4><div class=sections></div><div class=info><small>Total Positions: </small><p>Due Positions: </p><button>Play Due Positions</button></div><a class=delete>Delete Repeat"),$e=u("<div class=section>");const Ce=()=>o(pe,{}),pe=()=>{const[l,e]=w(!1),t=()=>{e(!0)},s=O(W),d=ie(()=>s.get_repeats()),[_,r]=w(0),a=p(()=>d[_()]),h=()=>{const c=a();c&&s.remove_repeat(c.name)};return(()=>{var c=ae();return i(c,o(fe,{repeats:d,set_i_selected_repeat:r,get i_selected_repeat(){return _()},on_open_create_repeat:t}),null),i(c,o(P,{get when(){return a()},get fallback(){return re()},children:b=>o(Se,{on_delete:h,get repeat(){return b()},on_open_create_repeat:t})}),null),i(c,o(P,{get when(){return l()},get children(){return o(ge,{onClose:()=>{e(!1)}})}}),null),c})()};class me{sections=[];add_section(e,t){this.sections=this.sections.filter(s=>!(s.study_id===e&&s.section_name===t)),this.sections.push({study_id:e,section_name:t})}remove_section(e,t){this.sections=this.sections.filter(s=>!(s.study_id===e&&s.section_name===t))}has(e,t){return!!this.sections.find(s=>s.study_id===e&&s.section_name===t)}}const ge=l=>{const e=p(X.imported[0]),[t,s]=w(0),d=p(()=>e()[t()]),_=p(()=>d()?.study_id),[r]=Y(()=>d()?.study_id,n=>le.read_section_study(n)),a=new me,h=(n,x)=>{x?a.add_section(_(),n):a.remove_section(_(),n)};let c;const b=()=>c.value,[f,S]=w(void 0,{equals:!1}),D=()=>{r()?.sections.map(n=>n.name).forEach(n=>a.add_section(_(),n)),S()},N=n=>(f(),a.has(_(),n)),E=O(W),y=()=>{let n=b();if(!n||n.length<3)return;let x={id:-1,name:n,sections:a.sections};E.add_repeat(x),l.onClose()};return o(be,{get onClose(){return l.onClose},get children(){var n=ce(),x=n.firstChild,L=x.nextSibling,F=L.nextSibling,B=F.firstChild,G=B.nextSibling,M=F.nextSibling,H=M.firstChild,T=H.nextSibling,J=T.firstChild,U=T.nextSibling,V=M.nextSibling;return Z(v=>c=v,L),i(G,o(R,{get each(){return e()},get fallback(){return(()=>{var v=oe();return i(v,o(ee,{href:"/repertoires",children:"Import some studies first"})),v})()},children:(v,$)=>(()=>{var m=z();return m.$$click=()=>s($()),i(m,()=>v.study_name),k(()=>Q(m,t()===$()?"study active":"study")),m})()})),J.$$click=()=>D(),i(U,o(P,{get when(){return r()},children:v=>o(R,{get each(){return v().sections},get fallback(){return de()},children:$=>(()=>{var m=_e(),C=m.firstChild,j=C.nextSibling;return C.addEventListener("change",g=>h($.name,g.target.checked)),i(j,()=>$.name),k(g=>{var q=$.name,I=$.name;return q!==g.e&&K(C,"id",g.e=q),I!==g.t&&K(j,"for",g.t=I),g},{e:void 0,t:void 0}),k(()=>C.checked=N($.name)),m})()})})),V.$$click=y,n}})},be=l=>{const e=te(()=>l.children);return(()=>{var t=ue(),s=t.firstChild,d=s.nextSibling;return A(s,"click",l.onClose,!0),i(d,e),t})()},fe=l=>{const e=p(()=>l.repeats);return(()=>{var t=he(),s=t.firstChild,d=s.nextSibling,_=d.nextSibling;return i(d,o(R,{get each(){return e()},children:(r,a)=>(()=>{var h=z();return h.$$click=()=>l.set_i_selected_repeat(a()),i(h,()=>r.name),k(()=>Q(h,"repeat"+(a()===l.i_selected_repeat?" active":""))),h})()})),A(_,"click",l.on_open_create_repeat,!0),t})()},Se=l=>{const e=p(()=>l.repeat),t=p(()=>e().moves.length),s=p(()=>e().moves.filter(r=>r.due.getTime()<=new Date().getTime()).length),d=se(),_=()=>{let r=e().id;d("/repeat/"+r)};return(()=>{var r=ve(),a=r.firstChild,h=a.nextSibling,c=h.nextSibling,b=c.nextSibling,f=b.firstChild;f.firstChild;var S=f.nextSibling;S.firstChild;var D=S.nextSibling,N=b.nextSibling;return i(a,()=>e().name),i(c,o(R,{get each(){return e().sections},children:E=>(()=>{var y=$e();return i(y,()=>E.section_name),y})()})),i(f,t,null),i(S,s,null),D.$$click=_,A(N,"click",l.on_delete,!0),r})()};ne(["click"]);export{Ce as default};
