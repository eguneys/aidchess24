var Te=Object.defineProperty;var Re=(d,r,a)=>r in d?Te(d,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[r]=a;var M=(d,r,a)=>(Re(d,typeof r!="symbol"?r+"":r,a),a);import{h as De,j as Qe,i as m,c as u,S as P,k as je,l as y,b as v,m as $,n as T,o as w,p as he,q as ue,r as Le,f as N,g as E,F as de,s as F,M as Q,e as Ye,v as Ie,d as Oe,t as l,w as k}from"./index-CUHX3pYO.js";/* empty css                   */import{S as Ae}from"./studyrepo-B70K42_7.js";import{S as Ne,C as Fe}from"./Shalala-BdOyL_wH.js";import{T as Ge,a as V,C as We}from"./Chesstree2-CW_O_Yh4.js";import{I as Be,M as He}from"./chess_pgn_logic-D6xT6ju7.js";import{S as Ke,O as me}from"./SessionStore-7Ws8UuIJ.js";function Ue(d){let r=0;return a=>{r+=a.deltaY*(a.deltaMode?40:1),Math.abs(r)>=4?(d(a,!0),r=0):d(a,!1)}}var Je=l("<div class=progress><div class=bar></div><h3>"),Ve=l("<div class=repertoire-wrap>"),pe=l("<small> Click on variations to expand. "),Xe=l("<small> Your goal is to guess every move correctly to pass the quiz. "),Ze=l("<h2>Select a Quiz Option"),et=l("<button><span> Take Quiz "),tt=l("<button><span> Play Deathmatch "),rt=l("<h2>Deathmatch Mode"),ve=l("<span class=passed>passed"),at=l("<small> Deathmatch "),st=l("<small> Your score: "),lt=l("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),it=l("<h2>Quiz Mode"),_t=l("<small> Quiz "),ot=l("<small> Your score: <!> out of 15 correct"),nt=l("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),ct=l("<small> Your goal is to guess every move correctly to fill up the progress bar. "),ht=l("<h2>Select a Practice Option"),ut=l("<button><span> Play all Moves "),dt=l("<button><span> Play as Match "),mt=l("<h2>Play as Match"),ge=l("<small> End of practice. "),fe=l("<small> Congratulations. "),pt=l("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),vt=l("<h2>Play all moves"),gt=l("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),ft=l("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5>Slav Defense</h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),$t=l("<li><div><h3></h3> "),zt=l('<div class=line><span class="fill white"></span><span class="fill black">'),qt=l("<small>You will play the moves from the opening."),bt=l("<small>If you go out of book, game ends."),kt=l("<div class=in_mode><button class=end2><span> End Deathmatch "),$e=l("<span class=failed>failed"),wt=l("<small>You are given 15 random positions from the opening."),yt=l("<small>Guess the correct move."),St=l("<h2> of 15"),Ct=l("<div class=in_mode><button class=end2><span> End Quiz "),xt=l("<small> Try to guess the moves for <!>."),Mt=l("<small> AI will play the next move, picking a random variation. "),Et=l("<small> Moves will be hidden once the game is started. "),Pt=l("<small>Try to guess the moves for both sides."),Tt=l("<small>Moves will be hidden once you start.");const Rt=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Dt=d=>Rt[Math.floor((1-d/10)*6)];class Qt{constructor(){M(this,"_mode");M(this,"_match_color");M(this,"_practice_end_result");M(this,"_quiz_quiz_ls");M(this,"_quiz_deathmatch_fail");M(this,"_quiz_deathmatch_result_path");this._mode=y(void 0,{equals:!1}),this._match_color=y("white"),this._quiz_quiz_ls=y([],{equals:!1}),this._quiz_deathmatch_fail=y(0),this._quiz_deathmatch_result_path=y([]),this._practice_end_result=y(!1)}get mode(){return this._mode[0]()}set mode(r){this._mode[1](r)}get match_color(){return this._match_color[0]()}set match_color(r){this._match_color[1](r)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(r){this._practice_end_result[1](r)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){k(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){k(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){k(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz-quiz"})}end_quiz(){k(()=>{this.quiz_quiz_ls=[],this.mode="quiz"})}quiz_pass_one(){k(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls})}quiz_fail_one(){k(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls})}get quiz_pass(){return this.quiz_quiz_ls.filter(r=>r>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(r){this._quiz_quiz_ls[1](r)}set quiz_deathmatch_fail_result(r){this._quiz_deathmatch_fail[1](r)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(r){this._quiz_deathmatch_result_path[1](r)}restart_deathmatch(){k(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){k(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const ze=d=>(()=>{var r=Je(),a=r.firstChild,c=a.nextSibling;return m(c,()=>`%${d.width}`),N(n=>F(a,`width: ${d.width}%`,n)),r})();class jt{constructor(r){this.chapters=r}get progress(){let r=this.chapters.length;return this.chapters.map(a=>Math.round(a.progress/r)).reduce((a,c)=>a+c)}}class j{constructor(r,a,c,n){this.study_id=r,this.i_chapter=a,this.score_tree=c,this.solved_paths=n}static load_from_store(r,a){let c=new me(r.id,a);return j.make(r.id,a,r.chapters[a].pgn.tree,V.set_for_saving(c.solved_paths))}static save_paths_to_store(r){let a=new me(r.study_id,r.i_chapter);a.solved_paths=r.solved_paths.get_for_saving(),a.practice_progress=r.progress}static make(r,a,c,n=new V){return new j(r,a,He.make(c),n)}get progress(){return Math.round(this.solved_paths.paths.map(r=>{var a;return((a=this.score_tree.get_at(r))==null?void 0:a.score)??0}).reduce((r,a)=>r+a,0)*100)}get progress_map(){let r=T(()=>this.score_tree.progress_paths);const a=T(()=>r.map(c=>[c.filter(n=>n.length%2===1).map(n=>this.score_tree.get_at(n).score).reduce((n,e)=>n+e,0),c.filter(n=>n.length%2===0).map(n=>this.score_tree.get_at(n).score).reduce((n,e)=>n+e,0)]));return r.map((c,n)=>{let e=c[0],f=c[c.length-1],S=a[n][0],G=a[n][1],L=v(()=>this.solved_paths.paths),Y=v(()=>L().filter(p=>c.some(z=>z.join("")===p.join("")))),I=v(()=>Y().filter(p=>p.length%2===1).map(p=>this.score_tree.get_at(p).score).reduce((p,z)=>p+z,0)),i=v(()=>Y().filter(p=>p.length%2===0).map(p=>this.score_tree.get_at(p).score).reduce((p,z)=>p+z,0));return{color:Dt(e.length/20+f.length/10),total:S*2,black:v(()=>i()/G),white:v(()=>I()/S),path:f}}).reverse()}merge_and_save_stats(r){this.solved_paths.merge_dup(r.solved_paths),j.save_paths_to_store(this)}}const Bt=()=>{const d=De(),[r]=Qe(d.id,Ae.read_study);return(()=>{var a=Ve();return m(a,u(P,{get when(){return!r.loading},fallback:"Loading...",get children(){return u(Lt,{get study(){return r()}})}})),a})()},Lt=d=>{const r=je(),a=()=>d.study;let[c,n]=y(!1),e=new Qt,f=new Ne;const[S,G]=y(Ke.i_chapter??0);let L=v(()=>{const s=a();return new jt(s.chapters.map((o,q)=>j.load_from_store(s,q)))}),Y=v(()=>L().chapters[S()]);const I=v(()=>a().chapters[S()]),i=v(()=>{e.mode;let s=I();return Ge.make(s.pgn.tree.clone)}),p=v(()=>{if(e.mode==="quiz-quiz")return e.i_quiz_quiz===15});$(()=>{e.mode==="quiz-quiz"&&(e.i_quiz_quiz===15||T(()=>{i().set_random_cursor_hide_rest(),e.match_color=i().cursor_after_color}))}),$(()=>{let{mode:s,match_color:o}=e;s==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{T(()=>{i().reveal_one_random()})},400)}),$(()=>{i().solved_paths.replace_all(Y().solved_paths)});const z=v(()=>{let s=i().tree;return T(()=>j.make(a().name,S(),s,new V))});$(()=>{if(e.mode!==void 0&&e.mode!=="match"&&e.mode!=="moves")return;T(()=>z()).solved_paths.replace_all(i().solved_paths)}),$(w(()=>[z(),Y()],(s,o)=>{if(o){let[q,R]=o;R.merge_and_save_stats(q)}})),$(w(()=>f.add_uci,s=>{if(c()||(console.log(c()),!s))return;i().try_next_uci_fail(s)?(X(),e.mode==="quiz-quiz"&&e.quiz_pass_one()):((e.mode==="match"||e.mode==="moves")&&(n(!0),setTimeout(()=>{i().on_wheel(-1),console.log(i().cursor_path),n(!1)},100)),e.mode==="quiz-quiz"&&(e.quiz_fail_one(),r.play("error")),e.mode==="quiz-deathmatch"&&(e.quiz_deathmatch_fail_result=-1,e.quiz_deathmatch_result_path=i().cursor_path.slice(0,-1)))})),$(w(()=>e.quiz_deathmatch_fail_result,()=>{r.play("victory")})),$(w(()=>e.practice_end_result,()=>{r.play("victory")})),$(()=>{let{mode:s,match_color:o}=e;s==="match"&&o==="black"&&T(()=>{X()})}),$(w(()=>i().fen_last_move,s=>{if(s){let[o,q]=s;f.on_set_fen_uci(o,q)}else f.on_set_fen_uci(Be)}));const X=()=>{let s=()=>i().is_cursor_path_at_a_leaf;s()?e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=i().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0):(e.mode==="match"||e.mode==="quiz-deathmatch")&&(n(!0),console.log("set"),setTimeout(()=>{console.trace("reveal"),console.log(i().cursor_path),i().reveal_one_random(),s()&&(e.mode==="quiz-deathmatch"?(e.quiz_deathmatch_fail_result=1,e.quiz_deathmatch_result_path=i().cursor_path):(e.mode==="match"||e.mode==="moves")&&(e.practice_end_result=!0)),n(!1)},400))};$(w(()=>f.on_wheel,s=>{s&&i().on_wheel(s)}));const Z=s=>{s.key==="f"&&e.flip_match_color()};$(w(()=>{var s;return(s=i().tree)==null?void 0:s.get_at(i().cursor_path)},s=>{s&&r.move(s)})),he(()=>{document.addEventListener("keypress",Z)}),ue(()=>{document.removeEventListener("keypress",Z)});const ee=Ue(s=>{const o=s.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(s.preventDefault(),f.set_on_wheel(Math.sign(s.deltaY)))});$(()=>{e.match_color=a().orientation??"white"});const qe=v(()=>z().progress_map);let W;he(()=>{W.addEventListener("wheel",ee,{passive:!1})}),ue(()=>{W.removeEventListener("wheel",ee)});const te=s=>{let o=e.mode;if(s==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},be=v(()=>e.mode!==void 0&&!p()&&!e.practice_end_result),ke=v(w(()=>e.quiz_deathmatch_result_path,s=>{var R,D;let o=s.length,q=(D=(R=i().tree)==null?void 0:R.all_leaves.map(C=>C.path).filter(C=>!i().failed_paths.find(B=>B.join("")===C.join(""))).filter(C=>C.join("").startsWith(s.join("")))[0])==null?void 0:D.length;return`${o} out of ${q}`}));return(()=>{var s=ft(),o=s.firstChild,q=o.firstChild,R=q.nextSibling,D=R.firstChild,C=D.firstChild,B=D.nextSibling,re=o.nextSibling,ae=re.nextSibling,we=ae.nextSibling,se=we.firstChild,le=se.firstChild,ye=le.firstChild,Se=ye.nextSibling,Ce=le.nextSibling,xe=Ce.firstChild,Me=se.nextSibling,ie=Me.firstChild,_e=ie.nextSibling,H=_e.firstChild,K=H.nextSibling,U=K.nextSibling,oe=U.nextSibling,Ee=_e.nextSibling,ne=Ee.firstChild,J=ne.firstChild,ce=J.nextSibling,Pe=ne.nextSibling;return Le(t=>W=t,s),m(C,()=>a().name),m(D,u(ze,{get width(){return L().progress}}),null),m(B,u(de,{get each(){return a().chapters},children:(t,_)=>(()=>{var h=$t(),b=h.firstChild,g=b.firstChild;return g.nextSibling,h.$$click=()=>G(_()),m(g,()=>t.name),m(b,u(ze,{get width(){var x;return((x=L())==null?void 0:x.chapters[_()].progress)??0}}),null),N(()=>E(h,_()===S()?"active":"")),h})()})),m(re,u(Fe,{get orientation(){return e.match_color},get movable(){return be()},get doPromotion(){return f.promotion},get onMoveAfter(){return f.on_move_after},get fen_uci(){return f.fen_uci},get color(){return f.turnColor},get dests(){return f.dests}})),m(ae,u(de,{get each(){return qe()},children:t=>(()=>{var _=zt(),h=_.firstChild,b=h.nextSibling;return _.$$click=g=>i().try_set_cursor_path(t.path),N(g=>{var x=`background: ${t.color}; height: ${Math.round(t.total*100)}%`,O=`height: ${Math.round(t.white()*100)}%`,A=`height: ${Math.round(t.black()*100)}%`;return g.e=F(_,x,g.e),g.t=F(h,O,g.t),g.a=F(b,A,g.a),g},{e:void 0,t:void 0,a:void 0}),_})()})),m(Se,()=>I().name),m(ie,u(We,{get lala(){return i()}})),H.$$click=()=>i().navigate_first(),K.$$click=()=>i().navigate_prev(),U.$$click=()=>i().navigate_next(),oe.$$click=()=>i().navigate_last(),J.$$click=()=>e.end_match_or_moves(),ce.$$click=()=>e.mode="quiz",m(Pe,u(Ye,{get children(){return[u(Q,{get when(){return e.mode==="quiz"},get children(){return[pe(),Xe(),Ze(),(()=>{var t=et();return t.$$click=()=>e.mode="quiz-quiz",t})(),(()=>{var t=tt();return t.$$click=()=>e.mode="quiz-deathmatch",t})()]}}),u(Q,{get when(){return e.mode==="quiz-deathmatch"},get children(){return[rt(),u(P,{get when(){return e.quiz_deathmatch_fail_result!==0},get fallback(){return[qt(),bt(),(()=>{var t=kt(),_=t.firstChild;return _.$$click=()=>e.end_deathmatch(),t})()]},get children(){return[(()=>{var t=at();return t.firstChild,m(t,u(P,{get when(){return e.quiz_deathmatch_fail_result>0},get fallback(){return $e()},get children(){return[" ",ve()]}}),null),t})(),(()=>{var t=st();return t.firstChild,m(t,ke,null),t})(),(()=>{var t=lt(),_=t.firstChild,h=_.nextSibling;return _.$$click=()=>e.restart_deathmatch(),h.$$click=()=>e.end_deathmatch(),t})()]}})]}}),u(Q,{get when(){return e.mode==="quiz-quiz"},get children(){return[it(),u(P,{get when(){return p()},get fallback(){return[wt(),yt(),(()=>{var t=St(),_=t.firstChild;return m(t,()=>e.i_quiz_quiz,_),t})(),(()=>{var t=Ct(),_=t.firstChild;return _.$$click=()=>e.end_quiz(),t})()]},get children(){return[(()=>{var t=_t();return t.firstChild,m(t,u(P,{get when(){return e.quiz_pass>10},get fallback(){return $e()},get children(){return[" ",ve()]}}),null),t})(),(()=>{var t=ot(),_=t.firstChild,h=_.nextSibling;return h.nextSibling,m(t,()=>e.quiz_pass,h),t})(),(()=>{var t=nt(),_=t.firstChild,h=_.nextSibling;return _.$$click=()=>e.restart_quiz(),h.$$click=()=>e.end_quiz(),t})()]}})]}}),u(Q,{get when(){return e.mode===void 0},get children(){return[pe(),ct(),ht(),(()=>{var t=ut();return t.$$click=()=>e.mode="moves",t})(),(()=>{var t=dt();return t.$$click=()=>e.mode="match",t})()]}}),u(Q,{get when(){return e.mode==="match"},get children(){return[mt(),u(P,{get when(){return e.practice_end_result},get fallback(){return[(()=>{var t=xt(),_=t.firstChild,h=_.nextSibling;return h.nextSibling,m(t,()=>e.match_color,h),t})(),Mt(),Et()]},get children(){return[ge(),fe()]}}),(()=>{var t=pt(),_=t.firstChild,h=_.nextSibling;return _.$$click=()=>e.restart_match(),h.$$click=()=>{let b=i().cursor_path;e.end_match_or_moves(),i().cursor_path=b},t})()]}}),u(Q,{get when(){return e.mode==="moves"},get children(){return[vt(),u(P,{get when(){return e.practice_end_result},get fallback(){return[Pt(),Tt()]},get children(){return[ge(),fe()]}}),(()=>{var t=gt(),_=t.firstChild,h=_.nextSibling;return _.$$click=()=>{e.restart_moves()},h.$$click=()=>e.end_match_or_moves(),t})()]}})]}})),N(t=>{var _=I().site,h="fbt first"+(!c()&&i().can_navigate_prev?"":" disabled"),b="fbt prev"+(!c()&&i().can_navigate_prev?"":" disabled"),g="fbt next"+(!c()&&i().can_navigate_next?"":" disabled"),x="fbt last"+(!c()&&i().can_navigate_next?"":" disabled"),O="tab"+te("practice"),A="tab"+te("quiz");return _!==t.e&&Ie(xe,"href",t.e=_),h!==t.t&&E(H,t.t=h),b!==t.a&&E(K,t.a=b),g!==t.o&&E(U,t.o=g),x!==t.i&&E(oe,t.i=x),O!==t.n&&E(J,t.n=O),A!==t.s&&E(ce,t.s=A),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),s})()};Oe(["click"]);export{Bt as default};
