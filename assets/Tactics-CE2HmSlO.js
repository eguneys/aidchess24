import{l as B,m as G,g as N,q as $,n as b,i as l,c as h,S as w,j as T,s as H,d as I,t as i,z as R,a as y,w as Q}from"./index-DKf-PiWO.js";/* empty css                   */import{S as U}from"./studyrepo-D2P3rfiz.js";import{S as V,C as W,o as Y}from"./Chessboard-y29EJ1B8.js";import{b as J,T as K}from"./Chesstree2-B5jLr7a2.js";var X=i("<div class=progress><div class=bar></div><h3>"),Z=i("<div class=list-wrap><h1 class=header>Tactics</h1><div class=list><div><h3 class=title></h3><span>Total Runs</span><p>Highscore: <!> </p></div><div><p>Current Run</p><p>Score: "),ee=i("<div class=repertoire>"),te=i("<div class=board-wrap>"),re=i("<h3>Puzzle solved. <span> Score +"),se=i("<h3> Current Run Finished "),ne=i("<button><span>New Run"),le=i("<div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=tools>"),ae=i("<h3>Find the best line!"),ie=i("<button><span>View Solution"),ce=i("<button><span>Next Puzzle");class E{constructor(r){this.id=r,this._scores=R(y([],{equals:!1}),{name:`.puzzle_run.${r}.scores.`}),this._current_run=[R(y(0),{name:`.puzzle_run.${r}.current_run.0.`}),R(y(0),{name:`.puzzle_run.${r}.current_run.1.`})]}static make=r=>new E(r);_scores;_current_run;get current_score(){return this._current_run[0][0]()??0}get i_selected_chapter(){return this._current_run[1][0]()??0}set current_score(r){this._current_run[0][1](r)}set i_selected_chapter(r){this._current_run[1][1](r)}get scores(){return this._scores[0]()}new_current_run(){this.current_score=0,this.i_selected_chapter=0}add_current_run(){let r=this._scores[0]();r.push(this.current_score),r=r.slice(-10),this._scores[1](r)}get highscore(){return Math.max(0,...this._scores[0]())}}class P{constructor(r,s){this.puzzle=r,this.solution=s,this.attempt=K.make(s)}static make=(r,s)=>new P(r,s);attempt}const A=d=>(()=>{var r=X(),s=r.firstChild,c=s.nextSibling;return l(c,()=>`${d.width}/${d.nb}`),T(S=>Q(s,`width: ${d.width/d.nb*100}%`,S)),r})(),pe=()=>{let r=B().id,s=E.make(r);const[c]=G(r,U.read_study),S=N(()=>c()?.chapters[s.i_selected_chapter]);let _=new V,u=N($(S,e=>{if(e){let t=P.make(e.pgn.puzzle,e.pgn.tree);return t.attempt.cursor_path=t.attempt.tree.root[0].data.path,t.attempt.tree.root[0].children.map(a=>a.data.path).forEach(a=>t.attempt._hidden_paths.add_path(a)),t}}));b($(()=>_.add_uci,e=>{if(!e)return;let[t]=e;u()?.attempt.try_next_uci_fail(t)})),b($(()=>u()?.attempt.fen_last_move,e=>{if(e){let[t,a]=e;_.on_set_fen_uci(t,a)}})),b($(()=>_.on_wheel,e=>{e&&u()?.attempt.on_wheel(e)}));const O=()=>{let e=c();return e?`${s.i_selected_chapter+1} / ${e.chapters.length}  Score: ${s.current_score}`:"--"},C=()=>{let e=u()?.attempt.solved_paths_expanded.length??0,t=u()?.attempt.failed_paths.length??0;return e%2===1?e=e+1+(e-1)/2:e=e+e/2,t%2===1?t=t+1+(t-1)/2:t=t+e/2,e-t},q=()=>{s.new_current_run()},D=()=>{s.current_score=Math.max(0,s.current_score+C()),s.i_selected_chapter=s.i_selected_chapter+1};b($(()=>u()?.attempt.is_revealed,(e,t)=>{e&&!t&&s.i_selected_chapter===c().chapters.length-1&&(s.current_score=Math.max(0,s.current_score+C()),s.add_current_run())}));const F=()=>{u()?.attempt.reveal_hidden_paths()},L=e=>{const t=e.target;t.tagName!=="PIECE"&&t.tagName!=="SQUARE"&&t.tagName!=="CG-BOARD"||(e.preventDefault(),_.set_on_wheel(Math.sign(e.deltaY)))};return(()=>{var e=ee();return e.addEventListener("wheel",L),l(e,h(w,{get when(){return!c.loading},fallback:"Loading...",get children(){var t=Z(),a=t.firstChild,f=a.nextSibling,o=f.firstChild,p=o.firstChild,x=p.nextSibling,m=x.nextSibling,k=m.firstChild,v=k.nextSibling;v.nextSibling;var g=o.nextSibling,z=g.firstChild,n=z.nextSibling;return n.firstChild,l(p,()=>c().name),l(o,h(A,{get width(){return s.scores.length},nb:10}),m),l(m,()=>s.highscore,v),l(g,h(A,{get width(){return s.i_selected_chapter+1},get nb(){return c().chapters.length}}),n),l(n,()=>s.current_score,null),t}}),null),l(e,h(w,{get when(){return u()},children:t=>[(()=>{var a=te();return l(a,h(W,{get orientation(){return Y(t().attempt.initial_color??"white")},get movable(){return!t().attempt.is_revealed},get doPromotion(){return _.promotion},get onMoveAfter(){return _.on_move_after},get fen_uci(){return _.fen_uci},get color(){return _.turnColor},get dests(){return _.dests}})),a})(),(()=>{var a=le(),f=a.firstChild,o=f.firstChild,p=o.firstChild,x=p.nextSibling,m=o.nextSibling,k=m.firstChild,v=f.nextSibling,g=v.firstChild,z=g.nextSibling;return l(p,()=>c().name),l(x,O),l(g,h(J,{get lala(){return t().attempt}})),l(z,h(w,{get when(){return t().attempt.is_revealed},get fallback(){return[ae(),(()=>{var n=ie();return n.$$click=F,n})()]},get children(){return[(()=>{var n=re(),j=n.firstChild,M=j.nextSibling;return M.firstChild,l(M,C,null),n})(),h(w,{get when(){return s.i_selected_chapter===c().chapters.length-1},get fallback(){return(()=>{var n=ce();return n.$$click=D,n})()},get children(){return[se(),(()=>{var n=ne();return n.$$click=q,n})()]}})]}})),T(()=>H(k,"href",`https://lichess.org/training/${t().puzzle}`)),a})()]}),null),e})()};I(["click"]);export{pe as default};
