const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-BXKD9t2i.js","assets/Home-OYlkU4dT.css","assets/Contact-CN7chQtM.js","assets/Contact-DI9B5wA9.css","assets/Beta-DC677eJz.js","assets/Beta-Ba2oikMa.css","assets/List-DbIg5vqC.js","assets/List-CE3C3CI1.css","assets/Show-CHQXOo3J.js","assets/random-BnFOfONc.js","assets/random-C7HFkO0p.css","assets/Show-CSTEVy9X.css","assets/List-DregIU3g.js","assets/List-DE0o7Jrc.css","assets/Show-BP7DMmmb.js","assets/Show-GJ83gIsB.css"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const se={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return So(this.context.count)},getNextContextId(){return So(this.context.count++)}};function So(t){const e=String(t),n=e.length-1;return se.context.id+(n?String.fromCharCode(96+n):"")+e}function Rt(t){se.context=t}const ia=!1,sa=(t,e)=>t===e,pt=Symbol("solid-proxy"),oa=typeof Proxy=="function",ls=Symbol("solid-track"),ti={equals:sa};let fr=null,aa=pa;const Qe=1,hr=2,ua={owned:null,cleanups:null,context:null,owner:null},ns={};var ue=null;let G=null,Hu=null,ge=null,Be=null,Ne=null,li=0;function Mn(t,e){const n=ge,i=ue,o=t.length===0,a=e===void 0?i:e,l=o?ua:{owned:null,cleanups:null,context:a?a.context:null,owner:a},c=o?t:()=>t(()=>De(()=>Bt(l)));ue=l,ge=null;try{return rt(c,!0)}finally{ge=n,ue=i}}function Ce(t,e){e=e?Object.assign({},ti,e):ti;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},i=o=>(typeof o=="function"&&(G&&G.running&&G.sources.has(n)?o=o(n.tValue):o=o(n.value)),da(n,o));return[ha.bind(n),i]}function Oo(t,e,n){const i=zn(t,e,!0,Qe);_n(i)}function nt(t,e,n){const i=zn(t,e,!1,Qe);_n(i)}function fi(t,e,n){aa=ec;const i=zn(t,e,!1,Qe),o=hn&&bt(hn);o&&(i.suspense=o),i.user=!0,Ne?Ne.push(i):_n(i)}function te(t,e,n){n=n?Object.assign({},ti,n):ti;const i=zn(t,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,_n(i),ha.bind(i)}function Gu(t){return t&&typeof t=="object"&&"then"in t}function ca(t,e,n){let i,o,a;typeof e=="function"?(i=t,o=e,a=n||{}):(i=!0,o=t,a=e||{});let l=null,c=ns,p=null,y=!1,m=!1,g="initialValue"in a,R=typeof i=="function"&&te(i);const $=new Set,[U,T]=(a.storage||Ce)(a.initialValue),[I,X]=Ce(void 0),[K,B]=Ce(void 0,{equals:!1}),[V,J]=Ce(g?"ready":"unresolved");se.context&&(p=se.getNextContextId(),a.ssrLoadFrom==="initial"?c=a.initialValue:se.load&&se.has(p)&&(c=se.load(p)));function re(ve,Se,Ee,qe){return l===ve&&(l=null,qe!==void 0&&(g=!0),(ve===c||Se===c)&&a.onHydrated&&queueMicrotask(()=>a.onHydrated(qe,{value:Se})),c=ns,G&&ve&&y?(G.promises.delete(ve),y=!1,rt(()=>{G.running=!0,fe(Se,Ee)},!1)):fe(Se,Ee)),Se}function fe(ve,Se){rt(()=>{Se===void 0&&T(()=>ve),J(Se!==void 0?"errored":g?"ready":"unresolved"),X(Se);for(const Ee of $.keys())Ee.decrement();$.clear()},!1)}function Me(){const ve=hn&&bt(hn),Se=U(),Ee=I();if(Ee!==void 0&&!l)throw Ee;return ge&&!ge.user&&ve&&Oo(()=>{K(),l&&(ve.resolved&&G&&y?G.promises.add(l):$.has(ve)||(ve.increment(),$.add(ve)))}),Se}function Ge(ve=!0){if(ve!==!1&&m)return;m=!1;const Se=R?R():i;if(y=G&&G.running,Se==null||Se===!1){re(l,De(U));return}G&&l&&G.promises.delete(l);const Ee=c!==ns?c:De(()=>o(Se,{value:U(),refetching:ve}));return Gu(Ee)?(l=Ee,"value"in Ee?(Ee.status==="success"?re(l,Ee.value,void 0,Se):re(l,void 0,hs(Ee.value),Se),Ee):(m=!0,queueMicrotask(()=>m=!1),rt(()=>{J(g?"refreshing":"pending"),B()},!1),Ee.then(qe=>re(Ee,qe,void 0,Se),qe=>re(Ee,void 0,hs(qe),Se)))):(re(l,Ee,void 0,Se),Ee)}return Object.defineProperties(Me,{state:{get:()=>V()},error:{get:()=>I()},loading:{get(){const ve=V();return ve==="pending"||ve==="refreshing"}},latest:{get(){if(!g)return Me();const ve=I();if(ve&&!l)throw ve;return U()}}}),R?Oo(()=>Ge(!1)):Ge(!1),[Me,{refetch:Ge,mutate:T}]}function od(t,e=sa,n){const i=new Map,o=zn(a=>{const l=t();for(const[c,p]of i.entries())if(e(c,l)!==e(c,a))for(const y of p.values())y.state=Qe,y.pure?Be.push(y):Ne.push(y);return l},void 0,!0,Qe);return _n(o),a=>{const l=ge;if(l){let c;(c=i.get(a))?c.add(l):i.set(a,c=new Set([l])),Vt(()=>{c.delete(l),!c.size&&i.delete(a)})}return e(a,G&&G.running&&G.sources.has(o)?o.tValue:o.value)}}function ht(t){return rt(t,!1)}function De(t){if(ge===null)return t();const e=ge;ge=null;try{return t()}finally{ge=e}}function gr(t,e,n){const i=Array.isArray(t);let o,a=n&&n.defer;return l=>{let c;if(i){c=Array(t.length);for(let y=0;y<t.length;y++)c[y]=t[y]()}else c=t();if(a)return a=!1,l;const p=De(()=>e(c,o,l));return o=c,p}}function Wu(t){fi(()=>De(t))}function Vt(t){return ue===null||(ue.cleanups===null?ue.cleanups=[t]:ue.cleanups.push(t)),t}function Yu(t,e){fr||(fr=Symbol("error")),ue=zn(void 0,void 0,!0),ue.context={...ue.context,[fr]:[e]},G&&G.running&&G.sources.add(ue);try{return t()}catch(n){wr(n)}finally{ue=ue.owner}}function fs(){return ge}function Ds(){return ue}function la(t,e){const n=ue,i=ge;ue=t,ge=null;try{return rt(e,!0)}catch(o){wr(o)}finally{ue=n,ge=i}}function fa(t){if(G&&G.running)return t(),G.done;const e=ge,n=ue;return Promise.resolve().then(()=>{ge=e,ue=n;let i;return hn&&(i=G||(G={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),i.done||(i.done=new Promise(o=>i.resolve=o)),i.running=!0),rt(t,!1),ge=ue=null,i?i.done:void 0})}const[Qu,Po]=Ce(!1);function ad(){return[Qu,fa]}function Xu(t){Ne.push.apply(Ne,t),t.length=0}function Tt(t,e){const n=Symbol("context");return{id:n,Provider:tc(n),defaultValue:t}}function bt(t){let e;return ue&&ue.context&&(e=ue.context[t.id])!==void 0?e:t.defaultValue}function Bn(t){const e=te(t),n=te(()=>ds(e()));return n.toArray=()=>{const i=n();return Array.isArray(i)?i:i!=null?[i]:[]},n}let hn;function Ju(){return hn||(hn=Tt())}function ha(){const t=G&&G.running;if(this.sources&&(t?this.tState:this.state))if((t?this.tState:this.state)===Qe)_n(this);else{const e=Be;Be=null,rt(()=>ri(this),!1),Be=e}if(ge){const e=this.observers?this.observers.length:0;ge.sources?(ge.sources.push(this),ge.sourceSlots.push(e)):(ge.sources=[this],ge.sourceSlots=[e]),this.observers?(this.observers.push(ge),this.observerSlots.push(ge.sources.length-1)):(this.observers=[ge],this.observerSlots=[ge.sources.length-1])}return t&&G.sources.has(this)?this.tValue:this.value}function da(t,e,n){let i=G&&G.running&&G.sources.has(t)?t.tValue:t.value;if(!t.comparator||!t.comparator(i,e)){if(G){const o=G.running;(o||!n&&G.sources.has(t))&&(G.sources.add(t),t.tValue=e),o||(t.value=e)}else t.value=e;t.observers&&t.observers.length&&rt(()=>{for(let o=0;o<t.observers.length;o+=1){const a=t.observers[o],l=G&&G.running;l&&G.disposed.has(a)||((l?!a.tState:!a.state)&&(a.pure?Be.push(a):Ne.push(a),a.observers&&ya(a)),l?a.tState=Qe:a.state=Qe)}if(Be.length>1e6)throw Be=[],new Error},!1)}return e}function _n(t){if(!t.fn)return;Bt(t);const e=li;Co(t,G&&G.running&&G.sources.has(t)?t.tValue:t.value,e),G&&!G.running&&G.sources.has(t)&&queueMicrotask(()=>{rt(()=>{G&&(G.running=!0),ge=ue=t,Co(t,t.tValue,e),ge=ue=null},!1)})}function Co(t,e,n){let i;const o=ue,a=ge;ge=ue=t;try{i=t.fn(e)}catch(l){return t.pure&&(G&&G.running?(t.tState=Qe,t.tOwned&&t.tOwned.forEach(Bt),t.tOwned=void 0):(t.state=Qe,t.owned&&t.owned.forEach(Bt),t.owned=null)),t.updatedAt=n+1,wr(l)}finally{ge=a,ue=o}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?da(t,i,!0):G&&G.running&&t.pure?(G.sources.add(t),t.tValue=i):t.value=i,t.updatedAt=n)}function zn(t,e,n,i=Qe,o){const a={fn:t,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:ue,context:ue?ue.context:null,pure:n};return G&&G.running&&(a.state=0,a.tState=i),ue===null||ue!==ua&&(G&&G.running&&ue.pure?ue.tOwned?ue.tOwned.push(a):ue.tOwned=[a]:ue.owned?ue.owned.push(a):ue.owned=[a]),a}function ni(t){const e=G&&G.running;if((e?t.tState:t.state)===0)return;if((e?t.tState:t.state)===hr)return ri(t);if(t.suspense&&De(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<li);){if(e&&G.disposed.has(t))return;(e?t.tState:t.state)&&n.push(t)}for(let i=n.length-1;i>=0;i--){if(t=n[i],e){let o=t,a=n[i+1];for(;(o=o.owner)&&o!==a;)if(G.disposed.has(o))return}if((e?t.tState:t.state)===Qe)_n(t);else if((e?t.tState:t.state)===hr){const o=Be;Be=null,rt(()=>ri(t,n[0]),!1),Be=o}}}function rt(t,e){if(Be)return t();let n=!1;e||(Be=[]),Ne?n=!0:Ne=[],li++;try{const i=t();return Zu(n),i}catch(i){n||(Ne=null),Be=null,wr(i)}}function Zu(t){if(Be&&(pa(Be),Be=null),t)return;let e;if(G){if(!G.promises.size&&!G.queue.size){const i=G.sources,o=G.disposed;Ne.push.apply(Ne,G.effects),e=G.resolve;for(const a of Ne)"tState"in a&&(a.state=a.tState),delete a.tState;G=null,rt(()=>{for(const a of o)Bt(a);for(const a of i){if(a.value=a.tValue,a.owned)for(let l=0,c=a.owned.length;l<c;l++)Bt(a.owned[l]);a.tOwned&&(a.owned=a.tOwned),delete a.tValue,delete a.tOwned,a.tState=0}Po(!1)},!1)}else if(G.running){G.running=!1,G.effects.push.apply(G.effects,Ne),Ne=null,Po(!0);return}}const n=Ne;Ne=null,n.length&&rt(()=>aa(n),!1),e&&e()}function pa(t){for(let e=0;e<t.length;e++)ni(t[e])}function ec(t){let e,n=0;for(e=0;e<t.length;e++){const i=t[e];i.user?t[n++]=i:ni(i)}if(se.context){if(se.count){se.effects||(se.effects=[]),se.effects.push(...t.slice(0,n));return}Rt()}for(se.effects&&(se.done||!se.count)&&(t=[...se.effects,...t],n+=se.effects.length,delete se.effects),e=0;e<n;e++)ni(t[e])}function ri(t,e){const n=G&&G.running;n?t.tState=0:t.state=0;for(let i=0;i<t.sources.length;i+=1){const o=t.sources[i];if(o.sources){const a=n?o.tState:o.state;a===Qe?o!==e&&(!o.updatedAt||o.updatedAt<li)&&ni(o):a===hr&&ri(o,e)}}}function ya(t){const e=G&&G.running;for(let n=0;n<t.observers.length;n+=1){const i=t.observers[n];(e?!i.tState:!i.state)&&(e?i.tState=hr:i.state=hr,i.pure?Be.push(i):Ne.push(i),i.observers&&ya(i))}}function Bt(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),i=t.sourceSlots.pop(),o=n.observers;if(o&&o.length){const a=o.pop(),l=n.observerSlots.pop();i<o.length&&(a.sourceSlots[l]=i,o[i]=a,n.observerSlots[i]=l)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Bt(t.tOwned[e]);delete t.tOwned}if(G&&G.running&&t.pure)_a(t,!0);else if(t.owned){for(e=t.owned.length-1;e>=0;e--)Bt(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}G&&G.running?t.tState=0:t.state=0}function _a(t,e){if(e||(t.tState=0,G.disposed.add(t)),t.owned)for(let n=0;n<t.owned.length;n++)_a(t.owned[n])}function hs(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Ro(t,e,n){try{for(const i of e)i(t)}catch(i){wr(i,n&&n.owner||null)}}function wr(t,e=ue){const n=fr&&e&&e.context&&e.context[fr],i=hs(t);if(!n)throw i;Ne?Ne.push({fn(){Ro(i,n,e)},state:Qe}):Ro(i,n,e)}function ds(t){if(typeof t=="function"&&!t.length)return ds(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const i=ds(t[n]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return e}return t}function tc(t,e){return function(i){let o;return nt(()=>o=De(()=>(ue.context={...ue.context,[t]:i.value},Bn(()=>i.children))),void 0),o}}const nc=Symbol("fallback");function To(t){for(let e=0;e<t.length;e++)t[e]()}function rc(t,e,n={}){let i=[],o=[],a=[],l=0,c=e.length>1?[]:null;return Vt(()=>To(a)),()=>{let p=t()||[],y=p.length,m,g;return p[ls],De(()=>{let $,U,T,I,X,K,B,V,J;if(y===0)l!==0&&(To(a),a=[],i=[],o=[],l=0,c&&(c=[])),n.fallback&&(i=[nc],o[0]=Mn(re=>(a[0]=re,n.fallback())),l=1);else if(l===0){for(o=new Array(y),g=0;g<y;g++)i[g]=p[g],o[g]=Mn(R);l=y}else{for(T=new Array(y),I=new Array(y),c&&(X=new Array(y)),K=0,B=Math.min(l,y);K<B&&i[K]===p[K];K++);for(B=l-1,V=y-1;B>=K&&V>=K&&i[B]===p[V];B--,V--)T[V]=o[B],I[V]=a[B],c&&(X[V]=c[B]);for($=new Map,U=new Array(V+1),g=V;g>=K;g--)J=p[g],m=$.get(J),U[g]=m===void 0?-1:m,$.set(J,g);for(m=K;m<=B;m++)J=i[m],g=$.get(J),g!==void 0&&g!==-1?(T[g]=o[m],I[g]=a[m],c&&(X[g]=c[m]),g=U[g],$.set(J,g)):a[m]();for(g=K;g<y;g++)g in T?(o[g]=T[g],a[g]=I[g],c&&(c[g]=X[g],c[g](g))):o[g]=Mn(R);o=o.slice(0,l=y),i=p.slice(0)}return o});function R($){if(a[g]=$,c){const[U,T]=Ce(g);return c[g]=T,e(p[g],U)}return e(p[g])}}}function ee(t,e){return De(()=>t(e||{}))}function Qr(){return!0}const ps={get(t,e,n){return e===pt?n:t.get(e)},has(t,e){return e===pt?!0:t.has(e)},set:Qr,deleteProperty:Qr,getOwnPropertyDescriptor(t,e){return{configurable:!0,enumerable:!0,get(){return t.get(e)},set:Qr,deleteProperty:Qr}},ownKeys(t){return t.keys()}};function rs(t){return(t=typeof t=="function"?t():t)?t:{}}function ic(){for(let t=0,e=this.length;t<e;++t){const n=this[t]();if(n!==void 0)return n}}function Ct(...t){let e=!1;for(let l=0;l<t.length;l++){const c=t[l];e=e||!!c&&pt in c,t[l]=typeof c=="function"?(e=!0,te(c)):c}if(oa&&e)return new Proxy({get(l){for(let c=t.length-1;c>=0;c--){const p=rs(t[c])[l];if(p!==void 0)return p}},has(l){for(let c=t.length-1;c>=0;c--)if(l in rs(t[c]))return!0;return!1},keys(){const l=[];for(let c=0;c<t.length;c++)l.push(...Object.keys(rs(t[c])));return[...new Set(l)]}},ps);const n={},i=Object.create(null);for(let l=t.length-1;l>=0;l--){const c=t[l];if(!c)continue;const p=Object.getOwnPropertyNames(c);for(let y=p.length-1;y>=0;y--){const m=p[y];if(m==="__proto__"||m==="constructor")continue;const g=Object.getOwnPropertyDescriptor(c,m);if(!i[m])i[m]=g.get?{enumerable:!0,configurable:!0,get:ic.bind(n[m]=[g.get.bind(c)])}:g.value!==void 0?g:void 0;else{const R=n[m];R&&(g.get?R.push(g.get.bind(c)):g.value!==void 0&&R.push(()=>g.value))}}}const o={},a=Object.keys(i);for(let l=a.length-1;l>=0;l--){const c=a[l],p=i[c];p&&p.get?Object.defineProperty(o,c,p):o[c]=p?p.value:void 0}return o}function sc(t,...e){if(oa&&pt in t){const o=new Set(e.length>1?e.flat():e[0]),a=e.map(l=>new Proxy({get(c){return l.includes(c)?t[c]:void 0},has(c){return l.includes(c)&&c in t},keys(){return l.filter(c=>c in t)}},ps));return a.push(new Proxy({get(l){return o.has(l)?void 0:t[l]},has(l){return o.has(l)?!1:l in t},keys(){return Object.keys(t).filter(l=>!o.has(l))}},ps)),a}const n={},i=e.map(()=>({}));for(const o of Object.getOwnPropertyNames(t)){const a=Object.getOwnPropertyDescriptor(t,o),l=!a.get&&!a.set&&a.enumerable&&a.writable&&a.configurable;let c=!1,p=0;for(const y of e)y.includes(o)&&(c=!0,l?i[p][o]=a.value:Object.defineProperty(i[p],o,a)),++p;c||(l?n[o]=a.value:Object.defineProperty(n,o,a))}return[...i,n]}function zt(t){let e,n;const i=o=>{const a=se.context;if(a){const[c,p]=Ce();se.count||(se.count=0),se.count++,(n||(n=t())).then(y=>{!se.done&&Rt(a),se.count--,p(()=>y.default),Rt()}),e=c}else if(!e){const[c]=ca(()=>(n||(n=t())).then(p=>p.default));e=c}let l;return te(()=>(l=e())?De(()=>{if(!a||se.done)return l(o);const c=se.context;Rt(a);const p=l(o);return Rt(c),p}):"")};return i.preload=()=>n||((n=t()).then(o=>e=()=>o.default),n),i}let oc=0;function ac(){return se.context?se.getNextContextId():`cl-${oc++}`}const ma=t=>`Stale read from <${t}>.`;function ga(t){const e="fallback"in t&&{fallback:()=>t.fallback};return te(rc(()=>t.each,t.children,e||void 0))}function dt(t){const e=t.keyed,n=te(()=>t.when,void 0,void 0),i=e?n:te(n,void 0,{equals:(o,a)=>!o==!a});return te(()=>{const o=i();if(o){const a=t.children;return typeof a=="function"&&a.length>0?De(()=>a(e?o:()=>{if(!De(i))throw ma("Show");return n()})):a}return t.fallback},void 0,void 0)}function ud(t){const e=Bn(()=>t.children),n=te(()=>{const i=e(),o=Array.isArray(i)?i:[i];let a=()=>{};for(let l=0;l<o.length;l++){const c=l,p=o[l],y=a,m=te(()=>y()?void 0:p.when,void 0,void 0),g=p.keyed?m:te(m,void 0,{equals:(R,$)=>!R==!$});a=()=>y()||(g()?[c,m,p]:void 0)}return a});return te(()=>{const i=n()();if(!i)return t.fallback;const[o,a,l]=i,c=l.children;return typeof c=="function"&&c.length>0?De(()=>c(l.keyed?a():()=>{if(De(n)()?.[0]!==o)throw ma("Match");return a()})):c},void 0,void 0)}function cd(t){return t}let Nn;function uc(){Nn&&[...Nn].forEach(t=>t())}function cc(t){let e;se.context&&se.load&&(e=se.load(se.getContextId()));const[n,i]=Ce(e,void 0);return Nn||(Nn=new Set),Nn.add(i),Vt(()=>Nn.delete(i)),te(()=>{let o;if(o=n()){const a=t.fallback;return typeof a=="function"&&a.length?De(()=>a(o,()=>i())):a}return Yu(()=>t.children,i)},void 0,void 0)}const lc=Tt();function ld(t){let e=0,n,i,o,a,l;const[c,p]=Ce(!1),y=Ju(),m={increment:()=>{++e===1&&p(!0)},decrement:()=>{--e===0&&p(!1)},inFallback:c,effects:[],resolved:!1},g=Ds();if(se.context&&se.load){const U=se.getContextId();let T=se.load(U);if(T&&(typeof T!="object"||T.status!=="success"?o=T:se.gather(U)),o&&o!=="$$f"){const[I,X]=Ce(void 0,{equals:!1});a=I,o.then(()=>{if(se.done)return X();se.gather(U),Rt(i),X(),Rt()},K=>{l=K,X()})}}const R=bt(lc);R&&(n=R.register(m.inFallback));let $;return Vt(()=>$&&$()),ee(y.Provider,{value:m,get children(){return te(()=>{if(l)throw l;if(i=se.context,a)return a(),a=void 0;i&&o==="$$f"&&Rt();const U=te(()=>t.children);return te(T=>{const I=m.inFallback(),{showContent:X=!0,showFallback:K=!0}=n?n():{};if((!I||o&&o!=="$$f")&&X)return m.resolved=!0,$&&$(),$=i=o=void 0,Xu(m.effects),U();if(K)return $?T:Mn(B=>($=B,i&&(Rt({id:i.id+"F",count:0}),i=void 0),t.fallback),g)})})}})}const fc=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],hc=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...fc]),dc=new Set(["innerHTML","textContent","innerText","children"]),pc=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),yc=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function _c(t,e){const n=yc[t];return typeof n=="object"?n[e]?n.$:void 0:n}const mc=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),gc={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function wc(t,e,n){let i=n.length,o=e.length,a=i,l=0,c=0,p=e[o-1].nextSibling,y=null;for(;l<o||c<a;){if(e[l]===n[c]){l++,c++;continue}for(;e[o-1]===n[a-1];)o--,a--;if(o===l){const m=a<i?c?n[c-1].nextSibling:n[a-c]:p;for(;c<a;)t.insertBefore(n[c++],m)}else if(a===c)for(;l<o;)(!y||!y.has(e[l]))&&e[l].remove(),l++;else if(e[l]===n[a-1]&&n[c]===e[o-1]){const m=e[--o].nextSibling;t.insertBefore(n[c++],e[l++].nextSibling),t.insertBefore(n[--a],m),e[o]=n[a]}else{if(!y){y=new Map;let g=c;for(;g<a;)y.set(n[g],g++)}const m=y.get(e[l]);if(m!=null)if(c<m&&m<a){let g=l,R=1,$;for(;++g<o&&g<a&&!(($=y.get(e[g]))==null||$!==m+R);)R++;if(R>m-c){const U=e[l];for(;c<m;)t.insertBefore(n[c++],U)}else t.replaceChild(n[c++],e[l++])}else l++;else e[l++].remove()}}}const Do="_$DX_DELEGATE";function vc(t,e,n,i={}){let o;return Mn(a=>{o=a,e===document?t():we(e,t(),e.firstChild?null:void 0,n)},i.owner),()=>{o(),e.textContent=""}}function Xe(t,e,n,i){let o;const a=()=>{const c=document.createElement("template");return c.innerHTML=t,c.content.firstChild},l=()=>(o||(o=a())).cloneNode(!0);return l.cloneNode=l,l}function Ns(t,e=window.document){const n=e[Do]||(e[Do]=new Set);for(let i=0,o=t.length;i<o;i++){const a=t[i];n.has(a)||(n.add(a),e.addEventListener(a,Oc))}}function ys(t,e,n){Hn(t)||(n==null?t.removeAttribute(e):t.setAttribute(e,n))}function bc(t,e,n,i){Hn(t)||(i==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,i))}function kc(t,e,n){Hn(t)||(n?t.setAttribute(e,""):t.removeAttribute(e))}function wa(t,e){Hn(t)||(e==null?t.removeAttribute("class"):t.className=e)}function xc(t,e,n,i){if(i)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const o=n[0];t.addEventListener(e,n[0]=a=>o.call(t,n[1],a))}else t.addEventListener(e,n,typeof n!="function"&&n)}function va(t,e,n={}){const i=Object.keys(e||{}),o=Object.keys(n);let a,l;for(a=0,l=o.length;a<l;a++){const c=o[a];!c||c==="undefined"||e[c]||(No(t,c,!1),delete n[c])}for(a=0,l=i.length;a<l;a++){const c=i[a],p=!!e[c];!c||c==="undefined"||n[c]===p||!p||(No(t,c,!0),n[c]=p)}return n}function Ec(t,e,n){if(!e)return n?ys(t,"style"):e;const i=t.style;if(typeof e=="string")return i.cssText=e;typeof n=="string"&&(i.cssText=n=void 0),n||(n={}),e||(e={});let o,a;for(a in n)e[a]==null&&i.removeProperty(a),delete n[a];for(a in e)o=e[a],o!==n[a]&&(i.setProperty(a,o),n[a]=o);return n}function _s(t,e={},n,i){const o={};return i||nt(()=>o.children=dr(t,e.children,o.children)),nt(()=>typeof e.ref=="function"&&$s(e.ref,t)),nt(()=>Ac(t,e,n,!0,o,!0)),o}function $s(t,e,n){return De(()=>t(e,n))}function we(t,e,n,i){if(n!==void 0&&!i&&(i=[]),typeof e!="function")return dr(t,e,i,n);nt(o=>dr(t,e(),o,n),i)}function Ac(t,e,n,i,o={},a=!1){e||(e={});for(const l in o)if(!(l in e)){if(l==="children")continue;o[l]=$o(t,l,null,o[l],n,a,e)}for(const l in e){if(l==="children")continue;const c=e[l];o[l]=$o(t,l,c,o[l],n,a,e)}}function Hn(t){return!!se.context&&!se.done&&(!t||t.isConnected)}function Sc(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function No(t,e,n){const i=e.trim().split(/\s+/);for(let o=0,a=i.length;o<a;o++)t.classList.toggle(i[o],n)}function $o(t,e,n,i,o,a,l){let c,p,y,m,g;if(e==="style")return Ec(t,n,i);if(e==="classList")return va(t,n,i);if(n===i)return i;if(e==="ref")a||n(t);else if(e.slice(0,3)==="on:"){const R=e.slice(3);i&&t.removeEventListener(R,i,typeof i!="function"&&i),n&&t.addEventListener(R,n,typeof n!="function"&&n)}else if(e.slice(0,10)==="oncapture:"){const R=e.slice(10);i&&t.removeEventListener(R,i,!0),n&&t.addEventListener(R,n,!0)}else if(e.slice(0,2)==="on"){const R=e.slice(2).toLowerCase(),$=mc.has(R);if(!$&&i){const U=Array.isArray(i)?i[0]:i;t.removeEventListener(R,U)}($||n)&&(xc(t,R,n,$),$&&Ns([R]))}else if(e.slice(0,5)==="attr:")ys(t,e.slice(5),n);else if(e.slice(0,5)==="bool:")kc(t,e.slice(5),n);else if((g=e.slice(0,5)==="prop:")||(y=dc.has(e))||!o&&((m=_c(e,t.tagName))||(p=hc.has(e)))||(c=t.nodeName.includes("-")||"is"in l)){if(g)e=e.slice(5),p=!0;else if(Hn(t))return n;e==="class"||e==="className"?wa(t,n):c&&!p&&!y?t[Sc(e)]=n:t[m||e]=n}else{const R=o&&e.indexOf(":")>-1&&gc[e.split(":")[0]];R?bc(t,R,e,n):ys(t,pc[e]||e,n)}return n}function Oc(t){if(se.registry&&se.events&&se.events.find(([p,y])=>y===t))return;let e=t.target;const n=`$$${t.type}`,i=t.target,o=t.currentTarget,a=p=>Object.defineProperty(t,"target",{configurable:!0,value:p}),l=()=>{const p=e[n];if(p&&!e.disabled){const y=e[`${n}Data`];if(y!==void 0?p.call(e,y,t):p.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&a(e.host),!0},c=()=>{for(;l()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),se.registry&&!se.done&&(se.done=_$HY.done=!0),t.composedPath){const p=t.composedPath();a(p[0]);for(let y=0;y<p.length-2&&(e=p[y],!!l());y++){if(e._$host){e=e._$host,c();break}if(e.parentNode===o)break}}else c();a(i)}function dr(t,e,n,i,o){const a=Hn(t);if(a){!n&&(n=[...t.childNodes]);let p=[];for(let y=0;y<n.length;y++){const m=n[y];m.nodeType===8&&m.data.slice(0,2)==="!$"?m.remove():p.push(m)}n=p}for(;typeof n=="function";)n=n();if(e===n)return n;const l=typeof e,c=i!==void 0;if(t=c&&n[0]&&n[0].parentNode||t,l==="string"||l==="number"){if(a||l==="number"&&(e=e.toString(),e===n))return n;if(c){let p=n[0];p&&p.nodeType===3?p.data!==e&&(p.data=e):p=document.createTextNode(e),n=Sn(t,n,i,p)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||l==="boolean"){if(a)return n;n=Sn(t,n,i)}else{if(l==="function")return nt(()=>{let p=e();for(;typeof p=="function";)p=p();n=dr(t,p,n,i)}),()=>n;if(Array.isArray(e)){const p=[],y=n&&Array.isArray(n);if(ms(p,e,n,o))return nt(()=>n=dr(t,p,n,i,!0)),()=>n;if(a){if(!p.length)return n;if(i===void 0)return n=[...t.childNodes];let m=p[0];if(m.parentNode!==t)return n;const g=[m];for(;(m=m.nextSibling)!==i;)g.push(m);return n=g}if(p.length===0){if(n=Sn(t,n,i),c)return n}else y?n.length===0?Mo(t,p,i):wc(t,n,p):(n&&Sn(t),Mo(t,p));n=p}else if(e.nodeType){if(a&&e.parentNode)return n=c?[e]:e;if(Array.isArray(n)){if(c)return n=Sn(t,n,i,e);Sn(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function ms(t,e,n,i){let o=!1;for(let a=0,l=e.length;a<l;a++){let c=e[a],p=n&&n[t.length],y;if(!(c==null||c===!0||c===!1))if((y=typeof c)=="object"&&c.nodeType)t.push(c);else if(Array.isArray(c))o=ms(t,c,p)||o;else if(y==="function")if(i){for(;typeof c=="function";)c=c();o=ms(t,Array.isArray(c)?c:[c],Array.isArray(p)?p:[p])||o}else t.push(c),o=!0;else{const m=String(c);p&&p.nodeType===3&&p.data===m?t.push(p):t.push(document.createTextNode(m))}}return o}function Mo(t,e,n=null){for(let i=0,o=e.length;i<o;i++)t.insertBefore(e[i],n)}function Sn(t,e,n,i){if(n===void 0)return t.textContent="";const o=i||document.createTextNode("");if(e.length){let a=!1;for(let l=e.length-1;l>=0;l--){const c=e[l];if(o!==c){const p=c.parentNode===t;!a&&!l?p?t.replaceChild(o,c):t.insertBefore(o,n):p&&c.remove()}else a=!0}}else t.insertBefore(o,n);return[o]}const Pc=!1,Cc="modulepreload",Rc=function(t){return"/"+t},jo={},Ht=function(e,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");o=Promise.allSettled(n.map(p=>{if(p=Rc(p),p in jo)return;jo[p]=!0;const y=p.endsWith(".css"),m=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${m}`))return;const g=document.createElement("link");if(g.rel=y?"stylesheet":Cc,y||(g.as="script"),g.crossOrigin="",g.href=p,c&&g.setAttribute("nonce",c),document.head.appendChild(g),y)return new Promise((R,$)=>{g.addEventListener("load",R),g.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return o.then(l=>{for(const c of l||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})};function ba(){let t=new Set;function e(o){return t.add(o),()=>t.delete(o)}let n=!1;function i(o,a){if(n)return!(n=!1);const l={to:o,options:a,defaultPrevented:!1,preventDefault:()=>l.defaultPrevented=!0};for(const c of t)c.listener({...l,from:c.location,retry:p=>{p&&(n=!0),c.navigate(o,{...a,resolve:!1})}});return!l.defaultPrevented}return{subscribe:e,confirm:i}}let gs;function Ms(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),gs=window.history.state._depth}Ms();function Tc(t){return{...t,_depth:window.history.state&&window.history.state._depth}}function Dc(t,e){let n=!1;return()=>{const i=gs;Ms();const o=i==null?null:gs-i;if(n){n=!1;return}o&&e(o)?(n=!0,window.history.go(-o)):t()}}const Nc=/^(?:[a-z0-9]+:)?\/\//i,$c=/^\/+|(\/)\/+$/g,ka="http://sr";function ln(t,e=!1){const n=t.replace($c,"$1");return n?e||/^[?#]/.test(n)?n:"/"+n:""}function Jr(t,e,n){if(Nc.test(e))return;const i=ln(t),o=n&&ln(n);let a="";return!o||e.startsWith("/")?a=i:o.toLowerCase().indexOf(i.toLowerCase())!==0?a=i+o:a=o,(a||"/")+ln(e,!a)}function Mc(t,e){if(t==null)throw new Error(e);return t}function jc(t,e){return ln(t).replace(/\/*(\*.*)?$/g,"")+ln(e)}function xa(t){const e={};return t.searchParams.forEach((n,i)=>{i in e?Array.isArray(e[i])?e[i].push(n):e[i]=[e[i],n]:e[i]=n}),e}function Kc(t,e,n){const[i,o]=t.split("/*",2),a=i.split("/").filter(Boolean),l=a.length;return c=>{const p=c.split("/").filter(Boolean),y=p.length-l;if(y<0||y>0&&o===void 0&&!e)return null;const m={path:l?"":"/",params:{}},g=R=>n===void 0?void 0:n[R];for(let R=0;R<l;R++){const $=a[R],U=$[0]===":",T=U?p[R]:p[R].toLowerCase(),I=U?$.slice(1):$.toLowerCase();if(U&&is(T,g(I)))m.params[I]=T;else if(U||!is(T,I))return null;m.path+=`/${T}`}if(o){const R=y?p.slice(-y).join("/"):"";if(is(R,g(o)))m.params[o]=R;else return null}return m}}function is(t,e){const n=i=>i===t;return e===void 0?!0:typeof e=="string"?n(e):typeof e=="function"?e(t):Array.isArray(e)?e.some(n):e instanceof RegExp?e.test(t):!1}function Ic(t){const[e,n]=t.pattern.split("/*",2),i=e.split("/").filter(Boolean);return i.reduce((o,a)=>o+(a.startsWith(":")?2:3),i.length-(n===void 0?0:1))}function Ea(t){const e=new Map,n=Ds();return new Proxy({},{get(i,o){return e.has(o)||la(n,()=>e.set(o,te(()=>t()[o]))),e.get(o)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(t())}})}function Lc(t,e){const n=new URLSearchParams(t);Object.entries(e).forEach(([o,a])=>{a==null||a===""||a instanceof Array&&!a.length?n.delete(o):a instanceof Array?(n.delete(o),a.forEach(l=>{n.append(o,String(l))})):n.set(o,String(a))});const i=n.toString();return i?`?${i}`:""}function Aa(t){let e=/(\/?\:[^\/]+)\?/.exec(t);if(!e)return[t];let n=t.slice(0,e.index),i=t.slice(e.index+e[0].length);const o=[n,n+=e[1]];for(;e=/^(\/\:[^\/]+)\?/.exec(i);)o.push(n+=e[1]),i=i.slice(e[0].length);return Aa(i).reduce((a,l)=>[...a,...o.map(c=>c+l)],[])}const Fc=100,Sa=Tt(),js=Tt(),Gn=()=>Mc(bt(Sa),"<A> and 'use' router primitives can be only used inside a Route."),Bc=()=>bt(js)||Gn().base,qc=t=>{const e=Bc();return te(()=>e.resolvePath(t()))},Uc=t=>{const e=Gn();return te(()=>{const n=t();return n!==void 0?e.renderPath(n):n})},Oa=()=>Gn().navigatorFactory(),hi=()=>Gn().location,fd=()=>Gn().params,hd=()=>{const t=hi(),e=Oa(),n=(i,o)=>{const a=De(()=>Lc(t.search,i)+t.hash);e(a,{scroll:!1,resolve:!1,...o})};return[t.query,n]},Vc=t=>{const e=Gn().beforeLeave.subscribe({listener:t,location:hi(),navigate:Oa()});Vt(e)};function zc(t,e=""){const{component:n,preload:i,load:o,children:a,info:l}=t,c=!a||Array.isArray(a)&&!a.length,p={key:t,component:n,preload:i||o,info:l};return Pa(t.path).reduce((y,m)=>{for(const g of Aa(m)){const R=jc(e,g);let $=c?R:R.split("/*",1)[0];$=$.split("/").map(U=>U.startsWith(":")||U.startsWith("*")?U:encodeURIComponent(U)).join("/"),y.push({...p,originalPath:m,pattern:$,matcher:Kc($,!c,t.matchFilters)})}return y},[])}function Hc(t,e=0){return{routes:t,score:Ic(t[t.length-1])*1e4-e,matcher(n){const i=[];for(let o=t.length-1;o>=0;o--){const a=t[o],l=a.matcher(n);if(!l)return null;i.unshift({...l,route:a})}return i}}}function Pa(t){return Array.isArray(t)?t:[t]}function Ca(t,e="",n=[],i=[]){const o=Pa(t);for(let a=0,l=o.length;a<l;a++){const c=o[a];if(c&&typeof c=="object"){c.hasOwnProperty("path")||(c.path="");const p=zc(c,e);for(const y of p){n.push(y);const m=Array.isArray(c.children)&&c.children.length===0;if(c.children&&!m)Ca(c.children,y.pattern,n,i);else{const g=Hc([...n],i.length);i.push(g)}n.pop()}}}return n.length?i:i.sort((a,l)=>l.score-a.score)}function ss(t,e){for(let n=0,i=t.length;n<i;n++){const o=t[n].matcher(e);if(o)return o}return[]}function Gc(t,e,n){const i=new URL(ka),o=te(m=>{const g=t();try{return new URL(g,i)}catch{return console.error(`Invalid path ${g}`),m}},i,{equals:(m,g)=>m.href===g.href}),a=te(()=>o().pathname),l=te(()=>o().search,!0),c=te(()=>o().hash),p=()=>"",y=gr(l,()=>xa(o()));return{get pathname(){return a()},get search(){return l()},get hash(){return c()},get state(){return e()},get key(){return p()},query:n?n(y):Ea(y)}}let on;function Wc(){return on}function Yc(t,e,n,i={}){const{signal:[o,a],utils:l={}}=t,c=l.parsePath||(be=>be),p=l.renderPath||(be=>be),y=l.beforeLeave||ba(),m=Jr("",i.base||"");if(m===void 0)throw new Error(`${m} is not a valid base path`);m&&!o().value&&a({value:m,replace:!0,scroll:!1});const[g,R]=Ce(!1);let $;const U=(be,ke)=>{ke.value===T()&&ke.state===X()||($===void 0&&R(!0),on=be,$=ke,fa(()=>{$===ke&&(I($.value),K($.state),uc(),J[1](Le=>Le.filter(Dt=>Dt.pending)))}).finally(()=>{$===ke&&ht(()=>{on=void 0,be==="navigate"&&Ee($),R(!1),$=void 0})}))},[T,I]=Ce(o().value),[X,K]=Ce(o().state),B=Gc(T,X,l.queryWrapper),V=[],J=Ce([]),re=te(()=>typeof i.transformUrl=="function"?ss(e(),i.transformUrl(B.pathname)):ss(e(),B.pathname)),fe=()=>{const be=re(),ke={};for(let Le=0;Le<be.length;Le++)Object.assign(ke,be[Le].params);return ke},Me=l.paramsWrapper?l.paramsWrapper(fe,e):Ea(fe),Ge={pattern:m,path:()=>m,outlet:()=>null,resolvePath(be){return Jr(m,be)}};return nt(gr(o,be=>U("native",be),{defer:!0})),{base:Ge,location:B,params:Me,isRouting:g,renderPath:p,parsePath:c,navigatorFactory:Se,matches:re,beforeLeave:y,preloadRoute:qe,singleFlight:i.singleFlight===void 0?!0:i.singleFlight,submissions:J};function ve(be,ke,Le){De(()=>{if(typeof ke=="number"){ke&&(l.go?l.go(ke):console.warn("Router integration does not support relative routing"));return}const Dt=!ke||ke[0]==="?",{replace:ut,resolve:Je,scroll:Ze,state:xt}={replace:!1,resolve:!Dt,scroll:!0,...Le},mn=Je?be.resolvePath(ke):Jr(Dt&&B.pathname||"",ke);if(mn===void 0)throw new Error(`Path '${ke}' is not a routable path`);if(V.length>=Fc)throw new Error("Too many redirects");const Et=T();(mn!==Et||xt!==X())&&(Pc||y.confirm(mn,Le)&&(V.push({value:Et,replace:ut,scroll:Ze,state:X()}),U("navigate",{value:mn,state:xt})))})}function Se(be){return be=be||bt(js)||Ge,(ke,Le)=>ve(be,ke,Le)}function Ee(be){const ke=V[0];ke&&(a({...be,replace:ke.replace,scroll:ke.scroll}),V.length=0)}function qe(be,ke){const Le=ss(e(),be.pathname),Dt=on;on="preload";for(let ut in Le){const{route:Je,params:Ze}=Le[ut];Je.component&&Je.component.preload&&Je.component.preload();const{preload:xt}=Je;ke&&xt&&la(n(),()=>xt({params:Ze,location:{pathname:be.pathname,search:be.search,hash:be.hash,query:xa(be),state:null,key:""},intent:"preload"}))}on=Dt}}function Qc(t,e,n,i){const{base:o,location:a,params:l}=t,{pattern:c,component:p,preload:y}=i().route,m=te(()=>i().path);p&&p.preload&&p.preload();const g=y?y({params:l,location:a,intent:on||"initial"}):void 0;return{parent:e,pattern:c,path:m,outlet:()=>p?ee(p,{params:l,location:a,data:g,get children(){return n()}}):n(),resolvePath($){return Jr(o.path(),$,m())}}}const Xc=t=>e=>{const{base:n}=e,i=Bn(()=>e.children),o=te(()=>Ca(i(),e.base||""));let a;const l=Yc(t,o,()=>a,{base:n,singleFlight:e.singleFlight,transformUrl:e.transformUrl});return t.create&&t.create(l),ee(Sa.Provider,{value:l,get children(){return ee(Jc,{routerState:l,get root(){return e.root},get preload(){return e.rootPreload||e.rootLoad},get children(){return[te(()=>(a=Ds())&&null),ee(Zc,{routerState:l,get branches(){return o()}})]}})}})};function Jc(t){const e=t.routerState.location,n=t.routerState.params,i=te(()=>t.preload&&De(()=>{t.preload({params:n,location:e,intent:Wc()||"initial"})}));return ee(dt,{get when(){return t.root},keyed:!0,get fallback(){return t.children},children:o=>ee(o,{params:n,location:e,get data(){return i()},get children(){return t.children}})})}function Zc(t){const e=[];let n;const i=te(gr(t.routerState.matches,(o,a,l)=>{let c=a&&o.length===a.length;const p=[];for(let y=0,m=o.length;y<m;y++){const g=a&&a[y],R=o[y];l&&g&&R.route.key===g.route.key?p[y]=l[y]:(c=!1,e[y]&&e[y](),Mn($=>{e[y]=$,p[y]=Qc(t.routerState,p[y-1]||t.routerState.base,Ko(()=>i()[y+1]),()=>t.routerState.matches()[y])}))}return e.splice(o.length).forEach(y=>y()),l&&c?l:(n=p[0],p)}));return Ko(()=>i()&&n)()}const Ko=t=>()=>ee(dt,{get when(){return t()},keyed:!0,children:e=>ee(js.Provider,{value:e,get children(){return e.outlet()}})}),We=t=>{const e=Bn(()=>t.children);return Ct(t,{get children(){return e()}})};function el([t,e],n,i){return[t,i?o=>e(i(o)):e]}function tl(t){let e=!1;const n=o=>typeof o=="string"?{value:o}:o,i=el(Ce(n(t.get()),{equals:(o,a)=>o.value===a.value&&o.state===a.state}),void 0,o=>(!e&&t.set(o),se.registry&&!se.done&&(se.done=!0),o));return t.init&&Vt(t.init((o=t.get())=>{e=!0,i[1](n(o)),e=!1})),Xc({signal:i,create:t.create,utils:t.utils})}function nl(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function rl(t,e){const n=t&&document.getElementById(t);n?n.scrollIntoView():e&&window.scrollTo(0,0)}const il=new Map;function sl(t=!0,e=!1,n="/_server",i){return o=>{const a=o.base.path(),l=o.navigatorFactory(o.base);let c,p;function y(T){return T.namespaceURI==="http://www.w3.org/2000/svg"}function m(T){if(T.defaultPrevented||T.button!==0||T.metaKey||T.altKey||T.ctrlKey||T.shiftKey)return;const I=T.composedPath().find(re=>re instanceof Node&&re.nodeName.toUpperCase()==="A");if(!I||e&&!I.hasAttribute("link"))return;const X=y(I),K=X?I.href.baseVal:I.href;if((X?I.target.baseVal:I.target)||!K&&!I.hasAttribute("state"))return;const V=(I.getAttribute("rel")||"").split(/\s+/);if(I.hasAttribute("download")||V&&V.includes("external"))return;const J=X?new URL(K,document.baseURI):new URL(K);if(!(J.origin!==window.location.origin||a&&J.pathname&&!J.pathname.toLowerCase().startsWith(a.toLowerCase())))return[I,J]}function g(T){const I=m(T);if(!I)return;const[X,K]=I,B=o.parsePath(K.pathname+K.search+K.hash),V=X.getAttribute("state");T.preventDefault(),l(B,{resolve:!1,replace:X.hasAttribute("replace"),scroll:!X.hasAttribute("noscroll"),state:V?JSON.parse(V):void 0})}function R(T){const I=m(T);if(!I)return;const[X,K]=I;i&&(K.pathname=i(K.pathname)),o.preloadRoute(K,X.getAttribute("preload")!=="false")}function $(T){clearTimeout(c);const I=m(T);if(!I)return p=null;const[X,K]=I;p!==X&&(i&&(K.pathname=i(K.pathname)),c=setTimeout(()=>{o.preloadRoute(K,X.getAttribute("preload")!=="false"),p=X},20))}function U(T){if(T.defaultPrevented)return;let I=T.submitter&&T.submitter.hasAttribute("formaction")?T.submitter.getAttribute("formaction"):T.target.getAttribute("action");if(!I)return;if(!I.startsWith("https://action/")){const K=new URL(I,ka);if(I=o.parsePath(K.pathname+K.search),!I.startsWith(n))return}if(T.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const X=il.get(I);if(X){T.preventDefault();const K=new FormData(T.target,T.submitter);X.call({r:o,f:T.target},T.target.enctype==="multipart/form-data"?K:new URLSearchParams(K))}}Ns(["click","submit"]),document.addEventListener("click",g),t&&(document.addEventListener("mousemove",$,{passive:!0}),document.addEventListener("focusin",R,{passive:!0}),document.addEventListener("touchstart",R,{passive:!0})),document.addEventListener("submit",U),Vt(()=>{document.removeEventListener("click",g),t&&(document.removeEventListener("mousemove",$),document.removeEventListener("focusin",R),document.removeEventListener("touchstart",R)),document.removeEventListener("submit",U)})}}function ol(t){const e=()=>{const i=window.location.pathname.replace(/^\/+/,"/")+window.location.search,o=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:i+window.location.hash,state:o}},n=ba();return tl({get:e,set({value:i,replace:o,scroll:a,state:l}){o?window.history.replaceState(Tc(l),"",i):window.history.pushState(l,"",i),rl(decodeURIComponent(window.location.hash.slice(1)),a),Ms()},init:i=>nl(window,"popstate",Dc(i,o=>{if(o&&o<0)return!n.confirm(o);{const a=e();return!n.confirm(a.value,{state:a.state})}})),create:sl(t.preload,t.explicitLinks,t.actionBase,t.transformUrl),utils:{go:i=>window.history.go(i),beforeLeave:n}})(t)}var al=Xe("<a>");function Ot(t){t=Ct({inactiveClass:"inactive",activeClass:"active"},t);const[,e]=sc(t,["href","state","class","activeClass","inactiveClass","end"]),n=qc(()=>t.href),i=Uc(n),o=hi(),a=te(()=>{const l=n();if(l===void 0)return[!1,!1];const c=ln(l.split(/[?#]/,1)[0]).toLowerCase(),p=decodeURI(ln(o.pathname).toLowerCase());return[t.end?c===p:p.startsWith(c+"/")||p===c,c===p]});return(()=>{var l=al();return _s(l,Ct(e,{get href(){return i()||t.href},get state(){return JSON.stringify(t.state)},get classList(){return{...t.class&&{[t.class]:!0},[t.inactiveClass]:!a()[0],[t.activeClass]:a()[0],...e.classList}},link:"",get"aria-current"(){return a()[1]?"page":void 0}}),!1,!1),l})()}const ws=Symbol("store-raw"),jn=Symbol("store-node"),Pt=Symbol("store-has"),Ra=Symbol("store-self");function Ta(t){let e=t[pt];if(!e&&(Object.defineProperty(t,pt,{value:e=new Proxy(t,ll)}),!Array.isArray(t))){const n=Object.keys(t),i=Object.getOwnPropertyDescriptors(t);for(let o=0,a=n.length;o<a;o++){const l=n[o];i[l].get&&Object.defineProperty(t,l,{enumerable:i[l].enumerable,get:i[l].get.bind(e)})}}return e}function qt(t){let e;return t!=null&&typeof t=="object"&&(t[pt]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function qn(t,e=new Set){let n,i,o,a;if(n=t!=null&&t[ws])return n;if(!qt(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let l=0,c=t.length;l<c;l++)o=t[l],(i=qn(o,e))!==o&&(t[l]=i)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const l=Object.keys(t),c=Object.getOwnPropertyDescriptors(t);for(let p=0,y=l.length;p<y;p++)a=l[p],!c[a].get&&(o=t[a],(i=qn(o,e))!==o&&(t[a]=i))}return t}function ii(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function pr(t,e,n){if(t[e])return t[e];const[i,o]=Ce(n,{equals:!1,internal:!0});return i.$=o,t[e]=i}function ul(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===pt||e===jn||(delete n.value,delete n.writable,n.get=()=>t[pt][e]),n}function Da(t){fs()&&pr(ii(t,jn),Ra)()}function cl(t){return Da(t),Reflect.ownKeys(t)}const ll={get(t,e,n){if(e===ws)return t;if(e===pt)return n;if(e===ls)return Da(t),n;const i=ii(t,jn),o=i[e];let a=o?o():t[e];if(e===jn||e===Pt||e==="__proto__")return a;if(!o){const l=Object.getOwnPropertyDescriptor(t,e);fs()&&(typeof a!="function"||t.hasOwnProperty(e))&&!(l&&l.get)&&(a=pr(i,e,a)())}return qt(a)?Ta(a):a},has(t,e){return e===ws||e===pt||e===ls||e===jn||e===Pt||e==="__proto__"?!0:(fs()&&pr(ii(t,Pt),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:cl,getOwnPropertyDescriptor:ul};function ot(t,e,n,i=!1){if(!i&&t[e]===n)return;const o=t[e],a=t.length;n===void 0?(delete t[e],t[Pt]&&t[Pt][e]&&o!==void 0&&t[Pt][e].$()):(t[e]=n,t[Pt]&&t[Pt][e]&&o===void 0&&t[Pt][e].$());let l=ii(t,jn),c;if((c=pr(l,e,o))&&c.$(()=>n),Array.isArray(t)&&t.length!==a){for(let p=t.length;p<a;p++)(c=l[p])&&c.$();(c=pr(l,"length",a))&&c.$(t.length)}(c=l[Ra])&&c.$()}function Na(t,e){const n=Object.keys(e);for(let i=0;i<n.length;i+=1){const o=n[i];ot(t,o,e[o])}}function fl(t,e){if(typeof e=="function"&&(e=e(t)),e=qn(e),Array.isArray(e)){if(t===e)return;let n=0,i=e.length;for(;n<i;n++){const o=e[n];t[n]!==o&&ot(t,n,o)}ot(t,"length",i)}else Na(t,e)}function lr(t,e,n=[]){let i,o=t;if(e.length>1){i=e.shift();const l=typeof i,c=Array.isArray(t);if(Array.isArray(i)){for(let p=0;p<i.length;p++)lr(t,[i[p]].concat(e),n);return}else if(c&&l==="function"){for(let p=0;p<t.length;p++)i(t[p],p)&&lr(t,[p].concat(e),n);return}else if(c&&l==="object"){const{from:p=0,to:y=t.length-1,by:m=1}=i;for(let g=p;g<=y;g+=m)lr(t,[g].concat(e),n);return}else if(e.length>1){lr(t[i],e,[i].concat(n));return}o=t[i],n=[i].concat(n)}let a=e[0];typeof a=="function"&&(a=a(o,n),a===o)||i===void 0&&a==null||(a=qn(a),i===void 0||qt(o)&&qt(a)&&!Array.isArray(a)?Na(o,a):ot(t,i,a))}function $a(...[t,e]){const n=qn(t||{}),i=Array.isArray(n),o=Ta(n);function a(...l){ht(()=>{i&&l.length===1?fl(n,l[0]):lr(n,l)})}return[o,a]}const vs=Symbol("store-root");function Tn(t,e,n,i,o){const a=e[n];if(t===a)return;const l=Array.isArray(t);if(n!==vs&&(!qt(t)||!qt(a)||l!==Array.isArray(a)||o&&t[o]!==a[o])){ot(e,n,t);return}if(l){if(t.length&&a.length&&(!i||o&&t[0]&&t[0][o]!=null)){let y,m,g,R,$,U,T,I;for(g=0,R=Math.min(a.length,t.length);g<R&&(a[g]===t[g]||o&&a[g]&&t[g]&&a[g][o]===t[g][o]);g++)Tn(t[g],a,g,i,o);const X=new Array(t.length),K=new Map;for(R=a.length-1,$=t.length-1;R>=g&&$>=g&&(a[R]===t[$]||o&&a[R]&&t[$]&&a[R][o]===t[$][o]);R--,$--)X[$]=a[R];if(g>$||g>R){for(m=g;m<=$;m++)ot(a,m,t[m]);for(;m<t.length;m++)ot(a,m,X[m]),Tn(t[m],a,m,i,o);a.length>t.length&&ot(a,"length",t.length);return}for(T=new Array($+1),m=$;m>=g;m--)U=t[m],I=o&&U?U[o]:U,y=K.get(I),T[m]=y===void 0?-1:y,K.set(I,m);for(y=g;y<=R;y++)U=a[y],I=o&&U?U[o]:U,m=K.get(I),m!==void 0&&m!==-1&&(X[m]=a[y],m=T[m],K.set(I,m));for(m=g;m<t.length;m++)m in X?(ot(a,m,X[m]),Tn(t[m],a,m,i,o)):ot(a,m,t[m])}else for(let y=0,m=t.length;y<m;y++)Tn(t[y],a,y,i,o);a.length>t.length&&ot(a,"length",t.length);return}const c=Object.keys(t);for(let y=0,m=c.length;y<m;y++)Tn(t[c[y]],a,c[y],i,o);const p=Object.keys(a);for(let y=0,m=p.length;y<m;y++)t[p[y]]===void 0&&ot(a,p[y],void 0)}function hl(t,e={}){const{merge:n,key:i="id"}=e,o=qn(t);return a=>{if(!qt(a)||!qt(o))return o;const l=Tn(o,{[vs]:a},vs,n,i);return l===void 0?a:l}}function di(t,e){let n,i=()=>!n||n.state==="unresolved"?void 0:n.latest;[n]=ca(()=>dl(t,De(i)),a=>a,e);const o=()=>n();return Object.defineProperty(o,"latest",{get(){return n.latest}}),o}class st{static all(){return new st}static allSettled(){return new st}static any(){return new st}static race(){return new st}static reject(){return new st}static resolve(){return new st}catch(){return new st}then(){return new st}finally(){return new st}}function dl(t,e){if(!se.context)return t(e);const n=fetch,i=Promise;try{return window.fetch=()=>new st,Promise=st,t(e)}finally{window.fetch=n,Promise=i}}const pl=Tt(),yl=["title","meta"],Io=[],Lo=["name","http-equiv","content","charset","media"].concat(["property"]),Fo=(t,e)=>{const n=Object.fromEntries(Object.entries(t.props).filter(([i])=>e.includes(i)).sort());return(Object.hasOwn(n,"name")||Object.hasOwn(n,"property"))&&(n.name=n.name||n.property,delete n.property),t.tag+JSON.stringify(n)};function _l(){if(!se.context){const n=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(n,i=>i.parentNode.removeChild(i))}const t=new Map;function e(n){if(n.ref)return n.ref;let i=document.querySelector(`[data-sm="${n.id}"]`);return i?(i.tagName.toLowerCase()!==n.tag&&(i.parentNode&&i.parentNode.removeChild(i),i=document.createElement(n.tag)),i.removeAttribute("data-sm")):i=document.createElement(n.tag),i}return{addTag(n){if(yl.indexOf(n.tag)!==-1){const a=n.tag==="title"?Io:Lo,l=Fo(n,a);t.has(l)||t.set(l,[]);let c=t.get(l),p=c.length;c=[...c,n],t.set(l,c);let y=e(n);n.ref=y,_s(y,n.props);let m=null;for(var i=p-1;i>=0;i--)if(c[i]!=null){m=c[i];break}return y.parentNode!=document.head&&document.head.appendChild(y),m&&m.ref&&m.ref.parentNode&&document.head.removeChild(m.ref),p}let o=e(n);return n.ref=o,_s(o,n.props),o.parentNode!=document.head&&document.head.appendChild(o),-1},removeTag(n,i){const o=n.tag==="title"?Io:Lo,a=Fo(n,o);if(n.ref){const l=t.get(a);if(l){if(n.ref.parentNode){n.ref.parentNode.removeChild(n.ref);for(let c=i-1;c>=0;c--)l[c]!=null&&document.head.appendChild(l[c].ref)}l[i]=null,t.set(a,l)}else n.ref.parentNode&&n.ref.parentNode.removeChild(n.ref)}}}}const ml=t=>{const e=_l();return ee(pl.Provider,{value:e,get children(){return t.children}})};var gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zr={exports:{}},vl=Zr.exports,Bo;function bl(){return Bo||(Bo=1,function(t,e){(function(n,i){t.exports=i()})(vl,function(){var n=function(r,s){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])})(r,s)},i=function(){return(i=Object.assign||function(r){for(var s,u=1,f=arguments.length;u<f;u++)for(var h in s=arguments[u])Object.prototype.hasOwnProperty.call(s,h)&&(r[h]=s[h]);return r}).apply(this,arguments)};function o(r,s,u){for(var f,h=0,d=s.length;h<d;h++)!f&&h in s||((f=f||Array.prototype.slice.call(s,0,h))[h]=s[h]);return r.concat(f||Array.prototype.slice.call(s))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:gl,l=Object.keys,c=Array.isArray;function p(r,s){return typeof s!="object"||l(s).forEach(function(u){r[u]=s[u]}),r}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var y=Object.getPrototypeOf,m={}.hasOwnProperty;function g(r,s){return m.call(r,s)}function R(r,s){typeof s=="function"&&(s=s(y(r))),(typeof Reflect>"u"?l:Reflect.ownKeys)(s).forEach(function(u){U(r,u,s[u])})}var $=Object.defineProperty;function U(r,s,u,f){$(r,s,p(u&&g(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},f))}function T(r){return{from:function(s){return r.prototype=Object.create(s.prototype),U(r.prototype,"constructor",r),{extend:R.bind(null,r.prototype)}}}}var I=Object.getOwnPropertyDescriptor,X=[].slice;function K(r,s,u){return X.call(r,s,u)}function B(r,s){return s(r)}function V(r){if(!r)throw new Error("Assertion Failed")}function J(r){a.setImmediate?setImmediate(r):setTimeout(r,0)}function re(r,s){if(typeof s=="string"&&g(r,s))return r[s];if(!s)return r;if(typeof s!="string"){for(var u=[],f=0,h=s.length;f<h;++f){var d=re(r,s[f]);u.push(d)}return u}var _=s.indexOf(".");if(_!==-1){var w=r[s.substr(0,_)];return w==null?void 0:re(w,s.substr(_+1))}}function fe(r,s,u){if(r&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof s!="string"&&"length"in s){V(typeof u!="string"&&"length"in u);for(var f=0,h=s.length;f<h;++f)fe(r,s[f],u[f])}else{var d,_,w=s.indexOf(".");w!==-1?(d=s.substr(0,w),(_=s.substr(w+1))===""?u===void 0?c(r)&&!isNaN(parseInt(d))?r.splice(d,1):delete r[d]:r[d]=u:fe(w=!(w=r[d])||!g(r,d)?r[d]={}:w,_,u)):u===void 0?c(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=u}}function Me(r){var s,u={};for(s in r)g(r,s)&&(u[s]=r[s]);return u}var Ge=[].concat;function ve(r){return Ge.apply([],r)}var Yt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ve([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(s){return s+r+"Array"})}))).filter(function(r){return a[r]}),Se=new Set(Yt.map(function(r){return a[r]})),Ee=null;function qe(r){return Ee=new WeakMap,r=function s(u){if(!u||typeof u!="object")return u;var f=Ee.get(u);if(f)return f;if(c(u)){f=[],Ee.set(u,f);for(var h=0,d=u.length;h<d;++h)f.push(s(u[h]))}else if(Se.has(u.constructor))f=u;else{var _,w=y(u);for(_ in f=w===Object.prototype?{}:Object.create(w),Ee.set(u,f),u)g(u,_)&&(f[_]=s(u[_]))}return f}(r),Ee=null,r}var be={}.toString;function ke(r){return be.call(r).slice(8,-1)}var Le=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Dt=typeof Le=="symbol"?function(r){var s;return r!=null&&(s=r[Le])&&s.apply(r)}:function(){return null};function ut(r,s){return s=r.indexOf(s),0<=s&&r.splice(s,1),0<=s}var Je={};function Ze(r){var s,u,f,h;if(arguments.length===1){if(c(r))return r.slice();if(this===Je&&typeof r=="string")return[r];if(h=Dt(r)){for(u=[];!(f=h.next()).done;)u.push(f.value);return u}if(r==null)return[r];if(typeof(s=r.length)!="number")return[r];for(u=new Array(s);s--;)u[s]=r[s];return u}for(s=arguments.length,u=new Array(s);s--;)u[s]=arguments[s];return u}var xt=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],it=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xn),mn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Et(r,s){this.name=r,this.message=s}function Vs(r,s){return r+". Errors: "+Object.keys(s).map(function(u){return s[u].toString()}).filter(function(u,f,h){return h.indexOf(u)===f}).join(`
`)}function kr(r,s,u,f){this.failures=s,this.failedKeys=f,this.successCount=u,this.message=Vs(r,s)}function gn(r,s){this.name="BulkError",this.failures=Object.keys(s).map(function(u){return s[u]}),this.failuresByPos=s,this.message=Vs(r,this.failures)}T(Et).from(Error).extend({toString:function(){return this.name+": "+this.message}}),T(kr).from(Et),T(gn).from(Et);var wi=it.reduce(function(r,s){return r[s]=s+"Error",r},{}),yu=Et,ie=it.reduce(function(r,s){var u=s+"Error";function f(h,d){this.name=u,h?typeof h=="string"?(this.message="".concat(h).concat(d?`
 `+d:""),this.inner=d||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=mn[s]||u,this.inner=null)}return T(f).from(yu),r[s]=f,r},{});ie.Syntax=SyntaxError,ie.Type=TypeError,ie.Range=RangeError;var zs=Xn.reduce(function(r,s){return r[s+"Error"]=ie[s],r},{}),xr=it.reduce(function(r,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(r[s+"Error"]=ie[s]),r},{});function Ae(){}function Yn(r){return r}function _u(r,s){return r==null||r===Yn?s:function(u){return s(r(u))}}function Wt(r,s){return function(){r.apply(this,arguments),s.apply(this,arguments)}}function mu(r,s){return r===Ae?s:function(){var u=r.apply(this,arguments);u!==void 0&&(arguments[0]=u);var f=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var d=s.apply(this,arguments);return f&&(this.onsuccess=this.onsuccess?Wt(f,this.onsuccess):f),h&&(this.onerror=this.onerror?Wt(h,this.onerror):h),d!==void 0?d:u}}function gu(r,s){return r===Ae?s:function(){r.apply(this,arguments);var u=this.onsuccess,f=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?Wt(u,this.onsuccess):u),f&&(this.onerror=this.onerror?Wt(f,this.onerror):f)}}function wu(r,s){return r===Ae?s:function(u){var f=r.apply(this,arguments);p(u,f);var h=this.onsuccess,d=this.onerror;return this.onsuccess=null,this.onerror=null,u=s.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?Wt(h,this.onsuccess):h),d&&(this.onerror=this.onerror?Wt(d,this.onerror):d),f===void 0?u===void 0?void 0:u:p(f,u)}}function vu(r,s){return r===Ae?s:function(){return s.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function vi(r,s){return r===Ae?s:function(){var u=r.apply(this,arguments);if(u&&typeof u.then=="function"){for(var f=this,h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];return u.then(function(){return s.apply(f,d)})}return s.apply(this,arguments)}}xr.ModifyError=kr,xr.DexieError=Et,xr.BulkError=gn;var yt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Hs(r){yt=r}var Qn={},Gs=100,Yt=typeof Promise>"u"?[]:function(){var r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,y(r),r];var s=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[s,y(s),r]}(),Xn=Yt[0],it=Yt[1],Yt=Yt[2],it=it&&it.then,Qt=Xn&&Xn.constructor,bi=!!Yt,Jn=function(r,s){Zn.push([r,s]),Er&&(queueMicrotask(ku),Er=!1)},ki=!0,Er=!0,Xt=[],Ar=[],xi=Yn,Nt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ae,pgp:!1,env:{},finalize:Ae},ne=Nt,Zn=[],Jt=0,Sr=[];function Q(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=ne;if(typeof r!="function"){if(r!==Qn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ai(this,this._value))}this._state=null,this._value=null,++s.ref,function u(f,h){try{h(function(d){if(f._state===null){if(d===f)throw new TypeError("A promise cannot be resolved with itself.");var _=f._lib&&wn();d&&typeof d.then=="function"?u(f,function(w,b){d instanceof Q?d._then(w,b):d.then(w,b)}):(f._state=!0,f._value=d,Ys(f)),_&&vn()}},Ai.bind(null,f))}catch(d){Ai(f,d)}}(this,r)}var Ei={get:function(){var r=ne,s=Rr;function u(f,h){var d=this,_=!r.global&&(r!==ne||s!==Rr),w=_&&!Mt(),b=new Q(function(x,S){Si(d,new Ws(Xs(f,r,_,w),Xs(h,r,_,w),x,S,r))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return u.prototype=Qn,u},set:function(r){U(this,"then",r&&r.prototype===Qn?Ei:{get:function(){return r},set:Ei.set})}};function Ws(r,s,u,f,h){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof s=="function"?s:null,this.resolve=u,this.reject=f,this.psd=h}function Ai(r,s){var u,f;Ar.push(s),r._state===null&&(u=r._lib&&wn(),s=xi(s),r._state=!1,r._value=s,f=r,Xt.some(function(h){return h._value===f._value})||Xt.push(f),Ys(r),u&&vn())}function Ys(r){var s=r._listeners;r._listeners=[];for(var u=0,f=s.length;u<f;++u)Si(r,s[u]);var h=r._PSD;--h.ref||h.finalize(),Jt===0&&(++Jt,Jn(function(){--Jt==0&&Oi()},[]))}function Si(r,s){if(r._state!==null){var u=r._state?s.onFulfilled:s.onRejected;if(u===null)return(r._state?s.resolve:s.reject)(r._value);++s.psd.ref,++Jt,Jn(bu,[u,r,s])}else r._listeners.push(s)}function bu(r,s,u){try{var f,h=s._value;!s._state&&Ar.length&&(Ar=[]),f=yt&&s._consoleTask?s._consoleTask.run(function(){return r(h)}):r(h),s._state||Ar.indexOf(h)!==-1||function(d){for(var _=Xt.length;_;)if(Xt[--_]._value===d._value)return Xt.splice(_,1)}(s),u.resolve(f)}catch(d){u.reject(d)}finally{--Jt==0&&Oi(),--u.psd.ref||u.psd.finalize()}}function ku(){Zt(Nt,function(){wn()&&vn()})}function wn(){var r=ki;return Er=ki=!1,r}function vn(){var r,s,u;do for(;0<Zn.length;)for(r=Zn,Zn=[],u=r.length,s=0;s<u;++s){var f=r[s];f[0].apply(null,f[1])}while(0<Zn.length);Er=ki=!0}function Oi(){var r=Xt;Xt=[],r.forEach(function(f){f._PSD.onunhandled.call(null,f._value,f)});for(var s=Sr.slice(0),u=s.length;u;)s[--u]()}function Or(r){return new Q(Qn,!1,r)}function Pe(r,s){var u=ne;return function(){var f=wn(),h=ne;try{return jt(u,!0),r.apply(this,arguments)}catch(d){s&&s(d)}finally{jt(h,!1),f&&vn()}}}R(Q.prototype,{then:Ei,_then:function(r,s){Si(this,new Ws(null,null,r,s,ne))},catch:function(r){if(arguments.length===1)return this.then(null,r);var s=r,u=arguments[1];return typeof s=="function"?this.then(null,function(f){return(f instanceof s?u:Or)(f)}):this.then(null,function(f){return(f&&f.name===s?u:Or)(f)})},finally:function(r){return this.then(function(s){return Q.resolve(r()).then(function(){return s})},function(s){return Q.resolve(r()).then(function(){return Or(s)})})},timeout:function(r,s){var u=this;return r<1/0?new Q(function(f,h){var d=setTimeout(function(){return h(new ie.Timeout(s))},r);u.then(f,h).finally(clearTimeout.bind(null,d))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&U(Q.prototype,Symbol.toStringTag,"Dexie.Promise"),Nt.env=Qs(),R(Q,{all:function(){var r=Ze.apply(null,arguments).map(Tr);return new Q(function(s,u){r.length===0&&s([]);var f=r.length;r.forEach(function(h,d){return Q.resolve(h).then(function(_){r[d]=_,--f||s(r)},u)})})},resolve:function(r){return r instanceof Q?r:r&&typeof r.then=="function"?new Q(function(s,u){r.then(s,u)}):new Q(Qn,!0,r)},reject:Or,race:function(){var r=Ze.apply(null,arguments).map(Tr);return new Q(function(s,u){r.map(function(f){return Q.resolve(f).then(s,u)})})},PSD:{get:function(){return ne},set:function(r){return ne=r}},totalEchoes:{get:function(){return Rr}},newPSD:$t,usePSD:Zt,scheduler:{get:function(){return Jn},set:function(r){Jn=r}},rejectionMapper:{get:function(){return xi},set:function(r){xi=r}},follow:function(r,s){return new Q(function(u,f){return $t(function(h,d){var _=ne;_.unhandleds=[],_.onunhandled=d,_.finalize=Wt(function(){var w,b=this;w=function(){b.unhandleds.length===0?h():d(b.unhandleds[0])},Sr.push(function x(){w(),Sr.splice(Sr.indexOf(x),1)}),++Jt,Jn(function(){--Jt==0&&Oi()},[])},_.finalize),r()},s,u,f)})}}),Qt&&(Qt.allSettled&&U(Q,"allSettled",function(){var r=Ze.apply(null,arguments).map(Tr);return new Q(function(s){r.length===0&&s([]);var u=r.length,f=new Array(u);r.forEach(function(h,d){return Q.resolve(h).then(function(_){return f[d]={status:"fulfilled",value:_}},function(_){return f[d]={status:"rejected",reason:_}}).then(function(){return--u||s(f)})})})}),Qt.any&&typeof AggregateError<"u"&&U(Q,"any",function(){var r=Ze.apply(null,arguments).map(Tr);return new Q(function(s,u){r.length===0&&u(new AggregateError([]));var f=r.length,h=new Array(f);r.forEach(function(d,_){return Q.resolve(d).then(function(w){return s(w)},function(w){h[_]=w,--f||u(new AggregateError(h))})})})}),Qt.withResolvers&&(Q.withResolvers=Qt.withResolvers));var je={awaits:0,echoes:0,id:0},xu=0,Pr=[],Cr=0,Rr=0,Eu=0;function $t(r,s,u,f){var h=ne,d=Object.create(h);return d.parent=h,d.ref=0,d.global=!1,d.id=++Eu,Nt.env,d.env=bi?{Promise:Q,PromiseProp:{value:Q,configurable:!0,writable:!0},all:Q.all,race:Q.race,allSettled:Q.allSettled,any:Q.any,resolve:Q.resolve,reject:Q.reject}:{},s&&p(d,s),++h.ref,d.finalize=function(){--this.parent.ref||this.parent.finalize()},f=Zt(d,r,u,f),d.ref===0&&d.finalize(),f}function bn(){return je.id||(je.id=++xu),++je.awaits,je.echoes+=Gs,je.id}function Mt(){return!!je.awaits&&(--je.awaits==0&&(je.id=0),je.echoes=je.awaits*Gs,!0)}function Tr(r){return je.echoes&&r&&r.constructor===Qt?(bn(),r.then(function(s){return Mt(),s},function(s){return Mt(),Re(s)})):r}function Au(){var r=Pr[Pr.length-1];Pr.pop(),jt(r,!1)}function jt(r,s){var u,f=ne;(s?!je.echoes||Cr++&&r===ne:!Cr||--Cr&&r===ne)||queueMicrotask(s?function(h){++Rr,je.echoes&&--je.echoes!=0||(je.echoes=je.awaits=je.id=0),Pr.push(ne),jt(h,!0)}.bind(null,r):Au),r!==ne&&(ne=r,f===Nt&&(Nt.env=Qs()),bi&&(u=Nt.env.Promise,s=r.env,(f.global||r.global)&&(Object.defineProperty(a,"Promise",s.PromiseProp),u.all=s.all,u.race=s.race,u.resolve=s.resolve,u.reject=s.reject,s.allSettled&&(u.allSettled=s.allSettled),s.any&&(u.any=s.any))))}function Qs(){var r=a.Promise;return bi?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Zt(r,s,u,f,h){var d=ne;try{return jt(r,!0),s(u,f,h)}finally{jt(d,!1)}}function Xs(r,s,u,f){return typeof r!="function"?r:function(){var h=ne;u&&bn(),jt(s,!0);try{return r.apply(this,arguments)}finally{jt(h,!1),f&&queueMicrotask(Mt)}}}function Pi(r){Promise===Qt&&je.echoes===0?Cr===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+it).indexOf("[native code]")===-1&&(bn=Mt=Ae);var Re=Q.reject,en="￿",At="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Js="String expected.",kn=[],Dr="__dbnames",Ci="readonly",Ri="readwrite";function tn(r,s){return r?s?function(){return r.apply(this,arguments)&&s.apply(this,arguments)}:r:s}var Zs={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Nr(r){return typeof r!="string"||/\./.test(r)?function(s){return s}:function(s){return s[r]===void 0&&r in s&&delete(s=qe(s))[r],s}}function eo(){throw ie.Type()}function ye(r,s){try{var u=to(r),f=to(s);if(u!==f)return u==="Array"?1:f==="Array"?-1:u==="binary"?1:f==="binary"?-1:u==="string"?1:f==="string"?-1:u==="Date"?1:f!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return s<r?1:r<s?-1:0;case"binary":return function(h,d){for(var _=h.length,w=d.length,b=_<w?_:w,x=0;x<b;++x)if(h[x]!==d[x])return h[x]<d[x]?-1:1;return _===w?0:_<w?-1:1}(no(r),no(s));case"Array":return function(h,d){for(var _=h.length,w=d.length,b=_<w?_:w,x=0;x<b;++x){var S=ye(h[x],d[x]);if(S!==0)return S}return _===w?0:_<w?-1:1}(r,s)}}catch{}return NaN}function to(r){var s=typeof r;return s!="object"?s:ArrayBuffer.isView(r)?"binary":(r=ke(r),r==="ArrayBuffer"?"binary":r)}function no(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}var ro=(Oe.prototype._trans=function(r,s,u){var f=this._tx||ne.trans,h=this.name,d=yt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function _(x,S,v){if(!v.schema[h])throw new ie.NotFound("Table "+h+" not part of transaction");return s(v.idbtrans,v)}var w=wn();try{var b=f&&f.db._novip===this.db._novip?f===ne.trans?f._promise(r,_,u):$t(function(){return f._promise(r,_,u)},{trans:f,transless:ne.transless||ne}):function x(S,v,P,k){if(S.idbdb&&(S._state.openComplete||ne.letThrough||S._vip)){var A=S._createTransaction(v,P,S._dbSchema);try{A.create(),S._state.PR1398_maxLoop=3}catch(O){return O.name===wi.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,v,P,k)})):Re(O)}return A._promise(v,function(O,E){return $t(function(){return ne.trans=A,k(O,E,A)})}).then(function(O){if(v==="readwrite")try{A.idbtrans.commit()}catch{}return v==="readonly"?O:A._completion.then(function(){return O})})}if(S._state.openComplete)return Re(new ie.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return Re(new ie.DatabaseClosed);S.open().catch(Ae)}return S._state.dbReadyPromise.then(function(){return x(S,v,P,k)})}(this.db,r,[this.name],_);return d&&(b._consoleTask=d,b=b.catch(function(x){return console.trace(x),Re(x)})),b}finally{w&&vn()}},Oe.prototype.get=function(r,s){var u=this;return r&&r.constructor===Object?this.where(r).first(s):r==null?Re(new ie.Type("Invalid argument to Table.get()")):this._trans("readonly",function(f){return u.core.get({trans:f,key:r}).then(function(h){return u.hook.reading.fire(h)})}).then(s)},Oe.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(c(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var s=l(r);if(s.length===1)return this.where(s[0]).equals(r[s[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(w){if(w.compound&&s.every(function(x){return 0<=w.keyPath.indexOf(x)})){for(var b=0;b<s.length;++b)if(s.indexOf(w.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(w,b){return w.keyPath.length-b.keyPath.length})[0];if(u&&this.db._maxKey!==en){var d=u.keyPath.slice(0,s.length);return this.where(d).equals(d.map(function(b){return r[b]}))}!u&&yt&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var f=this.schema.idxByName;function h(w,b){return ye(w,b)===0}var _=s.reduce(function(v,b){var x=v[0],S=v[1],v=f[b],P=r[b];return[x||v,x||!v?tn(S,v&&v.multi?function(k){return k=re(k,b),c(k)&&k.some(function(A){return h(P,A)})}:function(k){return h(P,re(k,b))}):S]},[null,null]),d=_[0],_=_[1];return d?this.where(d.name).equals(r[d.keyPath]).filter(_):u?this.filter(_):this.where(s).equals("")},Oe.prototype.filter=function(r){return this.toCollection().and(r)},Oe.prototype.count=function(r){return this.toCollection().count(r)},Oe.prototype.offset=function(r){return this.toCollection().offset(r)},Oe.prototype.limit=function(r){return this.toCollection().limit(r)},Oe.prototype.each=function(r){return this.toCollection().each(r)},Oe.prototype.toArray=function(r){return this.toCollection().toArray(r)},Oe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Oe.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,c(r)?"[".concat(r.join("+"),"]"):r))},Oe.prototype.reverse=function(){return this.toCollection().reverse()},Oe.prototype.mapToClass=function(r){var s,u=this.db,f=this.name;function h(){return s!==null&&s.apply(this,arguments)||this}(this.schema.mappedClass=r).prototype instanceof eo&&(function(b,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function S(){this.constructor=b}n(b,x),b.prototype=x===null?Object.create(x):(S.prototype=x.prototype,new S)}(h,s=r),Object.defineProperty(h.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),h.prototype.table=function(){return f},r=h);for(var d=new Set,_=r.prototype;_;_=y(_))Object.getOwnPropertyNames(_).forEach(function(b){return d.add(b)});function w(b){if(!b)return b;var x,S=Object.create(r.prototype);for(x in b)if(!d.has(x))try{S[x]=b[x]}catch{}return S}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=w,this.hook("reading",w),r},Oe.prototype.defineClass=function(){return this.mapToClass(function(r){p(this,r)})},Oe.prototype.add=function(r,s){var u=this,f=this.schema.primKey,h=f.auto,d=f.keyPath,_=r;return d&&h&&(_=Nr(d)(r)),this._trans("readwrite",function(w){return u.core.mutate({trans:w,type:"add",keys:s!=null?[s]:null,values:[_]})}).then(function(w){return w.numFailures?Q.reject(w.failures[0]):w.lastResult}).then(function(w){if(d)try{fe(r,d,w)}catch{}return w})},Oe.prototype.update=function(r,s){return typeof r!="object"||c(r)?this.where(":id").equals(r).modify(s):(r=re(r,this.schema.primKey.keyPath),r===void 0?Re(new ie.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(s))},Oe.prototype.put=function(r,s){var u=this,f=this.schema.primKey,h=f.auto,d=f.keyPath,_=r;return d&&h&&(_=Nr(d)(r)),this._trans("readwrite",function(w){return u.core.mutate({trans:w,type:"put",values:[_],keys:s!=null?[s]:null})}).then(function(w){return w.numFailures?Q.reject(w.failures[0]):w.lastResult}).then(function(w){if(d)try{fe(r,d,w)}catch{}return w})},Oe.prototype.delete=function(r){var s=this;return this._trans("readwrite",function(u){return s.core.mutate({trans:u,type:"delete",keys:[r]})}).then(function(u){return u.numFailures?Q.reject(u.failures[0]):void 0})},Oe.prototype.clear=function(){var r=this;return this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"deleteRange",range:Zs})}).then(function(s){return s.numFailures?Q.reject(s.failures[0]):void 0})},Oe.prototype.bulkGet=function(r){var s=this;return this._trans("readonly",function(u){return s.core.getMany({keys:r,trans:u}).then(function(f){return f.map(function(h){return s.hook.reading.fire(h)})})})},Oe.prototype.bulkAdd=function(r,s,u){var f=this,h=Array.isArray(s)?s:void 0,d=(u=u||(h?void 0:s))?u.allKeys:void 0;return this._trans("readwrite",function(_){var x=f.schema.primKey,w=x.auto,x=x.keyPath;if(x&&h)throw new ie.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==r.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var b=r.length,x=x&&w?r.map(Nr(x)):r;return f.core.mutate({trans:_,type:"add",keys:h,values:x,wantResults:d}).then(function(A){var v=A.numFailures,P=A.results,k=A.lastResult,A=A.failures;if(v===0)return d?P:k;throw new gn("".concat(f.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),A)})})},Oe.prototype.bulkPut=function(r,s,u){var f=this,h=Array.isArray(s)?s:void 0,d=(u=u||(h?void 0:s))?u.allKeys:void 0;return this._trans("readwrite",function(_){var x=f.schema.primKey,w=x.auto,x=x.keyPath;if(x&&h)throw new ie.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==r.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var b=r.length,x=x&&w?r.map(Nr(x)):r;return f.core.mutate({trans:_,type:"put",keys:h,values:x,wantResults:d}).then(function(A){var v=A.numFailures,P=A.results,k=A.lastResult,A=A.failures;if(v===0)return d?P:k;throw new gn("".concat(f.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),A)})})},Oe.prototype.bulkUpdate=function(r){var s=this,u=this.core,f=r.map(function(_){return _.key}),h=r.map(function(_){return _.changes}),d=[];return this._trans("readwrite",function(_){return u.getMany({trans:_,keys:f,cache:"clone"}).then(function(w){var b=[],x=[];r.forEach(function(v,P){var k=v.key,A=v.changes,O=w[P];if(O){for(var E=0,C=Object.keys(A);E<C.length;E++){var D=C[E],N=A[D];if(D===s.schema.primKey.keyPath){if(ye(N,k)!==0)throw new ie.Constraint("Cannot update primary key in bulkUpdate()")}else fe(O,D,N)}d.push(P),b.push(k),x.push(O)}});var S=b.length;return u.mutate({trans:_,type:"put",keys:b,values:x,updates:{keys:f,changeSpecs:h}}).then(function(v){var P=v.numFailures,k=v.failures;if(P===0)return S;for(var A=0,O=Object.keys(k);A<O.length;A++){var E,C=O[A],D=d[Number(C)];D!=null&&(E=k[C],delete k[C],k[D]=E)}throw new gn("".concat(s.name,".bulkUpdate(): ").concat(P," of ").concat(S," operations failed"),k)})})})},Oe.prototype.bulkDelete=function(r){var s=this,u=r.length;return this._trans("readwrite",function(f){return s.core.mutate({trans:f,type:"delete",keys:r})}).then(function(_){var h=_.numFailures,d=_.lastResult,_=_.failures;if(h===0)return d;throw new gn("".concat(s.name,".bulkDelete(): ").concat(h," of ").concat(u," operations failed"),_)})},Oe);function Oe(){}function er(r){function s(_,w){if(w){for(var b=arguments.length,x=new Array(b-1);--b;)x[b-1]=arguments[b];return u[_].subscribe.apply(null,x),r}if(typeof _=="string")return u[_]}var u={};s.addEventType=d;for(var f=1,h=arguments.length;f<h;++f)d(arguments[f]);return s;function d(_,w,b){if(typeof _!="object"){var x;w=w||vu;var S={subscribers:[],fire:b=b||Ae,subscribe:function(v){S.subscribers.indexOf(v)===-1&&(S.subscribers.push(v),S.fire=w(S.fire,v))},unsubscribe:function(v){S.subscribers=S.subscribers.filter(function(P){return P!==v}),S.fire=S.subscribers.reduce(w,b)}};return u[_]=s[_]=S}l(x=_).forEach(function(v){var P=x[v];if(c(P))d(v,x[v][0],x[v][1]);else{if(P!=="asap")throw new ie.InvalidArgument("Invalid event config");var k=d(v,Yn,function(){for(var A=arguments.length,O=new Array(A);A--;)O[A]=arguments[A];k.subscribers.forEach(function(E){J(function(){E.apply(null,O)})})})}})}}function tr(r,s){return T(s).from({prototype:r}),s}function xn(r,s){return!(r.filter||r.algorithm||r.or)&&(s?r.justLimit:!r.replayFilter)}function Ti(r,s){r.filter=tn(r.filter,s)}function Di(r,s,u){var f=r.replayFilter;r.replayFilter=f?function(){return tn(f(),s())}:s,r.justLimit=u&&!f}function $r(r,s){if(r.isPrimKey)return s.primaryKey;var u=s.getIndexByKeyPath(r.index);if(!u)throw new ie.Schema("KeyPath "+r.index+" on object store "+s.name+" is not indexed");return u}function io(r,s,u){var f=$r(r,s.schema);return s.openCursor({trans:u,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:f,range:r.range}})}function Mr(r,s,u,f){var h=r.replayFilter?tn(r.filter,r.replayFilter()):r.filter;if(r.or){var d={},_=function(w,b,x){var S,v;h&&!h(b,x,function(P){return b.stop(P)},function(P){return b.fail(P)})||((v=""+(S=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(S)),g(d,v)||(d[v]=!0,s(w,b,x)))};return Promise.all([r.or._iterate(_,u),so(io(r,f,u),r.algorithm,_,!r.keysOnly&&r.valueMapper)])}return so(io(r,f,u),tn(r.algorithm,h),s,!r.keysOnly&&r.valueMapper)}function so(r,s,u,f){var h=Pe(f?function(d,_,w){return u(f(d),_,w)}:u);return r.then(function(d){if(d)return d.start(function(){var _=function(){return d.continue()};s&&!s(d,function(w){return _=w},function(w){d.stop(w),_=Ae},function(w){d.fail(w),_=Ae})||h(d.value,d,function(w){return _=w}),_()})})}var nr=(oo.prototype.execute=function(r){var s=this["@@propmod"];if(s.add!==void 0){var u=s.add;if(c(u))return o(o([],c(r)?r:[],!0),u).sort();if(typeof u=="number")return(Number(r)||0)+u;if(typeof u=="bigint")try{return BigInt(r)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(s.remove!==void 0){var f=s.remove;if(c(f))return c(r)?r.filter(function(h){return!f.includes(h)}).sort():[];if(typeof f=="number")return Number(r)-f;if(typeof f=="bigint")try{return BigInt(r)-f}catch{return BigInt(0)-f}throw new TypeError("Invalid subtrahend ".concat(f))}return u=(u=s.replacePrefix)===null||u===void 0?void 0:u[0],u&&typeof r=="string"&&r.startsWith(u)?s.replacePrefix[1]+r.substring(u.length):r},oo);function oo(r){this["@@propmod"]=r}var Su=(me.prototype._read=function(r,s){var u=this._ctx;return u.error?u.table._trans(null,Re.bind(null,u.error)):u.table._trans("readonly",r).then(s)},me.prototype._write=function(r){var s=this._ctx;return s.error?s.table._trans(null,Re.bind(null,s.error)):s.table._trans("readwrite",r,"locked")},me.prototype._addAlgorithm=function(r){var s=this._ctx;s.algorithm=tn(s.algorithm,r)},me.prototype._iterate=function(r,s){return Mr(this._ctx,r,s,this._ctx.table.core)},me.prototype.clone=function(r){var s=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return r&&p(u,r),s._ctx=u,s},me.prototype.raw=function(){return this._ctx.valueMapper=null,this},me.prototype.each=function(r){var s=this._ctx;return this._read(function(u){return Mr(s,r,u,s.table.core)})},me.prototype.count=function(r){var s=this;return this._read(function(u){var f=s._ctx,h=f.table.core;if(xn(f,!0))return h.count({trans:u,query:{index:$r(f,h.schema),range:f.range}}).then(function(_){return Math.min(_,f.limit)});var d=0;return Mr(f,function(){return++d,!1},u,h).then(function(){return d})}).then(r)},me.prototype.sortBy=function(r,s){var u=r.split(".").reverse(),f=u[0],h=u.length-1;function d(b,x){return x?d(b[u[x]],x-1):b[f]}var _=this._ctx.dir==="next"?1:-1;function w(b,x){return ye(d(b,h),d(x,h))*_}return this.toArray(function(b){return b.sort(w)}).then(s)},me.prototype.toArray=function(r){var s=this;return this._read(function(u){var f=s._ctx;if(f.dir==="next"&&xn(f,!0)&&0<f.limit){var h=f.valueMapper,d=$r(f,f.table.core.schema);return f.table.core.query({trans:u,limit:f.limit,values:!0,query:{index:d,range:f.range}}).then(function(w){return w=w.result,h?w.map(h):w})}var _=[];return Mr(f,function(w){return _.push(w)},u,f.table.core).then(function(){return _})},r)},me.prototype.offset=function(r){var s=this._ctx;return r<=0||(s.offset+=r,xn(s)?Di(s,function(){var u=r;return function(f,h){return u===0||(u===1?--u:h(function(){f.advance(u),u=0}),!1)}}):Di(s,function(){var u=r;return function(){return--u<0}})),this},me.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),Di(this._ctx,function(){var s=r;return function(u,f,h){return--s<=0&&f(h),0<=s}},!0),this},me.prototype.until=function(r,s){return Ti(this._ctx,function(u,f,h){return!r(u.value)||(f(h),s)}),this},me.prototype.first=function(r){return this.limit(1).toArray(function(s){return s[0]}).then(r)},me.prototype.last=function(r){return this.reverse().first(r)},me.prototype.filter=function(r){var s;return Ti(this._ctx,function(u){return r(u.value)}),(s=this._ctx).isMatch=tn(s.isMatch,r),this},me.prototype.and=function(r){return this.filter(r)},me.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},me.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},me.prototype.desc=function(){return this.reverse()},me.prototype.eachKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(u,f){r(f.key,f)})},me.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},me.prototype.eachPrimaryKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(u,f){r(f.primaryKey,f)})},me.prototype.keys=function(r){var s=this._ctx;s.keysOnly=!s.isMatch;var u=[];return this.each(function(f,h){u.push(h.key)}).then(function(){return u}).then(r)},me.prototype.primaryKeys=function(r){var s=this._ctx;if(s.dir==="next"&&xn(s,!0)&&0<s.limit)return this._read(function(f){var h=$r(s,s.table.core.schema);return s.table.core.query({trans:f,values:!1,limit:s.limit,query:{index:h,range:s.range}})}).then(function(f){return f.result}).then(r);s.keysOnly=!s.isMatch;var u=[];return this.each(function(f,h){u.push(h.primaryKey)}).then(function(){return u}).then(r)},me.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},me.prototype.firstKey=function(r){return this.limit(1).keys(function(s){return s[0]}).then(r)},me.prototype.lastKey=function(r){return this.reverse().firstKey(r)},me.prototype.distinct=function(){var r=this._ctx,r=r.index&&r.table.schema.idxByName[r.index];if(!r||!r.multi)return this;var s={};return Ti(this._ctx,function(h){var f=h.primaryKey.toString(),h=g(s,f);return s[f]=!0,!h}),this},me.prototype.modify=function(r){var s=this,u=this._ctx;return this._write(function(f){var h,d,_;_=typeof r=="function"?r:(h=l(r),d=h.length,function(E){for(var C=!1,D=0;D<d;++D){var N=h[D],M=r[N],L=re(E,N);M instanceof nr?(fe(E,N,M.execute(L)),C=!0):L!==M&&(fe(E,N,M),C=!0)}return C});var w=u.table.core,v=w.schema.primaryKey,b=v.outbound,x=v.extractKey,S=200,v=s.db._options.modifyChunkSize;v&&(S=typeof v=="object"?v[w.name]||v["*"]||200:v);function P(E,N){var D=N.failures,N=N.numFailures;A+=E-N;for(var M=0,L=l(D);M<L.length;M++){var H=L[M];k.push(D[H])}}var k=[],A=0,O=[];return s.clone().primaryKeys().then(function(E){function C(N){var M=Math.min(S,E.length-N);return w.getMany({trans:f,keys:E.slice(N,N+M),cache:"immutable"}).then(function(L){for(var H=[],F=[],q=b?[]:null,W=[],z=0;z<M;++z){var Z=L[z],ce={value:qe(Z),primKey:E[N+z]};_.call(ce,ce.value,ce)!==!1&&(ce.value==null?W.push(E[N+z]):b||ye(x(Z),x(ce.value))===0?(F.push(ce.value),b&&q.push(E[N+z])):(W.push(E[N+z]),H.push(ce.value)))}return Promise.resolve(0<H.length&&w.mutate({trans:f,type:"add",values:H}).then(function(de){for(var pe in de.failures)W.splice(parseInt(pe),1);P(H.length,de)})).then(function(){return(0<F.length||D&&typeof r=="object")&&w.mutate({trans:f,type:"put",keys:q,values:F,criteria:D,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<N}).then(function(de){return P(F.length,de)})}).then(function(){return(0<W.length||D&&r===Ni)&&w.mutate({trans:f,type:"delete",keys:W,criteria:D,isAdditionalChunk:0<N}).then(function(de){return P(W.length,de)})}).then(function(){return E.length>N+M&&C(N+S)})})}var D=xn(u)&&u.limit===1/0&&(typeof r!="function"||r===Ni)&&{index:u.index,range:u.range};return C(0).then(function(){if(0<k.length)throw new kr("Error modifying one or more objects",k,A,O);return E.length})})})},me.prototype.delete=function(){var r=this._ctx,s=r.range;return xn(r)&&(r.isPrimKey||s.type===3)?this._write(function(u){var f=r.table.core.schema.primaryKey,h=s;return r.table.core.count({trans:u,query:{index:f,range:h}}).then(function(d){return r.table.core.mutate({trans:u,type:"deleteRange",range:h}).then(function(_){var w=_.failures;if(_.lastResult,_.results,_=_.numFailures,_)throw new kr("Could not delete some values",Object.keys(w).map(function(b){return w[b]}),d-_);return d-_})})}):this.modify(Ni)},me);function me(){}var Ni=function(r,s){return s.value=null};function Ou(r,s){return r<s?-1:r===s?0:1}function Pu(r,s){return s<r?-1:r===s?0:1}function et(r,s,u){return r=r instanceof uo?new r.Collection(r):r,r._ctx.error=new(u||TypeError)(s),r}function En(r){return new r.Collection(r,function(){return ao("")}).limit(0)}function jr(r,s,u,f){var h,d,_,w,b,x,S,v=u.length;if(!u.every(function(A){return typeof A=="string"}))return et(r,Js);function P(A){h=A==="next"?function(E){return E.toUpperCase()}:function(E){return E.toLowerCase()},d=A==="next"?function(E){return E.toLowerCase()}:function(E){return E.toUpperCase()},_=A==="next"?Ou:Pu;var O=u.map(function(E){return{lower:d(E),upper:h(E)}}).sort(function(E,C){return _(E.lower,C.lower)});w=O.map(function(E){return E.upper}),b=O.map(function(E){return E.lower}),S=(x=A)==="next"?"":f}P("next"),r=new r.Collection(r,function(){return Kt(w[0],b[v-1]+f)}),r._ondirectionchange=function(A){P(A)};var k=0;return r._addAlgorithm(function(A,O,E){var C=A.key;if(typeof C!="string")return!1;var D=d(C);if(s(D,b,k))return!0;for(var N=null,M=k;M<v;++M){var L=function(H,F,q,W,z,Z){for(var ce=Math.min(H.length,W.length),de=-1,pe=0;pe<ce;++pe){var tt=F[pe];if(tt!==W[pe])return z(H[pe],q[pe])<0?H.substr(0,pe)+q[pe]+q.substr(pe+1):z(H[pe],W[pe])<0?H.substr(0,pe)+W[pe]+q.substr(pe+1):0<=de?H.substr(0,de)+F[de]+q.substr(de+1):null;z(H[pe],tt)<0&&(de=pe)}return ce<W.length&&Z==="next"?H+q.substr(H.length):ce<H.length&&Z==="prev"?H.substr(0,q.length):de<0?null:H.substr(0,de)+W[de]+q.substr(de+1)}(C,D,w[M],b[M],_,x);L===null&&N===null?k=M+1:(N===null||0<_(N,L))&&(N=L)}return O(N!==null?function(){A.continue(N+S)}:E),!1}),r}function Kt(r,s,u,f){return{type:2,lower:r,upper:s,lowerOpen:u,upperOpen:f}}function ao(r){return{type:1,lower:r,upper:r}}var uo=(Object.defineProperty(Ke.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ke.prototype.between=function(r,s,u,f){u=u!==!1,f=f===!0;try{return 0<this._cmp(r,s)||this._cmp(r,s)===0&&(u||f)&&(!u||!f)?En(this):new this.Collection(this,function(){return Kt(r,s,!u,!f)})}catch{return et(this,At)}},Ke.prototype.equals=function(r){return r==null?et(this,At):new this.Collection(this,function(){return ao(r)})},Ke.prototype.above=function(r){return r==null?et(this,At):new this.Collection(this,function(){return Kt(r,void 0,!0)})},Ke.prototype.aboveOrEqual=function(r){return r==null?et(this,At):new this.Collection(this,function(){return Kt(r,void 0,!1)})},Ke.prototype.below=function(r){return r==null?et(this,At):new this.Collection(this,function(){return Kt(void 0,r,!1,!0)})},Ke.prototype.belowOrEqual=function(r){return r==null?et(this,At):new this.Collection(this,function(){return Kt(void 0,r)})},Ke.prototype.startsWith=function(r){return typeof r!="string"?et(this,Js):this.between(r,r+en,!0,!0)},Ke.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):jr(this,function(s,u){return s.indexOf(u[0])===0},[r],en)},Ke.prototype.equalsIgnoreCase=function(r){return jr(this,function(s,u){return s===u[0]},[r],"")},Ke.prototype.anyOfIgnoreCase=function(){var r=Ze.apply(Je,arguments);return r.length===0?En(this):jr(this,function(s,u){return u.indexOf(s)!==-1},r,"")},Ke.prototype.startsWithAnyOfIgnoreCase=function(){var r=Ze.apply(Je,arguments);return r.length===0?En(this):jr(this,function(s,u){return u.some(function(f){return s.indexOf(f)===0})},r,en)},Ke.prototype.anyOf=function(){var r=this,s=Ze.apply(Je,arguments),u=this._cmp;try{s.sort(u)}catch{return et(this,At)}if(s.length===0)return En(this);var f=new this.Collection(this,function(){return Kt(s[0],s[s.length-1])});f._ondirectionchange=function(d){u=d==="next"?r._ascending:r._descending,s.sort(u)};var h=0;return f._addAlgorithm(function(d,_,w){for(var b=d.key;0<u(b,s[h]);)if(++h===s.length)return _(w),!1;return u(b,s[h])===0||(_(function(){d.continue(s[h])}),!1)}),f},Ke.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ke.prototype.noneOf=function(){var r=Ze.apply(Je,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return et(this,At)}var s=r.reduce(function(u,f){return u?u.concat([[u[u.length-1][1],f]]):[[-1/0,f]]},null);return s.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},Ke.prototype.inAnyRange=function(C,s){var u=this,f=this._cmp,h=this._ascending,d=this._descending,_=this._min,w=this._max;if(C.length===0)return En(this);if(!C.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&h(D[0],D[1])<=0}))return et(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ie.InvalidArgument);var b=!s||s.includeLowers!==!1,x=s&&s.includeUppers===!0,S,v=h;function P(D,N){return v(D[0],N[0])}try{(S=C.reduce(function(D,N){for(var M=0,L=D.length;M<L;++M){var H=D[M];if(f(N[0],H[1])<0&&0<f(N[1],H[0])){H[0]=_(H[0],N[0]),H[1]=w(H[1],N[1]);break}}return M===L&&D.push(N),D},[])).sort(P)}catch{return et(this,At)}var k=0,A=x?function(D){return 0<h(D,S[k][1])}:function(D){return 0<=h(D,S[k][1])},O=b?function(D){return 0<d(D,S[k][0])}:function(D){return 0<=d(D,S[k][0])},E=A,C=new this.Collection(this,function(){return Kt(S[0][0],S[S.length-1][1],!b,!x)});return C._ondirectionchange=function(D){v=D==="next"?(E=A,h):(E=O,d),S.sort(P)},C._addAlgorithm(function(D,N,M){for(var L,H=D.key;E(H);)if(++k===S.length)return N(M),!1;return!A(L=H)&&!O(L)||(u._cmp(H,S[k][1])===0||u._cmp(H,S[k][0])===0||N(function(){v===h?D.continue(S[k][0]):D.continue(S[k][1])}),!1)}),C},Ke.prototype.startsWithAnyOf=function(){var r=Ze.apply(Je,arguments);return r.every(function(s){return typeof s=="string"})?r.length===0?En(this):this.inAnyRange(r.map(function(s){return[s,s+en]})):et(this,"startsWithAnyOf() only works with strings")},Ke);function Ke(){}function _t(r){return Pe(function(s){return rr(s),r(s.target.error),!1})}function rr(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var ir="storagemutated",$i="x-storagemutated-1",It=er(null,ir),Cu=(mt.prototype._lock=function(){return V(!ne.global),++this._reculock,this._reculock!==1||ne.global||(ne.lockOwnerFor=this),this},mt.prototype._unlock=function(){if(V(!ne.global),--this._reculock==0)for(ne.global||(ne.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Zt(r[1],r[0])}catch{}}return this},mt.prototype._locked=function(){return this._reculock&&ne.lockOwnerFor!==this},mt.prototype.create=function(r){var s=this;if(!this.mode)return this;var u=this.db.idbdb,f=this.db._state.dbOpenError;if(V(!this.idbtrans),!r&&!u)switch(f&&f.name){case"DatabaseClosedError":throw new ie.DatabaseClosed(f);case"MissingAPIError":throw new ie.MissingAPI(f.message,f);default:throw new ie.OpenFailed(f)}if(!this.active)throw new ie.TransactionInactive;return V(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Pe(function(h){rr(h),s._reject(r.error)}),r.onabort=Pe(function(h){rr(h),s.active&&s._reject(new ie.Abort(r.error)),s.active=!1,s.on("abort").fire(h)}),r.oncomplete=Pe(function(){s.active=!1,s._resolve(),"mutatedParts"in r&&It.storagemutated.fire(r.mutatedParts)}),this},mt.prototype._promise=function(r,s,u){var f=this;if(r==="readwrite"&&this.mode!=="readwrite")return Re(new ie.ReadOnly("Transaction is readonly"));if(!this.active)return Re(new ie.TransactionInactive);if(this._locked())return new Q(function(d,_){f._blockedFuncs.push([function(){f._promise(r,s,u).then(d,_)},ne])});if(u)return $t(function(){var d=new Q(function(_,w){f._lock();var b=s(_,w,f);b&&b.then&&b.then(_,w)});return d.finally(function(){return f._unlock()}),d._lib=!0,d});var h=new Q(function(d,_){var w=s(d,_,f);w&&w.then&&w.then(d,_)});return h._lib=!0,h},mt.prototype._root=function(){return this.parent?this.parent._root():this},mt.prototype.waitFor=function(r){var s,u=this._root(),f=Q.resolve(r);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return f}):(u._waitingFor=f,u._waitingQueue=[],s=u.idbtrans.objectStore(u.storeNames[0]),function d(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(s.get(-1/0).onsuccess=d)}());var h=u._waitingFor;return new Q(function(d,_){f.then(function(w){return u._waitingQueue.push(Pe(d.bind(null,w)))},function(w){return u._waitingQueue.push(Pe(_.bind(null,w)))}).finally(function(){u._waitingFor===h&&(u._waitingFor=null)})})},mt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ie.Abort))},mt.prototype.table=function(r){var s=this._memoizedTables||(this._memoizedTables={});if(g(s,r))return s[r];var u=this.schema[r];if(!u)throw new ie.NotFound("Table "+r+" not part of transaction");return u=new this.db.Table(r,u,this),u.core=this.db.core.table(r),s[r]=u},mt);function mt(){}function Mi(r,s,u,f,h,d,_){return{name:r,keyPath:s,unique:u,multi:f,auto:h,compound:d,src:(u&&!_?"&":"")+(f?"*":"")+(h?"++":"")+co(s)}}function co(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function ji(r,s,u){return{name:r,primKey:s,indexes:u,mappedClass:null,idxByName:(f=function(h){return[h.name,h]},u.reduce(function(h,d,_){return _=f(d,_),_&&(h[_[0]]=_[1]),h},{}))};var f}var sr=function(r){try{return r.only([[]]),sr=function(){return[[]]},[[]]}catch{return sr=function(){return en},en}};function Ki(r){return r==null?function(){}:typeof r=="string"?(s=r).split(".").length===1?function(u){return u[s]}:function(u){return re(u,s)}:function(u){return re(u,r)};var s}function lo(r){return[].slice.call(r)}var Ru=0;function or(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Tu(r,s,b){function f(E){if(E.type===3)return null;if(E.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var k=E.lower,A=E.upper,O=E.lowerOpen,E=E.upperOpen;return k===void 0?A===void 0?null:s.upperBound(A,!!E):A===void 0?s.lowerBound(k,!!O):s.bound(k,A,!!O,!!E)}function h(P){var k,A=P.name;return{name:A,schema:P,mutate:function(O){var E=O.trans,C=O.type,D=O.keys,N=O.values,M=O.range;return new Promise(function(L,H){L=Pe(L);var F=E.objectStore(A),q=F.keyPath==null,W=C==="put"||C==="add";if(!W&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var z,Z=(D||N||{length:1}).length;if(D&&N&&D.length!==N.length)throw new Error("Given keys array must have same length as given values array.");if(Z===0)return L({numFailures:0,failures:{},results:[],lastResult:void 0});function ce(He){++tt,rr(He)}var de=[],pe=[],tt=0;if(C==="deleteRange"){if(M.type===4)return L({numFailures:tt,failures:pe,results:[],lastResult:void 0});M.type===3?de.push(z=F.clear()):de.push(z=F.delete(f(M)))}else{var q=W?q?[N,D]:[N,null]:[D,null],ae=q[0],Ve=q[1];if(W)for(var ze=0;ze<Z;++ze)de.push(z=Ve&&Ve[ze]!==void 0?F[C](ae[ze],Ve[ze]):F[C](ae[ze])),z.onerror=ce;else for(ze=0;ze<Z;++ze)de.push(z=F[C](ae[ze])),z.onerror=ce}function Yr(He){He=He.target.result,de.forEach(function(sn,ts){return sn.error!=null&&(pe[ts]=sn.error)}),L({numFailures:tt,failures:pe,results:C==="delete"?D:de.map(function(sn){return sn.result}),lastResult:He})}z.onerror=function(He){ce(He),Yr(He)},z.onsuccess=Yr})},getMany:function(O){var E=O.trans,C=O.keys;return new Promise(function(D,N){D=Pe(D);for(var M,L=E.objectStore(A),H=C.length,F=new Array(H),q=0,W=0,z=function(de){de=de.target,F[de._pos]=de.result,++W===q&&D(F)},Z=_t(N),ce=0;ce<H;++ce)C[ce]!=null&&((M=L.get(C[ce]))._pos=ce,M.onsuccess=z,M.onerror=Z,++q);q===0&&D(F)})},get:function(O){var E=O.trans,C=O.key;return new Promise(function(D,N){D=Pe(D);var M=E.objectStore(A).get(C);M.onsuccess=function(L){return D(L.target.result)},M.onerror=_t(N)})},query:(k=x,function(O){return new Promise(function(E,C){E=Pe(E);var D,N,M,q=O.trans,L=O.values,H=O.limit,z=O.query,F=H===1/0?void 0:H,W=z.index,z=z.range,q=q.objectStore(A),W=W.isPrimaryKey?q:q.index(W.name),z=f(z);if(H===0)return E({result:[]});k?((F=L?W.getAll(z,F):W.getAllKeys(z,F)).onsuccess=function(Z){return E({result:Z.target.result})},F.onerror=_t(C)):(D=0,N=!L&&"openKeyCursor"in W?W.openKeyCursor(z):W.openCursor(z),M=[],N.onsuccess=function(Z){var ce=N.result;return ce?(M.push(L?ce.value:ce.primaryKey),++D===H?E({result:M}):void ce.continue()):E({result:M})},N.onerror=_t(C))})}),openCursor:function(O){var E=O.trans,C=O.values,D=O.query,N=O.reverse,M=O.unique;return new Promise(function(L,H){L=Pe(L);var W=D.index,F=D.range,q=E.objectStore(A),q=W.isPrimaryKey?q:q.index(W.name),W=N?M?"prevunique":"prev":M?"nextunique":"next",z=!C&&"openKeyCursor"in q?q.openKeyCursor(f(F),W):q.openCursor(f(F),W);z.onerror=_t(H),z.onsuccess=Pe(function(Z){var ce,de,pe,tt,ae=z.result;ae?(ae.___id=++Ru,ae.done=!1,ce=ae.continue.bind(ae),de=(de=ae.continuePrimaryKey)&&de.bind(ae),pe=ae.advance.bind(ae),tt=function(){throw new Error("Cursor not stopped")},ae.trans=E,ae.stop=ae.continue=ae.continuePrimaryKey=ae.advance=function(){throw new Error("Cursor not started")},ae.fail=Pe(H),ae.next=function(){var Ve=this,ze=1;return this.start(function(){return ze--?Ve.continue():Ve.stop()}).then(function(){return Ve})},ae.start=function(Ve){function ze(){if(z.result)try{Ve()}catch(He){ae.fail(He)}else ae.done=!0,ae.start=function(){throw new Error("Cursor behind last entry")},ae.stop()}var Yr=new Promise(function(He,sn){He=Pe(He),z.onerror=_t(sn),ae.fail=sn,ae.stop=function(ts){ae.stop=ae.continue=ae.continuePrimaryKey=ae.advance=tt,He(ts)}});return z.onsuccess=Pe(function(He){z.onsuccess=ze,ze()}),ae.continue=ce,ae.continuePrimaryKey=de,ae.advance=pe,ze(),Yr},L(ae)):L(null)},H)})},count:function(O){var E=O.query,C=O.trans,D=E.index,N=E.range;return new Promise(function(M,L){var H=C.objectStore(A),F=D.isPrimaryKey?H:H.index(D.name),H=f(N),F=H?F.count(H):F.count();F.onsuccess=Pe(function(q){return M(q.target.result)}),F.onerror=_t(L)})}}}var d,_,w,S=(_=b,w=lo((d=r).objectStoreNames),{schema:{name:d.name,tables:w.map(function(P){return _.objectStore(P)}).map(function(P){var k=P.keyPath,E=P.autoIncrement,A=c(k),O={},E={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:k==null,compound:A,keyPath:k,autoIncrement:E,unique:!0,extractKey:Ki(k)},indexes:lo(P.indexNames).map(function(C){return P.index(C)}).map(function(M){var D=M.name,N=M.unique,L=M.multiEntry,M=M.keyPath,L={name:D,compound:c(M),keyPath:M,unique:N,multiEntry:L,extractKey:Ki(M)};return O[or(M)]=L}),getIndexByKeyPath:function(C){return O[or(C)]}};return O[":id"]=E.primaryKey,k!=null&&(O[or(k)]=E.primaryKey),E})},hasGetAll:0<w.length&&"getAll"in _.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=S.schema,x=S.hasGetAll,S=b.tables.map(h),v={};return S.forEach(function(P){return v[P.name]=P}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(P){if(!v[P])throw new Error("Table '".concat(P,"' not found"));return v[P]},MIN_KEY:-1/0,MAX_KEY:sr(s),schema:b}}function Du(r,s,u,f){var h=u.IDBKeyRange;return u.indexedDB,{dbcore:(f=Tu(s,h,f),r.dbcore.reduce(function(d,_){return _=_.create,i(i({},d),_(d))},f))}}function Kr(r,f){var u=f.db,f=Du(r._middlewares,u,r._deps,f);r.core=f.dbcore,r.tables.forEach(function(h){var d=h.name;r.core.schema.tables.some(function(_){return _.name===d})&&(h.core=r.core.table(d),r[d]instanceof r.Table&&(r[d].core=h.core))})}function Ir(r,s,u,f){u.forEach(function(h){var d=f[h];s.forEach(function(_){var w=function b(x,S){return I(x,S)||(x=y(x))&&b(x,S)}(_,h);(!w||"value"in w&&w.value===void 0)&&(_===r.Transaction.prototype||_ instanceof r.Transaction?U(_,h,{get:function(){return this.table(h)},set:function(b){$(this,h,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):_[h]=new r.Table(h,d))})})}function Ii(r,s){s.forEach(function(u){for(var f in u)u[f]instanceof r.Table&&delete u[f]})}function Nu(r,s){return r._cfg.version-s._cfg.version}function $u(r,s,u,f){var h=r._dbSchema;u.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=ji("$meta",ho("")[0],[]),r._storeNames.push("$meta"));var d=r._createTransaction("readwrite",r._storeNames,h);d.create(u),d._completion.catch(f);var _=d._reject.bind(d),w=ne.transless||ne;$t(function(){return ne.trans=d,ne.transless=w,s!==0?(Kr(r,u),x=s,((b=d).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(S){return S??x}):Q.resolve(x)).then(function(S){return P=S,k=d,A=u,O=[],S=(v=r)._versions,E=v._dbSchema=Fr(0,v.idbdb,A),(S=S.filter(function(C){return C._cfg.version>=P})).length!==0?(S.forEach(function(C){O.push(function(){var D=E,N=C._cfg.dbschema;Br(v,D,A),Br(v,N,A),E=v._dbSchema=N;var M=Li(D,N);M.add.forEach(function(W){Fi(A,W[0],W[1].primKey,W[1].indexes)}),M.change.forEach(function(W){if(W.recreate)throw new ie.Upgrade("Not yet support for changing primary key");var z=A.objectStore(W.name);W.add.forEach(function(Z){return Lr(z,Z)}),W.change.forEach(function(Z){z.deleteIndex(Z.name),Lr(z,Z)}),W.del.forEach(function(Z){return z.deleteIndex(Z)})});var L=C._cfg.contentUpgrade;if(L&&C._cfg.version>P){Kr(v,A),k._memoizedTables={};var H=Me(N);M.del.forEach(function(W){H[W]=D[W]}),Ii(v,[v.Transaction.prototype]),Ir(v,[v.Transaction.prototype],l(H),H),k.schema=H;var F,q=xt(L);return q&&bn(),M=Q.follow(function(){var W;(F=L(k))&&q&&(W=Mt.bind(null,null),F.then(W,W))}),F&&typeof F.then=="function"?Q.resolve(F):M.then(function(){return F})}}),O.push(function(D){var N,M,L=C._cfg.dbschema;N=L,M=D,[].slice.call(M.db.objectStoreNames).forEach(function(H){return N[H]==null&&M.db.deleteObjectStore(H)}),Ii(v,[v.Transaction.prototype]),Ir(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),k.schema=v._dbSchema}),O.push(function(D){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===C._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(N){return N!=="$meta"})):D.objectStore("$meta").put(C._cfg.version,"version"))})}),function C(){return O.length?Q.resolve(O.shift()(k.idbtrans)).then(C):Q.resolve()}().then(function(){fo(E,A)})):Q.resolve();var v,P,k,A,O,E}).catch(_)):(l(h).forEach(function(S){Fi(u,S,h[S].primKey,h[S].indexes)}),Kr(r,u),void Q.follow(function(){return r.on.populate.fire(d)}).catch(_));var b,x})}function Mu(r,s){fo(r._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var u=Fr(0,r.idbdb,s);Br(r,r._dbSchema,s);for(var f=0,h=Li(u,r._dbSchema).change;f<h.length;f++){var d=function(_){if(_.change.length||_.recreate)return console.warn("Unable to patch indexes of table ".concat(_.name," because it has changes on the type of index or primary key.")),{value:void 0};var w=s.objectStore(_.name);_.add.forEach(function(b){yt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(_.name,".").concat(b.src)),Lr(w,b)})}(h[f]);if(typeof d=="object")return d.value}}function Li(r,s){var u,f={del:[],add:[],change:[]};for(u in r)s[u]||f.del.push(u);for(u in s){var h=r[u],d=s[u];if(h){var _={name:u,def:d,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(d.primKey.keyPath||"")||h.primKey.auto!==d.primKey.auto)_.recreate=!0,f.change.push(_);else{var w=h.idxByName,b=d.idxByName,x=void 0;for(x in w)b[x]||_.del.push(x);for(x in b){var S=w[x],v=b[x];S?S.src!==v.src&&_.change.push(v):_.add.push(v)}(0<_.del.length||0<_.add.length||0<_.change.length)&&f.change.push(_)}}else f.add.push([u,d])}return f}function Fi(r,s,u,f){var h=r.db.createObjectStore(s,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return f.forEach(function(d){return Lr(h,d)}),h}function fo(r,s){l(r).forEach(function(u){s.db.objectStoreNames.contains(u)||(yt&&console.debug("Dexie: Creating missing table",u),Fi(s,u,r[u].primKey,r[u].indexes))})}function Lr(r,s){r.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function Fr(r,s,u){var f={};return K(s.objectStoreNames,0).forEach(function(h){for(var d=u.objectStore(h),_=Mi(co(x=d.keyPath),x||"",!0,!1,!!d.autoIncrement,x&&typeof x!="string",!0),w=[],b=0;b<d.indexNames.length;++b){var S=d.index(d.indexNames[b]),x=S.keyPath,S=Mi(S.name,x,!!S.unique,!!S.multiEntry,!1,x&&typeof x!="string",!1);w.push(S)}f[h]=ji(h,_,w)}),f}function Br(r,s,u){for(var f=u.db.objectStoreNames,h=0;h<f.length;++h){var d=f[h],_=u.objectStore(d);r._hasGetAll="getAll"in _;for(var w=0;w<_.indexNames.length;++w){var b=_.indexNames[w],x=_.index(b).keyPath,S=typeof x=="string"?x:"["+K(x).join("+")+"]";!s[d]||(x=s[d].idxByName[S])&&(x.name=b,delete s[d].idxByName[S],s[d].idxByName[b]=x)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function ho(r){return r.split(",").map(function(s,u){var f=(s=s.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(f)?f.match(/^\[(.*)\]$/)[1].split("+"):f;return Mi(f,h||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),c(h),u===0)})}var ju=(qr.prototype._parseStoresSpec=function(r,s){l(r).forEach(function(u){if(r[u]!==null){var f=ho(r[u]),h=f.shift();if(h.unique=!0,h.multi)throw new ie.Schema("Primary key cannot be multi-valued");f.forEach(function(d){if(d.auto)throw new ie.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new ie.Schema("Index must have a name and cannot be an empty string")}),s[u]=ji(u,h,f)}})},qr.prototype.stores=function(u){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,u):u;var u=s._versions,f={},h={};return u.forEach(function(d){p(f,d._cfg.storesSource),h=d._cfg.dbschema={},d._parseStoresSpec(f,h)}),s._dbSchema=h,Ii(s,[s._allTables,s,s.Transaction.prototype]),Ir(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],l(h),h),s._storeNames=l(h),this},qr.prototype.upgrade=function(r){return this._cfg.contentUpgrade=vi(this._cfg.contentUpgrade||Ae,r),this},qr);function qr(){}function Bi(r,s){var u=r._dbNamesDB;return u||(u=r._dbNamesDB=new St(Dr,{addons:[],indexedDB:r,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function qi(r){return r&&typeof r.databases=="function"}function Ui(r){return $t(function(){return ne.letThrough=!0,r()})}function Vi(r){return!("from"in r)}var Ue=function(r,s){if(!this){var u=new Ue;return r&&"d"in r&&p(u,r),u}p(this,arguments.length?{d:1,from:r,to:1<arguments.length?s:r}:{d:0})};function ar(r,s,u){var f=ye(s,u);if(!isNaN(f)){if(0<f)throw RangeError();if(Vi(r))return p(r,{from:s,to:u,d:1});var h=r.l,f=r.r;if(ye(u,r.from)<0)return h?ar(h,s,u):r.l={from:s,to:u,d:1,l:null,r:null},yo(r);if(0<ye(s,r.to))return f?ar(f,s,u):r.r={from:s,to:u,d:1,l:null,r:null},yo(r);ye(s,r.from)<0&&(r.from=s,r.l=null,r.d=f?f.d+1:1),0<ye(u,r.to)&&(r.to=u,r.r=null,r.d=r.l?r.l.d+1:1),u=!r.r,h&&!r.l&&ur(r,h),f&&u&&ur(r,f)}}function ur(r,s){Vi(s)||function u(f,b){var d=b.from,_=b.to,w=b.l,b=b.r;ar(f,d,_),w&&u(f,w),b&&u(f,b)}(r,s)}function po(r,s){var u=Ur(s),f=u.next();if(f.done)return!1;for(var h=f.value,d=Ur(r),_=d.next(h.from),w=_.value;!f.done&&!_.done;){if(ye(w.from,h.to)<=0&&0<=ye(w.to,h.from))return!0;ye(h.from,w.from)<0?h=(f=u.next(w.from)).value:w=(_=d.next(h.from)).value}return!1}function Ur(r){var s=Vi(r)?null:{s:0,n:r};return{next:function(u){for(var f=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,f)for(;s.n.l&&ye(u,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!f||ye(u,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function yo(r){var s,u,f=(((s=r.r)===null||s===void 0?void 0:s.d)||0)-(((u=r.l)===null||u===void 0?void 0:u.d)||0),h=1<f?"r":f<-1?"l":"";h&&(s=h=="r"?"l":"r",u=i({},r),f=r[h],r.from=f.from,r.to=f.to,r[h]=f[h],u[h]=f[s],(r[s]=u).d=_o(u)),r.d=_o(r)}function _o(u){var s=u.r,u=u.l;return(s?u?Math.max(s.d,u.d):s.d:u?u.d:0)+1}function Vr(r,s){return l(s).forEach(function(u){r[u]?ur(r[u],s[u]):r[u]=function f(h){var d,_,w={};for(d in h)g(h,d)&&(_=h[d],w[d]=!_||typeof _!="object"||Se.has(_.constructor)?_:f(_));return w}(s[u])}),r}function zi(r,s){return r.all||s.all||Object.keys(r).some(function(u){return s[u]&&po(s[u],r[u])})}R(Ue.prototype,((it={add:function(r){return ur(this,r),this},addKey:function(r){return ar(this,r,r),this},addKeys:function(r){var s=this;return r.forEach(function(u){return ar(s,u,u)}),this},hasKey:function(r){var s=Ur(this).next(r).value;return s&&ye(s.from,r)<=0&&0<=ye(s.to,r)}})[Le]=function(){return Ur(this)},it));var nn={},Hi={},Gi=!1;function zr(r){Vr(Hi,r),Gi||(Gi=!0,setTimeout(function(){Gi=!1,Wi(Hi,!(Hi={}))},0))}function Wi(r,s){s===void 0&&(s=!1);var u=new Set;if(r.all)for(var f=0,h=Object.values(nn);f<h.length;f++)mo(_=h[f],r,u,s);else for(var d in r){var _,w=/^idb\:\/\/(.*)\/(.*)\//.exec(d);w&&(d=w[1],w=w[2],(_=nn["idb://".concat(d,"/").concat(w)])&&mo(_,r,u,s))}u.forEach(function(b){return b()})}function mo(r,s,u,f){for(var h=[],d=0,_=Object.entries(r.queries.query);d<_.length;d++){for(var w=_[d],b=w[0],x=[],S=0,v=w[1];S<v.length;S++){var P=v[S];zi(s,P.obsSet)?P.subscribers.forEach(function(E){return u.add(E)}):f&&x.push(P)}f&&h.push([b,x])}if(f)for(var k=0,A=h;k<A.length;k++){var O=A[k],b=O[0],x=O[1];r.queries.query[b]=x}}function Ku(r){var s=r._state,u=r._deps.indexedDB;if(s.isBeingOpened||r.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?Re(s.dbOpenError):r});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var f=s.openCanceller,h=Math.round(10*r.verno),d=!1;function _(){if(s.openCanceller!==f)throw new ie.DatabaseClosed("db.open() was cancelled")}function w(){return new Q(function(P,k){if(_(),!u)throw new ie.MissingAPI;var A=r.name,O=s.autoSchema||!h?u.open(A):u.open(A,h);if(!O)throw new ie.MissingAPI;O.onerror=_t(k),O.onblocked=Pe(r._fireOnBlocked),O.onupgradeneeded=Pe(function(E){var C;S=O.transaction,s.autoSchema&&!r._options.allowEmptyDB?(O.onerror=rr,S.abort(),O.result.close(),(C=u.deleteDatabase(A)).onsuccess=C.onerror=Pe(function(){k(new ie.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(S.onerror=_t(k),E=E.oldVersion>Math.pow(2,62)?0:E.oldVersion,v=E<1,r.idbdb=O.result,d&&Mu(r,S),$u(r,E/10,S,k))},k),O.onsuccess=Pe(function(){S=null;var E,C,D,N,M,L=r.idbdb=O.result,H=K(L.objectStoreNames);if(0<H.length)try{var F=L.transaction((N=H).length===1?N[0]:N,"readonly");if(s.autoSchema)C=L,D=F,(E=r).verno=C.version/10,D=E._dbSchema=Fr(0,C,D),E._storeNames=K(C.objectStoreNames,0),Ir(E,[E._allTables],l(D),D);else if(Br(r,r._dbSchema,F),((M=Li(Fr(0,(M=r).idbdb,F),M._dbSchema)).add.length||M.change.some(function(q){return q.add.length||q.change.length}))&&!d)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),L.close(),h=L.version+1,d=!0,P(w());Kr(r,F)}catch{}kn.push(r),L.onversionchange=Pe(function(q){s.vcFired=!0,r.on("versionchange").fire(q)}),L.onclose=Pe(function(q){r.on("close").fire(q)}),v&&(M=r._deps,F=A,L=M.indexedDB,M=M.IDBKeyRange,qi(L)||F===Dr||Bi(L,M).put({name:F}).catch(Ae)),P()},k)}).catch(function(P){switch(P?.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),w();break;case"VersionError":if(0<h)return h=0,w()}return Q.reject(P)})}var b,x=s.dbReadyResolve,S=null,v=!1;return Q.race([f,(typeof navigator>"u"?Q.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function k(){return indexedDB.databases().finally(P)}b=setInterval(k,100),k()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(w)]).then(function(){return _(),s.onReadyBeingFired=[],Q.resolve(Ui(function(){return r.on.ready.fire(r.vip)})).then(function P(){if(0<s.onReadyBeingFired.length){var k=s.onReadyBeingFired.reduce(vi,Ae);return s.onReadyBeingFired=[],Q.resolve(Ui(function(){return k(r.vip)})).then(P)}})}).finally(function(){s.openCanceller===f&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(P){s.dbOpenError=P;try{S&&S.abort()}catch{}return f===s.openCanceller&&r._close(),Re(P)}).finally(function(){s.openComplete=!0,x()}).then(function(){var P;return v&&(P={},r.tables.forEach(function(k){k.schema.indexes.forEach(function(A){A.name&&(P["idb://".concat(r.name,"/").concat(k.name,"/").concat(A.name)]=new Ue(-1/0,[[[]]]))}),P["idb://".concat(r.name,"/").concat(k.name,"/")]=P["idb://".concat(r.name,"/").concat(k.name,"/:dels")]=new Ue(-1/0,[[[]]])}),It(ir).fire(P),Wi(P,!0)),r})}function Yi(r){function s(d){return r.next(d)}var u=h(s),f=h(function(d){return r.throw(d)});function h(d){return function(b){var w=d(b),b=w.value;return w.done?b:b&&typeof b.then=="function"?b.then(u,f):c(b)?Promise.all(b).then(u,f):u(b)}}return h(s)()}function Hr(r,s,u){for(var f=c(r)?r.slice():[r],h=0;h<u;++h)f.push(s);return f}var Iu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return i(i({},r),{table:function(s){var u=r.table(s),f=u.schema,h={},d=[];function _(v,P,k){var A=or(v),O=h[A]=h[A]||[],E=v==null?0:typeof v=="string"?1:v.length,C=0<P,C=i(i({},k),{name:C?"".concat(A,"(virtual-from:").concat(k.name,")"):k.name,lowLevelIndex:k,isVirtual:C,keyTail:P,keyLength:E,extractKey:Ki(v),unique:!C&&k.unique});return O.push(C),C.isPrimaryKey||d.push(C),1<E&&_(E===2?v[0]:v.slice(0,E-1),P+1,k),O.sort(function(D,N){return D.keyTail-N.keyTail}),C}s=_(f.primaryKey.keyPath,0,f.primaryKey),h[":id"]=[s];for(var w=0,b=f.indexes;w<b.length;w++){var x=b[w];_(x.keyPath,0,x)}function S(v){var P,k=v.query.index;return k.isVirtual?i(i({},v),{query:{index:k.lowLevelIndex,range:(P=v.query.range,k=k.keyTail,{type:P.type===1?2:P.type,lower:Hr(P.lower,P.lowerOpen?r.MAX_KEY:r.MIN_KEY,k),lowerOpen:!0,upper:Hr(P.upper,P.upperOpen?r.MIN_KEY:r.MAX_KEY,k),upperOpen:!0})}}):v}return i(i({},u),{schema:i(i({},f),{primaryKey:s,indexes:d,getIndexByKeyPath:function(v){return(v=h[or(v)])&&v[0]}}),count:function(v){return u.count(S(v))},query:function(v){return u.query(S(v))},openCursor:function(v){var P=v.query.index,k=P.keyTail,A=P.isVirtual,O=P.keyLength;return A?u.openCursor(S(v)).then(function(C){return C&&E(C)}):u.openCursor(v);function E(C){return Object.create(C,{continue:{value:function(D){D!=null?C.continue(Hr(D,v.reverse?r.MAX_KEY:r.MIN_KEY,k)):v.unique?C.continue(C.key.slice(0,O).concat(v.reverse?r.MIN_KEY:r.MAX_KEY,k)):C.continue()}},continuePrimaryKey:{value:function(D,N){C.continuePrimaryKey(Hr(D,r.MAX_KEY,k),N)}},primaryKey:{get:function(){return C.primaryKey}},key:{get:function(){var D=C.key;return O===1?D[0]:D.slice(0,O)}},value:{get:function(){return C.value}}})}}})}})}};function Qi(r,s,u,f){return u=u||{},f=f||"",l(r).forEach(function(h){var d,_,w;g(s,h)?(d=r[h],_=s[h],typeof d=="object"&&typeof _=="object"&&d&&_?(w=ke(d))!==ke(_)?u[f+h]=s[h]:w==="Object"?Qi(d,_,u,f+h+"."):d!==_&&(u[f+h]=s[h]):d!==_&&(u[f+h]=s[h])):u[f+h]=void 0}),l(s).forEach(function(h){g(r,h)||(u[f+h]=s[h])}),u}function Xi(r,s){return s.type==="delete"?s.keys:s.keys||s.values.map(r.extractKey)}var Lu={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return i(i({},r),{table:function(s){var u=r.table(s),f=u.schema.primaryKey;return i(i({},u),{mutate:function(h){var d=ne.trans,_=d.table(s).hook,w=_.deleting,b=_.creating,x=_.updating;switch(h.type){case"add":if(b.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"put":if(b.fire===Ae&&x.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"delete":if(w.fire===Ae)break;return d._promise("readwrite",function(){return S(h)},!0);case"deleteRange":if(w.fire===Ae)break;return d._promise("readwrite",function(){return function v(P,k,A){return u.query({trans:P,values:!1,query:{index:f,range:k},limit:A}).then(function(O){var E=O.result;return S({type:"delete",keys:E,trans:P}).then(function(C){return 0<C.numFailures?Promise.reject(C.failures[0]):E.length<A?{failures:[],numFailures:0,lastResult:void 0}:v(P,i(i({},k),{lower:E[E.length-1],lowerOpen:!0}),A)})})}(h.trans,h.range,1e4)},!0)}return u.mutate(h);function S(v){var P,k,A,O=ne.trans,E=v.keys||Xi(f,v);if(!E)throw new Error("Keys missing");return(v=v.type==="add"||v.type==="put"?i(i({},v),{keys:E}):i({},v)).type!=="delete"&&(v.values=o([],v.values)),v.keys&&(v.keys=o([],v.keys)),P=u,A=E,((k=v).type==="add"?Promise.resolve([]):P.getMany({trans:k.trans,keys:A,cache:"immutable"})).then(function(C){var D=E.map(function(N,M){var L,H,F,q=C[M],W={onerror:null,onsuccess:null};return v.type==="delete"?w.fire.call(W,N,q,O):v.type==="add"||q===void 0?(L=b.fire.call(W,N,v.values[M],O),N==null&&L!=null&&(v.keys[M]=N=L,f.outbound||fe(v.values[M],f.keyPath,N))):(L=Qi(q,v.values[M]),(H=x.fire.call(W,L,N,q,O))&&(F=v.values[M],Object.keys(H).forEach(function(z){g(F,z)?F[z]=H[z]:fe(F,z,H[z])}))),W});return u.mutate(v).then(function(N){for(var M=N.failures,L=N.results,H=N.numFailures,N=N.lastResult,F=0;F<E.length;++F){var q=(L||E)[F],W=D[F];q==null?W.onerror&&W.onerror(M[F]):W.onsuccess&&W.onsuccess(v.type==="put"&&C[F]?v.values[F]:q)}return{failures:M,results:L,numFailures:H,lastResult:N}}).catch(function(N){return D.forEach(function(M){return M.onerror&&M.onerror(N)}),Promise.reject(N)})})}}})}})}};function go(r,s,u){try{if(!s||s.keys.length<r.length)return null;for(var f=[],h=0,d=0;h<s.keys.length&&d<r.length;++h)ye(s.keys[h],r[d])===0&&(f.push(u?qe(s.values[h]):s.values[h]),++d);return f.length===r.length?f:null}catch{return null}}var Fu={stack:"dbcore",level:-1,create:function(r){return{table:function(s){var u=r.table(s);return i(i({},u),{getMany:function(f){if(!f.cache)return u.getMany(f);var h=go(f.keys,f.trans._cache,f.cache==="clone");return h?Q.resolve(h):u.getMany(f).then(function(d){return f.trans._cache={keys:f.keys,values:f.cache==="clone"?qe(d):d},d})},mutate:function(f){return f.type!=="add"&&(f.trans._cache=null),u.mutate(f)}})}}}};function wo(r,s){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function vo(r,s){switch(r){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Bu={stack:"dbcore",level:0,name:"Observability",create:function(r){var s=r.schema.name,u=new Ue(r.MIN_KEY,r.MAX_KEY);return i(i({},r),{transaction:function(f,h,d){if(ne.subscr&&h!=="readonly")throw new ie.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ne.querier));return r.transaction(f,h,d)},table:function(f){var h=r.table(f),d=h.schema,_=d.primaryKey,v=d.indexes,w=_.extractKey,b=_.outbound,x=_.autoIncrement&&v.filter(function(k){return k.compound&&k.keyPath.includes(_.keyPath)}),S=i(i({},h),{mutate:function(k){function A(z){return z="idb://".concat(s,"/").concat(f,"/").concat(z),N[z]||(N[z]=new Ue)}var O,E,C,D=k.trans,N=k.mutatedParts||(k.mutatedParts={}),M=A(""),L=A(":dels"),H=k.type,W=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[Xi(_,k).filter(function(z){return z}),k.values]:[],F=W[0],q=W[1],W=k.trans._cache;return c(F)?(M.addKeys(F),(W=H==="delete"||F.length===q.length?go(F,W):null)||L.addKeys(F),(W||q)&&(O=A,E=W,C=q,d.indexes.forEach(function(z){var Z=O(z.name||"");function ce(pe){return pe!=null?z.extractKey(pe):null}function de(pe){return z.multiEntry&&c(pe)?pe.forEach(function(tt){return Z.addKey(tt)}):Z.addKey(pe)}(E||C).forEach(function(pe,Ve){var ae=E&&ce(E[Ve]),Ve=C&&ce(C[Ve]);ye(ae,Ve)!==0&&(ae!=null&&de(ae),Ve!=null&&de(Ve))})}))):F?(q={from:(q=F.lower)!==null&&q!==void 0?q:r.MIN_KEY,to:(q=F.upper)!==null&&q!==void 0?q:r.MAX_KEY},L.add(q),M.add(q)):(M.add(u),L.add(u),d.indexes.forEach(function(z){return A(z.name).add(u)})),h.mutate(k).then(function(z){return!F||k.type!=="add"&&k.type!=="put"||(M.addKeys(z.results),x&&x.forEach(function(Z){for(var ce=k.values.map(function(ae){return Z.extractKey(ae)}),de=Z.keyPath.findIndex(function(ae){return ae===_.keyPath}),pe=0,tt=z.results.length;pe<tt;++pe)ce[pe][de]=z.results[pe];A(Z.name).addKeys(ce)})),D.mutatedParts=Vr(D.mutatedParts||{},N),z})}}),v=function(A){var O=A.query,A=O.index,O=O.range;return[A,new Ue((A=O.lower)!==null&&A!==void 0?A:r.MIN_KEY,(O=O.upper)!==null&&O!==void 0?O:r.MAX_KEY)]},P={get:function(k){return[_,new Ue(k.key)]},getMany:function(k){return[_,new Ue().addKeys(k.keys)]},count:v,query:v,openCursor:v};return l(P).forEach(function(k){S[k]=function(A){var O=ne.subscr,E=!!O,C=wo(ne,h)&&vo(k,A)?A.obsSet={}:O;if(E){var D=function(q){return q="idb://".concat(s,"/").concat(f,"/").concat(q),C[q]||(C[q]=new Ue)},N=D(""),M=D(":dels"),O=P[k](A),E=O[0],O=O[1];if((k==="query"&&E.isPrimaryKey&&!A.values?M:D(E.name||"")).add(O),!E.isPrimaryKey){if(k!=="count"){var L=k==="query"&&b&&A.values&&h.query(i(i({},A),{values:!1}));return h[k].apply(this,arguments).then(function(q){if(k==="query"){if(b&&A.values)return L.then(function(ce){return ce=ce.result,N.addKeys(ce),q});var W=A.values?q.result.map(w):q.result;(A.values?N:M).addKeys(W)}else if(k==="openCursor"){var z=q,Z=A.values;return z&&Object.create(z,{key:{get:function(){return M.addKey(z.primaryKey),z.key}},primaryKey:{get:function(){var ce=z.primaryKey;return M.addKey(ce),ce}},value:{get:function(){return Z&&N.addKey(z.primaryKey),z.value}}})}return q})}M.add(u)}}return h[k].apply(this,arguments)}}),S}})}};function bo(r,s,u){if(u.numFailures===0)return s;if(s.type==="deleteRange")return null;var f=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1;return u.numFailures===f?null:(s=i({},s),c(s.keys)&&(s.keys=s.keys.filter(function(h,d){return!(d in u.failures)})),"values"in s&&c(s.values)&&(s.values=s.values.filter(function(h,d){return!(d in u.failures)})),s)}function Ji(r,s){return u=r,((f=s).lower===void 0||(f.lowerOpen?0<ye(u,f.lower):0<=ye(u,f.lower)))&&(r=r,(s=s).upper===void 0||(s.upperOpen?ye(r,s.upper)<0:ye(r,s.upper)<=0));var u,f}function ko(r,s,P,f,h,d){if(!P||P.length===0)return r;var _=s.query.index,w=_.multiEntry,b=s.query.range,x=f.schema.primaryKey.extractKey,S=_.extractKey,v=(_.lowLevelIndex||_).extractKey,P=P.reduce(function(k,A){var O=k,E=[];if(A.type==="add"||A.type==="put")for(var C=new Ue,D=A.values.length-1;0<=D;--D){var N,M=A.values[D],L=x(M);C.hasKey(L)||(N=S(M),(w&&c(N)?N.some(function(z){return Ji(z,b)}):Ji(N,b))&&(C.addKey(L),E.push(M)))}switch(A.type){case"add":var H=new Ue().addKeys(s.values?k.map(function(Z){return x(Z)}):k),O=k.concat(s.values?E.filter(function(Z){return Z=x(Z),!H.hasKey(Z)&&(H.addKey(Z),!0)}):E.map(function(Z){return x(Z)}).filter(function(Z){return!H.hasKey(Z)&&(H.addKey(Z),!0)}));break;case"put":var F=new Ue().addKeys(A.values.map(function(Z){return x(Z)}));O=k.filter(function(Z){return!F.hasKey(s.values?x(Z):Z)}).concat(s.values?E:E.map(function(Z){return x(Z)}));break;case"delete":var q=new Ue().addKeys(A.keys);O=k.filter(function(Z){return!q.hasKey(s.values?x(Z):Z)});break;case"deleteRange":var W=A.range;O=k.filter(function(Z){return!Ji(x(Z),W)})}return O},r);return P===r?r:(P.sort(function(k,A){return ye(v(k),v(A))||ye(x(k),x(A))}),s.limit&&s.limit<1/0&&(P.length>s.limit?P.length=s.limit:r.length===s.limit&&P.length<s.limit&&(h.dirty=!0)),d?Object.freeze(P):P)}function xo(r,s){return ye(r.lower,s.lower)===0&&ye(r.upper,s.upper)===0&&!!r.lowerOpen==!!s.lowerOpen&&!!r.upperOpen==!!s.upperOpen}function qu(r,s){return function(u,f,h,d){if(u===void 0)return f!==void 0?-1:0;if(f===void 0)return 1;if((f=ye(u,f))===0){if(h&&d)return 0;if(h)return 1;if(d)return-1}return f}(r.lower,s.lower,r.lowerOpen,s.lowerOpen)<=0&&0<=function(u,f,h,d){if(u===void 0)return f!==void 0?1:0;if(f===void 0)return-1;if((f=ye(u,f))===0){if(h&&d)return 0;if(h)return-1;if(d)return 1}return f}(r.upper,s.upper,r.upperOpen,s.upperOpen)}function Uu(r,s,u,f){r.subscribers.add(u),f.addEventListener("abort",function(){var h,d;r.subscribers.delete(u),r.subscribers.size===0&&(h=r,d=s,setTimeout(function(){h.subscribers.size===0&&ut(d,h)},3e3))})}var Vu={stack:"dbcore",level:0,name:"Cache",create:function(r){var s=r.schema.name;return i(i({},r),{transaction:function(u,f,h){var d,_,w=r.transaction(u,f,h);return f==="readwrite"&&(_=(d=new AbortController).signal,h=function(b){return function(){if(d.abort(),f==="readwrite"){for(var x=new Set,S=0,v=u;S<v.length;S++){var P=v[S],k=nn["idb://".concat(s,"/").concat(P)];if(k){var A=r.table(P),O=k.optimisticOps.filter(function(Z){return Z.trans===w});if(w._explicit&&b&&w.mutatedParts)for(var E=0,C=Object.values(k.queries.query);E<C.length;E++)for(var D=0,N=(H=C[E]).slice();D<N.length;D++)zi((F=N[D]).obsSet,w.mutatedParts)&&(ut(H,F),F.subscribers.forEach(function(Z){return x.add(Z)}));else if(0<O.length){k.optimisticOps=k.optimisticOps.filter(function(Z){return Z.trans!==w});for(var M=0,L=Object.values(k.queries.query);M<L.length;M++)for(var H,F,q,W=0,z=(H=L[M]).slice();W<z.length;W++)(F=z[W]).res!=null&&w.mutatedParts&&(b&&!F.dirty?(q=Object.isFrozen(F.res),q=ko(F.res,F.req,O,A,F,q),F.dirty?(ut(H,F),F.subscribers.forEach(function(Z){return x.add(Z)})):q!==F.res&&(F.res=q,F.promise=Q.resolve({result:q}))):(F.dirty&&ut(H,F),F.subscribers.forEach(function(Z){return x.add(Z)})))}}}x.forEach(function(Z){return Z()})}}},w.addEventListener("abort",h(!1),{signal:_}),w.addEventListener("error",h(!1),{signal:_}),w.addEventListener("complete",h(!0),{signal:_})),w},table:function(u){var f=r.table(u),h=f.schema.primaryKey;return i(i({},f),{mutate:function(d){var _=ne.trans;if(h.outbound||_.db._options.cache==="disabled"||_.explicit||_.idbtrans.mode!=="readwrite")return f.mutate(d);var w=nn["idb://".concat(s,"/").concat(u)];return w?(_=f.mutate(d),d.type!=="add"&&d.type!=="put"||!(50<=d.values.length||Xi(h,d).some(function(b){return b==null}))?(w.optimisticOps.push(d),d.mutatedParts&&zr(d.mutatedParts),_.then(function(b){0<b.numFailures&&(ut(w.optimisticOps,d),(b=bo(0,d,b))&&w.optimisticOps.push(b),d.mutatedParts&&zr(d.mutatedParts))}),_.catch(function(){ut(w.optimisticOps,d),d.mutatedParts&&zr(d.mutatedParts)})):_.then(function(b){var x=bo(0,i(i({},d),{values:d.values.map(function(S,v){var P;return b.failures[v]?S:(S=(P=h.keyPath)!==null&&P!==void 0&&P.includes(".")?qe(S):i({},S),fe(S,h.keyPath,b.results[v]),S)})}),b);w.optimisticOps.push(x),queueMicrotask(function(){return d.mutatedParts&&zr(d.mutatedParts)})}),_):f.mutate(d)},query:function(d){if(!wo(ne,f)||!vo("query",d))return f.query(d);var _=((x=ne.trans)===null||x===void 0?void 0:x.db._options.cache)==="immutable",v=ne,w=v.requery,b=v.signal,x=function(A,O,E,C){var D=nn["idb://".concat(A,"/").concat(O)];if(!D)return[];if(!(O=D.queries[E]))return[null,!1,D,null];var N=O[(C.query?C.query.index.name:null)||""];if(!N)return[null,!1,D,null];switch(E){case"query":var M=N.find(function(L){return L.req.limit===C.limit&&L.req.values===C.values&&xo(L.req.query.range,C.query.range)});return M?[M,!0,D,N]:[N.find(function(L){return("limit"in L.req?L.req.limit:1/0)>=C.limit&&(!C.values||L.req.values)&&qu(L.req.query.range,C.query.range)}),!1,D,N];case"count":return M=N.find(function(L){return xo(L.req.query.range,C.query.range)}),[M,!!M,D,N]}}(s,u,"query",d),S=x[0],v=x[1],P=x[2],k=x[3];return S&&v?S.obsSet=d.obsSet:(v=f.query(d).then(function(A){var O=A.result;if(S&&(S.res=O),_){for(var E=0,C=O.length;E<C;++E)Object.freeze(O[E]);Object.freeze(O)}else A.result=qe(O);return A}).catch(function(A){return k&&S&&ut(k,S),Promise.reject(A)}),S={obsSet:d.obsSet,promise:v,subscribers:new Set,type:"query",req:d,dirty:!1},k?k.push(S):(k=[S],(P=P||(nn["idb://".concat(s,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[d.query.index.name||""]=k)),Uu(S,k,w,b),S.promise.then(function(A){return{result:ko(A.result,d,P?.optimisticOps,f,S,_)}})}})}})}};function Gr(r,s){return new Proxy(r,{get:function(u,f,h){return f==="db"?s:Reflect.get(u,f,h)}})}var St=(Te.prototype.version=function(r){if(isNaN(r)||r<.1)throw new ie.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new ie.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var s=this._versions,u=s.filter(function(f){return f._cfg.version===r})[0];return u||(u=new this.Version(r),s.push(u),s.sort(Nu),u.stores({}),this._state.autoSchema=!1,u)},Te.prototype._whenReady=function(r){var s=this;return this.idbdb&&(this._state.openComplete||ne.letThrough||this._vip)?r():new Q(function(u,f){if(s._state.openComplete)return f(new ie.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void f(new ie.DatabaseClosed);s.open().catch(Ae)}s._state.dbReadyPromise.then(u,f)}).then(r)},Te.prototype.use=function(r){var s=r.stack,u=r.create,f=r.level,h=r.name;return h&&this.unuse({stack:s,name:h}),r=this._middlewares[s]||(this._middlewares[s]=[]),r.push({stack:s,create:u,level:f??10,name:h}),r.sort(function(d,_){return d.level-_.level}),this},Te.prototype.unuse=function(r){var s=r.stack,u=r.name,f=r.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(h){return f?h.create!==f:!!u&&h.name!==u})),this},Te.prototype.open=function(){var r=this;return Zt(Nt,function(){return Ku(r)})},Te.prototype._close=function(){var r=this._state,s=kn.indexOf(this);if(0<=s&&kn.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Q(function(u){r.dbReadyResolve=u}),r.openCanceller=new Q(function(u,f){r.cancelOpen=f}))},Te.prototype.close=function(u){var s=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;s?(u.isBeingOpened&&u.cancelOpen(new ie.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new ie.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Te.prototype.delete=function(r){var s=this;r===void 0&&(r={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",f=this._state;return new Q(function(h,d){function _(){s.close(r);var w=s._deps.indexedDB.deleteDatabase(s.name);w.onsuccess=Pe(function(){var b,x,S;b=s._deps,x=s.name,S=b.indexedDB,b=b.IDBKeyRange,qi(S)||x===Dr||Bi(S,b).delete(x).catch(Ae),h()}),w.onerror=_t(d),w.onblocked=s._fireOnBlocked}if(u)throw new ie.InvalidArgument("Invalid closeOptions argument to db.delete()");f.isBeingOpened?f.dbReadyPromise.then(_):_()})},Te.prototype.backendDB=function(){return this.idbdb},Te.prototype.isOpen=function(){return this.idbdb!==null},Te.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Te.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Te.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Te.prototype,"tables",{get:function(){var r=this;return l(this._allTables).map(function(s){return r._allTables[s]})},enumerable:!1,configurable:!0}),Te.prototype.transaction=function(){var r=function(s,u,f){var h=arguments.length;if(h<2)throw new ie.InvalidArgument("Too few arguments");for(var d=new Array(h-1);--h;)d[h-1]=arguments[h];return f=d.pop(),[s,ve(d),f]}.apply(this,arguments);return this._transaction.apply(this,r)},Te.prototype._transaction=function(r,s,u){var f=this,h=ne.trans;h&&h.db===this&&r.indexOf("!")===-1||(h=null);var d,_,w=r.indexOf("?")!==-1;r=r.replace("!","").replace("?","");try{if(_=s.map(function(x){if(x=x instanceof f.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),r=="r"||r===Ci)d=Ci;else{if(r!="rw"&&r!=Ri)throw new ie.InvalidArgument("Invalid transaction mode: "+r);d=Ri}if(h){if(h.mode===Ci&&d===Ri){if(!w)throw new ie.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&_.forEach(function(x){if(h&&h.storeNames.indexOf(x)===-1){if(!w)throw new ie.SubTransaction("Table "+x+" not included in parent transaction.");h=null}}),w&&h&&!h.active&&(h=null)}}catch(x){return h?h._promise(null,function(S,v){v(x)}):Re(x)}var b=function x(S,v,P,k,A){return Q.resolve().then(function(){var O=ne.transless||ne,E=S._createTransaction(v,P,S._dbSchema,k);if(E.explicit=!0,O={trans:E,transless:O},k)E.idbtrans=k.idbtrans;else try{E.create(),E.idbtrans._explicit=!0,S._state.PR1398_maxLoop=3}catch(N){return N.name===wi.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,v,P,null,A)})):Re(N)}var C,D=xt(A);return D&&bn(),O=Q.follow(function(){var N;(C=A.call(E,E))&&(D?(N=Mt.bind(null,null),C.then(N,N)):typeof C.next=="function"&&typeof C.throw=="function"&&(C=Yi(C)))},O),(C&&typeof C.then=="function"?Q.resolve(C).then(function(N){return E.active?N:Re(new ie.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):O.then(function(){return C})).then(function(N){return k&&E._resolve(),E._completion.then(function(){return N})}).catch(function(N){return E._reject(N),Re(N)})})}.bind(null,this,d,_,h,u);return h?h._promise(d,b,"lock"):ne.trans?Zt(ne.transless,function(){return f._whenReady(b)}):this._whenReady(b)},Te.prototype.table=function(r){if(!g(this._allTables,r))throw new ie.InvalidTable("Table ".concat(r," does not exist"));return this._allTables[r]},Te);function Te(r,s){var u=this;this._middlewares={},this.verno=0;var f=Te.dependencies;this._options=s=i({addons:Te.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},f=s.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,d,_,w,b,x={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ae,dbReadyPromise:null,cancelOpen:Ae,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};x.dbReadyPromise=new Q(function(v){x.dbReadyResolve=v}),x.openCanceller=new Q(function(v,P){x.cancelOpen=P}),this._state=x,this.name=r,this.on=er(this,"populate","blocked","versionchange","close",{ready:[vi,Ae]}),this.on.ready.subscribe=B(this.on.ready.subscribe,function(v){return function(P,k){Te.vip(function(){var A,O=u._state;O.openComplete?(O.dbOpenError||Q.resolve().then(P),k&&v(P)):O.onReadyBeingFired?(O.onReadyBeingFired.push(P),k&&v(P)):(v(P),A=u,k||v(function E(){A.on.ready.unsubscribe(P),A.on.ready.unsubscribe(E)}))})}}),this.Collection=(h=this,tr(Su.prototype,function(C,E){this.db=h;var k=Zs,A=null;if(E)try{k=E()}catch(D){A=D}var O=C._ctx,E=O.table,C=E.hook.reading.fire;this._ctx={table:E,index:O.index,isPrimKey:!O.index||E.schema.primKey.keyPath&&O.index===E.schema.primKey.name,range:k,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:O.or,valueMapper:C!==Yn?C:null}})),this.Table=(d=this,tr(ro.prototype,function(v,P,k){this.db=d,this._tx=k,this.name=v,this.schema=P,this.hook=d._allTables[v]?d._allTables[v].hook:er(null,{creating:[mu,Ae],reading:[_u,Yn],updating:[wu,Ae],deleting:[gu,Ae]})})),this.Transaction=(_=this,tr(Cu.prototype,function(v,P,k,A,O){var E=this;this.db=_,this.mode=v,this.storeNames=P,this.schema=k,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=er(this,"complete","error","abort"),this.parent=O||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Q(function(C,D){E._resolve=C,E._reject=D}),this._completion.then(function(){E.active=!1,E.on.complete.fire()},function(C){var D=E.active;return E.active=!1,E.on.error.fire(C),E.parent?E.parent._reject(C):D&&E.idbtrans&&E.idbtrans.abort(),Re(C)})})),this.Version=(w=this,tr(ju.prototype,function(v){this.db=w,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,tr(uo.prototype,function(v,P,k){if(this.db=b,this._ctx={table:v,index:P===":id"?null:P,or:k},this._cmp=this._ascending=ye,this._descending=function(A,O){return ye(O,A)},this._max=function(A,O){return 0<ye(A,O)?A:O},this._min=function(A,O){return ye(A,O)<0?A:O},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new ie.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=sr(s.IDBKeyRange),this._createTransaction=function(v,P,k,A){return new u.Transaction(v,P,k,u._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(v){u.on("blocked").fire(v),kn.filter(function(P){return P.name===u.name&&P!==u&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(v)})},this.use(Fu),this.use(Vu),this.use(Bu),this.use(Iu),this.use(Lu);var S=new Proxy(this,{get:function(v,P,k){if(P==="_vip")return!0;if(P==="table")return function(O){return Gr(u.table(O),S)};var A=Reflect.get(v,P,k);return A instanceof ro?Gr(A,S):P==="tables"?A.map(function(O){return Gr(O,S)}):P==="_createTransaction"?function(){return Gr(A.apply(this,arguments),S)}:A}});this.vip=S,f.forEach(function(v){return v(u)})}var Wr,it=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",zu=(Zi.prototype.subscribe=function(r,s,u){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:s,complete:u})},Zi.prototype[it]=function(){return this},Zi);function Zi(r){this._subscribe=r}try{Wr={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{Wr={indexedDB:null,IDBKeyRange:null}}function Eo(r){var s,u=!1,f=new zu(function(h){var d=xt(r),_,w=!1,b={},x={},S={get closed(){return w},unsubscribe:function(){w||(w=!0,_&&_.abort(),v&&It.storagemutated.unsubscribe(k))}};h.start&&h.start(S);var v=!1,P=function(){return Pi(A)},k=function(O){Vr(b,O),zi(x,b)&&P()},A=function(){var O,E,C;!w&&Wr.indexedDB&&(b={},O={},_&&_.abort(),_=new AbortController,C=function(D){var N=wn();try{d&&bn();var M=$t(r,D);return M=d?M.finally(Mt):M}finally{N&&vn()}}(E={subscr:O,signal:_.signal,requery:P,querier:r,trans:null}),Promise.resolve(C).then(function(D){u=!0,s=D,w||E.signal.aborted||(b={},function(N){for(var M in N)if(g(N,M))return;return 1}(x=O)||v||(It(ir,k),v=!0),Pi(function(){return!w&&h.next&&h.next(D)}))},function(D){u=!1,["DatabaseClosedError","AbortError"].includes(D?.name)||w||Pi(function(){w||h.error&&h.error(D)})}))};return setTimeout(P,0),S});return f.hasValue=function(){return u},f.getValue=function(){return s},f}var rn=St;function es(r){var s=Lt;try{Lt=!0,It.storagemutated.fire(r),Wi(r,!0)}finally{Lt=s}}R(rn,i(i({},xr),{delete:function(r){return new rn(r,{addons:[]}).delete()},exists:function(r){return new rn(r,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return s=rn.dependencies,u=s.indexedDB,s=s.IDBKeyRange,(qi(u)?Promise.resolve(u.databases()).then(function(f){return f.map(function(h){return h.name}).filter(function(h){return h!==Dr})}):Bi(u,s).toCollection().primaryKeys()).then(r)}catch{return Re(new ie.MissingAPI)}var s,u},defineClass:function(){return function(r){p(this,r)}},ignoreTransaction:function(r){return ne.trans?Zt(ne.transless,r):r()},vip:Ui,async:function(r){return function(){try{var s=Yi(r.apply(this,arguments));return s&&typeof s.then=="function"?s:Q.resolve(s)}catch(u){return Re(u)}}},spawn:function(r,s,u){try{var f=Yi(r.apply(u,s||[]));return f&&typeof f.then=="function"?f:Q.resolve(f)}catch(h){return Re(h)}},currentTransaction:{get:function(){return ne.trans||null}},waitFor:function(r,s){return s=Q.resolve(typeof r=="function"?rn.ignoreTransaction(r):r).timeout(s||6e4),ne.trans?ne.trans.waitFor(s):s},Promise:Q,debug:{get:function(){return yt},set:function(r){Hs(r)}},derive:T,extend:p,props:R,override:B,Events:er,on:It,liveQuery:Eo,extendObservabilitySet:Vr,getByKeyPath:re,setByKeyPath:fe,delByKeyPath:function(r,s){typeof s=="string"?fe(r,s,void 0):"length"in s&&[].map.call(s,function(u){fe(r,u,void 0)})},shallowClone:Me,deepClone:qe,getObjectDiff:Qi,cmp:ye,asap:J,minKey:-1/0,addons:[],connections:kn,errnames:wi,dependencies:Wr,cache:nn,semVer:"4.0.11",version:"4.0.11".split(".").map(function(r){return parseInt(r)}).reduce(function(r,s,u){return r+s/Math.pow(10,2*u)})})),rn.maxKey=sr(rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(It(ir,function(r){Lt||(r=new CustomEvent($i,{detail:r}),Lt=!0,dispatchEvent(r),Lt=!1)}),addEventListener($i,function(r){r=r.detail,Lt||es(r)}));var An,Lt=!1,Ao=function(){};return typeof BroadcastChannel<"u"&&((Ao=function(){(An=new BroadcastChannel($i)).onmessage=function(r){return r.data&&es(r.data)}})(),typeof An.unref=="function"&&An.unref(),It(ir,function(r){Lt||An.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!St.disableBfCache&&r.persisted){yt&&console.debug("Dexie: handling persisted pagehide"),An?.close();for(var s=0,u=kn;s<u.length;s++)u[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!St.disableBfCache&&r.persisted&&(yt&&console.debug("Dexie: handling persisted pageshow"),Ao(),es({all:new Ue(-1/0,[[]])}))})),Q.rejectionMapper=function(r,s){return!r||r instanceof Et||r instanceof TypeError||r instanceof SyntaxError||!r.name||!zs[r.name]?r:(s=new zs[r.name](s||r.message,r),"stack"in r&&U(s,"stack",{get:function(){return this.inner.stack}}),s)},Hs(yt),i(St,Object.freeze({__proto__:null,Dexie:St,liveQuery:Eo,Entity:eo,cmp:ye,PropModification:nr,replacePrefix:function(r,s){return new nr({replacePrefix:[r,s]})},add:function(r){return new nr({add:r})},remove:function(r){return new nr({remove:r})},default:St,RangeSet:Ue,mergeRanges:ur,rangesOverlap:po}),{default:St}),St})}(Zr)),Zr.exports}var kl=bl();const bs=wl(kl),qo=Symbol.for("Dexie"),si=globalThis[qo]||(globalThis[qo]=bs);if(bs.semVer!==si.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${bs.semVer} and ${si.semVer}`);const{liveQuery:dd,mergeRanges:pd,rangesOverlap:yd,RangeSet:_d,cmp:md,Entity:Gt,PropModification:gd,replacePrefix:wd,add:vd,remove:bd}=si,oi=["a","b","c","d","e","f","g","h"],Ma=["1","2","3","4","5","6","7","8"],dn=["white","black"],ct=["pawn","knight","bishop","rook","queen","king"],xl=["a","h"],yr=t=>"role"in t,oe=t=>t!==void 0,Ie=t=>t==="white"?"black":"white",pn=t=>t>>3,Ye=t=>t&7,ks=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,fn=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Kn(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function In(t){if(t.length===2)return ks(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const Ln=t=>oi[Ye(t)]+Ma[pn(t)],kd=t=>{if(t[1]==="@"&&t.length===4){const e=Kn(t[0]),n=In(t.slice(2));if(e&&oe(n))return{role:e,to:n}}else if(t.length===4||t.length===5){const e=In(t.slice(0,2)),n=In(t.slice(2,4));let i;if(t.length===5&&(i=Kn(t[4]),!i))return;if(oe(e)&&oe(n))return{from:e,to:n,promotion:i}}},ja=t=>yr(t)?`${fn(t.role).toUpperCase()}@${Ln(t.to)}`:Ln(t.from)+Ln(t.to)+(t.promotion?fn(t.promotion):""),Ks=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,Is=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Uo=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),xs=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),Vo=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,xs(t));class j{constructor(e,n){this.lo=e|0,this.hi=n|0}static fromSquare(e){return e>=32?new j(0,1<<e-32):new j(1<<e,0)}static fromRank(e){return new j(255,0).shl64(8*e)}static fromFile(e){return new j(16843009<<e,16843009<<e)}static empty(){return new j(0,0)}static full(){return new j(4294967295,4294967295)}static corners(){return new j(129,2164260864)}static center(){return new j(402653184,24)}static backranks(){return new j(255,4278190080)}static backrank(e){return e==="white"?new j(255,0):new j(0,4278190080)}static lightSquares(){return new j(1437226410,1437226410)}static darkSquares(){return new j(2857740885,2857740885)}complement(){return new j(~this.lo,~this.hi)}xor(e){return new j(this.lo^e.lo,this.hi^e.hi)}union(e){return new j(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new j(this.lo&e.lo,this.hi&e.hi)}diff(e){return new j(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?j.empty():e>=32?new j(this.hi>>>e-32,0):e>0?new j(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?j.empty():e>=32?new j(0,this.lo<<e-32):e>0?new j(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new j(xs(this.hi),xs(this.lo))}rbit64(){return new j(Vo(this.hi),Vo(this.lo))}minus64(e){const n=this.lo-e.lo,i=(n&e.lo&1)+(e.lo>>>1)+(n>>>1)>>>31;return new j(n,this.hi-(e.hi+i))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Uo(this.lo)+Uo(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,n){return n?this.with(e):this.without(e)}with(e){return e>=32?new j(this.lo,this.hi|1<<e-32):new j(this.lo|1<<e,this.hi)}without(e){return e>=32?new j(this.lo,this.hi&~(1<<e-32)):new j(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new j(this.lo,this.hi^1<<e-32):new j(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new j(this.lo&this.lo-1,this.hi):new j(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,n=this.hi;for(;e!==0;){const i=31-Math.clz32(e&-e);e^=1<<i,yield i}for(;n!==0;){const i=31-Math.clz32(n&-n);n^=1<<i,yield 32+i}}*reversed(){let e=this.lo,n=this.hi;for(;n!==0;){const i=31-Math.clz32(n);n^=1<<i,yield 32+i}for(;e!==0;){const i=31-Math.clz32(e);e^=1<<i,yield i}}}const ai=(t,e)=>{let n=j.empty();for(const i of e){const o=t+i;0<=o&&o<64&&Math.abs(Ye(t)-Ye(o))<=2&&(n=n.with(o))}return n},Ut=t=>{const e=[];for(let n=0;n<64;n++)e[n]=t(n);return e},El=Ut(t=>ai(t,[-9,-8,-7,-1,1,7,8,9])),Al=Ut(t=>ai(t,[-17,-15,-10,-6,6,10,15,17])),Sl={white:Ut(t=>ai(t,[7,9])),black:Ut(t=>ai(t,[-7,-9]))},pi=t=>El[t],yi=t=>Al[t],vr=(t,e)=>Sl[t][e],Es=Ut(t=>j.fromFile(Ye(t)).without(t)),As=Ut(t=>j.fromRank(pn(t)).without(t)),Ss=Ut(t=>{const e=new j(134480385,2151686160),n=8*(pn(t)-Ye(t));return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),Os=Ut(t=>{const e=new j(270549120,16909320),n=8*(pn(t)+Ye(t)-7);return(n>=0?e.shl64(n):e.shr64(-n)).without(t)}),Ps=(t,e,n)=>{let i=n.intersect(e),o=i.bswap64();return i=i.minus64(t),o=o.minus64(t.bswap64()),i.xor(o.bswap64()).intersect(e)},Ol=(t,e)=>Ps(j.fromSquare(t),Es[t],e),Pl=(t,e)=>{const n=As[t];let i=e.intersect(n),o=i.rbit64();return i=i.minus64(j.fromSquare(t)),o=o.minus64(j.fromSquare(63-t)),i.xor(o.rbit64()).intersect(n)},Un=(t,e)=>{const n=j.fromSquare(t);return Ps(n,Ss[t],e).xor(Ps(n,Os[t],e))},Vn=(t,e)=>Ol(t,e).xor(Pl(t,e)),Ls=(t,e)=>Un(t,e).xor(Vn(t,e)),Ka=(t,e,n)=>{switch(t.role){case"pawn":return vr(t.color,e);case"knight":return yi(e);case"bishop":return Un(e,n);case"rook":return Vn(e,n);case"queen":return Ls(e,n);case"king":return pi(e)}},Ia=(t,e)=>{const n=j.fromSquare(e);return As[t].intersects(n)?As[t].with(t):Os[t].intersects(n)?Os[t].with(t):Ss[t].intersects(n)?Ss[t].with(t):Es[t].intersects(n)?Es[t].with(t):j.empty()},_r=(t,e)=>Ia(t,e).intersect(j.full().shl64(t).xor(j.full().shl64(e))).withoutFirst();class Fn{constructor(){}static default(){const e=new Fn;return e.reset(),e}reset(){this.occupied=new j(65535,4294901760),this.promoted=j.empty(),this.white=new j(65535,0),this.black=new j(0,4294901760),this.pawn=new j(65280,16711680),this.knight=new j(66,1107296256),this.bishop=new j(36,603979776),this.rook=new j(129,2164260864),this.queen=new j(8,134217728),this.king=new j(16,268435456)}static empty(){const e=new Fn;return e.clear(),e}clear(){this.occupied=j.empty(),this.promoted=j.empty();for(const e of dn)this[e]=j.empty();for(const e of ct)this[e]=j.empty()}clone(){const e=new Fn;e.occupied=this.occupied,e.promoted=this.promoted;for(const n of dn)e[n]=this[n];for(const n of ct)e[n]=this[n];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const n of ct)if(this[n].has(e))return n}get(e){const n=this.getColor(e);if(!n)return;const i=this.getRole(e),o=this.promoted.has(e);return{color:n,role:i,promoted:o}}take(e){const n=this.get(e);return n&&(this.occupied=this.occupied.without(e),this[n.color]=this[n.color].without(e),this[n.role]=this[n.role].without(e),n.promoted&&(this.promoted=this.promoted.without(e))),n}set(e,n){const i=this.take(e);return this.occupied=this.occupied.with(e),this[n.color]=this[n.color].with(e),this[n.role]=this[n.role].with(e),n.promoted&&(this.promoted=this.promoted.with(e)),i}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,n){return this[e].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class gt{constructor(){}static empty(){const e=new gt;for(const n of ct)e[n]=0;return e}static fromBoard(e,n){const i=new gt;for(const o of ct)i[o]=e.pieces(n,o).size();return i}clone(){const e=new gt;for(const n of ct)e[n]=this[n];return e}equals(e){return ct.every(n=>this[n]===e[n])}add(e){const n=new gt;for(const i of ct)n[i]=this[i]+e[i];return n}subtract(e){const n=new gt;for(const i of ct)n[i]=this[i]-e[i];return n}nonEmpty(){return ct.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class an{constructor(e,n){this.white=e,this.black=n}static empty(){return new an(gt.empty(),gt.empty())}static fromBoard(e){return new an(gt.fromBoard(e,"white"),gt.fromBoard(e,"black"))}clone(){return new an(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new an(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new an(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class mr{constructor(e,n){this.white=e,this.black=n}static default(){return new mr(3,3)}clone(){return new mr(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}class La{unwrap(e,n){const i=this._chain(o=>le.ok(e?e(o):o),o=>n?le.ok(n(o)):le.err(o));if(i.isErr)throw i.error;return i.value}map(e,n){return this._chain(i=>le.ok(e(i)),i=>le.err(n?n(i):i))}chain(e,n){return this._chain(e,n||(i=>le.err(i)))}}class Cl extends La{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,n){return e(this.value)}}class Rl extends La{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,n){return n(this.error)}}var le;(function(t){t.ok=function(e){return new Cl(e)},t.err=function(e){return new Rl(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let a=0;a<e.length;a++){const l=e[a];if(l.isErr)return l;o.push(l.value)}return t.ok(o)}const n={},i=Object.keys(e);for(let o=0;o<i.length;o++){const a=e[i[o]];if(a.isErr)return a;n[i[o]]=a.value}return t.ok(n)}})(le||(le={}));var Ft;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(Ft||(Ft={}));class On extends Error{}const Tl=(t,e,n,i)=>n[e].intersect(Vn(t,i).intersect(n.rooksAndQueens()).union(Un(t,i).intersect(n.bishopsAndQueens())).union(yi(t).intersect(n.knight)).union(pi(t).intersect(n.king)).union(vr(Ie(e),t).intersect(n.pawn)));class un{constructor(){}static default(){const e=new un;return e.castlingRights=j.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new j(14,0),h:new j(96,0)},black:{a:new j(0,234881024),h:new j(0,1610612736)}},e}static empty(){const e=new un;return e.castlingRights=j.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:j.empty(),h:j.empty()},black:{a:j.empty(),h:j.empty()}},e}clone(){const e=new un;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,n,i,o){const a=Ks(e,n),l=Is(e,n);this.castlingRights=this.castlingRights.with(o),this.rook[e][n]=o,this.path[e][n]=_r(o,l).with(l).union(_r(i,a).with(a)).without(i).without(o)}static fromSetup(e){const n=un.empty(),i=e.castlingRights.intersect(e.board.rook);for(const o of dn){const a=j.backrank(o),l=e.board.kingOf(o);if(!oe(l)||!a.has(l))continue;const c=i.intersect(e.board[o]).intersect(a),p=c.first();oe(p)&&p<l&&n.add(o,"a",l,p);const y=c.last();oe(y)&&l<y&&n.add(o,"h",l,y)}return n}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const n of dn)for(const i of xl)this.rook[n][i]===e&&(this.rook[n][i]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(j.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class Dl{constructor(e){this.rules=e}reset(){this.board=Fn.default(),this.pockets=void 0,this.turn="white",this.castles=un.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=j.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=un.fromSetup(e),this.epSquare=$l(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,n,i){return Tl(e,n,this.board,i)}playCaptureAt(e,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[Ie(n.color)][n.promoted?"pawn":n.role]++}ctx(){const e=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!oe(n))return{king:n,blockers:j.empty(),checkers:j.empty(),variantEnd:e,mustCapture:!1};const i=Vn(n,j.empty()).intersect(this.board.rooksAndQueens()).union(Un(n,j.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[Ie(this.turn)]);let o=j.empty();for(const l of i){const c=_r(n,l).intersect(this.board.occupied);c.moreThanOne()||(o=o.union(c))}const a=this.kingAttackers(n,Ie(this.turn),this.board.occupied);return{king:n,blockers:o,checkers:a,variantEnd:e,mustCapture:!1}}clone(){var e,n;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return le.err(new On(Ft.Empty));if(this.board.king.size()!==2)return le.err(new On(Ft.Kings));if(!oe(this.board.kingOf(this.turn)))return le.err(new On(Ft.Kings));const e=this.board.kingOf(Ie(this.turn));return oe(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?le.err(new On(Ft.OppositeCheck)):j.backranks().intersects(this.board.pawn)?le.err(new On(Ft.PawnsOnBackrank)):le.ok(void 0):le.err(new On(Ft.Kings))}dropDests(e){return j.empty()}dests(e,n){if(n=n||this.ctx(),n.variantEnd)return j.empty();const i=this.board.get(e);if(!i||i.color!==this.turn)return j.empty();let o,a;if(i.role==="pawn"){o=vr(this.turn,e).intersect(this.board[Ie(this.turn)]);const l=this.turn==="white"?8:-8,c=e+l;if(0<=c&&c<64&&!this.board.occupied.has(c)){o=o.with(c);const p=this.turn==="white"?e<16:e>=48,y=c+l;p&&!this.board.occupied.has(y)&&(o=o.with(y))}oe(this.epSquare)&&jl(this,e,n)&&(a=j.fromSquare(this.epSquare))}else i.role==="bishop"?o=Un(e,this.board.occupied):i.role==="knight"?o=yi(e):i.role==="rook"?o=Vn(e,this.board.occupied):i.role==="queen"?o=Ls(e,this.board.occupied):o=pi(e);if(o=o.diff(this.board[this.turn]),oe(n.king)){if(i.role==="king"){const l=this.board.occupied.without(e);for(const c of o)this.kingAttackers(c,Ie(this.turn),l).nonEmpty()&&(o=o.without(c));return o.union(ui(this,"a",n)).union(ui(this,"h",n))}if(n.checkers.nonEmpty()){const l=n.checkers.singleSquare();if(!oe(l))return j.empty();o=o.intersect(_r(l,n.king).with(l))}n.blockers.has(e)&&(o=o.intersect(Ia(e,n.king)))}return a&&(o=o.union(a)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[Ie(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(j.darkSquares())||!this.board.bishop.intersects(j.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,n;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Ml(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return dn.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,n){if(yr(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&j.backranks().has(e.to)?!1:this.dropDests(n).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&j.backranks().has(e.to)))return!1;const i=this.dests(e.from,n);return i.has(e.to)||i.has(Kl(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return oe(e)&&this.kingAttackers(e,Ie(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const n=this.variantOutcome(e);return n||(e=e||this.ctx(),this.isCheckmate(e)?{winner:Ie(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const n=new Map;if(e.variantEnd)return n;for(const i of this.board[this.turn])n.set(i,this.dests(i,e));return n}play(e){const n=this.turn,i=this.epSquare,o=Fa(this,e);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=Ie(n),yr(e))this.board.set(e.to,{role:e.role,color:n}),this.pockets&&this.pockets[n][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const a=this.board.take(e.from);if(!a)return;let l;if(a.role==="pawn"){this.halfmoves=0,e.to===i&&(l=this.board.take(e.to+(n==="white"?-8:8)));const c=e.from-e.to;Math.abs(c)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!!this.pockets)}else if(a.role==="rook")this.castles.discardRook(e.from);else if(a.role==="king"){if(o){const c=this.castles.rook[n][o];if(oe(c)){const p=this.board.take(c);this.board.set(Ks(n,o),a),p&&this.board.set(Is(n,o),p)}}this.castles.discardColor(n)}if(!o){const c=this.board.set(e.to,a)||l;c&&this.playCaptureAt(e.to,c)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Nl extends Dl{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const n=new this;return n.setupUnchecked(e),n.validate().map(i=>n)}clone(){return super.clone()}}const $l=(t,e)=>{if(!oe(e))return;const n=t.turn==="white"?5:2,i=t.turn==="white"?8:-8;if(pn(e)!==n||t.board.occupied.has(e+i))return;const o=e-i;if(!(!t.board.pawn.has(o)||!t.board[Ie(t.turn)].has(o)))return e},Ml=t=>{if(!oe(t.epSquare))return;const e=t.ctx(),i=t.board.pieces(t.turn,"pawn").intersect(vr(Ie(t.turn),t.epSquare));for(const o of i)if(t.dests(o,e).has(t.epSquare))return t.epSquare},jl=(t,e,n)=>{if(!oe(t.epSquare)||!vr(t.turn,e).has(t.epSquare))return!1;if(!oe(n.king))return!0;const i=t.turn==="white"?8:-8,o=t.epSquare-i;return t.kingAttackers(n.king,Ie(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},ui=(t,e,n)=>{if(!oe(n.king)||n.checkers.nonEmpty())return j.empty();const i=t.castles.rook[t.turn][e];if(!oe(i)||t.castles.path[t.turn][e].intersects(t.board.occupied))return j.empty();const o=Ks(t.turn,e),a=_r(n.king,o),l=t.board.occupied.without(n.king);for(const y of a)if(t.kingAttackers(y,Ie(t.turn),l).nonEmpty())return j.empty();const c=Is(t.turn,e),p=t.board.occupied.toggle(n.king).toggle(i).toggle(c);return t.kingAttackers(o,Ie(t.turn),p).nonEmpty()?j.empty():j.fromSquare(i)},xd=(t,e,n)=>{if(n.variantEnd)return j.empty();const i=t.board.get(e);if(!i||i.color!==t.turn)return j.empty();let o=Ka(i,e,t.board.occupied);if(i.role==="pawn"){let a=t.board[Ie(t.turn)];oe(t.epSquare)&&(a=a.with(t.epSquare)),o=o.intersect(a);const l=t.turn==="white"?8:-8,c=e+l;if(0<=c&&c<64&&!t.board.occupied.has(c)){o=o.with(c);const p=t.turn==="white"?e<16:e>=48,y=c+l;p&&!t.board.occupied.has(y)&&(o=o.with(y))}return o}else o=o.diff(t.board[t.turn]);return e===n.king?o.union(ui(t,"a",n)).union(ui(t,"h",n)):o},Fa=(t,e)=>{if(yr(e))return;const n=e.to-e.from;if(!(Math.abs(n)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return n>0?"h":"a"},Kl=(t,e)=>{const n=Fa(t,e);if(!n)return e;const i=t.castles.rook[t.turn][n];return{from:e.from,to:oe(i)?i:e.to}},Il="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ll=Il+" w KQkq -",Ba=Ll+" 0 1",Fl="8/8/8/8/8/8/8/8",Bl=Fl+" w - -",Ed=Bl+" 0 1";var $e;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})($e||($e={}));class Fe extends Error{}const ql=(t,e,n)=>{let i=t.indexOf(e);for(;n-- >0&&i!==-1;)i=t.indexOf(e,i+e.length);return i},$n=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,qa=t=>{const e=Kn(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},os=t=>{const e=Fn.empty();let n=7,i=0;for(let o=0;o<t.length;o++){const a=t[o];if(a==="/"&&i===8)i=0,n--;else{const l=parseInt(a,10);if(l>0)i+=l;else{if(i>=8||n<0)return le.err(new Fe($e.Board));const c=i+n*8,p=qa(a);if(!p)return le.err(new Fe($e.Board));t[o+1]==="~"&&(p.promoted=!0,o++),e.set(c,p),i++}}}return n!==0||i!==8?le.err(new Fe($e.Board)):le.ok(e)},zo=t=>{if(t.length>64)return le.err(new Fe($e.Pockets));const e=an.empty();for(const n of t){const i=qa(n);if(!i)return le.err(new Fe($e.Pockets));e[i.color][i.role]++}return le.ok(e)},Ul=(t,e)=>{let n=j.empty();if(e==="-")return le.ok(n);for(const i of e){const o=i.toLowerCase(),a=i===o?"black":"white",l=a==="white"?0:7;if("a"<=o&&o<="h")n=n.with(ks(o.charCodeAt(0)-97,l));else if(o==="k"||o==="q"){const c=t[a].intersect(j.backrank(a)).intersect(t.rook.union(t.king)),p=o==="k"?c.last():c.first();n=n.with(oe(p)&&t.rook.has(p)?p:ks(o==="k"?7:0,l))}else return le.err(new Fe($e.Castling))}return dn.some(i=>j.backrank(i).intersect(n).size()>2)?le.err(new Fe($e.Castling)):le.ok(n)},Ho=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const n=$n(e[1]),i=$n(e[2]);return!oe(n)||n>3||!oe(i)||i>3?le.err(new Fe($e.RemainingChecks)):le.ok(new mr(3-n,3-i))}else if(e.length===2){const n=$n(e[0]),i=$n(e[1]);return!oe(n)||n>3||!oe(i)||i>3?le.err(new Fe($e.RemainingChecks)):le.ok(new mr(n,i))}else return le.err(new Fe($e.RemainingChecks))},Vl=t=>{const e=t.split(/[\s_]+/),n=e.shift();let i,o=le.ok(void 0);if(n.endsWith("]")){const c=n.indexOf("[");if(c===-1)return le.err(new Fe($e.Fen));i=os(n.slice(0,c)),o=zo(n.slice(c+1,-1))}else{const c=ql(n,"/",7);c===-1?i=os(n):(i=os(n.slice(0,c)),o=zo(n.slice(c+1)))}let a;const l=e.shift();if(!oe(l)||l==="w")a="white";else if(l==="b")a="black";else return le.err(new Fe($e.Turn));return i.chain(c=>{const p=e.shift(),y=oe(p)?Ul(c,p):le.ok(j.empty()),m=e.shift();let g;if(oe(m)&&m!=="-"&&(g=In(m),!oe(g)))return le.err(new Fe($e.EpSquare));let R=e.shift(),$;oe(R)&&R.includes("+")&&($=Ho(R),R=e.shift());const U=oe(R)?$n(R):0;if(!oe(U))return le.err(new Fe($e.Halfmoves));const T=e.shift(),I=oe(T)?$n(T):1;if(!oe(I))return le.err(new Fe($e.Fullmoves));const X=e.shift();let K=le.ok(void 0);if(oe(X)){if(oe($))return le.err(new Fe($e.RemainingChecks));K=Ho(X)}else oe($)&&(K=$);return e.length>0?le.err(new Fe($e.Fen)):o.chain(B=>y.chain(V=>K.map(J=>({board:c,pockets:B,turn:a,castlingRights:V,remainingChecks:J,epSquare:g,halfmoves:U,fullmoves:Math.max(1,I)}))))})},zl=t=>{let e=fn(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},Hl=t=>{let e="",n=0;for(let i=7;i>=0;i--)for(let o=0;o<8;o++){const a=o+i*8,l=t.get(a);l?(n>0&&(e+=n,n=0),e+=zl(l)):n++,o===7&&(n>0&&(e+=n,n=0),i!==0&&(e+="/"))}return e},Go=t=>ct.map(e=>fn(e).repeat(t[e])).join(""),Gl=t=>Go(t.white).toUpperCase()+Go(t.black),Wl=(t,e)=>{let n="";for(const i of dn){const o=j.backrank(i);let a=t.kingOf(i);oe(a)&&!o.has(a)&&(a=void 0);const l=t.pieces(i,"rook").intersect(o);for(const c of e.intersect(o).reversed())if(c===l.first()&&oe(a)&&c<a)n+=i==="white"?"Q":"q";else if(c===l.last()&&oe(a)&&a<c)n+=i==="white"?"K":"k";else{const p=oi[Ye(c)];n+=i==="white"?p.toUpperCase():p}}return n||"-"},Yl=t=>`${t.white}+${t.black}`,Ua=(t,e)=>[Hl(t.board)+(t.pockets?`[${Gl(t.pockets)}]`:""),t.turn[0],Wl(t.board,t.castlingRights),oe(t.epSquare)?Ln(t.epSquare):"-",...t.remainingChecks?[Yl(t.remainingChecks)]:[],Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))].join(" "),Ql=(t,e)=>{let n="";if(yr(e))e.role!=="pawn"&&(n=fn(e.role).toUpperCase()),n+="@"+Ln(e.to);else{const i=t.board.getRole(e.from);if(!i)return"--";if(i==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))n=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||i==="pawn"&&Ye(e.from)!==Ye(e.to);if(i!=="pawn"){n=fn(i).toUpperCase();let a;if(i==="king"?a=pi(e.to).intersect(t.board.king):i==="queen"?a=Ls(e.to,t.board.occupied).intersect(t.board.queen):i==="rook"?a=Vn(e.to,t.board.occupied).intersect(t.board.rook):i==="bishop"?a=Un(e.to,t.board.occupied).intersect(t.board.bishop):a=yi(e.to).intersect(t.board.knight),a=a.intersect(t.board[t.turn]).without(e.from),a.nonEmpty()){const l=t.ctx();for(const c of a)t.dests(c,l).has(e.to)||(a=a.without(c));if(a.nonEmpty()){let c=!1,p=a.intersects(j.fromRank(pn(e.from)));a.intersects(j.fromFile(Ye(e.from)))?c=!0:p=!0,p&&(n+=oi[Ye(e.from)]),c&&(n+=Ma[pn(e.from)])}}}else o&&(n=oi[Ye(e.from)]);o&&(n+="x"),n+=Ln(e.to),e.promotion&&(n+="="+fn(e.promotion).toUpperCase())}}return n},Xl=(t,e)=>{var n;const i=Ql(t,e);return t.play(e),!((n=t.outcome())===null||n===void 0)&&n.winner?i+"#":t.isCheck()?i+"+":i},Ad=(t,e)=>Xl(t.clone(),e),Va=(t,e)=>{const n=t.ctx(),i=e.match(/^([NBRQK])?([a-h])?([1-8])?[-x]?([a-h][1-8])(?:=?([nbrqkNBRQK]))?[+#]?$/);if(!i){let m;if(e==="O-O"||e==="O-O+"||e==="O-O#"?m="h":(e==="O-O-O"||e==="O-O-O+"||e==="O-O-O#")&&(m="a"),m){const $=t.castles.rook[t.turn][m];return!oe(n.king)||!oe($)||!t.dests(n.king,n).has($)?void 0:{from:n.king,to:$}}const g=e.match(/^([pnbrqkPNBRQK])?@([a-h][1-8])[+#]?$/);if(!g)return;const R={role:g[1]?Kn(g[1]):"pawn",to:In(g[2])};return t.isLegal(R,n)?R:void 0}const o=i[1]?Kn(i[1]):"pawn",a=In(i[4]),l=i[5]?Kn(i[5]):void 0;if(!!l!==(o==="pawn"&&j.backranks().has(a))||l==="king"&&t.rules!=="antichess")return;let c=t.board.pieces(t.turn,o);o==="pawn"&&!i[2]?c=c.intersect(j.fromFile(Ye(a))):i[2]&&(c=c.intersect(j.fromFile(i[2].charCodeAt(0)-97))),i[3]&&(c=c.intersect(j.fromRank(i[3].charCodeAt(0)-49)));const p=o==="pawn"?j.fromFile(Ye(a)):j.empty();c=c.intersect(p.union(Ka({color:Ie(t.turn),role:o},a,t.board.occupied)));let y;for(const m of c)if(t.dests(m,n).has(a)){if(oe(y))return;y=m}if(oe(y))return{from:y,to:a,promotion:l}},vt=t=>t.split(" ").slice(0,-1).join(" "),Fs=t=>Nl.fromSetup(Vl(t).unwrap()).unwrap(),Jl=t=>Fs(t).turn;function Wo(t,e=Ba){let n=Fs(e),i=Va(n,t),o=ja(i);n.play(i);let a=Ua(n.toSetup());return{path:`${o}`,ply:1,before_fen:e,fen:a,before_uci:void 0,uci:o,san:t}}function Yo(t,e){let n=Fs(t.fen),i=Va(n,e),o=ja(i);n.play(i);let a=Ua(n.toSetup()),l=`${t.path} ${o}`,c=t.ply+1,p=t.fen,y=t.uci;return{path:l,ply:c,before_fen:p,fen:a,before_uci:y,uci:o,san:e}}const Sd=["!!","!","!?","?!","?","??"],Od=["brilliant","good","interesting","inaccuracy","mistake","blunder"];function Pd(t){switch(t){case"!":return 1;case"?":return 2;case"!!":return 3;case"??":return 4;case"!?":return 5;case"?!":return 6}return 0}function Cd(t){switch(t){case 1:return"!";case 2:return"?";case 3:return"!!";case 4:return"??";case 5:return"!?";case 6:return"?!"}return""}function kt(){return Math.random().toString(16).slice(2,12)}async function Zl(t,e){await t.studies.add(e)}async function ef(t,e){t.transaction("rw",[t.studies,t.sections],async()=>{let n=await _i(t,e.study_id);return n.section_ids.push(e.id),await mi(t,n),await t.sections.add(e)})}async function tf(t,e){await t.transaction("rw",[t.sections,t.chapters],async()=>{let n=await Wn(t,e.section_id);return n.chapter_ids.push(e.id),await gi(t,n),await t.chapters.add(e)})}async function za(t,e){await t.steps_trees.add(e)}async function Ha(t,e){await t.play_uci_tree_replays.add(e)}async function Bs(t,e){let n=await t.chapters.get(e);if(!n)throw new at("Chapter",e);return n}async function Wn(t,e){let n=await t.sections.get(e);if(!n)throw new at("Section",e);return n}async function _i(t,e){let n=await t.studies.get(e);if(!n)throw new at("Study",e);return n}async function mi(t,e){await t.studies.update(e.id,e)}async function gi(t,e){await t.sections.update(e.id,e)}async function Ga(t,e){await t.chapters.update(e.id,e)}async function nf(t,e){t.transaction("rw",[t.studies,t.sections,t.chapters,t.play_uci_tree_replays],async()=>{let n=await t.studies.where("id").equals(e).first();if(!n)throw new at("Study",e);await t.studies.delete(e);let o=(await t.sections.where("study_id").equals(n.id).toArray()).map(a=>a.id);t.sections.bulkDelete(o),o.forEach(a=>Wa(t,a))})}async function rf(t,e){t.transaction("rw",[t.studies,t.sections,t.chapters],async()=>{let n=await Wn(t,e),i=await _i(t,n.study_id);i.section_ids.splice(i.section_ids.indexOf(e),1),await mi(t,i),await t.sections.delete(e),await Wa(t,e)})}async function Wa(t,e){let n=await t.chapters.where("section_id").equals(e).toArray(),i=n.map(o=>o.id);t.chapters.bulkDelete(i),await n.map(o=>qs(t,o))}async function sf(t,e){t.transaction("rw",[t.play_uci_tree_replays,t.sections,t.chapters],async()=>{let n=await Bs(t,e),i=await Wn(t,n.section_id);i.chapter_ids.splice(i.chapter_ids.indexOf(e),1),await gi(t,i),await t.chapters.delete(e),await qs(t,n)})}async function qs(t,e){let n=await t.play_uci_tree_replays.where("id").equals(e.tree_replay_id).first();if(!n)throw new at("TreeReplay",e.tree_replay_id);t.play_uci_tree_replays.delete(n.id)}async function of(t,e){await t.play_uci_tree_replays.update(e.id,e)}async function af(t,e){await t.tree_step_nodes.update(e.id,e)}async function uf(t,e){let n=await Wn(t,e),i=(await t.chapters.where("section_id").equals(e).toArray()).map(o=>({...o}));return n.chapter_ids.map(o=>i.find(a=>a.id===o))}async function cf(t,e){let n=await t.chapters.where("id").equals(e).first();if(!n)throw new at("Chapter",e);return n}async function lf(t,e){let n=await t.play_uci_tree_replays.where("steps_tree_id").equals(e).first();if(!n)throw new at("Play Uci Tree Replay",e);let i=await t.steps_trees.where("id").equals(n.steps_tree_id).first();if(!i)throw new at("Steps Tree",e);return Qa(t,n,i)}async function ff(t,e){let n=await Bs(t,e);return Ya(t,n.tree_replay_id)}async function Ya(t,e){let n=await t.play_uci_tree_replays.where("id").equals(e).first();if(!n)throw new at("Play Uci Tree Replay",e);let i=await t.steps_trees.where("id").equals(n.steps_tree_id).first();if(!i)throw new at("Steps Tree",e);return Qa(t,n,i)}async function Qa(t,e,n){let i=await t.tree_step_nodes.where("tree_id").equals(n.id).toArray(),o={};i.forEach(l=>{let c=o[vt(l.step.path)];c===void 0&&(c=[],o[vt(l.step.path)]=c),c.push({...l})});for(let l of Object.keys(o)){let c=await t.tree_step_node_order_for_paths.where("tree_id").equals(n.id).and(p=>p.path===l).first();c!==void 0&&(o[l]=c.order.map(p=>{let y=o[l].find(m=>m.id===p);if(!y)throw new br("Ordered Tree Step Node Not Found ",p);return y}))}let a={...n,flat_nodes:o};return{...e,steps_tree:a}}async function Qo(t,e){let n=await(e?t.studies.where("predicate").equals(e).toArray():t.studies.toArray());return Promise.all(n.map(i=>Xa(t,i.id,5)))}async function hf(t,e,n){let i=[];for(let o of e){let a=await t.chapters.where("section_id").equals(o.id);n&&(a=a.limit(n));let l=(await a.toArray()).map(c=>({...c}));l=o.chapter_ids.flatMap(c=>{let p=l.find(y=>y.id===c);if(!p){if(n===void 0)throw new br("Chapter ids dont contain chapter",c);return[]}return p}),i.push({id:o.id,...o,chapters:l})}return i}async function Xa(t,e,n){let i=await t.studies.get(e);if(!i)throw new at("Study",e);let o=await t.sections.where("study_id").equals(i.id).toArray(),a=await hf(t,o,n),l=i.section_ids.map(c=>{let p=a.find(y=>y.id===c);if(!p)throw new br("Section not found in section_ids",c);return p});return{...i,sections:l}}async function df(t,e,n,i){let o=await _i(t,e),a=o.section_ids.indexOf(n);if(a===-1)throw new br("Section not found in study.section_ids ",n);o.section_ids.splice(a,1),o.section_ids.splice(i,0,n),await mi(t,o)}async function pf(t,e,n,i){let o=await Wn(t,e),a=o.chapter_ids.indexOf(n);if(a===-1)throw new br("Chapter not found in section.chapter_ids ",n);o.chapter_ids.splice(a,1),o.chapter_ids.splice(i,0,n),await gi(t,o)}async function yf(t,e,n,i,o,a){let l={id:kt(),step:n,tree_id:e,nags:i,comments:o};return a&&await t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes],async()=>{await Ja(t,[l]),await t.tree_step_nodes.add(l)}),l}async function _f(t,e,n,i,o){let a=[];for(let l of Object.keys(n)){let c=n[l],p=[];for(let y of c)p.push({id:kt(),step:y,tree_id:e,nags:i[y.path],comments:o[y.path]});await Ja(t,p),a.push(...p)}await t.tree_step_nodes.bulkAdd(a)}async function Ja(t,e){let n=vt(e[0].step.path);const i=e[0].tree_id;let o=await t.tree_step_node_order_for_paths.where("tree_id").equals(i).and(a=>a.path===n).first();if(!o)await t.tree_step_node_order_for_paths.add({id:kt(),tree_id:e[0].tree_id,path:n,order:e.map(a=>a.id)});else{let a=[...o.order,...e.map(l=>l.id)];await t.tree_step_node_order_for_paths.update(o.id,{order:a})}}async function mf(t,e){await t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes],async()=>{let n=await t.tree_step_nodes.where("id").anyOf(e).toArray();for(let i of n){const o=await t.tree_step_node_order_for_paths.where("tree_id").equals(i.tree_id).and(a=>a.path===vt(i.step.path)).first();o!==void 0&&(o.order.splice(o.order.indexOf(i.id),1),o.order.length===0?await t.tree_step_node_order_for_paths.delete(o.id):await t.tree_step_node_order_for_paths.update(o.id,{order:o.order}))}await t.tree_step_nodes.bulkDelete(e)})}async function gf(t,e,n){let i=await t.chapters.where("section_id").anyOf(n).toArray(),o=await t.play_uci_tree_replays.where("id").anyOf(i.map(y=>y.tree_replay_id)).toArray(),a=await t.steps_trees.where("id").anyOf(o.map(y=>y.steps_tree_id)).toArray(),l=await t.tree_step_nodes.where("tree_id").anyOf(a.map(y=>y.id)).toArray(),c=await t.repeat_due_moves.where("study_id").equals(e).toArray(),p=[];for(let y of l){let m=c.find(g=>g.tree_step_node_id===y.id);if(m){let g=await Za(t,m.id,5);p.push({id:m.id,study_id:e,tree_step_node_id:y.id,tree_step_node:{...y},attempts:g,is_saved:!0})}else p.push({id:kt(),study_id:e,tree_step_node_id:y.id,tree_step_node:{...y},attempts:[],is_saved:!1})}return p}async function wf(t,e){await t.repeat_move_attempts.add(e)}async function Za(t,e,n){let i=t.repeat_move_attempts.where("repeat_due_move_id").equals(e);n!==void 0&&(i=i.limit(n));let o=await i.toArray();if(!o)throw new at("RepeatMoveAttempt",e);return o.sort((a,l)=>l.created_at-a.created_at)}async function vf(t,e){await t.repeat_due_moves.add(e)}async function bf(t,e,n){t.transaction("rw",[t.tree_step_node_order_for_paths,t.tree_step_nodes,t.steps_trees,t.play_uci_tree_replays,t.chapters],async()=>{let i=await Bs(t,e);qs(t,i);let o=eu(n);await za(t,o);let a=tu(o.id);await Ha(t,a),await Ga(t,{id:i.id,tree_replay_id:a.id})})}function kf(t){return{id:kt(),name:"New Study",is_edits_disabled:!1,predicate:"mine",section_ids:[],orientation:t}}function xf(t,e="New Section",n){return{id:kt(),study_id:t,name:e,chapter_ids:[],orientation:n}}function Ef(t,e,n="New Chapter",i){return{id:kt(),tree_replay_id:e,section_id:t,name:n,orientation:i}}function eu(t){return{id:kt(),initial_fen:t}}function tu(t){return{id:kt(),steps_tree_id:t,cursor_path:"",solved_paths:[],error_paths:[]}}function Af(t,e,n){return{id:kt(),repeat_due_move_id:t,created_at:Date.now(),card:e,attempt_result:n}}class Sf extends si{studies;sections;chapters;play_uci_tree_replays;steps_trees;tree_step_nodes;tree_step_node_order_for_paths;repeat_due_moves;repeat_move_attempts;remove_database(){this.delete()}constructor(){super("StudiesDB"),this.version(1).stores({studies:"id, predicate",sections:"id, study_id",chapters:"id, section_id, tree_replay_id",play_uci_tree_replays:"id, steps_tree_id",steps_trees:"id",tree_step_nodes:"id, tree_id",repeat_due_moves:"id, study_id, tree_step_node_id",repeat_move_attempts:"id, repeat_due_move_id, created_at",tree_step_node_order_for_paths:"id, tree_id, path"}),this.studies.mapToClass(Of),this.sections.mapToClass(Pf),this.chapters.mapToClass(Cf),this.play_uci_tree_replays.mapToClass(Rf),this.steps_trees.mapToClass(Tf),this.tree_step_nodes.mapToClass(Df),this.tree_step_node_order_for_paths.mapToClass(Nf),this.repeat_due_moves.mapToClass($f)}}class Of extends Gt{id;name;is_edits_disabled;predicate;selected_section_id;section_ids;orientation}class Pf extends Gt{id;study_id;name;selected_chapter_id;chapter_ids;orientation}class Cf extends Gt{id;section_id;tree_replay_id;name;orientation}class Rf extends Gt{id;steps_tree_id;cursor_path;solved_paths;error_paths;success_path;failed_path;hide_after_path}class Tf extends Gt{id;initial_fen}class Df extends Gt{id;tree_id;step;nags;comments}class Nf extends Gt{id;tree_id;path;order}class $f extends Gt{id;study_id;tree_step_node_id}const nu=Tt(),Mf=t=>{let e=new Sf,n={async new_study(){let i=kf();return await Zl(e,i),{id:i.id,...i,sections:[]}},async new_section(i,o){let a=xf(i,o);return await ef(e,a),{id:a.id,...a,chapters:[]}},async new_chapter(i,o,a){return e.transaction("rw",[e.tree_step_node_order_for_paths,e.tree_step_nodes,e.steps_trees,e.play_uci_tree_replays,e.studies,e.sections,e.chapters],async()=>{let l=await Wn(e,i),c=await _i(e,l.study_id),p=a?.orientation??l.orientation??c.orientation,y=eu();await za(e,y),a&&await _f(e,y.id,a.flat_steps,a.flat_nags,a.flat_comments);let m=tu(y.id);await Ha(e,m);let g=Ef(i,m.id,o,p);return await tf(e,g),{id:g.id,...g}})},get_chapter_by_id(i){return cf(e,i)},get_chapters_by_section_id(i){return uf(e,i)},get_studies_by_predicate(i){return Qo(e,i)},get_studies(){return Qo(e)},get_study_by_id(i,o){return Xa(e,i,o)},update_study(i){return mi(e,i)},update_section(i){return gi(e,i)},update_chapter(i){return Ga(e,i)},delete_chapter(i){return sf(e,i)},delete_section(i){return rf(e,i)},delete_study(i){return nf(e,i)},order_sections(i,o,a){return df(e,i,o,a)},order_chapters(i,o,a){return pf(e,i,o,a)},get_replay_tree_by_id(i){return Ya(e,i)},get_replay_tree_by_chapter_id(i){return ff(e,i)},get_replay_tree_by_steps_tree_id(i){return lf(e,i)},update_play_uci_tree_replay(i){return of(e,i)},async new_tree_step_node(i,o,a,l,c){return await yf(e,i,o,a,l,c)},update_tree_step_node(i){return af(e,i)},async delete_tree_nodes(i){await mf(e,i)},load_repeat_due_moves(i,o){return gf(e,i,o)},async add_repeat_move_attempt(i,o,a){let l=Af(i,o,a);return await wf(e,l),{...l}},load_repeat_move_attempts(i){return Za(e,i)},new_due_move(i){return vf(e,i)},change_root_fen(i,o){return bf(e,i,o)}};return ee(nu.Provider,{value:n,get children(){return t.children}})};class at extends Error{constructor(e,n){super(`DB ${e}${n?" by id "+n:""} not found.`),this.entity=e,this.id=n}}class br extends Error{constructor(e,n){super(`DB ${e}${n?" by id "+n:""} .`),this.msg=e,this.id=n}}const lt=(t,e)=>t;function jf(t){const e=lt(()=>t.get_studies_by_predicate("mine")),n=lt(()=>t.get_studies_by_predicate("auto")),i=lt(()=>t.get_studies_by_predicate("featured")),o=lt(()=>t.get_studies()),a=lt(l=>t.get_study_by_id(l));return{mine:e,auto:n,featured:i,all:o,get:a,create:async()=>await t.new_study(),delete:async l=>{await t.delete_study(l)},create_section:async(l,c)=>await t.new_section(l,c),update:async l=>{await t.update_study(l)},update_section:async l=>{await t.update_section(l)},delete_section:async(l,c)=>{await t.delete_section(c)},order_sections:async(l,c,p)=>{await t.order_sections(l,c,p)}}}function Kf(t){const e=lt(i=>t.get_chapters_by_section_id(i)),n=lt(i=>t.get_chapter_by_id(i));return{by_section_id:e,get:n,create:async(i,o,a)=>await t.new_chapter(i,o,a),delete:async i=>{await t.delete_chapter(i)},update_chapter:async i=>{await t.update_chapter(i)},order_chapters:async(i,o,a)=>{await t.order_chapters(i,o,a)}}}function If(t){const e=lt(o=>t.get_replay_tree_by_steps_tree_id(o)),n=lt(o=>t.get_replay_tree_by_chapter_id(o)),i=lt(o=>t.get_replay_tree_by_id(o));return{by_steps_tree_id:e,by_chapter_id:n,by_id:i,create_node:async(o,a,l,c,p)=>await t.new_tree_step_node(o,a,l,c,p),update:async o=>{await t.update_play_uci_tree_replay(o)},update_tree_node:async o=>{await t.update_tree_step_node(o)},delete_tree_nodes:async o=>{await t.delete_tree_nodes(o)},change_root_fen:async(o,a)=>{await t.change_root_fen(o,a)}}}function Lf(t){return{by_study_id:lt((n,i)=>t.load_repeat_due_moves(n,i)),async save_due_move(n){return t.new_due_move({id:n.id,study_id:n.study_id,tree_step_node_id:n.tree_step_node_id})},async new_attempt(n,i,o){return t.add_repeat_move_attempt(n,o,i)}}}function Ff(t){let e=bt(nu),n=jf(e),i=Kf(e),o=If(e),a=Lf(e);return{Studies:n,Chapters:i,ReplayTree:o,DueMoves:a}}function Bf(t,e,n,i){const[o,a]=Ce(),c=di(async y=>{let m=o();if(m===void 0)return{};if(m[0]==="studies")return(await p(m[1])).reduce((U,T)=>(U[T.id]=T,U),{});let g=m[1],R=y[g];return R?y:(R=await t.Studies.get(g),{...y,[g]:R})},{initialValue:{}});function p(y){return y==="mine"?t.Studies.mine():y==="auto"?t.Studies.auto():y==="featured"?t.Studies.featured():t.Studies.all()}return Object.assign(e,{load_studies(y){a(["studies",y])},load_study(y){a(["study",y])},async create_study(){let y=await t.Studies.create();return i("studies",{[y.id]:y}),y},async delete_study(y){const m=n.studies[y];i("studies",{[y]:void 0});try{await t.Studies.delete(y)}catch(g){throw i("studies",{[y]:m}),g}},async update_study(y){await t.Studies.update(y),i("studies",y.id,y)},async update_section(y,m){await t.Studies.update_section(m),ht(()=>{i("studies",y,"sections",g=>g.id===m.id,m)})},async create_section(y,m){const g=await t.Studies.create_section(y,m);return ht(()=>{i("studies",y,R=>({sections:[...R.sections,g]})),i("studies",y,"section_ids",R=>[...R,g.id])}),g},async delete_section(y,m){await t.Studies.delete_section(y,m),ht(()=>{i("studies",y,"section_ids",g=>g.filter(R=>R!==m)),i("studies",y,g=>({sections:g.sections.filter(R=>R.id!==m)}))})},async order_sections(y,m,g){await t.Studies.order_sections(y,m,g),i("studies",y,"section_ids",R=>{let $=R.indexOf(m);return R.splice($,1),R.splice(g,0,m),[...R]})},async study_as_export_pgn(y){let m="",g=await t.Studies.get(y);for(let R of g.section_ids){let $=g.sections.find(U=>U.id===R);for(let U of $.chapter_ids){let T=$.chapters.find(I=>I.id===U);m+=await e.chapter_as_export_pgn(g.name,$.name,T),m+=`

`}m+=`


`}return m}}),c}function qf(t,e,n,i){const[o,a]=Ce(),l=di(async c=>{let p=o();if(p===void 0)return{list:[]};if(p[0]==="sections"){let g=(await Promise.all(p[1].map(U=>t.Chapters.by_section_id(U)))).flat(),$=c.list.filter(U=>!g.find(T=>T.id===U.id));return{list:[...g,...$]}}if(p[0]==="chapters"){let g=await t.Chapters.by_section_id(p[1]),$=c.list.filter(U=>!g.find(T=>T.id===U.id));return{list:[...g,...$]}}let y=p[1];if(c.list.findIndex(g=>g.id===y)===-1){let g=await t.Chapters.get(y);return{list:[...c.list,g]}}return c},{initialValue:{list:[]}});return Object.assign(e,{load_chapters_for_sections(c){a(["sections",c])},load_chapters(c){a(["chapters",c])},load_chapter(c){a(["chapter",c])},async create_chapter(c,p,y,m){let g=await t.Chapters.create(p,y,m);return ht(()=>{i("chapters","list",n.chapters.list.length,g),i("studies",c,"sections",R=>R.id===g.section_id,"chapter_ids",R=>[...R,g.id])}),g},async update_chapter(c,p,y){await t.Chapters.update_chapter(y),i("chapters","list",m=>m.id===y.id,y)},async order_chapters(c,p,y,m){await t.Chapters.order_chapters(p,y,m),i("studies",c,"sections",g=>g.id===p,"chapter_ids",g=>{let R=g.indexOf(y);return g.splice(R,1),g.splice(m,0,y),[...g]})},async delete_chapter(c,p,y){await t.Chapters.delete(y),ht(()=>{i("chapters","list",m=>m.filter(g=>g.id!==y)),i("studies",c,"sections",m=>m.id===p,"chapter_ids",m=>m.filter(g=>g!==y))})}}),l}var Uf=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Vf=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),zf=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function Hf(t){if(!t)return"";let e="";for(const n in t){if(!zf.includes(n))continue;const i=t[n];e+=i instanceof Date?`; ${n}=${i.toUTCString()}`:typeof i=="boolean"?`; ${n}`:`; ${n}=${i}`}return e}function Gf(t,e){return t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`)?.pop()??null}var Xo;try{Xo=Uf("solid-start/server").useRequest}catch{Xo=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var Pn=Vf({_read:()=>document.cookie,_write:(t,e,n)=>{document.cookie=`${t}=${e}${Hf(n)}`},getItem:(t,e)=>Gf(Pn._read(e),t),setItem:(t,e,n)=>{Pn._write(t,e,n);{const o=Object.assign(new Event("storage"),{key:t,oldValue:null,newValue:e,url:globalThis.document.URL,storageArea:Pn});window.dispatchEvent(o)}},removeItem:(t,e)=>{Pn._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let n=null,i=0;return Pn._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(o,a)=>(!n&&a&&i++===t&&(n=a),"")),n},getLength:t=>{let e=0;return Pn._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,n=>(e+=n?1:0,"")),e},get length(){return this.getLength()}});function ru(t,e={}){const n=e.storage||globalThis.localStorage;if(!n)return t;const i=e.storageOptions,o=e.name||`storage-${ac()}`,a=e.serialize||JSON.stringify.bind(JSON),l=e.deserialize||JSON.parse.bind(JSON),c=n.getItem(o,i),p=typeof t[0]=="function"?m=>t[1](()=>l(m)):m=>t[1](hl(l(m)));let y=!0;return c instanceof Promise?c.then(m=>y&&m&&p(m)):c&&p(c),[t[0],typeof t[0]=="function"?m=>{const g=t[1](m);return m?n.setItem(o,a(g),i):n.removeItem(o,i),y=!1,g}:(...m)=>{t[1](...m);const g=a(De(()=>t[0]));n.setItem(o,g,i),y=!1}]}function Wf(t){let e,n;return function(...i){const o=this,a=()=>{n=void 0,e=t.apply(o,i).finally(()=>{e=void 0,n&&n()})};e?n=a:a()}}function Yf(t,e){return Wf(function(...n){return e.apply(this,n),new Promise(i=>setTimeout(i,t))})}function Qf(t,e,n){return ru(Ce(t),{name:`.aidchess.v1.${e}`})}class Xf{ctx=Zf();sounds=new Map;paths=new Map;theme="standard";volumeStorage=Qf("1","sound.volume");enabled=()=>this.theme!=="silent";resolvePath(e){return this.enabled()?`/sound/${this.theme}/${e[0].toUpperCase()+e.slice(1)}`:void 0}getVolume=()=>{const e=parseFloat(this.volumeStorage[0]());return e>=0?e:.7};async play(e,n=1){if(!this.enabled())return;const i=await this.load(e);i&&await i.play(this.getVolume()*n)}async load(e,n){if(!this.ctx||(n?this.paths.set(e,n):n=this.paths.get(e)??this.resolvePath(e),!n))return;if(this.sounds.has(n))return this.sounds.get(n);const i=await fetch(`${n}.mp3`);if(!i.ok)throw new Error(`${n}.mp3 failed ${i.status}`);const o=await i.arrayBuffer(),a=await new Promise((c,p)=>{this.ctx?.decodeAudioData.length===1?this.ctx?.decodeAudioData(o).then(c).catch(p):this.ctx?.decodeAudioData(o,c,p)}),l=new Jf(this.ctx,a);return this.sounds.set(n,l),l}preloadBoardSounds(){for(const e of["move","capture","check","genericNotify"])this.load(e)}throttled=Yf(200,e=>this.play(e));setVolume=e=>this.volumeStorage[1](e.toString());async move(e){e?.name?this.throttled(e.name):(e?.san?.includes("x")?this.throttled("capture"):this.throttled("move"),(e?.san?.includes("#")||e?.san?.includes("+"))&&this.throttled("check"))}}class Jf{constructor(e,n){this.buffer=n,this.rewire(e)}node;ctx;play(e=1){this.node.gain.setValueAtTime(e,this.ctx.currentTime);const n=this.ctx.createBufferSource();return n.buffer=this.buffer,n.connect(this.node),new Promise(i=>{n.onended=()=>{n.disconnect(),i()},n.start(0)})}rewire(e){this.node?.disconnect(),this.ctx=e,this.node=this.ctx.createGain(),this.node.connect(this.ctx.destination)}}function Zf(){return new AudioContext}const eh=Tt(new Xf);function th(){return bt(eh)}var nh=Xe('<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=replay-jump><button class="fbt first"data-icon=></button><button class="fbt prev"data-icon=></button><button class="fbt next"data-icon=></button><button class="fbt last"data-icon=>'),rh=Xe('<div class=branch-sums><button class="fbt up"data-icon=></button><button class="fbt down"data-icon=>'),iu=Xe("<span class=index>"),ih=Xe("<div class=fbt>"),sh=Xe("<div class=lines>"),oh=Xe("<div class=line>"),ah=Xe("<span class=collapsed>..<!> "),uh=Xe("<div class=context-menu><div class=title></div><div class=list>"),ch=Xe("<div class=move>"),lh=Xe("<span class=nag>");function su(t,e){let n=wt(t,e);if(!n)throw new kh(e);let i=xe(t,e);return[n,...i.flatMap(o=>su(t,o.step.path))]}function fh(t){return ou(t.steps_tree,t.cursor_path)}function hh(t,e){return xe(t,vt(e))}function ou(t,e){let n=[],i=Dn(t),o=i.length>1;if(e==="")return i;for(let a of e.split(" ")){let l=i.find(p=>p.step.uci===a);if(!l)return;o&&(n.push(l),o=!1);let c=xe(t,l.step.path);c.length>1&&(o=!0),i=c}return n}function Dn(t){return xe(t,"")}function Cn(t,e){let n=wt(t,e);return n?[wt(t,vt(e)),n]:void 0}function wt(t,e){if(e==="")return;let n=vt(e);return t.flat_nodes[n].find(a=>a.step.path===e)}function xe(t,e){return t.flat_nodes[e]??[]}function dh(t,e){let n=xe(t,e.step.path);if(n.length>1)return 1;if(n.length===0)return 0;let i=1,o=n[0];for(;xe(t,o.step.path).length===1;)i++,o=xe(t,o.step.path)[0];return i}function ph(t,e){return yh(t,e)?.length??0}const yh=(t,e)=>{let n=au(t,e);return n?xe(t,n.step.path):void 0},au=(t,e)=>{let n=xe(t,e.step.path);if(n.length!==0)return n.length===1?au(t,n[0]):e};function Rd(t,e){return uu(t,xe(t,""),!0,e)}function _h(t){return ei(t,xe(t,""),!0)}function Cs(t,e=!1){let n=t.step.ply,i=n%2===1||e?Math.ceil(n/2)+(n%2===1?".":"..."):"",o=n%2===1?"":" ";return`${i} ${t.step.san}${t.comments?" { "+t.comments+" }":""}${o}`}function ei(t,e,n=!1){let i="";return e.length===0||(e.length===1?(i+=Cs(e[0],n),i+=ei(t,xe(t,e[0].step.path),!1)):(i+=Cs(e[0],!1).trimEnd(),i+=" "+e.slice(1).map(o=>`(${ei(t,[o],!0).trimEnd()})`).join(" "),i+=" "+ei(t,xe(t,e[0].step.path),!0))),i}function uu(t,e,n=!1,i){let o="",a=e.find(l=>i.startsWith(l.step.path));return a&&(o+=Cs(a,n),o+=uu(t,xe(t,a.step.path),!1,i)),o}function mh(t,e,n,i){let o="";return o+=`[Event] ${t}: ${e}: ${n.name}
`,o+=`[StudyName] ${t}
`,o+=`[ChapterName] ${n.name}
`,o+=`
`,o+=_h(i),o}function gh(t){const e=te(()=>t.replay_tree.cursor_path),n=te(()=>t.replay_tree.hide_after_path),i=te(()=>t.replay_tree.solved_paths),o=te(()=>t.replay_tree.error_paths),a=te(()=>t.replay_tree.success_path),l=te(()=>t.replay_tree.failed_path),c=te(()=>t.replay_tree.steps_tree),p=te(()=>wt(c(),"")?.step.fen??c().initial_fen??Ba),y=te(()=>wt(c(),e())?.step.fen??p()),m=te(()=>{let B=wt(c(),e())?.step;if(B)return[B.uci,B.san]});let g=[];fi(gr(e,B=>{ou(c(),B)?.map(V=>{if(!g.includes(V.step.path)){if(hh(c(),V.step.path)?.forEach(J=>{g=g.filter(re=>re!==J.step.path)}),t.replay_tree.error_paths.includes(V.step.path)||t.replay_tree.failed_path===V.step.path)return;g.push(V.step.path)}})}));const R=te(()=>{let B=e();if(B!=="")return B.split(" ").slice(0,-1).join(" ")}),$=te(()=>{let B=e(),V=xe(c(),B);return V.length===1?V[0].step.path:V.find(J=>g.includes(J.step.path))?.step.path??V[0]?.step.path}),U=te(()=>{let B=Cn(c(),e());if(!B)return;let V=B;if(!V[0])return"";if(xe(c(),V[0].step.path).length>1)return V[0].step.path;for(;!(!V[0]||xe(c(),V[0].step.path).length>1);){let J=Cn(c(),V[0].step.path);if(!J)break;V=J}return V[1].step.path}),T=te(()=>{let B=wt(c(),e());if(!B){let re=Dn(c());return(re.find(fe=>g.includes(fe.step.path))??re[0])?.step.path}let V=B,J=xe(c(),V.step.path);if(J.length>1)return J.find(re=>g.includes(re.step.path))?.step.path??J[0]?.step.path;for(;J.length===1;)V=J[0],J=xe(c(),V.step.path);return V.step.path}),I=te(()=>{let B=Cn(c(),e());if(!B)return;let V=B[0]?xe(c(),B[0].step.path):[];if(!B[0])V=Dn(c());else if(xe(c(),B[0].step.path).length===1)for(;;){if(B=Cn(c(),B[0].step.path),!B)return;if(!B[0]){V=Dn(c());break}if(xe(c(),B[0].step.path).length>1){V=xe(c(),B[0].step.path);break}}let J=V.indexOf(B[1]),re=V[J-1];if(re)return re.step.path}),X=te(()=>{let B=Cn(c(),e());if(!B)return;let V=B[0]?xe(c(),B[0].step.path):[];if(!B[0])V=Dn(c());else if(xe(c(),B[0].step.path).length===1)for(;;){if(B=Cn(c(),B[0].step.path),!B)return;if(!B[0]){V=Dn(c());break}if(xe(c(),B[0].step.path).length>1){V=xe(c(),B[0].step.path);break}}let J=V.indexOf(B[1]),re=V[J+1];if(re)return re.step.path}),K=te(()=>wt(t.replay_tree.steps_tree,e()));return{get initial_fen(){return p()},get fen(){return y()},get turn(){return Jl(y())},get last_move(){return m()},get step_at_cursor_path(){return K()},get cursor_path(){return e()},get hide_after_path(){return n()},get solved_paths(){return i()},get error_paths(){return o()},get success_path(){return a()},get failed_path(){return l()},get get_prev_path(){return R()},get get_next_path(){return $()},get get_first_path(){return U()},get get_last_path(){return T()},get get_down_path(){return X()},get get_up_path(){return I()}}}const Td=t=>{const e=th();e.setVolume(.2),fi(gr(()=>t.step_at_cursor_path,(n,i)=>{n&&(!i||i.step.ply===n.step.ply-1)&&e.move(n.step)}))},Dd=t=>{let e=gh(t);const n=m=>{t.handle_goto_path(m)},i=m=>{t.handle_goto_path(m)},o=m=>{n(m)},a=(m,g)=>{t.on_context_menu?.(m,g)};let l;fi(()=>{let m=t.replay_tree.cursor_path,g=l.parentElement;if(!g)return;const R=l.querySelector(".on-path-end");if(!R){g.scrollTop=m.length>0?99999:0;return}let $=R.offsetTop-g.offsetHeight/2+R.offsetHeight;g.scrollTo({behavior:"smooth",top:$})});const c=m=>{if(t.lose_focus)return;let g=!1;m.key==="ArrowLeft"&&(i(e.get_prev_path),g=!0),m.key==="ArrowRight"&&(i(e.get_next_path),g=!0),m.key==="ArrowUp"&&(i(e.get_up_path),g=!0),m.key==="ArrowDown"&&(i(e.get_down_path),g=!0),g&&m.preventDefault()};Wu(()=>{document.addEventListener("keydown",c),Vt(()=>{document.removeEventListener("keydown",c)})});const p=Bn(()=>t.features),y=Bn(()=>t.feature_content);return(()=>{var m=nh(),g=m.firstChild,R=g.firstChild,$=g.nextSibling,U=$.firstChild,T=U.nextSibling,I=T.nextSibling,X=I.nextSibling;return $s(K=>l=K,R),we(R,ee(Rs,Ct({get replay_tree(){return t.replay_tree}},e,{on_set_cursor:o,on_context_menu:a,path:""}))),we(m,ee(dt,{get when(){return y()},get fallback(){return(()=>{var K=rh(),B=K.firstChild,V=B.nextSibling;return B.$$click=()=>i(e.get_up_path),V.$$click=()=>i(e.get_down_path),we(K,ee(ga,{get each(){return fh(t.replay_tree)},children:J=>(()=>{var re=ih();return re.$$click=()=>n(J.step.path),we(re,ee(dt,{get when(){return J.step.ply&1},get children(){var fe=iu();return we(fe,()=>Us(J.step.ply)),fe}}),null),we(re,()=>J.step.san,null),re})()}),null),nt(J=>{var re=e.get_up_path===void 0,fe=e.get_up_path===void 0,Me=e.get_down_path===void 0,Ge=e.get_down_path===void 0;return re!==J.e&&(B.disabled=J.e=re),fe!==J.t&&B.classList.toggle("disabled",J.t=fe),Me!==J.a&&(V.disabled=J.a=Me),Ge!==J.o&&V.classList.toggle("disabled",J.o=Ge),J},{e:void 0,t:void 0,a:void 0,o:void 0}),K})()},children:K=>K()}),$),we($,ee(dt,{get when(){return p()},children:K=>K()}),U),U.$$click=()=>i(e.get_first_path),T.$$click=()=>i(e.get_prev_path),I.$$click=()=>i(e.get_next_path),X.$$click=()=>i(e.get_last_path),nt(K=>{var B=e.get_first_path===void 0,V=e.get_first_path===void 0,J=e.get_prev_path===void 0,re=e.get_prev_path===void 0,fe=e.get_next_path===void 0,Me=e.get_next_path===void 0,Ge=e.get_last_path===void 0,ve=e.get_last_path===void 0;return B!==K.e&&(U.disabled=K.e=B),V!==K.t&&U.classList.toggle("disabled",K.t=V),J!==K.a&&(T.disabled=K.a=J),re!==K.o&&T.classList.toggle("disabled",K.o=re),fe!==K.i&&(I.disabled=K.i=fe),Me!==K.n&&I.classList.toggle("disabled",K.n=Me),Ge!==K.s&&(X.disabled=K.s=Ge),ve!==K.h&&X.classList.toggle("disabled",K.h=ve),K},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),m})()};function Rs(t){const e=te(()=>t.replay_tree.steps_tree.flat_nodes[t.path]??[]);return[ee(dt,{get when(){return e().length===1},get children(){return[ee(as,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},get node(){return e()[0]}})),ee(Rs,Ct(t,{get path(){return e()[0].step.path}}))]}}),ee(dt,{get when(){return e().length>1},get children(){var n=sh();return we(n,ee(ga,{get each(){return e()},children:i=>(()=>{var o=oh();return we(o,ee(dt,{get when(){return t.replay_tree.cursor_path.startsWith(i.step.path)},get fallback(){return[ee(as,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},node:i,show_index:!0,collapsed:!0})),ee(wh,{node:i,get replay_tree(){return t.replay_tree}})]},get children(){return[ee(as,Ct(t,{get cursor_path(){return t.replay_tree.cursor_path},node:i,show_index:!0})),ee(Rs,Ct(t,{get path(){return i.step.path}}))]}})),o})()})),n}})]}function wh(t){return(()=>{var e=ah(),n=e.firstChild,i=n.nextSibling;return i.nextSibling,we(e,()=>dh(t.replay_tree.steps_tree,t.node),i),we(e,()=>ph(t.replay_tree.steps_tree,t.node),null),e})()}function Nd(t){return(()=>{var e=uh(),n=e.firstChild,i=n.nextSibling,o=t.ref;return typeof o=="function"?$s(o,e):t.ref=e,e.$$click=a=>{a.preventDefault(),a.stopImmediatePropagation()},we(n,()=>Us(t.step.ply),null),we(n,()=>t.step.san,null),we(i,()=>t.children),e})()}function as(t){const e=te(()=>t.node.step);let n=te(()=>e().ply%2===1||t.show_index);const i=te(()=>e().path),o=te(()=>t.cursor_path.startsWith(i())),a=te(()=>i()===t.cursor_path),l=te(()=>t.hide_after_path!==void 0&&i()!==t.hide_after_path&&i().startsWith(t.hide_after_path)),c=te(()=>t.failed_path===i()),p=te(()=>t.success_path===i()),y=te(()=>t.solved_paths.includes(i())),m=te(()=>t.error_paths.includes(i())),g=te(()=>({collapsed:t.collapsed,"on-path":o(),"on-path-end":a(),hidden:l(),failed:c(),success:p(),"in-solved":y(),"in-error":m(),[vh[t.node.nags?.[0]??0]]:t.node.nags!==void 0}));return(()=>{var R=ch();return R.$$click=()=>{t.on_set_cursor(e().path)},R.$$contextmenu=$=>{$.preventDefault(),t.on_context_menu($,e().path)},we(R,ee(dt,{get when(){return n()},get children(){var $=iu();return we($,()=>Us(e().ply)),$}}),null),we(R,()=>e().san,null),we(R,ee(dt,{get when(){return t.node.nags},children:$=>ee(bh,{get nags(){return $()}})}),null),nt($=>va(R,g(),$)),R})()}let cu=["","!","?","!!","??","!?","?!"];cu[22]="⨀";let vh=["","good","mistake","top","blunder","interesting","inaccuracy"];const bh=t=>[" ",(()=>{var e=lh();return we(e,()=>cu[t.nags[0]]),e})()," "],Us=t=>`${Math.ceil(t/2)}.`+(t%2===0?"..":"");class kh extends Error{constructor(e){super(e)}}Ns(["click","contextmenu"]);function xh(t,e,n,i){const[o,a]=Ce(!0),[l,c]=Ce(void 0,{equals:!1}),p=()=>({id:"",steps_tree_id:"",cursor_path:"",solved_paths:[],error_paths:[],success_path:void 0,failed_path:void 0,hide_after_path:void 0,steps_tree:{id:"",flat_nodes:{}}}),y=di(async()=>{let T=l();if(!T)return p();if(Array.isArray(T)){if(T[0]==="by_id")return T[1]===""?p():t.ReplayTree.by_id(T[1]).then(I=>(T[2]!==void 0&&(I.cursor_path=T[2]),I));if(T[0]==="by_steps_id")return t.ReplayTree.by_steps_tree_id(T[1]);{let I=T[1];return t.ReplayTree.by_steps_tree_id(I.tree_step_node.tree_id).then(X=>(X.cursor_path=vt(I.tree_step_node.step.path),X.hide_after_path="",X))}}return t.ReplayTree.by_chapter_id(T)},{initialValue:p()}),m=T=>{let I=n.replay_tree.hide_after_path;I!==void 0&&T!==I&&T.startsWith(I)||g(T)},g=T=>{o()&&t.ReplayTree.update({id:n.replay_tree.id,cursor_path:T}),i("replay_tree","cursor_path",T)};return Object.assign(e,{set_write_enabled_replay_tree(T){a(T)},reload_replay_tree_with_cursor_path(T){c(["by_id",n.replay_tree.id,T])},reset_replay_tree(){c(void 0)},load_replay_tree(T){c(T)},load_replay_tree_by_id(T,I){c(["by_id",T,I])},load_replay_tree_by_due_move(T){ht(()=>{c(["by_due_move",T]),a(!1)})},set_success_path:T=>{i("replay_tree","success_path",T)},set_failed_path:T=>{i("replay_tree","failed_path",T)},set_hide_after_path:T=>{i("replay_tree","hide_after_path",T)},goto_path_force:g,goto_path:m,goto_path_if_can(T){T!==void 0&&m(T)},delete_at_and_after_path(T){let I=vt(T),X=su(n.replay_tree.steps_tree,T);o()&&t.ReplayTree.delete_tree_nodes(X.map(K=>K.id)),ht(()=>{i("replay_tree","steps_tree","flat_nodes",I,K=>K.filter(B=>B.step.path!==T)),X.forEach(K=>{i("replay_tree","steps_tree","flat_nodes",K.step.path,void 0)})}),m(I)},async tree_step_node_set_nags(T,I){let X=vt(T.step.path),K={id:T.id,nags:I};o()&&await t.ReplayTree.update_tree_node(K);let B=n.replay_tree.steps_tree.flat_nodes[X];i("replay_tree","steps_tree","flat_nodes",X,B.indexOf(T),"nags",I)},async add_child_san_to_current_path(T){let I=n.replay_tree.cursor_path,K=xe(n.replay_tree.steps_tree,I).find(Me=>Me.step.san===T);if(K)return K;let B=n.replay_tree.steps_tree.initial_fen,V=wt(n.replay_tree.steps_tree,I),J=V?Yo(V.step,T):Wo(T,B),re=await t.ReplayTree.create_node(n.replay_tree.steps_tree_id,J,void 0,void 0,o());return n.replay_tree.steps_tree.flat_nodes[I]?i("replay_tree","steps_tree","flat_nodes",I,Me=>[...Me,re]):i("replay_tree","steps_tree","flat_nodes",I,[re]),re},async add_child_san_to_success_or_error_path_no_save(T){let I=n.replay_tree.cursor_path,K=xe(n.replay_tree.steps_tree,I).find(fe=>fe.step.san===T);if(K)return n.replay_tree.error_paths.includes(K.step.path)?["error",K]:(i("replay_tree","solved_paths",fe=>[K.step.path,...fe]),["success",K]);let B=wt(n.replay_tree.steps_tree,I),V=B?Yo(B.step,T):Wo(T,n.replay_tree.steps_tree.initial_fen),J=await t.ReplayTree.create_node(n.replay_tree.steps_tree_id,V,void 0,void 0,!1),re=n.replay_tree.steps_tree.flat_nodes[I];return ht(()=>{re?i("replay_tree","steps_tree","flat_nodes",I,fe=>[...fe,J]):i("replay_tree","steps_tree","flat_nodes",I,[J]),i("replay_tree","error_paths",fe=>[J.step.path,...fe])}),["error",J]},async chapter_as_export_pgn(T,I,X){let K=await t.ReplayTree.by_chapter_id(X.id);return mh(T,I,X,K.steps_tree)},async change_root_fen(T,I){await t.ReplayTree.change_root_fen(T,I),console.log("here"),ht(()=>{c(void 0),c(T)})}}),y}var _e=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(_e||{}),Y=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(Y||{});class he{static card(e){return{...e,state:he.state(e.state),due:he.time(e.due),last_review:e.last_review?he.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),i=e.slice(1).toLowerCase(),o=Y[`${n}${i}`];if(o===void 0)throw new Error(`Invalid rating:[${e}]`);return o}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){const n=e.charAt(0).toUpperCase(),i=e.slice(1).toLowerCase(),o=_e[`${n}${i}`];if(o===void 0)throw new Error(`Invalid state:[${e}]`);return o}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){const n=Date.parse(e);if(isNaN(n))throw new Error(`Invalid date:[${e}]`);return new Date(n)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:he.time(e.due),rating:he.rating(e.rating),state:he.state(e.state),review:he.time(e.review)}}}Date.prototype.scheduler=function(t,e){return Eh(this,t,e)},Date.prototype.diff=function(t,e){return Ah(this,t,e)},Date.prototype.format=function(){return Sh(this)},Date.prototype.dueFormat=function(t,e,n){return Oh(this,t,e,n)};function Eh(t,e,n){return new Date(n?yn(t).getTime()+e*24*60*60*1e3:yn(t).getTime()+e*60*1e3)}function Ah(t,e,n){if(!t||!e)throw new Error("Invalid date");const i=yn(t).getTime()-yn(e).getTime();let o=0;switch(n){case"days":o=Math.floor(i/(24*60*60*1e3));break;case"minutes":o=Math.floor(i/(60*1e3));break}return o}function Sh(t){const e=yn(t),n=e.getFullYear(),i=e.getMonth()+1,o=e.getDate(),a=e.getHours(),l=e.getMinutes(),c=e.getSeconds();return`${n}-${cr(i)}-${cr(o)} ${cr(a)}:${cr(l)}:${cr(c)}`}function cr(t){return t<10?`0${t}`:`${t}`}const us=[60,60,24,31,12],cs=["second","min","hour","day","month","year"];function Oh(t,e,n,i=cs){t=yn(t),e=yn(e),i.length!==cs.length&&(i=cs);let o=t.getTime()-e.getTime(),a;for(o/=1e3,a=0;a<us.length&&!(o<us[a]);a++)o/=us[a];return`${Math.floor(o)}${n?i[a]:""}`}function yn(t){return he.time(t)}const Ph=[Y.Again,Y.Hard,Y.Good,Y.Easy],Ch=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function Rh(t,e,n){let i=1;for(const l of Ch)i+=l.factor*Math.max(Math.min(t,l.end)-l.start,0);t=Math.min(t,n);let o=Math.max(2,Math.round(t-i));const a=Math.min(Math.round(t+i),n);return t>e&&(o=Math.max(o,e+1)),o=Math.min(o,a),{min_ivl:o,max_ivl:a}}function cn(t,e,n){return Math.min(Math.max(t,e),n)}function Th(t,e){const n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),i=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((i-n)/864e5)}const Dh=.9,Nh=36500,$h=[.40255,1.18385,3.173,15.69105,7.1949,.5345,1.4604,.0046,1.54575,.1192,1.01925,1.9395,.11,.29605,2.2698,.2315,2.9898,.51655,.6621],Mh=!1,jh=!0,ft=.01,Xr=100,Jo=[[ft,Xr],[ft,Xr],[ft,Xr],[ft,Xr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,2],[0,2]],Zo=t=>{let e=$h;return t?.w&&(t.w.length===19?e=t?.w:t.w.length===17&&(e=t?.w.concat([0,0]),e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS V5]auto fill w to 19 length"))),e=e.map((n,i)=>cn(n,Jo[i][0],Jo[i][1])),{request_retention:t?.request_retention||Dh,maximum_interval:t?.maximum_interval||Nh,w:e,enable_fuzz:t?.enable_fuzz??Mh,enable_short_term:t?.enable_short_term??jh}};function ci(t,e){return{due:t?he.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:_e.New,last_review:void 0}}class Kh{c;s0;s1;s2;constructor(e){const n=Ih();this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),e==null&&(e=+new Date),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function Ih(){let t=4022871197;return function(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296}return(t>>>0)*23283064365386963e-26}}function Lh(t){const e=new Kh(t),n=()=>e.next();return n.int32=()=>e.next()*4294967296|0,n.double=()=>n()+(n()*2097152|0)*11102230246251565e-32,n.state=()=>e.state,n.importState=i=>(e.state=i,n),n}const ea=-.5,ta=19/81;class Fh{param;intervalModifier;_seed;constructor(e){this.param=new Proxy(Zo(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(e,1/ea)-1)/ta).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){const e=this;return{set:function(n,i,o){return i==="request_retention"&&Number.isFinite(o)&&(e.intervalModifier=e.calculate_interval_modifier(Number(o))),Reflect.set(n,i,o),!0}}}update_parameters(e){const n=Zo(e);for(const i in n)if(i in this.param){const o=i;this.param[o]=n[o]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return this.constrain_difficulty(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1)}apply_fuzz(e,n){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);const i=Lh(this._seed)(),{min_ivl:o,max_ivl:a}=Rh(e,n,this.param.maximum_interval);return Math.floor(i*(a-o+1)+o)}next_interval(e,n){const i=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(i,n)}linear_damping(e,n){return+(e*(10-n)/9).toFixed(8)}next_difficulty(e,n){const i=-this.param.w[6]*(n-3),o=e+this.linear_damping(i,e);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(Y.Easy),o))}constrain_difficulty(e){return Math.min(Math.max(+e.toFixed(8),1),10)}mean_reversion(e,n){return+(this.param.w[7]*e+(1-this.param.w[7])*n).toFixed(8)}next_recall_stability(e,n,i,o){const a=Y.Hard===o?this.param.w[15]:1,l=Y.Easy===o?this.param.w[16]:1;return+cn(n*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(n,-this.param.w[9])*(Math.exp((1-i)*this.param.w[10])-1)*a*l),ft,36500).toFixed(8)}next_forget_stability(e,n,i){return+cn(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(n+1,this.param.w[13])-1)*Math.exp((1-i)*this.param.w[14]),ft,36500).toFixed(8)}next_short_term_stability(e,n){return+cn(e*Math.exp(this.param.w[17]*(n-3+this.param.w[18])),ft,36500).toFixed(8)}forgetting_curve(e,n){return+Math.pow(1+ta*e/n,ea).toFixed(8)}next_state(e,n,i){const{difficulty:o,stability:a}=e??{difficulty:0,stability:0};if(n<0)throw new Error(`Invalid delta_t "${n}"`);if(i<0||i>4)throw new Error(`Invalid grade "${i}"`);if(o===0&&a===0)return{difficulty:this.init_difficulty(i),stability:this.init_stability(i)};if(i===0)return{difficulty:o,stability:a};if(o<1||a<ft)throw new Error(`Invalid memory state { difficulty: ${o}, stability: ${a} }`);const l=this.forgetting_curve(n,a),c=this.next_recall_stability(o,a,l,i),p=this.next_forget_stability(o,a,l),y=this.next_short_term_stability(a,i);let m=c;if(i===1){let[g,R]=[0,0];this.param.enable_short_term&&(g=this.param.w[17],R=this.param.w[18]);const $=a/Math.exp(g*R);m=cn(+$.toFixed(8),ft,p)}return n===0&&this.param.enable_short_term&&(m=y),{difficulty:this.next_difficulty(o,i),stability:m}}}function lu(){const t=this.review_time.getTime(),e=this.current.reps,n=this.current.difficulty*this.current.stability;return`${t}_${e}_${n}`}var Ts=(t=>(t.SCHEDULER="Scheduler",t.SEED="Seed",t))(Ts||{});class fu{last;current;review_time;next=new Map;algorithm;initSeedStrategy;constructor(e,n,i,o={seed:lu}){this.algorithm=i,this.initSeedStrategy=o.seed.bind(this),this.last=he.card(e),this.current=he.card(e),this.review_time=he.time(n),this.init()}init(){const{state:e,last_review:n}=this.current;let i=0;e!==_e.New&&n&&(i=Th(n,this.review_time)),this.current.last_review=this.review_time,this.current.elapsed_days=i,this.current.reps+=1,this.algorithm.seed=this.initSeedStrategy()}preview(){return{[Y.Again]:this.review(Y.Again),[Y.Hard]:this.review(Y.Hard),[Y.Good]:this.review(Y.Good),[Y.Easy]:this.review(Y.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const e of Ph)yield this.review(e)}review(e){const{state:n}=this.last;let i;switch(n){case _e.New:i=this.newState(e);break;case _e.Learning:case _e.Relearning:i=this.learningState(e);break;case _e.Review:i=this.reviewState(e);break}if(i)return i;throw new Error("Invalid grade")}buildLog(e){const{last_review:n,due:i,elapsed_days:o}=this.last;return{rating:e,state:this.current.state,due:n||i,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:o,scheduled_days:this.current.scheduled_days,review:this.review_time}}}class na extends fu{newState(e){const n=this.next.get(e);if(n)return n;const i=he.card(this.current);switch(i.difficulty=this.algorithm.init_difficulty(e),i.stability=this.algorithm.init_stability(e),e){case Y.Again:i.scheduled_days=0,i.due=this.review_time.scheduler(1),i.state=_e.Learning;break;case Y.Hard:i.scheduled_days=0,i.due=this.review_time.scheduler(5),i.state=_e.Learning;break;case Y.Good:i.scheduled_days=0,i.due=this.review_time.scheduler(10),i.state=_e.Learning;break;case Y.Easy:{const a=this.algorithm.next_interval(i.stability,this.current.elapsed_days);i.scheduled_days=a,i.due=this.review_time.scheduler(a,!0),i.state=_e.Review;break}default:throw new Error("Invalid grade")}const o={card:i,log:this.buildLog(e)};return this.next.set(e,o),o}learningState(e){const n=this.next.get(e);if(n)return n;const{state:i,difficulty:o,stability:a}=this.last,l=he.card(this.current),c=this.current.elapsed_days;switch(l.difficulty=this.algorithm.next_difficulty(o,e),l.stability=this.algorithm.next_short_term_stability(a,e),e){case Y.Again:{l.scheduled_days=0,l.due=this.review_time.scheduler(5,!1),l.state=i;break}case Y.Hard:{l.scheduled_days=0,l.due=this.review_time.scheduler(10),l.state=i;break}case Y.Good:{const y=this.algorithm.next_interval(l.stability,c);l.scheduled_days=y,l.due=this.review_time.scheduler(y,!0),l.state=_e.Review;break}case Y.Easy:{const y=this.algorithm.next_short_term_stability(a,Y.Good),m=this.algorithm.next_interval(y,c),g=Math.max(this.algorithm.next_interval(l.stability,c),m+1);l.scheduled_days=g,l.due=this.review_time.scheduler(g,!0),l.state=_e.Review;break}default:throw new Error("Invalid grade")}const p={card:l,log:this.buildLog(e)};return this.next.set(e,p),p}reviewState(e){const n=this.next.get(e);if(n)return n;const i=this.current.elapsed_days,{difficulty:o,stability:a}=this.last,l=this.algorithm.forgetting_curve(i,a),c=he.card(this.current),p=he.card(this.current),y=he.card(this.current),m=he.card(this.current);this.next_ds(c,p,y,m,o,a,l),this.next_interval(c,p,y,m,i),this.next_state(c,p,y,m),c.lapses+=1;const g={card:c,log:this.buildLog(Y.Again)},R={card:p,log:super.buildLog(Y.Hard)},$={card:y,log:super.buildLog(Y.Good)},U={card:m,log:super.buildLog(Y.Easy)};return this.next.set(Y.Again,g),this.next.set(Y.Hard,R),this.next.set(Y.Good,$),this.next.set(Y.Easy,U),this.next.get(e)}next_ds(e,n,i,o,a,l,c){e.difficulty=this.algorithm.next_difficulty(a,Y.Again);const p=l/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),y=this.algorithm.next_forget_stability(a,l,c);e.stability=cn(+p.toFixed(8),ft,y),n.difficulty=this.algorithm.next_difficulty(a,Y.Hard),n.stability=this.algorithm.next_recall_stability(a,l,c,Y.Hard),i.difficulty=this.algorithm.next_difficulty(a,Y.Good),i.stability=this.algorithm.next_recall_stability(a,l,c,Y.Good),o.difficulty=this.algorithm.next_difficulty(a,Y.Easy),o.stability=this.algorithm.next_recall_stability(a,l,c,Y.Easy)}next_interval(e,n,i,o,a){let l,c;l=this.algorithm.next_interval(n.stability,a),c=this.algorithm.next_interval(i.stability,a),l=Math.min(l,c),c=Math.max(c,l+1);const p=Math.max(this.algorithm.next_interval(o.stability,a),c+1);e.scheduled_days=0,e.due=this.review_time.scheduler(5),n.scheduled_days=l,n.due=this.review_time.scheduler(l,!0),i.scheduled_days=c,i.due=this.review_time.scheduler(c,!0),o.scheduled_days=p,o.due=this.review_time.scheduler(p,!0)}next_state(e,n,i,o){e.state=_e.Relearning,n.state=_e.Review,i.state=_e.Review,o.state=_e.Review}}class ra extends fu{newState(e){const n=this.next.get(e);if(n)return n;this.current.scheduled_days=0,this.current.elapsed_days=0;const i=he.card(this.current),o=he.card(this.current),a=he.card(this.current),l=he.card(this.current);return this.init_ds(i,o,a,l),this.next_interval(i,o,a,l,0),this.next_state(i,o,a,l),this.update_next(i,o,a,l),this.next.get(e)}init_ds(e,n,i,o){e.difficulty=this.algorithm.init_difficulty(Y.Again),e.stability=this.algorithm.init_stability(Y.Again),n.difficulty=this.algorithm.init_difficulty(Y.Hard),n.stability=this.algorithm.init_stability(Y.Hard),i.difficulty=this.algorithm.init_difficulty(Y.Good),i.stability=this.algorithm.init_stability(Y.Good),o.difficulty=this.algorithm.init_difficulty(Y.Easy),o.stability=this.algorithm.init_stability(Y.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){const n=this.next.get(e);if(n)return n;const i=this.current.elapsed_days,{difficulty:o,stability:a}=this.last,l=this.algorithm.forgetting_curve(i,a),c=he.card(this.current),p=he.card(this.current),y=he.card(this.current),m=he.card(this.current);return this.next_ds(c,p,y,m,o,a,l),this.next_interval(c,p,y,m,i),this.next_state(c,p,y,m),c.lapses+=1,this.update_next(c,p,y,m),this.next.get(e)}next_ds(e,n,i,o,a,l,c){e.difficulty=this.algorithm.next_difficulty(a,Y.Again);const p=this.algorithm.next_forget_stability(a,l,c);e.stability=cn(l,ft,p),n.difficulty=this.algorithm.next_difficulty(a,Y.Hard),n.stability=this.algorithm.next_recall_stability(a,l,c,Y.Hard),i.difficulty=this.algorithm.next_difficulty(a,Y.Good),i.stability=this.algorithm.next_recall_stability(a,l,c,Y.Good),o.difficulty=this.algorithm.next_difficulty(a,Y.Easy),o.stability=this.algorithm.next_recall_stability(a,l,c,Y.Easy)}next_interval(e,n,i,o,a){let l,c,p,y;l=this.algorithm.next_interval(e.stability,a),c=this.algorithm.next_interval(n.stability,a),p=this.algorithm.next_interval(i.stability,a),y=this.algorithm.next_interval(o.stability,a),l=Math.min(l,c),c=Math.max(c,l+1),p=Math.max(p,c+1),y=Math.max(y,p+1),e.scheduled_days=l,e.due=this.review_time.scheduler(l,!0),n.scheduled_days=c,n.due=this.review_time.scheduler(c,!0),i.scheduled_days=p,i.due=this.review_time.scheduler(p,!0),o.scheduled_days=y,o.due=this.review_time.scheduler(y,!0)}next_state(e,n,i,o){e.state=_e.Review,n.state=_e.Review,i.state=_e.Review,o.state=_e.Review}update_next(e,n,i,o){const a={card:e,log:this.buildLog(Y.Again)},l={card:n,log:super.buildLog(Y.Hard)},c={card:i,log:super.buildLog(Y.Good)},p={card:o,log:super.buildLog(Y.Easy)};this.next.set(Y.Again,a),this.next.set(Y.Hard,l),this.next.set(Y.Good,c),this.next.set(Y.Easy,p)}}class Bh{fsrs;constructor(e){this.fsrs=e}replay(e,n,i){return this.fsrs.next(e,n,i)}handleManualRating(e,n,i,o,a,l,c){if(typeof n>"u")throw new Error("reschedule: state is required for manual rating");let p,y;if(n===_e.New)p={rating:Y.Manual,state:n,due:c??i,stability:e.stability,difficulty:e.difficulty,elapsed_days:o,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:i},y=ci(i),y.last_review=i;else{if(typeof c>"u")throw new Error("reschedule: due is required for manual rating");const m=c.diff(i,"days");p={rating:Y.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:o,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:i},y={...e,state:n,due:c,last_review:i,stability:a||e.stability,difficulty:l||e.difficulty,elapsed_days:o,scheduled_days:m,reps:e.reps+1}}return{card:y,log:p}}reschedule(e,n){const i=[];let o=ci(e.due);for(const a of n){let l;if(a.review=he.time(a.review),a.rating===Y.Manual){let c=0;o.state!==_e.New&&o.last_review&&(c=a.review.diff(o.last_review,"days")),l=this.handleManualRating(o,a.state,a.review,c,a.stability,a.difficulty,a.due?he.time(a.due):void 0)}else l=this.replay(o,a.review,a.rating);i.push(l),o=l.card}return i}calculateManualRecord(e,n,i,o){if(!i)return null;const{card:a,log:l}=i,c=he.card(e);return c.due.getTime()===a.due.getTime()?null:(c.scheduled_days=a.due.diff(c.due,"days"),this.handleManualRating(c,a.state,he.time(n),l.elapsed_days,o?a.stability:void 0,o?a.difficulty:void 0,a.due))}}class $d extends Fh{strategyHandler=new Map;Scheduler;constructor(e){super(e);const{enable_short_term:n}=this.parameters;this.Scheduler=n?na:ra}params_handler_proxy(){const e=this;return{set:function(n,i,o){return i==="request_retention"&&Number.isFinite(o)?e.intervalModifier=e.calculate_interval_modifier(Number(o)):i==="enable_short_term"&&(e.Scheduler=o===!0?na:ra),Reflect.set(n,i,o),!0}}}useStrategy(e,n){return this.strategyHandler.set(e,n),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,n){const i=this.strategyHandler.get(Ts.SEED),o=this.strategyHandler.get(Ts.SCHEDULER)||this.Scheduler,a=i||lu;return new o(e,n,this,{seed:a})}repeat(e,n,i){const o=this.getScheduler(e,n).preview();return i&&typeof i=="function"?i(o):o}next(e,n,i,o){const a=this.getScheduler(e,n),l=he.rating(i);if(l===Y.Manual)throw new Error("Cannot review a manual rating");const c=a.review(l);return o&&typeof o=="function"?o(c):c}get_retrievability(e,n,i=!0){const o=he.card(e);n=n?he.time(n):new Date;const a=o.state!==_e.New?Math.max(n.diff(o.last_review,"days"),0):0,l=o.state!==_e.New?this.forgetting_curve(a,+o.stability.toFixed(8)):0;return i?`${(l*100).toFixed(2)}%`:l}rollback(e,n,i){const o=he.card(e),a=he.review_log(n);if(a.rating===Y.Manual)throw new Error("Cannot rollback a manual rating");let l,c,p;switch(a.state){case _e.New:l=a.due,c=void 0,p=0;break;case _e.Learning:case _e.Relearning:case _e.Review:l=a.review,c=a.due,p=o.lapses-(a.rating===Y.Again&&a.state===_e.Review?1:0);break}const y={...o,due:l,stability:a.stability,difficulty:a.difficulty,elapsed_days:a.last_elapsed_days,scheduled_days:a.scheduled_days,reps:Math.max(0,o.reps-1),lapses:Math.max(0,p),state:a.state,last_review:c};return i&&typeof i=="function"?i(y):y}forget(e,n,i=!1,o){const a=he.card(e);n=he.time(n);const l=a.state===_e.New?0:n.diff(a.last_review,"days"),c={rating:Y.Manual,state:a.state,due:a.due,stability:a.stability,difficulty:a.difficulty,elapsed_days:0,last_elapsed_days:a.elapsed_days,scheduled_days:l,review:n},p={card:{...a,due:n,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:a.reps,lapses:i?0:a.lapses,state:_e.New,last_review:a.last_review},log:c};return o&&typeof o=="function"?o(p):p}reschedule(e,n=[],i={}){const{recordLogHandler:o,reviewsOrderBy:a,skipManual:l=!0,now:c=new Date,update_memory_state:p=!1}=i;a&&typeof a=="function"&&n.sort(a),l&&(n=n.filter(U=>U.rating!==Y.Manual));const y=new Bh(this),m=y.reschedule(i.first_card||ci(),n),g=m.length,R=he.card(e),$=y.calculateManualRecord(R,c,g?m[g-1]:void 0,p);return o&&typeof o=="function"?{collections:m.map(o),reschedule_item:$?o($):null}:{collections:m,reschedule_item:$}}}function qh(t,e,n,i){const[o,a]=Ce(),l=di(async()=>{let c=o();return c===void 0?{list:[]}:{list:await t.DueMoves.by_study_id(...c)}},{initialValue:{list:[]}});return Object.assign(e,{load_due_moves(c,p){a([c,p])},async save_due_move_if_not(c){c.is_saved||(await t.DueMoves.save_due_move(c),i("due_moves","list",p=>p.id===c.id,"is_saved",!0))},async add_attempt_with_spaced_repetition(c,p,y){let m=ci(),g=p.attempts[0]?.card;if(g){let $;switch(y){case"failed":$=Y.Hard;break;case"failed-with-hint":$=Y.Again;break;case"failed-with-skip":$=Y.Again;break;case"solved":$=Y.Easy;break;case"solved-with-hint":$=Y.Good;break}m=c.repeat(g,new Date)[$].card}let R=await t.DueMoves.new_attempt(p.id,y,m);i("due_moves","list",$=>$.id===p.id,"attempts",$=>[R,...$])}}),l}const hu=Tt();function Uh(t){let e,n,i,o,[a,l]=$a({get studies(){return e()},get chapters(){return n()},get replay_tree(){return i()},get due_moves(){return o()}}),c={},p=[a,c],y=Ff();return e=Bf(y,c,a,l),n=qf(y,c,a,l),i=xh(y,c,a,l),o=qh(y,c,a,l),ee(hu.Provider,{value:p,get children(){return t.children}})}function Md(){return bt(hu)}const Vh=1,du=Tt();function zh(t){let[e,n]=ru($a({repeat_selected_study_id:void 0,selected_section_ids:{}}),{name:".aidchess.pstore?v"+Vh}),o=[e,{set_repeat_selected_study(a){n("repeat_selected_study_id",a)},toggle_repeat_study_section(a){let l=e.repeat_selected_study_id;if(!l)return;let c=e.selected_section_ids[l];c?c.includes(a)?n("selected_section_ids",l,p=>p.filter(y=>y!==a)):n("selected_section_ids",l,p=>[...p,a]):n("selected_section_ids",l,[a])}}];return ee(du.Provider,{value:o,get children(){return t.children}})}const jd=()=>bt(du);var Hh=Xe("<main class=not-found><h3>404 Not Found"),Gh=Xe('<header id=top><div class=site-title-nav><input type=checkbox id=tn-tg class="topnav-toggle fullscreen-toggle"><label for=tn-tg class=fullscreen-mask></label><label for=tn-tg class=hbg><span class=hbg__in></span></label><h1 class=site-title> <small></small> </h1><nav id=topnav><section></section><section></section><section></section><section></section><section></section></nav></div><div class=site-buttons><div class=dasher>'),Wh=Xe("<div>");const Yh=zt(()=>Ht(()=>import("./Home-BXKD9t2i.js"),__vite__mapDeps([0,1]))),Rn=zt(()=>Ht(()=>import("./Contact-CN7chQtM.js"),__vite__mapDeps([2,3]))),Qh=zt(()=>Ht(()=>import("./Placeholder-ItQnVkg2.js"),[])),pu=zt(()=>Ht(()=>import("./Beta-DC677eJz.js"),__vite__mapDeps([4,5]))),Xh=zt(()=>Ht(()=>import("./List-DbIg5vqC.js"),__vite__mapDeps([6,7]))),Jh=zt(()=>Ht(()=>import("./Show-CHQXOo3J.js"),__vite__mapDeps([8,9,10,11]))),Zh=zt(()=>Ht(()=>import("./List-DregIU3g.js"),__vite__mapDeps([12,13]))),ed=zt(()=>Ht(()=>import("./Show-BP7DMmmb.js"),__vite__mapDeps([14,12,13,9,10,15]))),td=()=>ee(ml,{get children(){return ee(ol,{root:rd,get children(){return[ee(We,{path:"/",component:Yh}),ee(We,{path:"/builder",component:Qh}),ee(We,{path:"/beta",component:pu}),ee(We,{path:"/openings",component:Xh}),ee(We,{path:"/openings/:id",component:Jh}),ee(We,{path:"/repetition",component:Zh}),ee(We,{path:"/repetition/:id",component:ed}),ee(We,{path:"/contact",component:Rn}),ee(We,{path:"/terms",component:Rn}),ee(We,{path:"/privacy",component:Rn}),ee(We,{path:"/about",component:Rn}),ee(We,{path:"/donate",component:Rn}),ee(We,{path:"/thanks",component:Rn}),ee(We,{path:"*",component:nd})]}})}}),nd=()=>(()=>{var t=Hh();return t.firstChild,we(t,ee(Ot,{href:"/",children:"Go back home."}),null),t})(),rd=t=>ee(Mf,{get children(){return ee(zh,{get children(){return ee(Uh,{get children(){return ee(id,t)}})}})}}),id=t=>{let e=hi(),n=te(()=>e.pathname.split("/")[1]);const i=()=>{let c=n();return c===""?"home":c},o=()=>`on-${i()}`,[a,l]=Ce(!1,{equals:!1});return Vc(()=>{l(!1)}),[(()=>{var c=Gh(),p=c.firstChild,y=p.firstChild,m=y.nextSibling,g=m.nextSibling,R=g.nextSibling,$=R.firstChild,U=$.nextSibling,T=R.nextSibling,I=T.firstChild,X=I.nextSibling,K=X.nextSibling,B=K.nextSibling,V=B.nextSibling,J=p.nextSibling,re=J.firstChild;return we(R,ee(Ot,{href:"/",children:"aidchess.com"}),$),we(U,ee(Ot,{class:"beta",href:"/beta",children:"beta"})),we(I,ee(Ot,{class:"home",href:"/",children:"aidchess.com"})),we(X,ee(Ot,{href:"/builder",target:"_self",children:"Builder"})),we(K,ee(Ot,{href:"/openings",children:"Openings"})),we(B,ee(Ot,{href:"/repetition",children:"Repetition"})),we(V,ee(Ot,{class:"donate",href:"/donate",target:"_self",children:"Donate"})),we(re,ee(Ot,{href:"/dashboard",children:"Dashboard"})),nt(()=>y.checked=a()),c})(),(()=>{var c=Wh();return we(c,ee(dt,{get when(){return!1},get fallback(){return ee(cc,{fallback:p=>pu(),get children(){return t.children}})},get children(){return t.children}})),nt(()=>wa(c,"main-wrap "+o())),c})()]},sd=document.getElementById("root");vc(()=>ee(td,{}),sd);export{Vt as $,Ot as A,gt as B,Nl as C,xd as D,vr as E,ga as F,Fn as G,Vl as H,Ft as I,Ba as J,Va as K,ja as L,cd as M,Ua as N,Ce as O,Dl as P,$a as Q,mr as R,ud as S,Ul as T,In as U,od as V,xc as W,Ec as X,ht as Y,ct as Z,Wu as _,hi as a,$s as a0,va as a1,Ed as a2,ca as a3,fd as a4,Oo as a5,Ct as a6,gr as a7,gh as a8,Td as a9,wt as aa,Jl as ab,Dd as ac,Nd as ad,Sd as ae,Od as af,xe as ag,Fs as ah,kd as ai,Ad as aj,Cd as ak,Rd as al,ad as am,Pd as an,rc as ao,vt as ap,bt as aq,Tt as ar,$d as as,Ye as at,pn as au,jd as av,te as b,ee as c,Ns as d,nt as e,wa as f,Md as g,hd as h,we as i,fi as j,dt as k,ld as l,Ln as m,an as n,le as o,On as p,j as q,oe as r,ys as s,Xe as t,Oa as u,_r as v,dn as w,un as x,pi as y,Ie as z};
