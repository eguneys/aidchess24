import{B as me,a as k,g as d,D as be,n as J,i,c,F as j,S as b,j as ne,k as se,d as xe,t as f,E as Se,G as ie,q as K,x as L}from"./index-CZL4b7iT.js";import{S as we,C as ke}from"./Chessboard-B6V2DqdC.js";import"./chessground-lU4YbH_i.js";const Ce=_=>_.trim().split(`
`).map(t=>{let[u,g,x,N]=t.split(","),B=parseInt(g),D=N.split("/").map(h=>{let[C,p]=h.split(" ");return C}).slice(0,B);return{fen:x,candidates:D}}),ye=()=>fetch("puzzles/puzzles.csv").then(_=>_.text()).then(_=>Ce(_));class ze{i_next;all;constructor(){this.i_next=me(0,"candidates_i_next")}async fetch_candidates(){this.all=await ye()}get_current_8(){let t=this.i_next[0]();return this.all.slice(t,t+8)}get_next_8(){let t=this.i_next[0]()+8;return t+8>this.all.length&&(t=0),this.i_next[1](t),this.get_current_8()}}let U=new ze;await U.fetch_candidates();var Pe=f("<div class=results><h3>Total Score: <!> </h3><ul class=cc-list></ul><div class=cc-compare><a class=analyse> Analyse on lichess </a><div class=compare><div><h4>You</h4><ul></ul></div><div><h4>Answer</h4><ul></ul></div></div><div class=q-score><span>Score: </span></div></div><div class=next-cc><a>New Puzzles"),Te=f("<div class=widen><div class=board-wrap></div><div class=replay-wrap><div class=header>Widen Your Search</div><div class=replay>"),Ee=f("<a class=link>See Results"),Me=f("<div class=questions><h3>There are <!> Candidate Moves</h3><small>Positions taken from masters games</small><p>that doesn't worsen the position too much.</p><p>Try to guess what they are.</p><p>Order is considered for extra score.</p><small>Some positions are not winning, try to find the best resistance.</small><h3> of 8</h3><ul class=candidates>"),Ne=f("<div><span>--"),Q=f("<li>"),qe=f("<div><span></span><a>Takeback"),Ae=f("<a class=link>Next Position"),Re=f("<li> <span>");class M{constructor(t,u,g="none",x){this.pvs=t,this.fen=u,this.solution_uci=x,this._state=k(g),this._uci=k()}get score(){let{uci:t,solution_uci:u}=this;return t?t===u?5:this.pvs.includes(t)?2:0:0}takeback(){this.uci=void 0,this.state="guess"}get applied_fen(){let t=this.uci;return t?Se(this.fen,t):this.fen}get solution_san(){let t=this.solution_uci;if(t)return ie(this.fen,t)}get san(){let t=this.uci;if(t)return ie(this.fen,t)}get uci(){return this._uci[0]()}set uci(t){this._uci[1](t)}get state(){return this._state[0]()}set state(t){this._state[1](t)}_uci;_state}const je=()=>{let[_,t]=k(U.get_current_8()),[u,g]=k(0),x=d(()=>_()[u()]);const N=d(()=>x().fen);let B=d(()=>x().candidates);const D=d(()=>B().length);let h=new we;const[C,p]=k(1),le=e=>{if(C()===e)return"active"},re=e=>{if(u()===e)return"active"},ae=d(()=>be(N())),V=d(()=>_().map(e=>{let s=e.fen,n=e.candidates.length,l=e.candidates;return[new M(l,s,n>=2?"guess":void 0,l[0]),new M(l,s,n>=2?"guess":void 0,l[1]),new M(l,s,n>=3?"guess":void 0,l[2]),new M(l,s,n>=4?"guess":void 0,l[3]),new M(l,s,n>=5?"guess":void 0,l[4])]})),$=d(()=>V()[u()]),ce=d(()=>V().map(e=>e.map(s=>s.score).reduce((s,n)=>s+n,0)).reduce((e,s)=>e+s,0));J(K(N,e=>{h.on_set_fen_uci(e)}));const y=d(()=>$()[C()-1]);J(K(()=>y().applied_fen,e=>{let s=y().uci;ee()||h.on_set_fen_uci(e,s)})),J(K(()=>h.add_uci,e=>{if(!e)return;let[s]=e,n=y();n.state==="guess"&&(n.state="filled",n.uci=s,X=setTimeout(()=>{_e()},1e3))}));let X;const _e=()=>{let e=$(),s=C();for(let n=s+1;n<=5;n++)if(e[n-1].state==="guess"){p(n);return}for(let n=1;n<s;n++)if(e[n-1].state==="guess"){p(n);return}},ue=()=>y().state==="guess",oe=d(()=>$().filter(e=>e.state==="guess").length===0),de=d(()=>u()===7),he=()=>{Z(u()+1)},Z=e=>{L(()=>{clearTimeout(X),g(e),p(1)})},[ee,te]=k(!1),fe=()=>{L(()=>{te(!0),g(0)})},ge=()=>{L(()=>{t(U.get_next_8()),g(0),p(1),te(!1)})},pe=()=>{let e=y().fen.replace(" ","%20");window.open(`https://lichess.org/analysis?fen=${e}`,"_blank")};return(()=>{var e=Te(),s=e.firstChild,n=s.nextSibling,l=n.firstChild,$e=l.nextSibling;return i(s,c(ke,{get orientation(){return ae()},get movable(){return ue()},get doPromotion(){return h.promotion},get onMoveAfter(){return h.on_move_after},get fen_uci(){return h.fen_uci},get color(){return h.turnColor},get dests(){return h.dests}})),i($e,c(b,{get when(){return ee()},get fallback(){return(()=>{var S=Me(),v=S.firstChild,G=v.firstChild,z=G.nextSibling;z.nextSibling;var q=v.nextSibling,A=q.nextSibling,R=A.nextSibling,F=R.nextSibling,W=F.nextSibling,P=W.nextSibling,I=P.firstChild,O=P.nextSibling;return i(v,D,z),i(P,()=>u()+1,I),i(O,c(j,{get each(){return $()},children:(r,T)=>c(b,{get when(){return r.state!=="none"},get children(){var w=Q();return w.$$click=()=>p(T()+1),i(w,c(b,{get when(){return r.state==="guess"},get fallback(){return(()=>{var E=qe(),Y=E.firstChild,H=Y.nextSibling;return i(Y,()=>r.san),H.$$click=()=>{r.takeback(),p(T()+1)},E})()},get children(){return Ne()}})),ne(()=>se(w,le(T()+1))),w}})})),i(S,c(b,{get when(){return oe()},get children(){return c(b,{get when(){return de()},get fallback(){return(()=>{var r=Ae();return r.$$click=()=>{he()},r})()},get children(){var r=Ee();return r.$$click=()=>{fe()},r}})}}),null),S})()},get children(){var S=Pe(),v=S.firstChild,G=v.firstChild,z=G.nextSibling;z.nextSibling;var q=v.nextSibling,A=q.nextSibling,R=A.firstChild,F=R.nextSibling,W=F.firstChild,P=W.firstChild,I=P.nextSibling,O=W.nextSibling,r=O.firstChild,T=r.nextSibling,w=F.nextSibling,E=w.firstChild;E.firstChild;var Y=A.nextSibling,H=Y.firstChild;return i(v,ce,z),i(q,c(j,{get each(){return _()},children:(o,a)=>(()=>{var m=Q();return m.$$click=()=>Z(a()),i(m,()=>a()+1),ne(()=>se(m,re(a()))),m})()})),R.$$click=()=>pe(),i(I,c(j,{get each(){return $()},children:o=>c(b,{get when(){return o.state!=="none"},get children(){var a=Re(),m=a.firstChild,ve=m.nextSibling;return i(a,()=>o.san,m),i(ve,()=>o.score),a}})})),i(T,c(j,{get each(){return $()},children:o=>c(b,{get when(){return o.state!=="none"},get children(){var a=Q();return i(a,()=>o.solution_san),a}})})),i(E,()=>$().map(o=>o.score).reduce((o,a)=>o+a,0),null),H.$$click=()=>{ge()},S}})),e})()};xe(["click"]);export{je as default};
