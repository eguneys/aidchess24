import{_ as me,H as V,c as m,g as S,J as be,a as E,m as Z,K as we,L,N as I,O as J,Q as $e,T as ke,x as W,r as oe,n as B,b as ee,t as C,I as D,U as xe,V as Se,W as Ne,v as te,X as de,Y as ue,d as ne,C as K,q as R,i as k,S as O,j as z,k as T,F as ce,Z as Ce,D as _e,$ as Ee,p as Be,a0 as re,a1 as H,a2 as Me,o as Oe,B as Pe,a3 as qe,a4 as Ae,u as Re}from"./index-dBa4Owhr.js";import{C as Te}from"./chessground-lU4YbH_i.js";import{s as je}from"./scroll-DnAhRpRC.js";async function De(e){const l=await Ue(e);function o(a){return l.transaction(e.store,a).objectStore(e.store)}function s(a){return new Promise((n,i)=>{const r=a();r.onsuccess=_=>n(_.target.result),r.onerror=_=>i(_.target.result)})}return{list:()=>s(()=>o("readonly").getAllKeys()),get:a=>s(()=>o("readonly").get(a)),getMany:a=>s(()=>o("readonly").getAll(a)),put:(a,n)=>s(()=>o("readwrite").put(n,a)),count:a=>s(()=>o("readonly").count(a)),remove:a=>s(()=>o("readwrite").delete(a)),clear:()=>s(()=>o("readwrite").clear()),cursor:(a,n)=>s(()=>o("readonly").openCursor(a,n)).then(i=>i??void 0),txn:a=>l.transaction(e.store,a)}}async function Ue(e){const l=e?.db||`${e.store}--db`;return new Promise((o,s)=>{const a=window.indexedDB.open(l,e?.version??1);a.onsuccess=n=>o(n.target.result),a.onerror=n=>s(n.target.error??"IndexedDB Unavailable"),a.onupgradeneeded=n=>{const i=n.target.result,r=n.target.transaction,_=i.objectStoreNames.contains(e.store)?r.objectStore(e.store):i.createObjectStore(e.store);e.upgrade?.(n,_)}})}async function Le(e){let l;await Ie({on_received:n,on_status(p){p&&(p.download&&e.on_downloaded_nb(p.download),p.error&&e.on_engine_failed(p.error))},on_connected(p){l=p}}),o("uci");function o(p){l?.(p)}function s(p){_=p,c(),f()}function a(){return!!r&&!r.stop_requested}function n(p){const u=p.trim().split(/\s+/g);if(u[0]==="uciok")o("ucinewgame"),o("isready");else if(u[0]==="readyok")f();else if(!(u[0]==="id"&&u[1]==="name"))if(u[0]==="bestmove"){r&&h&&r.emit(h),r=void 0,f();return}else if(r&&!r.stop_requested&&u[0]==="info"){let g=0,b,x=1,N,P,v=!1,w,M=[];for(let $=1;$<u.length;$++)switch(u[$]){case"depth":g=parseInt(u[++$]);break;case"nodes":b=parseInt(u[++$]);break;case"multipv":x=parseInt(u[++$]);break;case"time":N=parseInt(u[++$]);break;case"score":v=u[++$]==="mate",w=parseInt(u[++$]),(u[$+1]==="lowerbound"||u[$+1]==="upperbound")&&(P=u[++$]);break;case"pv":M=u.slice(++$),$=u.length;break}if(v&&!w||(i<x&&(i=x),!V(b)||!V(N)||!V(v)||!V(w)))return;const q=r.ply%2===1?-w:w;if(P&&x===1)return;const j={moves:M,cp:v?void 0:q,mate:v?q:void 0,depth:g};x===1?h={fen:r.current_fen,depth:g,nodes:b,millis:N,cp:v?void 0:q,mate:v?q:void 0,pvs:[j]}:h&&(h.pvs.push(j),h.depth=Math.min(h.depth,g)),x===i&&h&&(r.emit(h),g>=40&&c())}else p&&!["Stockfish","id","option","info"].includes(u[0])&&console.warn(`SF: ${p}`)}let i=0,r,_,h;function f(){if(!r&&(r=_,_=void 0,r)){h=void 0,i=1,d("Threads",r.threads),d("Hash",r.hash_size||16),d("MultiPV",Math.max(1,r.multi_pv)),y&&y!==r.game_id&&o("ucinewgame"),y=r.game_id,o(["position fen",r.initial_fen,"moves",r.moves].join(" "));const[p,u]=Object.entries(r.search)[0];o(`go ${p} ${u}`)}}let t=new Map([["Threads","1"],["Hash","16"],["MultiPV","1"],["UCI_Variant","chess"]]);function d(p,u){u=u.toString(),t.get(p)!==u&&(o(`setoption name ${p} value ${u}`),t.set(p,u))}function c(){r&&!r.stop_requested&&(r.stop_requested=!0,o("stop"))}let y;return{start(p){s(p)},stop(){s()},destroy(){o("quit")},get state(){return a()?"computing":"idle"}}}async function Ie(e){const l=t=>{e.on_status(t)},o=t=>{e.on_received(t)},s=t=>{e.on_connected(t)};let a=await me(()=>import("./sf17-79-Dr-iJHKx.js"),[],import.meta.url),n=await new Promise((t,d)=>{a.default({wasmMemory:Qe(2560),onError:c=>d(new Error(c)),locateFile:c=>`stockfish/${c}`}).then(t).catch(d)}),i=await De({store:".aidchess.nnue"}).catch(()=>{}),r=[];for(let t=0;;t++){let d=n.getRecommendedNnue(t);if(!d||r.includes(d))break;r.push(d)}(await h(r)).forEach((t,d)=>n.setNnueBuffer(t,d)),n.onError=f(),n.listen=t=>o(t),s(t=>n.uci(t));async function h(t){return Promise.all(t.map(async d=>{let c=await i?.get(d).catch(()=>{});if(c&&c.byteLength>128*1024)return c;const y=new XMLHttpRequest;y.open("get",`stockfish/nnue/${d}`,!0),y.responseType="arraybuffer",y.onprogress=u=>l({download:{bytes:u.loaded,total:u.total}});const p=await new Promise((u,g)=>{y.onerror=()=>g(new Error(`fetch '${d}' failed: ${y.status}`)),y.onload=()=>{y.status/100===2?u(new Uint8Array(y.response)):g(new Error(`fetch '${d}' failed: ${y.status}`))},y.send()});return l(),i?.put(d,p).catch(()=>console.warn("IDB store failed")),p}))}function f(){return t=>{if(t.startsWith("BAD_NNUE")&&i){const d=Math.max(0,Number(t.slice(9))),c=n.getRecommendedNnue(d);setTimeout(()=>{console.warn(`Corrupt NNUE file, removing ${c} from IDB`),i.remove(c)},2e3)}else l({error:t})}}}const Qe=(e,l=32767)=>{let o=4;for(;;)try{return new WebAssembly.Memory({shared:!0,initial:e,maximum:l})}catch(s){if(l<=e||!(s instanceof RangeError))throw s;l=Math.max(e,Math.ceil(l-l/o)),o=o===4?3:4}},fe=be();function He(e){let l=async function(){let[o,s]=E(void 0),[a,n]=E(void 0),[i]=Z(()=>Le({on_downloaded_nb(r){s(r)},on_engine_failed(r){n(r)}}));return{get download_nb(){return o()},get engine_failed(){return a()},get state(){let r=i();return i.loading||!r?"loading":r.state},async get_best_move(r,_,h,f,t){let d=u=>{},c=i();if(!c)return;let y=Math.max(1,navigator.hardwareConcurrency-2);return c.start({threads:y,hash_size:16,game_id:r,stop_requested:!1,path:[],search:{depth:t},multi_pv:f,ply:h,threatMode:!1,initial_fen:_,current_fen:_,moves:[],emit:we(200,function(u){u.depth===t&&d(u)})}),new Promise(u=>{d=u})}}};return m(fe.Provider,{get value(){return l()},get children(){return S(()=>e.children)}})}var We=C('<div class="is2d chessboard">');function Fe(){let[e,l]=E(L.fromSetup(I(D).unwrap()).unwrap(),{equals:!1}),[o,s]=E(void 0),[a,n]=E(void 0),i=S(()=>J(e().toSetup())),r=S(()=>e().turn),_=S(()=>$e(e()));const h=f=>{let t=e(),d=xe(f),c=Se(t,d);t.play(d),W(()=>{s([f,c]),n([f,c]),l(t),f.length})};return{play_orig_key(f,t){let d=e(),c=r(),y=d.board.get(ke(f)),p=f+t;y.role==="pawn"&&(t[1]==="8"&&c==="white"||t[1]==="1"&&c==="black")&&(p+="q"),h(p)},play_uci:h,set_fen_last_move(f,t){W(()=>{l(L.fromSetup(I(f).unwrap()).unwrap()),s(t)})},get dests(){return _()},get fen_last_move(){let f=i(),t=o();return t?[f,t]:void 0},get fen(){return i()},get last_move(){return o()},get add_last_move(){return a()},get check(){return e().isCheck()},get isEnd(){return e().isEnd()}}}function Ve(e){let l,o;return oe(()=>{let s=e.color,a=e.play_uci.dests,n={fen:e.play_uci.fen,check:e.play_uci.check,premovable:{enabled:!1},movable:{color:s,free:!1,dests:a,events:{after:e.play_uci.play_orig_key}}};o=Te(l,n)}),B(()=>{let s,a;if(!e.play_uci.fen_last_move)s=D;else{let r;[s,[a,r]]=e.play_uci.fen_last_move}let n=[];a&&(n.push(a.slice(0,2)),n.push(a.slice(2,4)));let i=e.movable?e.color:void 0;o.set({fen:s,lastMove:n,turnColor:e.color,movable:{color:i,dests:e.play_uci.dests}})}),B(()=>{let s=e.orientation??"white";o.set({orientation:s})}),B(()=>{let s=e.play_uci.check;o.set({check:s})}),B(()=>{e.shapes?o.setAutoShapes(e.shapes):o.setAutoShapes([])}),(()=>{var s=We();return ee(a=>l=a,s),s})()}var Ke={equals:!1},ze=Ke,ae=class{#e;constructor(e=Map){this.#e=new e}dirty(e){this.#e.get(e)?.$$()}dirtyAll(){for(const e of this.#e.values())e.$$()}track(e){if(!Ne())return;let l=this.#e.get(e);if(l)l.n++;else{const[o,s]=E(void 0,ze);this.#e.set(e,l={$:o,$$:s,n:1})}te(()=>{l.n--===1&&queueMicrotask(()=>l.n===0&&this.#e.delete(e))}),l.$()}},A=Symbol("track-object"),Ge=class extends Map{#e=new ae;#t=new ae;[Symbol.iterator](){return this.entries()}constructor(e){if(super(),e)for(const l of e)super.set(...l)}get size(){return this.#e.track(A),super.size}*keys(){this.#e.track(A);for(const e of super.keys())yield e}*values(){this.#t.track(A);for(const e of super.values())yield e}*entries(){this.#e.track(A),this.#t.track(A);for(const e of super.entries())yield e}forEach(e,l){this.#e.track(A),this.#t.track(A),super.forEach(e,l)}has(e){return this.#e.track(e),super.has(e)}get(e){return this.#t.track(e),super.get(e)}set(e,l){const o=!super.has(e),s=super.get(e)!==l,a=super.set(e,l);return(s||o)&&W(()=>{o&&(this.#e.dirty(A),this.#e.dirty(e)),s&&(this.#t.dirty(A),this.#t.dirty(e))}),a}delete(e){const l=super.get(e)!==void 0,o=super.delete(e);return o&&W(()=>{this.#e.dirty(A),this.#t.dirty(A),this.#e.dirty(e),l&&this.#t.dirty(e)}),o}clear(){super.size&&(super.clear(),W(()=>{this.#e.dirtyAll(),this.#t.dirtyAll()}))}};const Xe=e=>L.fromSetup(I(e).unwrap()).unwrap().isEnd();function he(e,l,o,s){let a=de(l,o),n=ue(a),i=J(l.toSetup());l.play(a);let r=J(l.toSetup());return{path:s.length===0?n:`${s} ${n}`,ply:e,before_fen:i,fen:r,uci:n,san:o}}function pe(e,l,o){let s=l[l.length-1];return o||(o=L.fromSetup(I(s?.fen??D).unwrap()).unwrap()),[...l,he((s?.ply??0)+1,o,e,s?.path??"")]}function le(e,l=D){let o=[],s=L.fromSetup(I(l).unwrap()).unwrap();for(let a of e)o=pe(a,o,s);return o}var Je=C("<div class=replay-single><div class=moves>"),Ye=C("<span class=index>"),Ze=C("<span><span class=san>"),et=C("<span class=judgement>"),tt=C("<span class=eval>");function nt(e,l){let o=st({s:e,game_id:l}),[s,a]=E([]);const n=S(()=>{let g=s();return g[g.length-1]});let[i,r]=E(n()?.ply??0);const _=S(()=>{let g=i();return s().find(x=>x.ply===g)});let h=S(K(s,g=>g.san)),f=S(K(s,g=>g.ply)),t=S(()=>{let g=h(),b=f();return g.map((x,N)=>`${b[N]} ${x}`)});const d=g=>{r(g)},c=()=>{let g=i()-1;return f().find(b=>b===g)},y=()=>{let g=i()+1;return f().find(b=>b===g)},p=S(K(s,g=>o.request_step_with_search(g))),u=S(()=>{let g=p();return g[g.length-1]});return{set_sans(g){a(le(g)),r(g.length)},get sf_steps(){return p()},get last_sf_step(){return u()},get steps(){return s()},get steps_up_to_ply(){return s().slice(0,i())},get plies(){return f()},get sans(){return h()},get ply_sans(){return t()},get ply_step(){return _()},get last_step(){return n()},get ply(){return i()},goto_ply:d,get_prev_ply:c,get_next_ply:y,goto_prev_ply_if_can(){let g=c();g!==void 0&&d(g),i()===1&&r(0)},goto_next_ply_if_can(){let g=y();g!==void 0&&d(g)},play_san(g){let b=n();if(!b){a(le([g]));return}let x=s();a(pe(g,x)),r(b.ply+1)},get is_on_last_ply(){return i()===(n()?.ply??0)}}}function rt(e){const l=S(K(()=>e.play_replay.ply_sans,i=>{let[r,_]=i.split(" ");return{ply:parseInt(r),san:_}})),o=i=>{e.play_replay.goto_ply(i)},s=S(()=>e.play_replay.ply_step?.ply);let a;B(R(l,i=>{if(i.length<7)return;let r=a.parentElement,_;if(e.play_replay.ply<3)_=0;else if(e.play_replay.is_on_last_ply)_=99999;else{let h=r.querySelector(".active");h&&(_=h.offsetTop-a.offsetHeight/2+h.offsetHeight/2)}_!==void 0&&r.scrollTo({behavior:"smooth",top:_})}));const n=i=>{let r=e.play_replay.sf_steps[i];return r?r.request_search()()?.judgement??"":""};return(()=>{var i=Je(),r=i.firstChild;return ee(_=>a=_,r),k(r,m(ce,{get each(){return l()},children:(_,h)=>[m(O,{get when(){return _.ply%2===1},get children(){var f=Ye();return k(f,()=>Math.ceil(_.ply/2)),f}}),(()=>{var f=Ze(),t=f.firstChild;return f.$$click=()=>o(_.ply),k(t,()=>_.san),k(f,m(O,{get when(){return e.play_replay.sf_steps[h()]},children:d=>m(O,{get when(){return d().request_search()},children:c=>m(O,{get when(){return c()()},children:y=>m(at,{get ss(){return y()}})})})}),null),z(()=>T(f,"move "+n(h())+(_.ply===s()?" active":""))),f})()]})),i})()}const at=e=>{const l=()=>e.ss.search?.cp,o=()=>e.ss.judgement;return[m(O,{get when(){return l()},children:s=>(()=>{var a=tt();return k(a,()=>ot(s())),a})()}),(()=>{var s=et();return k(s,()=>it(o())),s})()]},lt=(e,l,o)=>Ce(_e(e),l,o),it=e=>e==="good"?"✓":e==="inaccuracy"?"?!":e==="mistake"?"?":"??";function st(e){let l=[];const o=(_,h,f,t,d)=>new Promise(c=>{l.push({fen:_,ply:h,game_id:f,multi_pv:t,depth:d,resolve_ev:c}),a()});let s;const a=async()=>{if(s||(s=l.pop(),!s))return;let{game_id:_,fen:h,ply:f,multi_pv:t,depth:d}=s,c=await e.s.get_best_move(_,h,f,t,d);s.resolve_ev(c),s=void 0,a()};let n={};const i=async(_,h,f,t,d)=>{let y=(p=>[_,h,t,p].join("$$"))(d);if(!n[y]){let p=Math.floor(Math.random()*3),u=await o(_,h,f,t,d+p);u&&(n[y]=u)}return n[y]};return{request_step_with_search:_=>{if(Xe(_.fen))return;let h=new Ge;function f(t){if(!t)return()=>{let u=[...h.values()];return u[u.length-1]?.()};let d=[t.depth,t.multi_pv,t.server].join("$$");if(h.get(d))return h.get(d);let{multi_pv:c,depth:y}=t,[p]=Z(async()=>{let[u,g]=await Promise.all([i(_.before_fen,_.ply-1,e.game_id,c,y),i(_.fen,_.ply,e.game_id,c,y)]),b=lt(_.before_fen,u,g),x=b<.03?"good":b<.05?"inaccuracy":b<.12?"mistake":"blunder";return{params:t,..._,before_search:u,search:g,judgement:x}});return h.set(d,p),p}return{request_search:f}}}}function ot(e){return e=Math.max(Math.min(Math.round(e/10)/10,99),-99),(e>0?"+":"")+e.toFixed(1)}ne(["click"]);var G=Symbol("fallback");function ie(e){for(const l of e)l.dispose()}function dt(e,l,o,s={}){const a=new Map;return te(()=>ie(a.values())),()=>{const i=e()||[];return i[Ee],Be(()=>{if(!i.length)return ie(a.values()),a.clear(),s.fallback?[re(t=>(a.set(G,{dispose:t}),s.fallback()))]:[];const r=new Array(i.length),_=a.get(G);if(!a.size||_){_?.dispose(),a.delete(G);for(let f=0;f<i.length;f++){const t=i[f],d=l(t,f);n(r,t,f,d)}return r}const h=new Set(a.keys());for(let f=0;f<i.length;f++){const t=i[f],d=l(t,f);h.delete(d);const c=a.get(d);c?(r[f]=c.mapped,c.setIndex?.(f),c.setItem(()=>t)):n(r,t,f,d)}for(const f of h)a.get(f)?.dispose(),a.delete(f);return r})};function n(i,r,_,h){re(f=>{const[t,d]=E(r),c={setItem:d,dispose:f};if(o.length>1){const[y,p]=E(_);c.setIndex=p,c.mapped=o(t,y)}else c.mapped=o(t);a.set(h,c),i[_]=c.mapped})}}function se(e){const{by:l}=e;return S(dt(()=>e.each,typeof l=="function"?l:o=>o[l],e.children,"fallback"in e?{fallback:()=>e.fallback}:void 0))}var ut=C("<div class=replay-tree><div class=moves-wrap><div class=moves></div></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=>"),ge=C("<span class=index>"),ct=C("<div class=fbt>"),_t=C("<div class=lines>"),ft=C("<div class=line>"),ht=C("<span class=collapsed>..<!> "),pt=C("<div>");function gt(e){return Me(e).map(l=>{let o=l.headers.get("Event"),s=l.headers.get("Site"),a=l.headers.get("White"),n=l.headers.get("Black"),i=l.headers.get("Chapter"),r=l.headers.get("Orientation"),_=l.headers.get("FEN"),h=_??D,f=L.fromSetup(I(h).unwrap()).unwrap(),t=ye();l.moves.children.forEach(c=>{d(c,f,"")});function d(c,y,p){let u=c.data.san,g=de(y,u),b=y.clone();b.play(g);let x=ue(g),N=c.data.nags;t.add_child_san(p,u).set_nags(N??[]);let P=p.length===0?x:`${p} ${x}`;c.children.forEach(v=>{d(v,b,P)})}return{event:o,site:s,white:a,black:n,chapter:i,fen:_,orientation:r,tree:t}})}function ye(){let[e,l]=E([]);const o=a=>s(a)?.[1],s=a=>{if(a==="")return;let n=a.split(" "),i=0,r,_=e();for(;;){let h=n.slice(0,i+1).join(" "),f=_.find(t=>t.path===h);if(!f)return;if(i++,i===n.length)return[r,f];r=f,_=f.children}};return{get initial_fen(){if(e().length!==0)return e()[0].step.before_fen},get root(){return e()},add_sans_at_root(a){if(a.length===0)return[];let n=a[0],i=this.add_child_san("",n),r=[i];return a.slice(1).forEach(_=>{i=i.add_child_san(_),r.push(i)}),r},add_child_san(a,n){if(a===""){let r=e(),_=r.find(t=>t.san===n);if(_)return _;let h=L.fromSetup(I(D).unwrap()).unwrap(),f=ve(0,h,n,"");return l([...r,f]),f}let i=o(a);if(i)return i.add_child_san(n)},remove_child_at_path(a){let n=s(a);if(n){if(!n[0]){let i=e(),r=i.indexOf(n[1]);return i.splice(r,1),l([...i]),n[1]}return n[0].remove_child(n[1]),n[1]}},find_at_path:o,find_parent_and_child_at_path:s,siblings_of(a){let n=s(a)?.[0];if(n)return n.children},previous_branch_points(a){let n=[],i=e(),r=e.length>1;for(let _ of a.split(" ")){let h=i.find(f=>f.step.uci===_);if(!h)return;r&&(n.push(h),r=!1),h.children.length>1&&(r=!0),i=h.children}return n}}}function ve(e,l,o,s){let[a,n]=E([]),[i,r]=E([]);l=l.clone();let _=he(e,l,o,s),h=()=>f()?.length??0,f=()=>t()?.children,t=()=>{let c=a();if(c.length!==0)return c.length===1?c[0].first_node_with_variations:d},d={get nags(){return i()},set_nags:r,get path(){return _.path},get ply(){return _.ply},get san(){return _.san},step:_,get children(){return a()},remove_child(c){let y=a(),p=y.indexOf(c);if(p!==-1)return y.splice(p,1),n([...y]),c},add_child_san(c){let y=a(),p=y.find(g=>g.san===c);if(p)return p;let u=ve(e+1,l,c,_.path);return n([...y,u]),u},remove_child_san(c){let y=a(),p=y.findIndex(g=>g.step.san!==c);if(p===-1)return;let u=y.splice(p,1)[0];return n([...y]),u},get nb_first_variations(){return h()},get first_node_with_variations(){return t()},get length(){let c=a();if(c.length>1)return 1;if(c.length===0)return 0;let y=1,p=c[0];for(;p?.children.length===1;)y++,p=p.children[0];return y}};return d}const yt=`
[Event "e4 vs Minor Defences: Alekhine"]
[Site "https://lichess.org/study/F8wyMEli/XtCmR5GS"]
[Result "*"]
[UTCDate "2023.04.06"]
[UTCTime "17:47:58"]
[Variant "Standard"]
[ECO "B04"]
[Opening "Alekhine Defense: Modern Variation, Larsen-Haakert Variation"]
[Annotator "https://lichess.org/@/heroku"]

1. e4 Nf6 2. e5 Nd5 3. d4 d6 4. Nf3 Nc6 (4... Nb6 5. a4 a5 6. Nc3 g6 (6... Bf5 7. d5 e6 8. dxe6 Bxe6 9. Bg5 Qd7 10. exd6 Bxd6 11. Nb5 Nd5 12. Nxd6+ Qxd6) 7. exd6 cxd6 (7... exd6 8. Bg5 f6 9. Bf4 d5 10. Bd3 Bd6 11. Bxd6 Qxd6 12. O-O O-O 13. Qd2) 8. d5 Bg7 9. Be3 O-O 10. Bd4 N8d7 11. Bxg7 Kxg7 12. Qd4+ Nf6 13. Nd2 Bd7 14. Nde4 Rc8 15. h4 h5 16. f3) (4... c6 5. Be2 g6 6. c4 Nc7 7. exd6 Qxd6 8. Nc3 Bg7 9. O-O O-O 10. h3 Ne6 11. Be3 Nf4 12. Re1) (4... Bf5 5. Bd3 Bxd3 6. Qxd3 e6 7. O-O Nc6 8. c4 Nb6 9. exd6 cxd6 10. Nc3 Be7 11. d5 Nb4 12. Qe4 e5 13. c5 dxc5 14. a3 Na6 15. Rd1 O-O) 5. c4 Nb6 6. e6 fxe6 7. Nc3 g6 8. h4 Bg7 9. Be3 e5 10. d5 Nd4 11. Nxd4 exd4 12. Bxd4 Bxd4 13. Qxd4 e5 14. Qe3 *
`;function vt(){let e=ye();e=gt(yt)[0].tree;let[l,o]=E(""),s=[];B(R(l,t=>{e.previous_branch_points(t)?.map(d=>{s.includes(d.path)||(e.siblings_of(d.path)?.forEach(c=>{s=s.filter(y=>y!==c.path)}),s.push(d.path))})}));const a=t=>{o(t)},n=()=>{let t=l();if(t!=="")return t.split(" ").slice(0,-1).join(" ")},i=()=>{let t=l(),d=e.find_at_path(t)?.children??e.root;return d.length===1?d[0].path:d.find(c=>s.includes(c.path))?.path??d[0]?.path},r=()=>{let t=e.find_parent_and_child_at_path(l());if(!t)return;let d=t;if(!d[0])return"";if(d[0].children.length>1)return d[0].path;for(;!(!d[0]||d[0].children.length>1);){let c=e.find_parent_and_child_at_path(d[0].path);if(!c)break;d=c}return d[1].path},_=()=>{let t=e.find_at_path(l());if(!t)return e.root.find(c=>s.includes(c.path))?.path??e.root[0]?.path;let d=t;if(d.children.length>1)return d.children.find(c=>s.includes(c.path))?.path??d.children[0]?.path;for(;d.children.length===1;)d=d.children[0];return d.path},h=()=>{let t=e.find_parent_and_child_at_path(l());if(!t||!t[0])return;if(t[0].children.length===1)for(;;){if(t=e.find_parent_and_child_at_path(t[0].path),!t||!t[0])return;if(t[0].children.length>1)break}let d=t[0].children.indexOf(t[1]),c=t[0].children[d-1];if(c)return c.path},f=()=>{let t=e.find_parent_and_child_at_path(l());if(!t||!t[0])return;if(t[0].children.length===1)for(;;){if(t=e.find_parent_and_child_at_path(t[0].path),!t||!t[0])return;if(t[0].children.length>1)break}let d=t[0].children.indexOf(t[1]),c=t[0].children[d+1];if(c)return c.path};return{steps:e,get cursor_path(){return l()},set cursor_path(t){o(t)},get cursor_path_step(){return e.find_at_path(l())?.step},goto_path:a,get_prev_path:n,get_next_path:i,goto_prev_if_can(){let t=n();t!==void 0&&a(t)},goto_next_if_can(){let t=i();t!==void 0&&a(t)},get_first_path:r,get_last_path:_,get_up_path:h,get_down_path:f,goto_up_if_can(){let t=h();t!==void 0&&a(t)},goto_down_if_can(){let t=f();t!==void 0&&a(t)},goto_last_if_can(){let t=_();t!==void 0&&a(t)},goto_first_if_can(){let t=r();t!==void 0&&a(t)},get previous_branch_points_at_cursor_path(){return e.previous_branch_points(l())??[]}}}function mt(e){const l=e.play_replay.steps;let o;B(()=>{let n=e.play_replay.cursor_path,i=o.parentElement;if(!i)return;const r=o.querySelector(".on-path-end");if(!r){i.scrollTop=n.length>0?99999:0;return}let _=r.offsetTop-i.offsetHeight/2+r.offsetHeight;i.scrollTo({behavior:"smooth",top:_})});const s=n=>`${Math.floor(n/2)+1}.`+(n%2===0?"..":""),a=n=>{let i=!1;n.key==="ArrowLeft"&&(e.play_replay.goto_prev_if_can(),i=!0),n.key==="ArrowRight"&&(e.play_replay.goto_next_if_can(),i=!0),n.key==="ArrowUp"&&(e.play_replay.goto_up_if_can(),i=!0),n.key==="ArrowDown"&&(e.play_replay.goto_down_if_can(),i=!0),i&&n.preventDefault()};return oe(()=>{document.addEventListener("keydown",a),te(()=>{document.removeEventListener("keydown",a)})}),(()=>{var n=ut(),i=n.firstChild,r=i.firstChild,_=i.nextSibling,h=_.firstChild,f=h.nextSibling,t=_.nextSibling,d=t.firstChild,c=d.nextSibling,y=c.nextSibling,p=y.nextSibling;return ee(u=>o=u,r),k(r,m(Y,{get nodes(){return l.root},get cursor_path(){return e.play_replay.cursor_path},on_set_cursor:u=>e.play_replay.cursor_path=u})),h.$$click=()=>e.play_replay.goto_up_if_can(),f.$$click=()=>e.play_replay.goto_down_if_can(),k(_,m(ce,{get each(){return e.play_replay.previous_branch_points_at_cursor_path},children:u=>(()=>{var g=ct();return g.$$click=()=>e.play_replay.cursor_path=u.path,k(g,m(O,{get when(){return u.ply&1},get children(){var b=ge();return k(b,()=>s(u.ply)),b}}),null),k(g,()=>u.san,null),g})()}),null),d.$$click=()=>e.play_replay.goto_first_if_can(),c.$$click=()=>e.play_replay.goto_prev_if_can(),y.$$click=()=>e.play_replay.goto_next_if_can(),p.$$click=()=>e.play_replay.goto_last_if_can(),z(u=>{var g=e.play_replay.get_up_path()===void 0,b="fbt prev"+(e.play_replay.get_up_path()===void 0?" disabled":""),x=e.play_replay.get_down_path()===void 0,N="fbt prev"+(e.play_replay.get_down_path()===void 0?" disabled":""),P=e.play_replay.get_first_path()===void 0,v="fbt first"+(e.play_replay.get_first_path()===void 0?" disabled":""),w=e.play_replay.get_prev_path()===void 0,M="fbt prev"+(e.play_replay.get_prev_path()===void 0?" disabled":""),U=e.play_replay.get_next_path()===void 0,q="fbt next"+(e.play_replay.get_next_path()===void 0?" disabled":""),j=e.play_replay.get_last_path()===void 0,$="fbt last"+(e.play_replay.get_last_path()===void 0?"disabled":"");return g!==u.e&&(h.disabled=u.e=g),b!==u.t&&T(h,u.t=b),x!==u.a&&(f.disabled=u.a=x),N!==u.o&&T(f,u.o=N),P!==u.i&&(d.disabled=u.i=P),v!==u.n&&T(d,u.n=v),w!==u.s&&(c.disabled=u.s=w),M!==u.h&&T(c,u.h=M),U!==u.r&&(y.disabled=u.r=U),q!==u.d&&T(y,u.d=q),j!==u.l&&(p.disabled=u.l=j),$!==u.u&&T(p,u.u=$),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0}),n})()}function Y(e){return m(se,{get each(){return e.nodes},by:"path",children:l=>[m(X,H(e,{get node(){return l()}})),m(O,{get when(){return l().children.length===1},get children(){return m(Y,H(e,{get nodes(){return l().children}}))}}),m(O,{get when(){return l().children.length>1},get children(){var o=_t();return k(o,m(se,{get each(){return l().children},by:"path",children:s=>(()=>{var a=ft();return k(a,m(O,{get when(){return e.cursor_path.startsWith(s().path)},get fallback(){return[m(X,H(e,{get node(){return s()},show_index:!0,collapsed:!0})),(()=>{var n=ht(),i=n.firstChild,r=i.nextSibling;return r.nextSibling,k(n,()=>s().length,r),k(n,()=>s().nb_first_variations,null),n})()]},get children(){return[m(X,H(e,{get node(){return s()},show_index:!0})),m(Y,H(e,{get nodes(){return s().children}}))]}})),a})()})),o}})]})}function X(e){let l=S(()=>e.node.ply%2===0||e.show_index),o=S(()=>e.node.ply%2===0?".":"...");const s=S(()=>e.node.path),a=S(()=>e.cursor_path.startsWith(s())),n=S(()=>s()===e.cursor_path),i=S(()=>{let r=["move"];return e.collapsed&&r.push("collapsed"),a()&&r.push("on-path"),n()&&r.push("on-path-end"),r.join(" ")});return(()=>{var r=pt();return r.$$click=()=>e.on_set_cursor(e.node.path),k(r,m(O,{get when(){return l()},get children(){var _=ge();return k(_,()=>Math.floor(e.node.ply/2)+1,null),k(_,o,null),_}}),null),k(r,()=>e.node.san,null),z(()=>T(r,i())),r})()}ne(["click"]);var bt=C("<span class=info>Loading <!>%"),wt=C("<span class=result>Game Over"),$t=C("<small class=drop>Evaluation Dropped Below -2"),kt=C("<div class=result-wrap>"),xt=C("<div class=tools-wrap><button class=save>Save Line</button><button class=rematch>Rematch"),St=C("<div class=builder><div class=board-wrap></div><div class=replay-wrap><div class=tabs-wrap><div>Match</div><div>Repertoire");const Ot=()=>m(He,{get children(){return m(Nt,{})}});function Nt(){let[e]=Z(()=>Re(fe));const l=S(()=>{let o=e()?.download_nb;if(o)return Math.ceil(o.bytes/(o.total===0?70*1024*1024:o.total)*100)});return m(O,{get when(){return e()},children:o=>m(O,{get when(){return o().state==="loading"},get fallback(){return m(Ct,{get s(){return o()}})},get children(){return[(()=>{var s=bt(),a=s.firstChild,n=a.nextSibling;return n.nextSibling,k(s,()=>l()??"--",n),s})()," "]}})})}function Ct(e){const l=Oe();l.setVolume(.2);let[o,s]=Pe([],"builder.current.sans");const n=nt(e.s,"");let i=Fe();const[r,_]=E("white"),h=S(()=>qe(r())),f={depth:8,multi_pv:1},t={depth:8,multi_pv:6};B(()=>{const v=n.last_sf_step;v&&B(R(v.request_search(t),w=>{if(!w||!w.search)return;if(_e(w.fen)===h()){let U=w.search.pvs;i.play_uci(U[0].moves[0])}}))}),B(R(()=>i.add_last_move,v=>{v&&n.play_san(v[1])})),B(R(()=>n.sans,s)),B(R(()=>n.ply_step,v=>{v?i.set_fen_last_move(v.fen,[v.uci,v.san]):i.set_fen_last_move(D)})),B(R(()=>n.ply_step,(v,w)=>{v&&(!w||w.ply===v.ply-1)&&l.move(v)}));const d=je(v=>{const w=v.target;w.tagName!=="PIECE"&&w.tagName!=="SQUARE"&&w.tagName!=="CG-BOARD"||(v.preventDefault(),c(Math.sign(v.deltaY)))}),c=v=>{v>0?(N()==="match"&&n.goto_next_ply_if_can(),N()==="repertoire"&&b.goto_next_if_can()):(N()==="match"&&n.goto_prev_ply_if_can(),N()==="repertoire"&&b.goto_prev_if_can())},y=()=>!i.isEnd&&n.is_on_last_ply&&u()===void 0;n.set_sans(o()),n.sf_steps.forEach(v=>v?.request_search(f));const p=()=>{s([]),n.set_sans(o()),g(void 0)};B(R(()=>n.last_sf_step,v=>{v&&B(R(v.request_search(t),w=>{if(!w||!w.search)return;let M=w.search.cp??w.search.mate;M&&M<-200&&g("drop")}))}));const[u,g]=E(void 0),b=vt();B(R(()=>b.cursor_path_step,v=>{v?i.set_fen_last_move(v.fen,[v.uci,v.san]):i.set_fen_last_move(D)}));const x=()=>{let w=n.steps_up_to_ply.map(M=>M.san);b.steps.add_sans_at_root(w)},[N,P]=E("repertoire");return(()=>{var v=St(),w=v.firstChild,M=w.nextSibling,U=M.firstChild,q=U.firstChild,j=q.nextSibling;return Ae(v,"wheel",d),k(w,m(Ve,{get color(){return r()},get movable(){return y()},play_uci:i})),q.$$click=()=>P("match"),j.$$click=()=>P("repertoire"),k(M,m(O,{get when(){return N()==="match"},get children(){return[m(rt,{play_replay:n}),(()=>{var $=kt();return k($,m(O,{get when(){return u()==="drop"},get children(){return[wt(),$t()]}})),$})(),(()=>{var $=xt(),Q=$.firstChild,F=Q.nextSibling;return Q.$$click=x,F.$$click=p,$})()]}}),null),k(M,m(O,{get when(){return N()==="repertoire"},get children(){return m(mt,{play_replay:b})}}),null),z($=>{var Q="tab"+(N()==="match"?" active":""),F="tab"+(N()==="repertoire"?" active":"");return Q!==$.e&&T(q,$.e=Q),F!==$.t&&T(j,$.t=F),$},{e:void 0,t:void 0}),v})()}ne(["click"]);export{Ot as default};
