var G=Object.defineProperty;var Q=(e,t,n)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var f=(e,t,n)=>(Q(e,typeof t!="symbol"?t+"":t,n),n);import{d as Z,h as q,n as k,l as V,q as K,i as g,c as u,S as N,r as m,e as U,M as T,F as E,f as ee,g as te,t as S,v as P,$ as ne,w as re}from"./index-gTp4Koyz.js";import"./Shalala-Cpc8pJyZ.js";import{I as se,a as ae}from"./chess_pgn_logic-BjdvsIds.js";var X=S("<div class=chesstree>"),Y=S("<div class=lines>"),B=S("<div class=line>"),ie=S("<span class=index>"),he=S("<div>"),le=S("<span class=collapsed> ..<!> ");class y{constructor(){f(this,"_blacks");f(this,"_whites");this._blacks=q([],{equals:!1}),this._whites=q([],{equals:!1})}replace_all(t){this.blacks=t.blacks.slice(0),this.whites=t.whites.slice(0)}merge_dup(t){k(()=>{t.paths.forEach(n=>this.add_path(n))})}get_for_saving(){return[this.blacks,this.whites]}static set_for_saving(t){let n=new y;return n.blacks=t[0],n.whites=t[1],n}set blacks(t){this._blacks[1](t)}set whites(t){this._whites[1](t)}get blacks(){return this._blacks[0]()}get whites(){return this._whites[0]()}get paths(){return[...this.blacks,...this.whites]}get expand_paths(){let t=[];return this.whites.forEach(n=>{for(let s=0;s<=n.length-1;s+=2)t.push(n.slice(0,s+1))}),this.blacks.forEach(n=>{for(let s=1;s<=n.length-1;s+=2)t.push(n.slice(0,s+1))}),t}clear(){this.blacks=[],this.whites=[]}remove_path(t){P(()=>{if(t.length%2===0){let n=this.blacks;n=n.filter(s=>s.join("")!==t.join("")),this.blacks=n}else{let n=this.whites;n=n.filter(s=>s.join("")!==t.join("")),this.whites=n}})}add_path(t){P(()=>{if(t.length%2===0){let n=this.blacks;if(n.find(r=>r.join("").startsWith(t.join(""))))return;let s=n.findIndex(r=>t.join("").startsWith(r.join("")));s!==-1?n.splice(s,1,t):n.push(t),this.blacks=n}else{let n=this.whites;if(n.find(r=>r.join("").startsWith(t.join(""))))return;let s=n.findIndex(r=>t.join("").startsWith(r.join("")));s!==-1?n.splice(s,1,t):n.push(t),this.whites=n}})}}const W=class W{constructor(t,n){f(this,"_tree");f(this,"_cursor_path");f(this,"_hidden_paths");f(this,"_revealed_paths");f(this,"_failed_paths");f(this,"_solved_paths");f(this,"reveal_hidden_paths",()=>{k(()=>{this.hidden_paths.forEach(t=>{this._revealed_paths.add_path(t)}),this._hidden_paths.clear()})});f(this,"reveal_one_random",()=>{var s,r;if(!this.tree)return!1;const t=((r=(s=this.tree)==null?void 0:s._traverse_path(this.cursor_path))==null?void 0:r.children)??[this.tree.root],n=de(t);return n?(k(()=>{this._hidden_paths.remove_path(n.data.path),n.children.forEach(a=>this._hidden_paths.add_path(a.data.path)),this.cursor_path=n.data.path}),!0):!1});f(this,"try_next_uci_fail",t=>{var a,o,l;if(!this.tree)return!1;const n=((a=this.tree)==null?void 0:a._traverse_path(this.cursor_path))??this.tree.root,s=((l=(o=this.tree)==null?void 0:o._traverse_path(this.cursor_path))==null?void 0:l.children)??[this.tree.root],r=s.find(c=>c.data.uci===t)??s.find(c=>_e(c.data)===t);if(r){if(this.failed_paths_expanded.find(h=>h.join("")===r.data.path.join(""))){setTimeout(()=>{this.cursor_path=this.cursor_path},100);return}return k(()=>{this._hidden_paths.remove_path(r.data.path),r.children.forEach(h=>this._hidden_paths.add_path(h.data.path)),this._solved_paths.add_path(r.data.path),this.cursor_path=r.data.path}),!0}else{if(this.is_revealed){setTimeout(()=>{this.cursor_path=this.cursor_path},100);return}return this.add_uci(t),this._failed_paths.add_path([...n.data.path,t]),setTimeout(()=>{this.on_wheel(-1)},100),!1}});f(this,"on_wheel",t=>{var s;let n=this.cursor_path;if(t<0)n.length>0&&this.try_set_cursor_path(n.slice(0,-1));else{let r=this.tree;if(r){let a;n.length===0?a=[r.root]:a=(s=r._traverse_path(n))==null?void 0:s.children;let o=a==null?void 0:a.map(l=>l.data.path).find(l=>{var c;return!((c=this.hidden_paths)!=null&&c.some(h=>l.join("").startsWith(h.join(""))))});o&&this.try_set_cursor_path(o)}}});this.initial_fen=t,this._cursor_path=q([],{equals:!1}),this._tree=q(n),this._hidden_paths=new y,this._revealed_paths=new y,this._failed_paths=new y,this._solved_paths=new y}get hidden_paths(){return this._hidden_paths.paths}get revealed_paths(){return this._revealed_paths.paths}get failed_paths(){return this._failed_paths.paths}get solved_paths(){return this._solved_paths}get failed_paths_expanded(){return this._failed_paths.expand_paths}get solved_paths_expanded(){return this._solved_paths.expand_paths}get initial_color(){var t;return(t=this.tree)==null?void 0:t.initial_color}get cursor_path(){return this._cursor_path[0]()}get tree(){return this._tree[0]()}set cursor_path(t){this._cursor_path[1](t)}set tree(t){this._tree[1](t)}get fen_last_move(){let t=this.tree;if(t){let n=t.get_at(this.cursor_path);if(!n)return;let s=n.after_fen,r=n.uci;return[s,r]}}try_set_cursor_path(t){return this.hidden_paths.find(s=>t.join("").startsWith(s.join("")))?!1:(this.cursor_path=t,!0)}get is_revealed(){return this.hidden_paths.length===0}add_uci(t){let n=this.tree,s=this.cursor_path;n?n.append_uci(t,s):n=ae.make(this.initial_fen,[t]),s=[...s,t],k(()=>{this.tree=n,this.cursor_path=s})}};f(W,"make",(t,n=(t==null?void 0:t.root.data.before_fen)||se)=>new W(n,t));let F=W;const xe=e=>{let t;return V(()=>{let n=e.lala.cursor_path,s=t.parentElement;if(!s)return;const r=t.querySelector(".on_path_end");if(!r){s.scrollTop=n.length>0?99999:0;return}let a=r.offsetTop-s.offsetHeight/2+r.offsetHeight;s.scrollTo({behavior:"smooth",top:a})}),(()=>{var n=X();return K(s=>t=s,n),g(n,u(N,{get when(){return e.lala.tree},get fallback(){return[]},children:s=>u(C,{on_set_path:r=>e.lala.try_set_cursor_path(r),get cursor_path(){return e.lala.cursor_path},get hidden_paths(){return e.lala.hidden_paths},get revealed_paths(){return e.lala.revealed_paths},get solved_paths(){return e.lala.solved_paths_expanded},get failed_paths(){return e.lala.failed_paths_expanded},get lines(){return[s().root]}})})),n})()},C=e=>u(E,{get each(){return e.lines},children:t=>[u(D,m({get data(){return t.data}},e)),u(U,{get children(){return[u(T,{get when(){return t.children.length===1},get children(){return u(C,m(e,{get lines(){return t.children}}))}}),u(T,{get when(){return t.children.length>1},get children(){var n=Y();return g(n,u(E,{get each(){return t.children},children:s=>(()=>{var r=B();return g(r,u(C,m(e,{lines:[s],show_index:!0}))),r})()})),n}})]}})]}),D=e=>{let t=`${Math.ceil(e.data.ply/2)}.`;e.data.ply%2===0&&(t+="..");let n=()=>e.cursor_path.join("").startsWith(e.data.path.join("")),s=()=>e.cursor_path.join("")===e.data.path.join(""),r=e.data.path.join(""),a=()=>e.hidden_paths.find(_=>_.join("")===r),o=()=>e.hidden_paths.find(_=>r.startsWith(_.join(""))),l=()=>e.revealed_paths.find(_=>_.join("")===r),c=()=>e.revealed_paths.find(_=>r.startsWith(_.join(""))),h=()=>e.failed_paths.find(_=>_.join("")===r),i=()=>e.solved_paths.find(_=>_.join("")===r),d=()=>["move",s()?"on_path_end":n()?"on_path":"",a()?"on_hidden_path_start":o()?"on_hidden_path":"",l()?"on_revealed_path_start":c()?"on_revealed_path":"",h()?"on_failed_path":"",i()?"on_solved_path":"",e.collapsed?"collapsed":""].join(" ");return(()=>{var _=he();return _.$$click=()=>e.on_set_path(e.data.path),g(_,u(N,{get when(){return e.show_index||e.data.ply&1},get children(){var p=ie();return g(p,t),p}}),null),g(_,()=>e.data.san,null),ee(()=>te(_,d())),_})()},ke=e=>{let t;return V(()=>{let n=e.lala.cursor_path,s=t.parentElement;if(!s)return;const r=t.querySelector(".on_path_end");if(!r){s.scrollTop=n.length>0?99999:0;return}let a=r.offsetTop-s.offsetHeight/2+r.offsetHeight;s.scrollTo({behavior:"smooth",top:a})}),(()=>{var n=X();return K(s=>t=s,n),g(n,u(N,{get when(){return e.lala.tree},get fallback(){return[]},children:s=>u(M,{on_set_path:r=>e.lala.try_set_cursor_path(r),get cursor_path(){return e.lala.cursor_path},get hidden_paths(){return e.lala.hidden_paths},get revealed_paths(){return e.lala.revealed_paths},get solved_paths(){return e.lala.solved_paths_expanded},get failed_paths(){return e.lala.failed_paths_expanded},get lines(){return[s().root]}})})),n})()},M=e=>u(E,{get each(){return e.lines},children:t=>[u(D,m({get data(){return t.data}},e)),u(U,{get children(){return[u(T,{get when(){return t.children.length===1},get children(){return u(M,m(e,{get lines(){return t.children},show_index:!1}))}}),u(T,{get when(){return t.children.length>1},get children(){var n=Y();return g(n,u(E,{get each(){return t.children},children:s=>(()=>{var r=B();return g(r,u(N,{get when(){return e.cursor_path.join("").startsWith(s.data.path.join(""))},get fallback(){return u(oe,m(e,{lines:[s],show_index:!0}))},get children(){return u(M,m(e,{lines:[s],show_index:!0}))}})),r})()})),n}})]}})]}),oe=e=>u(E,{get each(){return e.lines},children:t=>[u(D,m({get data(){return t.data}},e,{collapsed:!0})),(()=>{var n=le(),s=n.firstChild,r=s.nextSibling;return r.nextSibling,g(n,()=>t.length,r),g(n,()=>t.nb_first_variations,null),n})()]});function de(e){let t=e.length*(e.length+1)/2,n=Math.floor(Math.random()*t)+1,s=0;for(let r=0;r<e.length;r++)if(s+=e.length-r,n<=s)return e[r]}const _e=e=>{let t=e.uci.slice(0,2),n=e.uci[3];if(e.san==="O-O")return t+"g"+n;if(e.san==="O-O-O")return t+"c"+n};Z(["click"]);const ue=Symbol("store-raw"),ce=Symbol("store-node"),$=Symbol("store-has"),fe=Symbol("store-self");function A(e){let t;return e!=null&&typeof e=="object"&&(e[ne]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function z(e,t=new Set){let n,s,r,a;if(n=e!=null&&e[ue])return n;if(!A(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let o=0,l=e.length;o<l;o++)r=e[o],(s=z(r,t))!==r&&(e[o]=s)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const o=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let c=0,h=o.length;c<h;c++)a=o[c],!l[a].get&&(r=e[a],(s=z(r,t))!==r&&(e[a]=s))}return e}function pe(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function H(e,t,n){if(e[t])return e[t];const[s,r]=q(n,{equals:!1,internal:!0});return s.$=r,e[t]=s}function w(e,t,n,s=!1){if(!s&&e[t]===n)return;const r=e[t],a=e.length;n===void 0?(delete e[t],e[$]&&e[$][t]&&r!==void 0&&e[$][t].$()):(e[t]=n,e[$]&&e[$][t]&&r===void 0&&e[$][t].$());let o=pe(e,ce),l;if((l=H(o,t,r))&&l.$(()=>n),Array.isArray(e)&&e.length!==a){for(let c=e.length;c<a;c++)(l=o[c])&&l.$();(l=H(o,"length",a))&&l.$(e.length)}(l=o[fe])&&l.$()}const L=Symbol("store-root");function O(e,t,n,s,r){const a=t[n];if(e===a)return;const o=Array.isArray(e);if(n!==L&&(!A(e)||!A(a)||o!==Array.isArray(a)||r&&e[r]!==a[r])){w(t,n,e);return}if(o){if(e.length&&a.length&&(!s||r&&e[0]&&e[0][r]!=null)){let h,i,d,_,p,v,R,b;for(d=0,_=Math.min(a.length,e.length);d<_&&(a[d]===e[d]||r&&a[d]&&e[d]&&a[d][r]===e[d][r]);d++)O(e[d],a,d,s,r);const x=new Array(e.length),I=new Map;for(_=a.length-1,p=e.length-1;_>=d&&p>=d&&(a[_]===e[p]||r&&a[d]&&e[d]&&a[_][r]===e[p][r]);_--,p--)x[p]=a[_];if(d>p||d>_){for(i=d;i<=p;i++)w(a,i,e[i]);for(;i<e.length;i++)w(a,i,x[i]),O(e[i],a,i,s,r);a.length>e.length&&w(a,"length",e.length);return}for(R=new Array(p+1),i=p;i>=d;i--)v=e[i],b=r&&v?v[r]:v,h=I.get(b),R[i]=h===void 0?-1:h,I.set(b,i);for(h=d;h<=_;h++)v=a[h],b=r&&v?v[r]:v,i=I.get(b),i!==void 0&&i!==-1&&(x[i]=a[h],i=R[i],I.set(b,i));for(i=d;i<e.length;i++)i in x?(w(a,i,x[i]),O(e[i],a,i,s,r)):w(a,i,e[i])}else for(let h=0,i=e.length;h<i;h++)O(e[h],a,h,s,r);a.length>e.length&&w(a,"length",e.length);return}const l=Object.keys(e);for(let h=0,i=l.length;h<i;h++)O(e[l[h]],a,l[h],s,r);const c=Object.keys(a);for(let h=0,i=c.length;h<i;h++)e[c[h]]===void 0&&w(a,c[h],void 0)}function ge(e,t={}){const{merge:n,key:s="id"}=t,r=z(e);return a=>{if(!A(a)||!A(r))return r;const o=O(r,{[L]:a},L,n,s);return o===void 0?a:o}}var ve=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),we=e=>(typeof e.clear=="function"||(e.clear=()=>{let t;for(;t=e.key(0);)e.removeItem(t)}),e),me=["domain","expires","path","secure","httpOnly","maxAge","sameSite"];function be(e){if(!e)return"";let t="";for(const n in e){if(!me.includes(n))continue;const s=e[n];t+=s instanceof Date?`; ${n}=${s.toUTCString()}`:typeof s=="boolean"?`; ${n}`:`; ${n}=${s}`}return t}function $e(e,t){var n;return((n=e.match(`(^|;)\\s*${t}\\s*=\\s*([^;]+)`))==null?void 0:n.pop())??null}var J;try{J=ve("solid-start/server").useRequest}catch{J=()=>(console.warn("It seems you attempt to use cookieStorage on the server without having solid-start installed or use vite."),{request:{headers:{get:()=>""}}})}var j=we({_read:()=>document.cookie,_write:(e,t,n)=>{document.cookie=`${e}=${t}${be(n)}`},getItem:(e,t)=>$e(j._read(t),e),setItem:(e,t,n)=>{j._write(e,t,n);{const r=Object.assign(new Event("storage"),{key:e,oldValue:null,newValue:t,url:globalThis.document.URL,storageArea:j});window.dispatchEvent(r)}},removeItem:(e,t)=>{j._write(e,"deleted",{...t,expires:new Date(0)})},key:(e,t)=>{let n=null,s=0;return j._read(t).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(r,a)=>(!n&&a&&s++===e&&(n=a),"")),n},getLength:e=>{let t=0;return j._read(e).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,n=>(t+=n?1:0,"")),t},get length(){return this.getLength()}});function qe(e,t={}){const n=t.storage||globalThis.localStorage;if(!n)return e;const s=t.storageOptions,r=t.name||`storage-${re()}`,a=t.serialize||JSON.stringify.bind(JSON),o=t.deserialize||JSON.parse.bind(JSON),l=n.getItem(r,s),c=typeof e[0]=="function"?i=>e[1](()=>o(i)):i=>e[1](ge(o(i)));let h=!0;return l instanceof Promise?l.then(i=>h&&i&&c(i)):l&&c(l),[e[0],typeof e[0]=="function"?i=>{const d=e[1](i);return i?n.setItem(r,a(d),s):n.removeItem(r,s),h=!1,d}:(...i)=>{e[1](...i);const d=a(P(()=>e[0]));n.setItem(r,d,s),h=!1}]}export{ke as C,F as T,y as a,xe as b,qe as m};
