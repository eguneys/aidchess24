var Be=Object.defineProperty;var He=(m,s,i)=>s in m?Be(m,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[s]=i;var S=(m,s,i)=>(He(m,typeof s!="symbol"?s+"":s,i),i);import{h as Ke,j as Ue,i as c,c as d,S as x,k as Ve,l as y,b as g,m as q,n as k,o as C,p as ke,q as ye,r as Je,f as A,g as w,F as B,s as H,M as Q,v as $,e as Xe,w as Ze,d as et,t as n}from"./index-CsOMkGgz.js";/* empty css                   */import{S as tt}from"./studyrepo-Blsv4LB9.js";import{S as st,C as rt}from"./Shalala-dhB8hpUG.js";import{T as at,a as re,C as lt}from"./Chesstree2-C2uBTSpx.js";import{M as it,I as _t}from"./chess_pgn_logic-DRNlf28A.js";import{S as nt,O as Se}from"./SessionStore-C9QNAzvp.js";import{s as ot}from"./scroll-DnAhRpRC.js";var ct=n("<div class=progress><div class=bar></div><h3>"),ht=n("<div class=repertoire-wrap>"),Ce=n("<small> Click on variations to expand. "),ut=n("<small> Your goal is to guess every move correctly to pass the quiz. "),dt=n("<div class=in_mode><button><span> Take Quiz </span></button><button><span> Play Deathmatch "),mt=n("<h2>Deathmatch Mode"),xe=n("<span class=passed>passed"),pt=n("<small> Deathmatch "),vt=n("<small> Your score: "),Ee=n("<small> Progress +<!>% "),gt=n("<div class=in_mode><button><span> Restart Deathmatch </span></button><button class=end2><span> End Deathmatch "),ft=n("<small> Quiz "),$t=n("<small> Your score: <!> out of 15 correct"),zt=n("<div class=past>"),qt=n("<div class=in_mode><button><span> Restart Quiz </span></button><button class=end2><span> End Quiz "),bt=n("<small> Your goal is to guess every move correctly to fill up the progress bar. "),wt=n("<div class=in_mode><button><span> Play all Moves </span></button><button><span> Play as Match "),kt=n("<h2>Play as Match"),Me=n("<small> End of practice. "),Pe=n("<small> Congratulations. "),yt=n("<div class=in_mode><button><span> Rematch </span></button><button class=end2><span> End Practice "),St=n("<h2>Play all moves"),Ct=n("<div class=in_mode><button><span> Clear </span></button><button class=end2><span> End Practice "),xt=n("<div class=repertoire><div class=list-wrap><h1 class=header>Repertoire</h1><div class=list><div><h3 class=title></h3></div><ul></ul></div></div><div class=board-wrap></div><div class=eval-gauge></div><div class=replay-wrap><div class=replay-header><div class=title><h5></h5><h4></h4></div><h3 class=progress>%</h3><h3 class=lichess><a target=_blank>lichess</a></h3></div><div class=replay><div class=replay-v></div><div class=branch-sums><button data-icon=></button><button data-icon=></button></div><div class=replay-jump><button data-icon=></button><button data-icon=></button><button data-icon=></button><button data-icon=></button></div><div class=tools><div class=tabs><h3>Practice</h3><h3>Quiz</h3></div><div class=content></div></div></div></div><div class=under><br><br><br>"),Et=n("<li><div><h3></h3> "),Mt=n('<div class=line><span class="fill white"></span><span class="fill black">'),Pt=n("<span class=index>"),Tt=n("<div class=fbt>"),Rt=n("<small>You will play the moves from the opening."),Dt=n("<small>If you go out of book, game ends."),jt=n("<div class=in_mode><button class=end2><span> End Deathmatch "),Te=n("<span class=failed>failed"),Lt=n("<h3>Quiz Mode"),Qt=n("<small>You are given 15 random positions from the opening."),It=n("<small>Guess the correct move."),Yt=n("<h2> of 15"),At=n("<div class=in_mode><button class=end2><span> End Quiz "),Nt=n("<span>"),Ot=n("<small> Try to guess the moves for <!>."),Ft=n("<small> AI will play the next move, picking a random variation. "),Gt=n("<small> Moves will be hidden once the game is started. "),Wt=n("<small>Try to guess the moves for both sides."),Bt=n("<small>Moves will be hidden once you start.");const Ht=["#afacc6","#0d2b45","#203c56","#544e68","#8d697a","#d08159"],Kt=m=>Ht[Math.floor((1-m/10)*6)],Ut=m=>`${Math.floor(m/2)+1}.`+(m%2===0?"..":"");class Vt{constructor(){S(this,"_mode");S(this,"_match_color");S(this,"_practice_end_result");S(this,"_quiz_quiz_ls_paths",[]);S(this,"_quiz_quiz_ls");S(this,"_quiz_deathmatch_fail");S(this,"_quiz_deathmatch_result_path");this._mode=y(void 0,{equals:!1}),this._match_color=y("white"),this._quiz_quiz_ls=y([],{equals:!1}),this._quiz_deathmatch_fail=y(0),this._quiz_deathmatch_result_path=y([]),this._practice_end_result=y(!1)}get mode(){return this._mode[0]()}set mode(s){this._mode[1](s)}get match_color(){return this._match_color[0]()}set match_color(s){this._match_color[1](s)}flip_match_color(){this.match_color=this.match_color==="white"?"black":"white"}get practice_end_result(){return this._practice_end_result[0]()}set practice_end_result(s){this._practice_end_result[1](s)}get i_quiz_quiz(){return this.quiz_quiz_ls.length+1}restart_match(){$(()=>{this.practice_end_result=!1,this.mode="match",this.flip_match_color()})}restart_moves(){$(()=>{this.practice_end_result=!1,this.mode="moves",this.flip_match_color()})}end_match_or_moves(){$(()=>{this.practice_end_result=!1,this.mode=void 0})}restart_quiz(){$(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz-quiz"})}end_quiz(){$(()=>{this.quiz_quiz_ls=[],this._quiz_quiz_ls_paths=[],this.mode="quiz"})}quiz_pass_one(s){$(()=>{this.quiz_quiz_ls.push(1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(s)})}quiz_fail_one(s){$(()=>{this.quiz_quiz_ls.push(-1),this.quiz_quiz_ls=this.quiz_quiz_ls,this._quiz_quiz_ls_paths.push(s)})}get quiz_pass(){return this.quiz_quiz_ls.filter(s=>s>0).length}get quiz_quiz_ls(){return this._quiz_quiz_ls[0]()}set quiz_quiz_ls(s){this._quiz_quiz_ls[1](s)}set quiz_deathmatch_fail_result(s){this._quiz_deathmatch_fail[1](s)}get quiz_deathmatch_fail_result(){return this._quiz_deathmatch_fail[0]()}get quiz_deathmatch_result_path(){return this._quiz_deathmatch_result_path[0]()}set quiz_deathmatch_result_path(s){this._quiz_deathmatch_result_path[1](s)}restart_deathmatch(){$(()=>{this.flip_match_color(),this.quiz_deathmatch_fail_result=0,this.mode="quiz-deathmatch"})}end_deathmatch(){$(()=>{this.quiz_deathmatch_fail_result=0,this.mode="quiz",this.flip_match_color()})}}const Re=m=>(()=>{var s=ct(),i=s.firstChild,h=i.nextSibling;return c(h,()=>`%${m.width}`),A(u=>H(i,`width: ${m.width}%`,u)),s})();class Jt{constructor(s){this.chapters=s}get progress(){let s=this.chapters.length;return this.chapters.map(i=>Math.round(i.progress/s)).reduce((i,h)=>i+h)}}class j{constructor(s,i,h,u){this.study_id=s,this.i_chapter=i,this.score_tree=h,this.solved_paths=u}static load_from_store(s,i){let h=new Se(s.id,i);return j.make(s.id,i,s.chapters[i].pgn.tree,re.set_for_saving(h.solved_paths))}static save_paths_to_store(s){let i=new Se(s.study_id,s.i_chapter);i.solved_paths=s.solved_paths.get_for_saving(),i.practice_progress=s.progress}static make(s,i,h,u=new re){return new j(s,i,it.make(h),u)}get clone(){return new j(this.study_id,this.i_chapter,this.score_tree,this.solved_paths.clone)}get progress(){return Math.round(this.solved_paths.paths.map(s=>k(()=>{var i;return(i=this.score_tree.get_at(s))==null?void 0:i.score})??0).reduce((s,i)=>s+i,0)*100)}get progress_map(){let s=k(()=>this.score_tree.progress_paths);const i=k(()=>s.map(h=>[h.filter(u=>u.length%2===1).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0),h.filter(u=>u.length%2===0).map(u=>this.score_tree.get_at(u).score).reduce((u,t)=>u+t,0)]));return s.map((h,u)=>{let t=h[0],z=h[h.length-1],E=i[u][0],N=i[u][1],I=g(()=>this.solved_paths.paths),M=g(()=>I().filter(v=>h.some(P=>P.join("")===v.join("")))),Y=g(()=>M().filter(v=>v.length%2===1).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0)),r=g(()=>M().filter(v=>v.length%2===0).map(v=>this.score_tree.get_at(v).score).reduce((v,P)=>v+P,0));return{color:Kt(t.length/20+z.length/10),total:E+N,black:g(()=>r()/N),white:g(()=>Y()/E),path:z}}).reverse()}clone_merge_stats(s){let i=k(()=>this.clone);return i.solved_paths.merge_dup(s.solved_paths),i}merge_and_save_stats(s){this.solved_paths.merge_dup(s.solved_paths),this.save_stats()}save_stats(){j.save_paths_to_store(this)}}const ns=()=>{const m=Ke(),[s]=Ue(m.id,tt.read_study);return(()=>{var i=ht();return c(i,d(x,{get when(){return!s.loading},fallback:"Loading...",get children(){return d(Xt,{get study(){return s()}})}})),i})()},Xt=m=>{const s=Ve(),i=()=>m.study;s.setVolume(.2);let[h,u]=y(!1),t=new Vt,z=new st;const[E,N]=y(nt.i_chapter??0);let I=g(()=>{const a=i();return new Jt(a.chapters.map((o,b)=>j.load_from_store(a,b)))}),M=g(()=>I().chapters[E()]);const Y=g(()=>i().chapters[E()]),r=g(()=>{t.mode;let a=Y();return at.make(a.pgn.tree.clone)}),v=g(()=>{if(t.mode==="quiz-quiz")return t.i_quiz_quiz===16}),[P,ae]=y(!1);q(()=>{if(t.mode==="quiz-quiz"){let a=v();t.quiz_quiz_ls[t.quiz_quiz_ls.length-1]<0&&(ae(!0),setTimeout(()=>{ae(!1)},500)),a?k(()=>{r().clear_failed_paths(),r()._hidden_paths.clear()}):(u(!0),setTimeout(()=>{$(()=>k(()=>{r().set_random_cursor_hide_rest(),t.match_color=r().cursor_after_color,u(!1)}))},100))}}),q(()=>{let{mode:a,match_color:o}=t;a==="quiz-deathmatch"&&o==="black"&&setTimeout(()=>{k(()=>{r().reveal_one_random()})},400)}),q(()=>{r().solved_paths.replace_all(M().solved_paths)});const O=g(()=>{let a=r().tree;return k(()=>j.make(i().name,E(),a,new re))});q(()=>{k(()=>O()).solved_paths.replace_all(r().solved_paths)});let le=g(()=>{let a=M(),o=O(),b=k(()=>a.progress);return a.clone_merge_stats(o).progress-b});q(C(()=>[M(),O()],(a,o)=>{if(o){let[b,T]=o;b.merge_and_save_stats(T)}})),q(C(()=>z.add_uci,a=>{if(h()||!a)return;r().try_next_uci_fail(a)?(ie(),t.mode==="quiz-quiz"&&t.quiz_pass_one(r().cursor_path)):((t.mode==="match"||t.mode==="moves")&&(u(!0),setTimeout(()=>{r().on_wheel(-1),u(!1)},100)),t.mode==="quiz-quiz"&&(t.quiz_fail_one(r().cursor_path.slice(0,-1)),s.play("error")),t.mode==="quiz-deathmatch"&&(t.quiz_deathmatch_fail_result=-1,t.quiz_deathmatch_result_path=r().cursor_path.slice(0,-1)))})),q(C(()=>t.quiz_deathmatch_fail_result,a=>{(a>0||a<0)&&s.play("victory")})),q(C(()=>t.practice_end_result,a=>{a&&s.play("victory")})),q(()=>{let{mode:a,match_color:o}=t;a==="match"&&o==="black"&&k(()=>{ie()})}),q(C(()=>r().fen_last_move,a=>{if(a){let[o,b]=a;z.on_set_fen_uci(o,b)}else z.on_set_fen_uci(_t)}));const ie=()=>{let a=()=>r().is_cursor_path_at_a_leaf;a()?t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=r().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0):(t.mode==="match"||t.mode==="quiz-deathmatch")&&(u(!0),setTimeout(()=>{r().reveal_one_random(),a()&&(t.mode==="quiz-deathmatch"?(t.quiz_deathmatch_fail_result=1,t.quiz_deathmatch_result_path=r().cursor_path):(t.mode==="match"||t.mode==="moves")&&(t.practice_end_result=!0)),u(!1)},400))};q(C(()=>z.on_wheel,a=>{a&&r().on_wheel(a)}));const _e=a=>{a.key==="f"&&t.flip_match_color()};q(C(()=>{var a;return(a=r().tree)==null?void 0:a.get_at(r().cursor_path)},a=>{a&&s.move(a)})),ke(()=>{document.addEventListener("keypress",_e)}),ye(()=>{document.removeEventListener("keypress",_e)});const ne=ot(a=>{const o=a.target;o.tagName!=="PIECE"&&o.tagName!=="SQUARE"&&o.tagName!=="CG-BOARD"||(a.preventDefault(),z.set_on_wheel(Math.sign(a.deltaY)))});q(()=>{t.match_color=i().orientation??"white"});const De=g(()=>O().progress_map);let K;ke(()=>{K.addEventListener("wheel",ne,{passive:!1})}),ye(()=>{K.removeEventListener("wheel",ne)});const oe=a=>{let o=t.mode;if(a==="practice"){if(o===void 0||o==="match"||o==="moves")return" active"}else if(o==="quiz"||o==="quiz-quiz"||o==="quiz-deathmatch")return" active";return""},je=g(()=>t.mode!==void 0&&!v()&&!t.practice_end_result),Le=g(C(()=>t.quiz_deathmatch_result_path,a=>{var T,L;let o=a.length,b=(L=(T=r().tree)==null?void 0:T.all_leaves.map(R=>R.path).filter(R=>!r().failed_paths.find(U=>U.join("")===R.join(""))).filter(R=>R.join("").startsWith(a.join("")))[0])==null?void 0:L.length;return`${o} out of ${b}`})),Qe=g(()=>r().collect_branch_sums(r().cursor_path));return(()=>{var a=xt(),o=a.firstChild,b=o.firstChild,T=b.nextSibling,L=T.firstChild,R=L.firstChild,U=L.nextSibling,ce=o.nextSibling,he=ce.nextSibling,Ie=he.nextSibling,ue=Ie.firstChild,de=ue.firstChild,me=de.firstChild,Ye=me.nextSibling,V=de.nextSibling,Ae=V.firstChild,Ne=V.nextSibling,Oe=Ne.firstChild,Fe=ue.nextSibling,pe=Fe.firstChild,J=pe.nextSibling,F=J.firstChild,X=F.nextSibling,ve=J.nextSibling,Z=ve.firstChild,ee=Z.nextSibling,te=ee.nextSibling,ge=te.nextSibling,Ge=ve.nextSibling,fe=Ge.firstChild,se=fe.firstChild,$e=se.nextSibling,We=fe.nextSibling;return Je(e=>K=e,a),c(R,()=>i().name),c(L,d(Re,{get width(){return I().progress}}),null),c(U,d(B,{get each(){return i().chapters},children:(e,l)=>(()=>{var _=Et(),p=_.firstChild,f=p.firstChild;return f.nextSibling,_.$$click=()=>N(l()),c(f,()=>e.name),c(p,d(Re,{get width(){var D;return((D=I())==null?void 0:D.chapters[l()].progress)??0}}),null),A(()=>w(_,l()===E()?"active":"")),_})()})),c(ce,d(rt,{get orientation(){return t.match_color},get movable(){return je()},get doPromotion(){return z.promotion},get onMoveAfter(){return z.on_move_after},get fen_uci(){return z.fen_uci},get color(){return z.turnColor},get dests(){return z.dests}})),c(he,d(B,{get each(){return De()},children:e=>(()=>{var l=Mt(),_=l.firstChild,p=_.nextSibling;return l.$$click=f=>r().try_set_cursor_path(e.path),A(f=>{var D=`background: ${e.color}; height: ${e.total*100}%`,G=`height: ${e.white()*100}%`,W=`height: ${e.black()*100}%`;return f.e=H(l,D,f.e),f.t=H(_,G,f.t),f.a=H(p,W,f.a),f},{e:void 0,t:void 0,a:void 0}),l})()})),c(me,()=>i().name),c(Ye,()=>Y().name),c(V,()=>M().progress,Ae),c(pe,d(lt,{get lala(){return r()}})),F.$$click=()=>r().navigate_up(),X.$$click=()=>r().navigate_down(),c(J,d(B,{get each(){return Qe()},children:e=>(()=>{var l=Tt();return l.$$click=()=>r().try_set_cursor_path(e.path),c(l,d(x,{get when(){return e.ply&1},get children(){var _=Pt();return c(_,()=>Ut(e.ply)),_}}),null),c(l,()=>e.san,null),l})()}),null),Z.$$click=()=>r().navigate_first(),ee.$$click=()=>r().navigate_prev(),te.$$click=()=>r().navigate_next(),ge.$$click=()=>r().navigate_last(),se.$$click=()=>t.end_match_or_moves(),$e.$$click=()=>t.mode="quiz",c(We,d(Xe,{get children(){return[d(Q,{get when(){return t.mode==="quiz"},get children(){return[Ce(),ut(),(()=>{var e=dt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="quiz-quiz",_.$$click=()=>t.mode="quiz-deathmatch",e})()]}}),d(Q,{get when(){return t.mode==="quiz-deathmatch"},get children(){return[mt(),d(x,{get when(){return t.quiz_deathmatch_fail_result!==0},get fallback(){return[Rt(),Dt(),(()=>{var e=jt(),l=e.firstChild;return l.$$click=()=>{$(()=>{let _=r().cursor_path;t.end_deathmatch(),r()._hidden_paths.clear(),r().cursor_path=_})},e})()]},get children(){return[(()=>{var e=pt();return e.firstChild,c(e,d(x,{get when(){return t.quiz_deathmatch_fail_result>0},get fallback(){return Te()},get children(){return[" ",xe()]}}),null),e})(),(()=>{var e=vt();return e.firstChild,c(e,Le,null),e})(),(()=>{var e=Ee(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,le,_),e})(),(()=>{var e=gt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_deathmatch(),_.$$click=()=>{$(()=>{let p=r().cursor_path;t.end_deathmatch(),r()._hidden_paths.clear(),r().cursor_path=p})},e})()]}})]}}),d(Q,{get when(){return t.mode==="quiz-quiz"},get children(){return d(x,{get when(){return v()},get fallback(){return[Lt(),Qt(),It(),(()=>{var e=Yt(),l=e.firstChild;return c(e,()=>t.i_quiz_quiz,l),A(()=>w(e,P()?"error":"")),e})(),(()=>{var e=At(),l=e.firstChild;return l.$$click=()=>{$(()=>{let _=r().cursor_path;t.end_quiz(),r()._hidden_paths.clear(),r().cursor_path=_})},e})()]},get children(){return[(()=>{var e=ft();return e.firstChild,c(e,d(x,{get when(){return t.quiz_pass>10},get fallback(){return Te()},get children(){return[" ",xe()]}}),null),e})(),(()=>{var e=$t(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,()=>t.quiz_pass,_),e})(),(()=>{var e=Ee(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,le,_),e})(),(()=>{var e=zt();return c(e,d(B,{get each(){return t.quiz_quiz_ls},children:(l,_)=>(()=>{var p=Nt();return p.$$click=()=>r().cursor_path=t._quiz_quiz_ls_paths[_()],w(p,"move "+(l>0?"success":"error")),c(p,()=>_()+1),p})()})),e})(),(()=>{var e=qt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_quiz(),_.$$click=()=>{$(()=>{let p=r().cursor_path;t.end_quiz(),r()._hidden_paths.clear(),r().cursor_path=p})},e})()]}})}}),d(Q,{get when(){return t.mode===void 0},get children(){return[Ce(),bt(),(()=>{var e=wt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.mode="moves",_.$$click=()=>t.mode="match",e})()]}}),d(Q,{get when(){return t.mode==="match"},get children(){return[kt(),d(x,{get when(){return t.practice_end_result},get fallback(){return[(()=>{var e=Ot(),l=e.firstChild,_=l.nextSibling;return _.nextSibling,c(e,()=>t.match_color,_),e})(),Ft(),Gt()]},get children(){return[Me(),Pe()]}}),(()=>{var e=yt(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>t.restart_match(),_.$$click=()=>{let p=r().cursor_path;t.end_match_or_moves(),r()._hidden_paths.clear(),r().cursor_path=p},e})()]}}),d(Q,{get when(){return t.mode==="moves"},get children(){return[St(),d(x,{get when(){return t.practice_end_result},get fallback(){return[Wt(),Bt()]},get children(){return[Me(),Pe()]}}),(()=>{var e=Ct(),l=e.firstChild,_=l.nextSibling;return l.$$click=()=>{t.restart_moves()},_.$$click=()=>t.end_match_or_moves(),e})()]}})]}})),A(e=>{var l=Y().site,_=h()||!r().can_navigate_up,p="fbt prev"+(!h()&&r().can_navigate_up?"":" disabled"),f=h()||!r().can_navigate_down,D="fbt prev"+(!h()&&r().can_navigate_down?"":" disabled"),G="fbt first"+(!h()&&r().can_navigate_prev?"":" disabled"),W="fbt prev"+(!h()&&r().can_navigate_prev?"":" disabled"),ze="fbt next"+(!h()&&r().can_navigate_next?"":" disabled"),qe="fbt last"+(!h()&&r().can_navigate_next?"":" disabled"),be="tab"+oe("practice"),we="tab"+oe("quiz");return l!==e.e&&Ze(Oe,"href",e.e=l),_!==e.t&&(F.disabled=e.t=_),p!==e.a&&w(F,e.a=p),f!==e.o&&(X.disabled=e.o=f),D!==e.i&&w(X,e.i=D),G!==e.n&&w(Z,e.n=G),W!==e.s&&w(ee,e.s=W),ze!==e.h&&w(te,e.h=ze),qe!==e.r&&w(ge,e.r=qe),be!==e.d&&w(se,e.d=be),we!==e.l&&w($e,e.l=we),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),a})()};et(["click"]);export{ns as default};
